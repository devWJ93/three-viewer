{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index.vue?7a6b","webpack:///./src/libs/threejs/controls/OrbitControls.js","webpack:///./src/modules/environment/zlib.js","webpack:///./src/modules/environment/EnvironmentCubeMap.js","webpack:///./src/modules/environment/EnvironmentPanorama.js","webpack:///./src/modules/environment/IntegrateBRDFMap.js","webpack:///./src/modules/environment/EnvironmentSphericalHarmonics.js","webpack:///./src/modules/environment/requestFile.js","webpack:///./src/modules/environment/fileHelper.js","webpack:///./src/modules/environment/Environment.js","webpack:///./src/shaders/pbrVS.glsl","webpack:///./src/shaders/pbrFS.glsl","webpack:///./src/const/defaultParams.js","webpack:///./src/js/PBRMaterial.js","webpack:///./src/modules/background/shaders/backgroundVS.glsl","webpack:///./src/modules/background/shaders/backgroundFS.glsl","webpack:///./src/modules/background/BackgroundMaterial.js","webpack:///./src/modules/background/Background.js","webpack:///./src/const/config.js","webpack:///./src/js/ThreeUtils.js","webpack:///./src/js/Utils.js","webpack:///./src/libs/threejs/libs/dat.gui.module.js","webpack:///./src/js/ModelViewer.js","webpack:///./src/MainScene.js","webpack:///./src/libs/threejs/loaders/GLTFLoader.js","webpack:///./src/js/Loader.js","webpack:///src/index.vue","webpack:///./src/index.vue?d6be","webpack:///./src/index.vue","webpack:///./src/main.js","webpack:///./src/index.vue?420c"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","_v","directives","rawName","expression","_m","on","loadDefaultMode","staticRenderFns","OrbitControls","domElement","undefined","console","warn","document","error","enabled","target","Vector3","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","Math","PI","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","keys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","clone","position0","position","zoom0","zoom","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","scope","copy","reset","updateProjectionMatrix","dispatchEvent","changeEvent","update","state","STATE","NONE","offset","quat","Quaternion","setFromUnitVectors","up","quatInverse","inverse","lastPosition","lastQuaternion","sub","applyQuaternion","setFromVector3","rotateLeft","getAutoRotationAngle","sphericalDelta","max","min","makeSafe","radius","scale","addScaledVector","panOffset","add","setFromSpherical","lookAt","multiplyScalar","set","zoomChanged","distanceToSquared","EPS","dot","quaternion","dispose","removeEventListener","onContextMenu","onMouseDown","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","onMouseMove","onMouseUp","onKeyDown","type","startEvent","endEvent","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","pow","angle","rotateUp","panLeft","v","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","matrix","isOrthographicCamera","right","left","clientWidth","top","bottom","dollyIn","dollyScale","dollyOut","handleMouseDownRotate","event","clientX","clientY","handleMouseDownDolly","handleMouseDownPan","handleMouseMoveRotate","subVectors","x","y","handleMouseMoveDolly","handleMouseMovePan","handleMouseUp","handleMouseWheel","handleKeyDown","needsUpdate","keyCode","preventDefault","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchStartDollyPan","handleTouchStartDollyRotate","handleTouchMoveRotate","handleTouchMovePan","handleTouchMoveDolly","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","handleTouchEnd","focus","button","ctrlKey","metaKey","shiftKey","addEventListener","stopPropagation","DOLLY_ROTATE","tabIndex","EventDispatcher","constructor","MapControls","zlib","Zlib","isGunzipBuffer","arrayBuffer","typedArray","Uint8Array","gunzip","zdec","Gunzip","decompress","buffer","CubeMapEnv","size","options","_options","_size","_data","src","dst","npixel","npixel2","npixel3","idx","readInputArray","inputArray","maxLevel","log","LN2","images","byteSize","byteLength","face","imageData","deinterleave","deinterleaveImage4","_packedImages","createRGBA8Packed","cubeTextures","packedImages","numMips","textureEncoding","THREE","mip","cubeTexture","format","encoding","minFilter","magFilter","generateMipmaps","dataTexture","texture","image","mipmaps","PanoramaEnv","_texture","flipY","IntegrateBRDF","EnvironmentSphericalHarmonics","file","_file","initSHCoef","sphCoef","_sphCoef","coef0","coef1","coef2","coef3","coef4","coef5","coef6","coef7","coef8","coef","map","index","_uniformSpherical","Float32Array","requestFileFromURL","url","Promise","resolve","reject","req","XMLHttpRequest","open","responseType","toLowerCase","progress","response","responseText","send","requestFileFromReader","reader","FileReader","onload","readAsArrayBuffer","readAsText","readAsDataURL","requestFile","urlOrFile","zip","mimeTypes","Map","isString","str","String","isBlobURL","substr","isHttpURL","isURL","createImageFromURL","img","Image","onerror","createImageFromBlob","blob","privateURL","URL","createObjectURL","promise","revokeObjectURL","createArrayBufferFromBlob","fr","createArrayBufferFromURL","createJSONFromURL","then","string","JSON","parse","createJSONFromString","obj","fileHelper","requestURI","requestResource","uri","extension","getExtension","mimetype","getMimeType","match","resolveData","createData","Blob","resolveFilesMap","filesMap","promises","filename","fname","dataResolved","all","_unzipEntry","entry","Writer","BlobWriter","TextWriter","getData","unzipBlob","filePromises","createReader","BlobReader","zipReader","getEntries","entries","directory","close","filesMapResolved","unzip","input","ArrayBuffer","lastIndexOf","addMimeTypeForExtension","mimeType","has","Environment","viewer","renderer","isMobile","_config","_files","ctx","context","textureLODSupport","configSrc","config","init","results","getTextures","limitSize","textures","filter","envMapFormat","textureData","getImage","mapFile","mapSize","width","mapData","mapEnv","EnvironmentCubeMap","EnvironmentPanorama","loadPacked","minTextureSize","nbLod","maxLod","uEnvironmentLodRange","uEnvironmentSize","lutTextureData","lutFile","lutSize","lutData","_integrateBRDF","IntegrateBRDFMap","uIntegrateBRDF","bgTextureData","bgFile","bgSize","bgData","backgroundEnv","uBGEnvironmentSize","_spherical","diffuseSPH","uEnvironmentSphericalHarmonics","Lights","sunlight","sunlightInfo","color","fromArray","direction","negate","intensity","luminosity","syncMapArr","syncUniformArr","bgDefaultUniforms","uBrightness","uEnvironmentTransform","pbrDefaultUniforms","roughness","metalness","emissive","uSpecularPeak","uOcclusionHorizon","pbrDefaultDefines","ENABLE_IBL","ENABLE_LIGHT","DIFFUSE_LAMBERT","NDF_GGX","F_SCHLICK","V_SMITHJOINTAPPROX","PBRMaterial","mesh","environment","uniformsOpt","sourceMaterial","material","modelNormalMatrix","defines","assign","normalMapType","UniformsLib","uniforms","merge","common","normalmap","lightmap","bumpmap","roughnessmap","metalnessmap","aomap","emissivemap","displacementmap","envmap","fog","lights","shadowDepthRange","syncEnvSetting","syncParam","vertexShader","pbrVS","fragmentShader","pbrFS","isGLTFSpecularGlossinessMaterial","initSGWorkflow","onBeforeRender","getNormalMatrix","matrixWorld","envMap","forEach","diffuse","Color","_extraUniforms","specular","glossiness","specularMap","glossinessMap","BackgroundMaterial","uEnvBrightness","debug","backgroundVS","backgroundFS","side","depthTest","Background","sphere","setScalar","envMapPath","envMapList","diffuseEquation","specularFresnelEquation","specularNDFEquation","specularVisEquation","toneMappingList","adjustCameraByBox","camera","controls","factor","box","setFromObject","getSize","maxSize","z","fitHeightDistance","atan","fitWidthDistance","aspect","near","far","adjustSunLightByBox","light","scene","shadow","height","lightCamera","updateMatrixWorld","cameraInverseMatrix","getInverse","applyMatrix4","bias","helper","helper1","getEleWidth","res","currentStyle","getComputedStyle","indexOf","getEleHeight","e","test","navigator","userAgent","___$insertStyle","css","style","createElement","setAttribute","innerHTML","head","appendChild","colorToString","forceCSSHex","colorFormat","__state","conversionName","toString","round","g","b","a","h","toFixed","hex","ARR_EACH","Array","ARR_SLICE","Common","BREAK","extend","each","arguments","isObject","isUndefined","defaults","compose","toCall","args","itr","_key","defer","fnc","setTimeout","debounce","func","threshold","callImmediately","timeout","delayed","callNow","clearTimeout","toArray","isNull","isNaN","_isNaN","isArray","isNumber","isBoolean","isFunction","INTERPRETATIONS","litmus","conversions","THREE_CHAR_HEX","read","original","space","parseInt","write","SIX_CHAR_HEX","CSS_RGB","parseFloat","CSS_RGBA","HEX","RGB_ARRAY","RGBA_ARRAY","RGBA_OBJ","RGB_OBJ","HSVA_OBJ","HSV_OBJ","toReturn","interpret","family","conversion","tmpComponent","ColorMath","hsv_to_rgb","hi","floor","f","q","rgb_to_hsv","delta","NaN","rgb_to_hex","hex_with_component","component_from_hex","componentIndex","_typeof","iterator","classCallCheck","instance","Constructor","TypeError","createClass","defineProperties","props","descriptor","configurable","writable","protoProps","staticProps","receiver","Function","desc","getOwnPropertyDescriptor","parent","getPrototypeOf","inherits","subClass","superClass","setPrototypeOf","__proto__","possibleConstructorReturn","self","ReferenceError","Error","defineRGBComponent","component","componentHexIndex","recalculateRGB","defineHSVComponent","recalculateHSV","COMPONENTS","Controller","initialValue","__onChange","__onFinishChange","newValue","updateDisplay","getValue","EVENT_MAP","HTMLEvents","MouseEvents","KeyboardEvents","EVENT_MAP_INV","k","CSS_VALUE_PIXELS","cssValueToPixels","val","dom","makeSelectable","elem","selectable","onselectstart","MozUserSelect","KhtmlUserSelect","unselectable","makeFullscreen","hor","vert","vertical","horizontal","fakeEvent","eventType","pars","aux","params","className","evt","createEvent","initMouseEvent","bubbles","cancelable","clickCount","initKeyboardEvent","initKeyEvent","altKey","charCode","initEvent","newBool","bool","attachEvent","unbind","detachEvent","addClass","classes","split","join","replace","removeClass","removeAttribute","hasClass","RegExp","getWidth","getHeight","getOffset","el","offsetParent","offsetLeft","offsetTop","isActive","activeElement","href","BooleanController","_Controller","_this2","_this","onChange","setValue","__prev","__checkbox","checked","OptionController","opts","__select","opt","desiredValue","selectedIndex","StringController","__input","onBlur","blur","numDecimals","_x","NumberController","_params","__min","__max","__step","step","__impliedStep","abs","LN10","__precision","minValue","maxValue","stepValue","roundToDecimal","decimals","tenTo","NumberControllerBox","_NumberController","__truncationSuspended","prevY","attempted","onFinish","onMouseDrag","diff","i1","i2","o1","o2","NumberControllerSlider","bgRect","__background","getBoundingClientRect","__foreground","pct","FunctionController","text","__button","fire","ColorController","__color","__temp","__selector","__saturation_field","__field_knob","__field_knob_border","__hue_knob","__hue_field","__input_textShadow","valueField","fieldDown","setSV","fieldUpSV","fieldDownH","setH","fieldUpH","toOriginal","fieldRect","_ref","_ref2","padding","backgroundColor","boxShadow","border","borderRadius","zIndex","borderRight","marginRight","display","cursor","background","linearGradient","hueGradient","outline","textAlign","fontWeight","textShadow","mismatch","flip","_flip","marginLeft","marginTop","toHexString","vendors","vendor","cssText","load","indoc","doc","link","rel","getElementsByTagName","inject","cssContent","injected","saveDialogContents","ControllerFactory","requestAnimationFrame","callback","requestAnimationFrame$1","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","CenteredDiv","backgroundElement","opacity","WebkitTransition","transition","body","hide","webkitTransform","layout","innerWidth","innerHeight","styleSheet","CSS_NAMESPACE","HIDE_KEY_CODE","CLOSE_BUTTON_HEIGHT","DEFAULT_DEFAULT_PRESET_NAME","SUPPORTS_LOCAL_STORAGE","localStorage","SAVE_DIALOGUE","autoPlaceVirgin","autoPlaceContainer","hideableGuis","GUI","__ul","__folders","__controllers","__rememberedObjects","__rememberedObjectIndecesToControllers","__listening","closeOnTop","autoPlace","DEFAULT_WIDTH","resizable","hideable","preset","scrollable","useLocalStorage","getItem","getLocalStorageHash","saveToLocalStorage","titleRow","getRoot","setPresetSelectIndex","revert","setWidth","closed","CLASS_CLOSED","onResize","__closeButton","TEXT_OPEN","TEXT_CLOSED","setItem","CLASS_MAIN","savedGui","CLASS_CLOSE_BUTTON","CLASS_CLOSE_TOP","insertBefore","childNodes","CLASS_CLOSE_BOTTOM","titleRowName","createTextNode","addRow","onClickTitle","resetWidth","root","CLASS_AUTO_PLACE_CONTAINER","CLASS_AUTO_PLACE","__resizeHandler","onResizeDebounced","addResizeHandle","stringify","getSaveObject","saveToLocalStorageIfPossible","gui","newDom","liBefore","li","removeListeners","markPresetModified","modified","__preset_select","augmentController","controller","__li","__gui","nextSibling","nextElementSibling","remove","_add","before","factoryArgs","_nextSibling","_name","firstElementChild","listen","method","pc","pb","returned","oldName","wasListening","newController","borderLeftColor","isModified","recallSavedValue","matchedIndex","controllerMap","remembered","presetMap","concat","container","CLASS_CONTROLLER_ROW","location","addPresetOption","setSelected","showHideExplain","explain","addSaveMenu","div","__save_row","firstChild","gears","button2","button3","select","getElementById","localStorageCheckBox","saveLocally","newConstructorTextArea","which","show","save","presetName","prompt","saveAs","pmouseX","drag","dragStop","CLASS_DRAG","dragStart","__resize_handle","w","getCurrentPreset","useInitialValues","savedValues","updateDisplays","controllerArray","toggleHide","CLASS_TOO_TALL","_keydownHandler","addColor","removeChild","destroy","subfolder","removeFolder","addFolder","newGuiParams","folders","folder","parentElement","node","offsetHeight","remember","GUI$1","ModelViewer","mainScene","gltf","callBack","gltfScene","time","envRotation","envRotationMat","makeRotationY","envBrightness","toneMapping","control","initScene","envMapName","envMapSrc","loadPackage","sunLight","castShadow","loadEnvMap","loadSunLight","sunLightStartPos","loadBackground","traverse","child","isMesh","adjustFactorFromBox","receiveShadow","uEnableIBL","enableIBL","uEnableLight","enableLight","initGUI","center","getCenter","boxObj","setSize","lastMousePosition","guiParams","pbrFolder","reCompileShader","querySelector","classList","updateEnvMap","equationsFolder","postFolder","reg","toUpperCase","updateBG","setDefinesFromGUI","resultSunlight","updateEnvironmentRotation","render","MainScene","antialias","id","setPixelRatio","devicePixelRatio","gammaFactor","setClearColor","shadowMap","initEvents","modelViewer","loaded","onWindowResize","animete","GLTFLoader","manager","Loader","dracoLoader","ddsLoader","GLTFRegistry","objects","removeAll","onLoad","onProgress","onError","resourcePath","path","LoaderUtils","extractUrlBase","itemStart","_onError","itemError","itemEnd","loader","FileLoader","setPath","setResponseType","crossOrigin","setWithCredentials","setDRACOLoader","setDDSLoader","content","extensions","magic","decodeText","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","GLTFBinaryExtension","json","asset","version","extensionsUsed","extensionName","extensionsRequired","KHR_LIGHTS_PUNCTUAL","GLTFLightsExtension","KHR_MATERIALS_UNLIT","GLTFMaterialsUnlitExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","GLTFMaterialsPbrSpecularGlossinessExtension","KHR_DRACO_MESH_COMPRESSION","GLTFDracoMeshCompressionExtension","MSFT_TEXTURE_DDS","GLTFTextureDDSExtension","KHR_TEXTURE_TRANSFORM","GLTFTextureTransformExtension","KHR_MESH_QUANTIZATION","GLTFMeshQuantizationExtension","parser","GLTFParser","lightDefs","loadLight","lightIndex","lightNode","lightDef","range","DirectionalLight","PointLight","SpotLight","spot","innerConeAngle","outerConeAngle","penumbra","decay","getMaterialType","MeshBasicMaterial","extendParams","materialParams","materialDef","pending","metallicRoughness","pbrMetallicRoughness","baseColorFactor","array","baseColorTexture","assignTexture","BINARY_EXTENSION_HEADER_LENGTH","BINARY_EXTENSION_CHUNK_TYPES","BIN","headerView","DataView","header","getUint32","chunkView","chunkIndex","chunkLength","chunkType","contentArray","byteOffset","preload","GLTFMeshStandardSGMaterial","MeshStandardMaterial","specularMapParsFragmentChunk","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","setHex","onBeforeCompile","shader","uniformName","USE_GLOSSINESSMAP","USE_ROUGHNESSMAP","metalnessMap","roughnessMap","setValues","specularGlossinessParams","pbrSpecularGlossiness","diffuseFactor","diffuseTexture","glossinessFactor","specularFactor","specularGlossinessTexture","specGlossMapDef","createMaterial","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","TangentSpaceNormalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMapIntensity","refractionRatio","GLTFCubicSplineInterpolant","parameterPositions","sampleValues","sampleSize","resultBuffer","Interpolant","decodePrimitive","primitive","bufferViewIndex","bufferView","gltfAttributeMap","attributes","threeAttributeMap","attributeNormalizedMap","attributeTypeMap","attributeName","threeAttributeName","ATTRIBUTES","accessorDef","accessors","componentType","WEBGL_COMPONENT_TYPES","normalized","getDependency","decodeDracoFile","geometry","attribute","extendTexture","transform","rotation","repeat","texCoord","source","copySampleValue_","values","valueSize","beforeStart_","afterEnd_","interpolate_","t0","t1","stride","stride2","stride3","td","pp","ppp","offset1","offset0","s2","s3","s0","s1","p0","m0","p1","m1","WEBGL_CONSTANTS","FLOAT","FLOAT_MAT3","FLOAT_MAT4","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","LINEAR","REPEAT","SAMPLER_2D","POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN","UNSIGNED_BYTE","UNSIGNED_SHORT","5120","Int8Array","5121","5122","Int16Array","5123","Uint16Array","5125","Uint32Array","5126","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipmapNearestFilter","9985","LinearMipmapNearestFilter","9986","NearestMipmapLinearFilter","9987","LinearMipmapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","RepeatWrapping","WEBGL_TYPE_SIZES","POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","WEIGHTS_0","JOINTS_0","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","OPAQUE","MASK","BLEND","MIME_TYPE_FORMATS","RGBAFormat","RGBFormat","resolveURL","createDefaultMaterial","cache","transparent","FrontSide","addUnknownExtensionsToUserData","knownExtensions","objectDef","userData","gltfExtensions","assignExtrasToUserData","gltfDef","extras","addMorphTargets","targets","hasMorphPosition","hasMorphNormal","il","pendingPositionAccessors","pendingNormalAccessors","pendingAccessor","normal","morphPositions","morphNormals","morphAttributes","morphTargetsRelative","updateMorphTargets","meshDef","morphTargetInfluences","targetNames","morphTargetDictionary","createPrimitiveKey","primitiveDef","geometryKey","dracoExtension","indices","createAttributesKey","attributesKey","sort","primitiveCache","textureLoader","TextureLoader","setCrossOrigin","fileLoader","computeBounds","Box3","accessor","vector","setX","setY","setZ","expandByVector","boundingBox","Sphere","distanceTo","boundingSphere","addPrimitiveAttributes","assignAttributeAccessor","accessorIndex","gltfAttributeName","setIndex","toTrianglesDrawMode","drawMode","getIndex","getAttribute","count","numberOfTriangles","newIndices","TriangleFanDrawMode","getX","newGeometry","markDefs","getDependencies","dependencies","scenes","animations","cameras","nodeDefs","nodes","skinDefs","skins","meshDefs","meshes","meshReferences","meshUses","skinIndex","skinLength","joints","isBone","nodeIndex","nodeLength","nodeDef","skin","isSkinnedMesh","cacheKey","dependency","loadScene","loadNode","loadMesh","loadAccessor","loadBufferView","loadBuffer","loadMaterial","loadTexture","loadSkin","loadAnimation","loadCamera","defs","def","bufferIndex","bufferDef","buffers","bufferViewDef","bufferViews","sparse","pendingBufferViews","bufferAttribute","itemSize","TypedArray","elementBytes","BYTES_PER_ELEMENT","itemBytes","byteStride","ibSlice","ibCacheKey","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","SCALAR","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setW","textureIndex","webkitURL","textureDef","textureExtensions","sourceURI","isObjectURL","getHandler","samplers","sampler","wrapS","wrapT","mapName","mapDef","isCompressedTexture","assignFinalMaterial","useVertexTangents","tangent","useVertexColors","useFlatShading","useSkinning","useMorphTargets","useMorphNormals","isPoints","uuid","pointsMaterial","PointsMaterial","Material","sizeAttenuation","isLine","lineMaterial","LineBasicMaterial","cachedMaterial","skinning","vertexTangents","vertexColors","VertexColors","flatShading","morphTargets","uv2","uv","materialIndex","materialType","materials","materialExtensions","sgExtension","kmuExtension","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","DoubleSide","alphaMode","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","sRGBEncoding","loadGeometries","primitives","createDracoPrimitive","geometryPromise","cached","BufferGeometry","meshIndex","geometries","SkinnedMesh","Mesh","skinWeight","normalizeSkinWeights","TriangleStripDrawMode","LineSegments","Line","LineLoop","Points","group","Group","cameraIndex","cameraDef","PerspectiveCamera","MathUtils","radToDeg","yfov","aspectRatio","znear","zfar","OrthographicCamera","xmag","ymag","skinDef","skinEntry","inverseBindMatrices","animationIndex","animationDef","pendingNodes","pendingInputAccessors","pendingOutputAccessors","pendingSamplers","pendingTargets","channels","channel","parameters","output","inputAccessors","outputAccessors","tracks","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","matrixAutoUpdate","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","interpolation","outputArray","scaled","jl","track","createInterpolant","times","getValueSize","isInterpolantFactoryMethodGLTFCubicSpline","AnimationClip","instanceNum","Bone","Object3D","PropertyBinding","sanitizeNodeName","Matrix4","buildNodeHierachy","nodeId","parentObject","pendingJoints","jointNodes","bones","boneInverses","jointNode","mat","Skeleton","children","sceneIndex","sceneDef","Scene","nodeIds","fileMap","rootFile","rootPath","from","fileURL","loadLocalGLTF","assetMap","baseURL","setURLModifier","normalizedURL","blobURL","blobURLs","fileName","Vue","App","$mount"],"mappings":"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","file":"js/app.5c55c82a.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/three-viewer/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"isLoading\",attrs:{\"id\":\"wrapper\"}},[_c('div',{attrs:{\"id\":\"canvasContainer\"}}),_c('p',{staticClass:\"loadingText\"},[_vm._v(\"Loading...\")]),_c('main',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.openImportPage),expression:\"openImportPage\"}],staticClass:\"dropWrap\"},[_c('div',{staticClass:\"dropzone\"},[_c('div',{staticClass:\"innerArea\"},[_vm._m(0),_c('div',{staticClass:\"btnArea\"},[_c('div',{staticClass:\"uploadBtn\"},[_c('input',{attrs:{\"type\":\"file\",\"name\":\"file-input[]\",\"id\":\"file-input\",\"multiple\":\"\"}}),_c('label',{attrs:{\"for\":\"file-input\"}},[_c('svg',{attrs:{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"20\",\"height\":\"17\",\"viewBox\":\"0 0 20 17\"}},[_c('path',{attrs:{\"d\":\"M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z\"}})]),_c('span',[_vm._v(\"Upload\")])])]),_c('div',{staticClass:\"uploadBtn\",on:{\"click\":_vm.loadDefaultMode}},[_c('span',[_vm._v(\"Defalut(3.5MB)\")])])])])])])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"placeholder\"},[_c('p',[_vm._v(\"Please drag the glTF file or folder (zip supported) to this page\")])])}]\n\nexport { render, staticRenderFns }","/**\r\n * @author qiao / https://github.com/qiao\r\n * @author mrdoob / http://mrdoob.com\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author erich666 / http://erichaines.com\r\n * @author ScieCode / http://github.com/sciecode\r\n */\r\n\r\nimport {\r\n\tEventDispatcher,\r\n\tMOUSE,\r\n\tQuaternion,\r\n\tSpherical,\r\n\tTOUCH,\r\n\tVector2,\r\n\tVector3\r\n} from \"three\";\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n//\r\n//    Orbit - left mouse / touch: one-finger move\r\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\r\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\r\n\r\nvar OrbitControls = function ( object, domElement ) {\r\n\r\n\tif ( domElement === undefined ) console.warn( 'THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.' );\r\n\tif ( domElement === document ) console.error( 'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\r\n\r\n\tthis.object = object;\r\n\tthis.domElement = domElement;\r\n\r\n\t// Set to false to disable this control\r\n\tthis.enabled = true;\r\n\r\n\t// \"target\" sets the location of focus, where the object orbits around\r\n\tthis.target = new Vector3();\r\n\r\n\t// How far you can dolly in and out ( PerspectiveCamera only )\r\n\tthis.minDistance = 0;\r\n\tthis.maxDistance = Infinity;\r\n\r\n\t// How far you can zoom in and out ( OrthographicCamera only )\r\n\tthis.minZoom = 0;\r\n\tthis.maxZoom = Infinity;\r\n\r\n\t// How far you can orbit vertically, upper and lower limits.\r\n\t// Range is 0 to Math.PI radians.\r\n\tthis.minPolarAngle = 0; // radians\r\n\tthis.maxPolarAngle = Math.PI; // radians\r\n\r\n\t// How far you can orbit horizontally, upper and lower limits.\r\n\t// If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\r\n\tthis.minAzimuthAngle = - Infinity; // radians\r\n\tthis.maxAzimuthAngle = Infinity; // radians\r\n\r\n\t// Set to true to enable damping (inertia)\r\n\t// If damping is enabled, you must call controls.update() in your animation loop\r\n\tthis.enableDamping = false;\r\n\tthis.dampingFactor = 0.05;\r\n\r\n\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\r\n\t// Set to false to disable zooming\r\n\tthis.enableZoom = true;\r\n\tthis.zoomSpeed = 1.0;\r\n\r\n\t// Set to false to disable rotating\r\n\tthis.enableRotate = true;\r\n\tthis.rotateSpeed = 1.0;\r\n\r\n\t// Set to false to disable panning\r\n\tthis.enablePan = true;\r\n\tthis.panSpeed = 1.0;\r\n\tthis.screenSpacePanning = false; // if true, pan in screen-space\r\n\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\r\n\r\n\t// Set to true to automatically rotate around the target\r\n\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\r\n\tthis.autoRotate = false;\r\n\tthis.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\r\n\r\n\t// Set to false to disable use of the keys\r\n\tthis.enableKeys = true;\r\n\r\n\t// The four arrow keys\r\n\tthis.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\r\n\r\n\t// Mouse buttons\r\n\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\r\n\r\n\t// Touch fingers\r\n\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\r\n\r\n\t// for reset\r\n\tthis.target0 = this.target.clone();\r\n\tthis.position0 = this.object.position.clone();\r\n\tthis.zoom0 = this.object.zoom;\r\n\r\n\t//\r\n\t// public methods\r\n\t//\r\n\r\n\tthis.getPolarAngle = function () {\r\n\r\n\t\treturn spherical.phi;\r\n\r\n\t};\r\n\r\n\tthis.getAzimuthalAngle = function () {\r\n\r\n\t\treturn spherical.theta;\r\n\r\n\t};\r\n\r\n\tthis.saveState = function () {\r\n\r\n\t\tscope.target0.copy( scope.target );\r\n\t\tscope.position0.copy( scope.object.position );\r\n\t\tscope.zoom0 = scope.object.zoom;\r\n\r\n\t};\r\n\r\n\tthis.reset = function () {\r\n\r\n\t\tscope.target.copy( scope.target0 );\r\n\t\tscope.object.position.copy( scope.position0 );\r\n\t\tscope.object.zoom = scope.zoom0;\r\n\r\n\t\tscope.object.updateProjectionMatrix();\r\n\t\tscope.dispatchEvent( changeEvent );\r\n\r\n\t\tscope.update();\r\n\r\n\t\tstate = STATE.NONE;\r\n\r\n\t};\r\n\r\n\t// this method is exposed, but perhaps it would be better if we can make it private...\r\n\tthis.update = function () {\r\n\r\n\t\tvar offset = new Vector3();\r\n\r\n\t\t// so camera.up is the orbit axis\r\n\t\tvar quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\r\n\t\tvar quatInverse = quat.clone().inverse();\r\n\r\n\t\tvar lastPosition = new Vector3();\r\n\t\tvar lastQuaternion = new Quaternion();\r\n\r\n\t\treturn function update() {\r\n\r\n\t\t\tvar position = scope.object.position;\r\n\r\n\t\t\toffset.copy( position ).sub( scope.target );\r\n\r\n\t\t\t// rotate offset to \"y-axis-is-up\" space\r\n\t\t\toffset.applyQuaternion( quat );\r\n\r\n\t\t\t// angle from z-axis around y-axis\r\n\t\t\tspherical.setFromVector3( offset );\r\n\r\n\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\r\n\r\n\t\t\t\trotateLeft( getAutoRotationAngle() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( scope.enableDamping ) {\r\n\r\n\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\r\n\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tspherical.theta += sphericalDelta.theta;\r\n\t\t\t\tspherical.phi += sphericalDelta.phi;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// restrict theta to be between desired limits\r\n\t\t\tspherical.theta = Math.max( scope.minAzimuthAngle, Math.min( scope.maxAzimuthAngle, spherical.theta ) );\r\n\r\n\t\t\t// restrict phi to be between desired limits\r\n\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\r\n\r\n\t\t\tspherical.makeSafe();\r\n\r\n\r\n\t\t\tspherical.radius *= scale;\r\n\r\n\t\t\t// restrict radius to be between desired limits\r\n\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\r\n\r\n\t\t\t// move target to panned location\r\n\r\n\t\t\tif ( scope.enableDamping === true ) {\r\n\r\n\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tscope.target.add( panOffset );\r\n\r\n\t\t\t}\r\n\r\n\t\t\toffset.setFromSpherical( spherical );\r\n\r\n\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\r\n\t\t\toffset.applyQuaternion( quatInverse );\r\n\r\n\t\t\tposition.copy( scope.target ).add( offset );\r\n\r\n\t\t\tscope.object.lookAt( scope.target );\r\n\r\n\t\t\tif ( scope.enableDamping === true ) {\r\n\r\n\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\r\n\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\r\n\r\n\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tsphericalDelta.set( 0, 0, 0 );\r\n\r\n\t\t\t\tpanOffset.set( 0, 0, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tscale = 1;\r\n\r\n\t\t\t// update condition is:\r\n\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\r\n\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\r\n\r\n\t\t\tif ( zoomChanged ||\r\n\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\r\n\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\r\n\r\n\t\t\t\tscope.dispatchEvent( changeEvent );\r\n\r\n\t\t\t\tlastPosition.copy( scope.object.position );\r\n\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\r\n\t\t\t\tzoomChanged = false;\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\tthis.dispose = function () {\r\n\r\n\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu, false );\r\n\t\tscope.domElement.removeEventListener( 'mousedown', onMouseDown, false );\r\n\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel, false );\r\n\r\n\t\tscope.domElement.removeEventListener( 'touchstart', onTouchStart, false );\r\n\t\tscope.domElement.removeEventListener( 'touchend', onTouchEnd, false );\r\n\t\tscope.domElement.removeEventListener( 'touchmove', onTouchMove, false );\r\n\r\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\r\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\r\n\r\n\t\tscope.domElement.removeEventListener( 'keydown', onKeyDown, false );\r\n\r\n\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\r\n\r\n\t};\r\n\r\n\t//\r\n\t// internals\r\n\t//\r\n\r\n\tvar scope = this;\r\n\r\n\tvar changeEvent = { type: 'change' };\r\n\tvar startEvent = { type: 'start' };\r\n\tvar endEvent = { type: 'end' };\r\n\r\n\tvar STATE = {\r\n\t\tNONE: - 1,\r\n\t\tROTATE: 0,\r\n\t\tDOLLY: 1,\r\n\t\tPAN: 2,\r\n\t\tTOUCH_ROTATE: 3,\r\n\t\tTOUCH_PAN: 4,\r\n\t\tTOUCH_DOLLY_PAN: 5,\r\n\t\tTOUCH_DOLLY_ROTATE: 6\r\n\t};\r\n\r\n\tvar state = STATE.NONE;\r\n\r\n\tvar EPS = 0.000001;\r\n\r\n\t// current position in spherical coordinates\r\n\tvar spherical = new Spherical();\r\n\tvar sphericalDelta = new Spherical();\r\n\r\n\tvar scale = 1;\r\n\tvar panOffset = new Vector3();\r\n\tvar zoomChanged = false;\r\n\r\n\tvar rotateStart = new Vector2();\r\n\tvar rotateEnd = new Vector2();\r\n\tvar rotateDelta = new Vector2();\r\n\r\n\tvar panStart = new Vector2();\r\n\tvar panEnd = new Vector2();\r\n\tvar panDelta = new Vector2();\r\n\r\n\tvar dollyStart = new Vector2();\r\n\tvar dollyEnd = new Vector2();\r\n\tvar dollyDelta = new Vector2();\r\n\r\n\tfunction getAutoRotationAngle() {\r\n\r\n\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\r\n\r\n\t}\r\n\r\n\tfunction getZoomScale() {\r\n\r\n\t\treturn Math.pow( 0.95, scope.zoomSpeed );\r\n\r\n\t}\r\n\r\n\tfunction rotateLeft( angle ) {\r\n\r\n\t\tsphericalDelta.theta -= angle;\r\n\r\n\t}\r\n\r\n\tfunction rotateUp( angle ) {\r\n\r\n\t\tsphericalDelta.phi -= angle;\r\n\r\n\t}\r\n\r\n\tvar panLeft = function () {\r\n\r\n\t\tvar v = new Vector3();\r\n\r\n\t\treturn function panLeft( distance, objectMatrix ) {\r\n\r\n\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\r\n\t\t\tv.multiplyScalar( - distance );\r\n\r\n\t\t\tpanOffset.add( v );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\tvar panUp = function () {\r\n\r\n\t\tvar v = new Vector3();\r\n\r\n\t\treturn function panUp( distance, objectMatrix ) {\r\n\r\n\t\t\tif ( scope.screenSpacePanning === true ) {\r\n\r\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\r\n\t\t\t\tv.crossVectors( scope.object.up, v );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tv.multiplyScalar( distance );\r\n\r\n\t\t\tpanOffset.add( v );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\t// deltaX and deltaY are in pixels; right and down are positive\r\n\tvar pan = function () {\r\n\r\n\t\tvar offset = new Vector3();\r\n\r\n\t\treturn function pan( deltaX, deltaY ) {\r\n\r\n\t\t\tvar element = scope.domElement;\r\n\r\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t// perspective\r\n\t\t\t\tvar position = scope.object.position;\r\n\t\t\t\toffset.copy( position ).sub( scope.target );\r\n\t\t\t\tvar targetDistance = offset.length();\r\n\r\n\t\t\t\t// half of the fov is center to top of screen\r\n\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\r\n\r\n\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\r\n\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\r\n\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\r\n\r\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\t// orthographic\r\n\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\r\n\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// camera neither orthographic nor perspective\r\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\r\n\t\t\t\tscope.enablePan = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\tfunction dollyIn( dollyScale ) {\r\n\r\n\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\tscale /= dollyScale;\r\n\r\n\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tzoomChanged = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\r\n\t\t\tscope.enableZoom = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction dollyOut( dollyScale ) {\r\n\r\n\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\tscale *= dollyScale;\r\n\r\n\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tzoomChanged = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\r\n\t\t\tscope.enableZoom = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//\r\n\t// event callbacks - update the object state\r\n\t//\r\n\r\n\tfunction handleMouseDownRotate( event ) {\r\n\r\n\t\trotateStart.set( event.clientX, event.clientY );\r\n\r\n\t}\r\n\r\n\tfunction handleMouseDownDolly( event ) {\r\n\r\n\t\tdollyStart.set( event.clientX, event.clientY );\r\n\r\n\t}\r\n\r\n\tfunction handleMouseDownPan( event ) {\r\n\r\n\t\tpanStart.set( event.clientX, event.clientY );\r\n\r\n\t}\r\n\r\n\tfunction handleMouseMoveRotate( event ) {\r\n\r\n\t\trotateEnd.set( event.clientX, event.clientY );\r\n\r\n\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\r\n\r\n\t\tvar element = scope.domElement;\r\n\r\n\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\r\n\r\n\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\r\n\r\n\t\trotateStart.copy( rotateEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleMouseMoveDolly( event ) {\r\n\r\n\t\tdollyEnd.set( event.clientX, event.clientY );\r\n\r\n\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\r\n\r\n\t\tif ( dollyDelta.y > 0 ) {\r\n\r\n\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t} else if ( dollyDelta.y < 0 ) {\r\n\r\n\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t}\r\n\r\n\t\tdollyStart.copy( dollyEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleMouseMovePan( event ) {\r\n\r\n\t\tpanEnd.set( event.clientX, event.clientY );\r\n\r\n\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\r\n\r\n\t\tpan( panDelta.x, panDelta.y );\r\n\r\n\t\tpanStart.copy( panEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleMouseUp( /*event*/ ) {\r\n\r\n\t\t// no-op\r\n\r\n\t}\r\n\r\n\tfunction handleMouseWheel( event ) {\r\n\r\n\t\tif ( event.deltaY < 0 ) {\r\n\r\n\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t} else if ( event.deltaY > 0 ) {\r\n\r\n\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t}\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleKeyDown( event ) {\r\n\r\n\t\tvar needsUpdate = false;\r\n\r\n\t\tswitch ( event.keyCode ) {\r\n\r\n\t\t\tcase scope.keys.UP:\r\n\t\t\t\tpan( 0, scope.keyPanSpeed );\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.BOTTOM:\r\n\t\t\t\tpan( 0, - scope.keyPanSpeed );\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.LEFT:\r\n\t\t\t\tpan( scope.keyPanSpeed, 0 );\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.RIGHT:\r\n\t\t\t\tpan( - scope.keyPanSpeed, 0 );\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tif ( needsUpdate ) {\r\n\r\n\t\t\t// prevent the browser from scrolling on cursor keys\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartRotate( event ) {\r\n\r\n\t\tif ( event.touches.length == 1 ) {\r\n\r\n\t\t\trotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\r\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\r\n\r\n\t\t\trotateStart.set( x, y );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartPan( event ) {\r\n\r\n\t\tif ( event.touches.length == 1 ) {\r\n\r\n\t\t\tpanStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\r\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\r\n\r\n\t\t\tpanStart.set( x, y );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartDolly( event ) {\r\n\r\n\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\r\n\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\r\n\r\n\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\tdollyStart.set( 0, distance );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartDollyPan( event ) {\r\n\r\n\t\tif ( scope.enableZoom ) handleTouchStartDolly( event );\r\n\r\n\t\tif ( scope.enablePan ) handleTouchStartPan( event );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartDollyRotate( event ) {\r\n\r\n\t\tif ( scope.enableZoom ) handleTouchStartDolly( event );\r\n\r\n\t\tif ( scope.enableRotate ) handleTouchStartRotate( event );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMoveRotate( event ) {\r\n\r\n\t\tif ( event.touches.length == 1 ) {\r\n\r\n\t\t\trotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\r\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\r\n\r\n\t\t\trotateEnd.set( x, y );\r\n\r\n\t\t}\r\n\r\n\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\r\n\r\n\t\tvar element = scope.domElement;\r\n\r\n\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\r\n\r\n\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\r\n\r\n\t\trotateStart.copy( rotateEnd );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMovePan( event ) {\r\n\r\n\t\tif ( event.touches.length == 1 ) {\r\n\r\n\t\t\tpanEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\r\n\t\t\tvar y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\r\n\r\n\t\t\tpanEnd.set( x, y );\r\n\r\n\t\t}\r\n\r\n\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\r\n\r\n\t\tpan( panDelta.x, panDelta.y );\r\n\r\n\t\tpanStart.copy( panEnd );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMoveDolly( event ) {\r\n\r\n\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\r\n\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\r\n\r\n\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\tdollyEnd.set( 0, distance );\r\n\r\n\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\r\n\r\n\t\tdollyIn( dollyDelta.y );\r\n\r\n\t\tdollyStart.copy( dollyEnd );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMoveDollyPan( event ) {\r\n\r\n\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\r\n\r\n\t\tif ( scope.enablePan ) handleTouchMovePan( event );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMoveDollyRotate( event ) {\r\n\r\n\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\r\n\r\n\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchEnd( /*event*/ ) {\r\n\r\n\t\t// no-op\r\n\r\n\t}\r\n\r\n\t//\r\n\t// event handlers - FSM: listen for events and reset state\r\n\t//\r\n\r\n\tfunction onMouseDown( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t// Prevent the browser from scrolling.\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\t// Manually set the focus since calling preventDefault above\r\n\t\t// prevents the browser from setting it automatically.\r\n\r\n\t\tscope.domElement.focus ? scope.domElement.focus() : window.focus();\r\n\r\n\t\tswitch ( event.button ) {\r\n\r\n\t\t\tcase 0:\r\n\r\n\t\t\t\tswitch ( scope.mouseButtons.LEFT ) {\r\n\r\n\t\t\t\t\tcase MOUSE.ROTATE:\r\n\r\n\t\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\r\n\r\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleMouseDownPan( event );\r\n\r\n\t\t\t\t\t\t\tstate = STATE.PAN;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleMouseDownRotate( event );\r\n\r\n\t\t\t\t\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase MOUSE.PAN:\r\n\r\n\t\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\r\n\r\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleMouseDownRotate( event );\r\n\r\n\t\t\t\t\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleMouseDownPan( event );\r\n\r\n\t\t\t\t\t\t\tstate = STATE.PAN;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\r\n\t\t\tcase 1:\r\n\r\n\t\t\t\tswitch ( scope.mouseButtons.MIDDLE ) {\r\n\r\n\t\t\t\t\tcase MOUSE.DOLLY:\r\n\r\n\t\t\t\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownDolly( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.DOLLY;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\r\n\t\t\t\tswitch ( scope.mouseButtons.RIGHT ) {\r\n\r\n\t\t\t\t\tcase MOUSE.ROTATE:\r\n\r\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownRotate( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase MOUSE.PAN:\r\n\r\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownPan( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.PAN;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tif ( state !== STATE.NONE ) {\r\n\r\n\t\t\tdocument.addEventListener( 'mousemove', onMouseMove, false );\r\n\t\t\tdocument.addEventListener( 'mouseup', onMouseUp, false );\r\n\r\n\t\t\tscope.dispatchEvent( startEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onMouseMove( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tswitch ( state ) {\r\n\r\n\t\t\tcase STATE.ROTATE:\r\n\r\n\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\thandleMouseMoveRotate( event );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.DOLLY:\r\n\r\n\t\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\t\thandleMouseMoveDolly( event );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.PAN:\r\n\r\n\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\thandleMouseMovePan( event );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onMouseUp( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\thandleMouseUp( event );\r\n\r\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\r\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\r\n\r\n\t\tscope.dispatchEvent( endEvent );\r\n\r\n\t\tstate = STATE.NONE;\r\n\r\n\t}\r\n\r\n\tfunction onMouseWheel( event ) {\r\n\r\n\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tscope.dispatchEvent( startEvent );\r\n\r\n\t\thandleMouseWheel( event );\r\n\r\n\t\tscope.dispatchEvent( endEvent );\r\n\r\n\t}\r\n\r\n\tfunction onKeyDown( event ) {\r\n\r\n\t\tif ( scope.enabled === false || scope.enableKeys === false || scope.enablePan === false ) return;\r\n\r\n\t\thandleKeyDown( event );\r\n\r\n\t}\r\n\r\n\tfunction onTouchStart( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tswitch ( event.touches.length ) {\r\n\r\n\t\t\tcase 1:\r\n\r\n\t\t\t\tswitch ( scope.touches.ONE ) {\r\n\r\n\t\t\t\t\tcase TOUCH.ROTATE:\r\n\r\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartRotate( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase TOUCH.PAN:\r\n\r\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartPan( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\r\n\t\t\t\tswitch ( scope.touches.TWO ) {\r\n\r\n\t\t\t\t\tcase TOUCH.DOLLY_PAN:\r\n\r\n\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartDollyPan( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\r\n\r\n\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartDollyRotate( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t\tif ( state !== STATE.NONE ) {\r\n\r\n\t\t\tscope.dispatchEvent( startEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onTouchMove( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch ( state ) {\r\n\r\n\t\t\tcase STATE.TOUCH_ROTATE:\r\n\r\n\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\thandleTouchMoveRotate( event );\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.TOUCH_PAN:\r\n\r\n\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\thandleTouchMovePan( event );\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.TOUCH_DOLLY_PAN:\r\n\r\n\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\r\n\r\n\t\t\t\thandleTouchMoveDollyPan( event );\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\r\n\r\n\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\r\n\r\n\t\t\t\thandleTouchMoveDollyRotate( event );\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onTouchEnd( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\thandleTouchEnd( event );\r\n\r\n\t\tscope.dispatchEvent( endEvent );\r\n\r\n\t\tstate = STATE.NONE;\r\n\r\n\t}\r\n\r\n\tfunction onContextMenu( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tscope.domElement.addEventListener( 'contextmenu', onContextMenu, false );\r\n\r\n\tscope.domElement.addEventListener( 'mousedown', onMouseDown, false );\r\n\tscope.domElement.addEventListener( 'wheel', onMouseWheel, false );\r\n\r\n\tscope.domElement.addEventListener( 'touchstart', onTouchStart, false );\r\n\tscope.domElement.addEventListener( 'touchend', onTouchEnd, false );\r\n\tscope.domElement.addEventListener( 'touchmove', onTouchMove, false );\r\n\r\n\tscope.domElement.addEventListener( 'keydown', onKeyDown, false );\r\n\r\n\t// make sure element can receive keys.\r\n\r\n\tif ( scope.domElement.tabIndex === - 1 ) {\r\n\r\n\t\tscope.domElement.tabIndex = 0;\r\n\r\n\t}\r\n\r\n\t// force an update at start\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nOrbitControls.prototype = Object.create( EventDispatcher.prototype );\r\nOrbitControls.prototype.constructor = OrbitControls;\r\n\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n// This is very similar to OrbitControls, another set of touch behavior\r\n//\r\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\r\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\r\n//    Pan - left mouse, or arrow keys / touch: one-finger move\r\n\r\nvar MapControls = function ( object, domElement ) {\r\n\r\n\tOrbitControls.call( this, object, domElement );\r\n\r\n\tthis.mouseButtons.LEFT = MOUSE.PAN;\r\n\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\r\n\r\n\tthis.touches.ONE = TOUCH.PAN;\r\n\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\r\n\r\n};\r\n\r\nMapControls.prototype = Object.create( EventDispatcher.prototype );\r\nMapControls.prototype.constructor = MapControls;\r\n\r\nexport { OrbitControls, MapControls };\r\n","const zlib = window.Zlib;\r\n\r\nfunction isGunzipBuffer(arrayBuffer) {\r\n\tlet typedArray = new Uint8Array(arrayBuffer);\r\n\treturn typedArray[0] === 0x1f && typedArray[1] === 0x8b;\r\n}\r\n\r\nfunction gunzip(arrayBuffer) {\r\n\tlet typedArray = new Uint8Array(arrayBuffer);\r\n\tif (!zlib) {\r\n\t\tconsole.error(\r\n\t\t\t'Lack of necessary dependencies: gunzip.min.js.\\n You can add this vendors to enable this feature or get it at https://github.com/imaya/zlib.js/blob/master/bin/gunzip.min.js'\r\n\t\t);\r\n\t\treturn;\r\n\t}\r\n\tlet zdec = new zlib.Gunzip(typedArray);\r\n\tlet result = zdec.decompress();\r\n\treturn result.buffer;\r\n}\r\n\r\nexport {\r\n\tisGunzipBuffer,\r\n\tgunzip\r\n};\r\n","import * as THREE from 'three';\r\nimport { isGunzipBuffer, gunzip } from './zlib';\r\n\r\nexport default class CubeMapEnv {\r\n\tconstructor(data, size, options) {\r\n\t\tthis._options = options || {};\r\n\t\tthis._size = size;\r\n\t\tthis._data = data;\r\n\t}\r\n\r\n\t// Convert to RGBA Buffer\r\n    deinterleaveImage4(size, src, dst){\r\n        let npixel = size * size;\r\n        let npixel2 = 2 * size * size;\r\n        let npixel3 = 3 * size * size;\r\n        let idx = 0;\r\n        for (let i = 0; i < npixel; i++) {\r\n            dst[idx++] = src[i];\r\n            dst[idx++] = src[i + npixel];\r\n            dst[idx++] = src[i + npixel2];\r\n            dst[idx++] = src[i + npixel3];\r\n        }\r\n    }\r\n\r\n\tloadPacked() {\r\n\t\tlet readInputArray = inputArray => {\r\n\t\t\tlet data = inputArray;\r\n\t\t\tif (isGunzipBuffer(data)) data = gunzip(data);\r\n\r\n\t\t\tconst maxLevel = Math.log(this._size) / Math.LN2;\r\n\t\t\tlet offset = 0;\r\n\t\t\tlet images = {};\r\n\t\t\t// Load cube mipmaps data\r\n\t\t\t// Per mipmaps level => 6 faces data\r\n\t\t\tfor (let i = 0; i <= maxLevel; i++) {\r\n\t\t\t\tlet size = Math.pow(2, maxLevel - i);\r\n\t\t\t\tlet byteSize;\r\n\t\t\t\tif (offset >= data.byteLength) break;\r\n\t\t\t\tfor (let face = 0; face < 6; face++) {\r\n\t\t\t\t\t// Add entry if does not exist\r\n\t\t\t\t\tif (!images[face]) images[face] = [];\r\n\t\t\t\t\tlet imageData;\r\n\t\t\t\t\tlet deinterleave;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// RGBA\r\n\t\t\t\t\tbyteSize = size * size * 4;\r\n\t\t\t\t\t// Read a block of data\r\n\t\t\t\t\timageData = new Uint8Array(data, offset, byteSize);\r\n\t\t\t\t\t// Split it\r\n\t\t\t\t\tdeinterleave = new Uint8Array(byteSize);\r\n\t\t\t\t\t// Todo: deinterleave all just once\r\n\t\t\t\t\tthis.deinterleaveImage4(size, imageData, deinterleave);\r\n\r\n\t\t\t\t\timageData = deinterleave;\r\n\t\t\t\t\timages[face].push(imageData);\r\n\t\t\t\t\t// Next block\r\n\t\t\t\t\toffset += byteSize;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._packedImages = images;\r\n\t\t\tthis.createRGBA8Packed();\r\n\t\t};\r\n\r\n\t\treturn readInputArray(this._data);\r\n    }\r\n\r\n    createRGBA8Packed(){\r\n        let cubeTextures = this.cubeTextures = [];\r\n\t\tlet size = this._size;\r\n\t\tlet packedImages = this._packedImages;\r\n\t\t// CubeTexture Mipmap\r\n\t\tconst numMips = packedImages[0].length;\r\n\t\t// Todo: encoding\r\n\t\tlet textureEncoding = THREE.LogLuvEncoding;\r\n\r\n        for (let mip = 0; mip < numMips; mip++) {\r\n\t\t\tlet cubeTexture = new THREE.CubeTexture();\r\n            cubeTextures.push(cubeTexture);\r\n\t\t\tcubeTexture.format = THREE.RGBAFormat;\r\n\t\t\tcubeTexture.encoding = textureEncoding; \r\n\t\t\t// Todo: cubeTexture.type\r\n            cubeTexture.minFilter = THREE.LinearMipMapLinearFilter;\r\n            cubeTexture.magFilter = THREE.LinearFilter;\r\n\t\t\tcubeTexture.generateMipmaps = false;\r\n\t\t\t\r\n\t\t\t// Get per face data\t\r\n\t\t\tfor (let face = 0; face < 6; face++) {\r\n\t\t\t\tlet dataTexture = new THREE.DataTexture(packedImages[face][mip], size, size, THREE.RGBAFormat);\r\n\t\t\t\tdataTexture.format = cubeTexture.format;\r\n\t\t\t\tdataTexture.encoding = textureEncoding;\r\n\t\t\t\tdataTexture.type = cubeTexture.type;\r\n\t\t\t\tdataTexture.generateMipmaps = false;\r\n\t\t\t\tcubeTexture.images[face] = dataTexture;\r\n\t\t\t\tcubeTexture.needsUpdate = true;\r\n\t\t\t}\r\n\t\t\tcubeTexture.needsUpdate = true;\r\n\t\t\tsize = size / 2;\r\n\t\t}\r\n\t\t// Integrate\r\n\t\tthis.texture = new THREE.CubeTexture();\r\n        this.texture.format = THREE.RGBAFormat;\r\n        this.texture.encoding = textureEncoding;\r\n        this.texture.minFilter = this._options.minFilter || THREE.LinearMipMapLinearFilter;\r\n        this.texture.magFilter = this._options.magFilter || THREE.LinearFilter;\r\n        this.texture.generateMipmaps = false;\r\n        \r\n        for(let i = 0; i < 6; i ++) {\r\n            this.texture.image[i] = this.cubeTextures[0].images[i];\r\n            for( let m = 1; m < numMips; m++ ) {\r\n                this.texture.mipmaps[m-1] = this.cubeTextures[m];\r\n                this.cubeTextures[m].needsUpdate = true;\r\n            }\r\n        }\r\n\t\tthis.texture.needsUpdate = true;\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { isGunzipBuffer, gunzip } from './zlib';\r\n\r\nexport default class PanoramaEnv {\r\n\tconstructor(data, size, options) {\r\n\t\tthis._options = options || {};\r\n\t\tthis._size = size;\r\n\t\tthis._data = data;\r\n\t\tthis._texture = null;\r\n\t}\r\n\r\n\tget texture() {\r\n\t\treturn this._texture;\r\n\t}\r\n\r\n\t// Convert to RGBA Buffer\r\n\tdeinterleaveImage4(size, src, dst) {\r\n\t\tlet npixel = size * size;\r\n\t\tlet npixel2 = 2 * size * size;\r\n\t\tlet npixel3 = 3 * size * size;\r\n\t\tlet idx = 0;\r\n\t\tfor (let i = 0; i < npixel; i++) {\r\n\t\t\tdst[idx++] = src[i];\r\n\t\t\tdst[idx++] = src[i + npixel];\r\n\t\t\tdst[idx++] = src[i + npixel2];\r\n\t\t\tdst[idx++] = src[i + npixel3];\r\n\t\t}\r\n\t}\r\n\r\n\tloadPacked() {\r\n\t\tlet readInputArray = inputArray => {\r\n\t\t\tlet data = inputArray;\r\n\t\t\tif (isGunzipBuffer(data)) data = gunzip(data);\r\n\r\n\t\t\tlet size = this._size;\r\n\t\t\tlet imageData, deinterleave;\r\n\r\n\t\t\timageData = new Uint8Array(data);\r\n\t\t\tdeinterleave = new Uint8Array(data.byteLength);\r\n\t\t\tthis.deinterleaveImage4(size, imageData, deinterleave);\r\n\r\n\t\t\timageData = deinterleave;\r\n\r\n\t\t\tlet dataTexture = new THREE.DataTexture(imageData, size, size, THREE.RGBAFormat);\r\n\t\t\tdataTexture.encoding = THREE.LogLuvEncoding;\r\n\t\t\tdataTexture.flipY = true;\r\n\t\t\tdataTexture.needsUpdate = true;\r\n\t\t\tthis._texture = dataTexture;\r\n\t\t};\r\n\r\n\t\treturn readInputArray(this._data);\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { isGunzipBuffer, gunzip } from './zlib';\r\n\r\nexport default class IntegrateBRDF {\r\n\tconstructor(data, size) {\r\n        this._data = data;\r\n\t\tthis._size = size;\r\n    }\r\n    \r\n\tloadPacked() {\r\n\t\tlet readInputArray = inputArray => {\r\n\t\t\tlet size = this._size;\r\n\t\t\tlet data = inputArray;\r\n            if (isGunzipBuffer(data)) data = gunzip(data);\r\n            \r\n            let byteSize = size * size * 4;\r\n\t\t\tlet imageData = new Uint8Array(data, 0, byteSize);\r\n            let _texture = new THREE.DataTexture(imageData, size, size, THREE.RGBAFormat);\r\n            return _texture;\r\n\t\t};\r\n\r\n\t\treturn readInputArray(this._data);\r\n    }\r\n\r\n}\r\n","export default class EnvironmentSphericalHarmonics {\r\n\tconstructor(file) {\r\n\t\tthis._file = file;\r\n\t\tthis.initSHCoef(file);\r\n\t}\r\n\r\n\tinitSHCoef(sphCoef) {\r\n\t\t// use spherical harmonics with 9 coef\r\n\t\tthis._sphCoef = sphCoef.slice(0, 9 * 3);\r\n\r\n\t\tlet coef0 = 1.0 / (2.0 * Math.sqrt(Math.PI));\r\n\t\tlet coef1 = -(Math.sqrt(3.0 / Math.PI) * 0.5);\r\n\t\tlet coef2 = -coef1;\r\n\t\tlet coef3 = coef1;\r\n\t\tlet coef4 = Math.sqrt(15.0 / Math.PI) * 0.5;\r\n\t\tlet coef5 = -coef4;\r\n\t\tlet coef6 = Math.sqrt(5.0 / Math.PI) * 0.25;\r\n\t\tlet coef7 = coef5;\r\n\t\tlet coef8 = Math.sqrt(15.0 / Math.PI) * 0.25;\r\n\r\n\t\tlet coef = [\r\n\t\t\tcoef0,\r\n\t\t\tcoef0,\r\n\t\t\tcoef0,\r\n\t\t\tcoef1,\r\n\t\t\tcoef1,\r\n\t\t\tcoef1,\r\n\t\t\tcoef2,\r\n\t\t\tcoef2,\r\n\t\t\tcoef2,\r\n\t\t\tcoef3,\r\n\t\t\tcoef3,\r\n\t\t\tcoef3,\r\n\t\t\tcoef4,\r\n\t\t\tcoef4,\r\n\t\t\tcoef4,\r\n\t\t\tcoef5,\r\n\t\t\tcoef5,\r\n\t\t\tcoef5,\r\n\t\t\tcoef6,\r\n\t\t\tcoef6,\r\n\t\t\tcoef6,\r\n\t\t\tcoef7,\r\n\t\t\tcoef7,\r\n\t\t\tcoef7,\r\n\t\t\tcoef8,\r\n\t\t\tcoef8,\r\n\t\t\tcoef8\r\n\t\t];\r\n\t\t\r\n\t\tthis._sphCoef = coef.map((value, index) => {\r\n\t\t\treturn value * this._sphCoef[index];\r\n\t\t});\r\n\t\tthis._uniformSpherical = new Float32Array(3 * 9);\r\n\t\tfor (let i = 0; i < 9; i++) {\r\n\t\t\tthis._uniformSpherical[i * 3] = this._sphCoef[i * 3];\r\n\t\t\tthis._uniformSpherical[i * 3 + 1] = this._sphCoef[i * 3 + 1];\r\n\t\t\tthis._uniformSpherical[i * 3 + 2] = this._sphCoef[i * 3 + 2];\r\n\t\t}\r\n\t}\r\n}\r\n","function requestFileFromURL(url, options) {\r\n\treturn new Promise(function(resolve, reject) {\r\n\t\tvar req = new XMLHttpRequest();\r\n\t\treq.open('GET', url, true);\r\n\r\n\t\tvar responseType = options && options.responseType ? options.responseType.toLowerCase() : undefined;\r\n\r\n\t\t// handle responseType\r\n\t\tif (responseType) req.responseType = responseType;\r\n\r\n\t\tif (options && options.progress) {\r\n\t\t\treq.addEventListener('progress', options.progress, false);\r\n\t\t}\r\n\r\n\t\treq.addEventListener('error', reject, false);\r\n\r\n\t\treq.addEventListener('load', function() {\r\n\t\t\tif (req.responseType === 'arraybuffer' || req.responseType === 'blob') resolve(req.response);\r\n\t\t\telse resolve(req.responseText);\r\n\t\t});\r\n\r\n\t\treq.send(null);\r\n\t});\r\n}\r\n\r\nfunction requestFileFromReader(file, options) {\r\n\treturn new Promise(function(resolve) {\r\n\t\tvar responseType = options && options.responseType ? options.responseType.toLowerCase() : undefined;\r\n\t\tvar reader = new window.FileReader();\r\n\t\treader.onload = function(data) {\r\n\t\t\tresolve(data.target.result);\r\n\t\t};\r\n\t\t// handle responseType\r\n\t\tif (responseType) {\r\n\t\t\tif (responseType === 'arraybuffer') reader.readAsArrayBuffer(file);\r\n\t\t\telse if (responseType === 'blob') resolve(file);\r\n\t\t\telse if (responseType === 'string') reader.readAsText(file);\r\n\t\t\telse reader.readAsDataURL(file);\r\n\t\t} else {\r\n\t\t\treader.readAsText(file);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction requestFile(urlOrFile, options) {\r\n\tif (typeof urlOrFile === 'string') {\r\n\t\treturn requestFileFromURL(urlOrFile, options);\r\n\t} else {\r\n\t\treturn requestFileFromReader(urlOrFile, options);\r\n\t}\r\n}\r\n\r\nexport default requestFile;\r\n","import requestFile from './requestFile.js';\r\nconst zip = window.zip;\r\n\r\nlet mimeTypes = new Map();\r\n\r\nvar isString = function(str) {\r\n\treturn typeof str === 'string' || str instanceof String;\r\n};\r\n\r\nvar isBlobURL = function(str) {\r\n\treturn str.substr(0, 9) === 'blob:http';\r\n};\r\n\r\nvar isHttpURL = function(str) {\r\n\treturn str.substr(0, 7) === 'http://' || str.substr(0, 8) === 'https://';\r\n};\r\n\r\nvar isURL = function(str) {\r\n\tif (!isString(str)) return false;\r\n\r\n\treturn isBlobURL(str) || isHttpURL(str);\r\n};\r\n\r\nvar createImageFromURL = function(url) {\r\n\treturn new Promise(function(resolve, reject) {\r\n\t\tvar img = new Image();\r\n\t\timg.onerror = function() {\r\n\t\t\treject(img);\r\n\t\t};\r\n\r\n\t\timg.onload = function() {\r\n\t\t\tresolve(img);\r\n\t\t};\r\n\t\timg.src = url;\r\n\t});\r\n};\r\n\r\nvar createImageFromBlob = function(blob) {\r\n\tvar privateURL = window.URL.createObjectURL(blob);\r\n\tvar promise = createImageFromURL(privateURL);\r\n\r\n\tpromise.finally(function() {\r\n\t\twindow.URL.revokeObjectURL(privateURL);\r\n\t});\r\n\treturn promise;\r\n};\r\n\r\nvar createArrayBufferFromBlob = function(blob) {\r\n\treturn new Promise(function(resolve, reject) {\r\n\t\tvar fr = new FileReader();\r\n\r\n\t\tfr.onerror = function() {\r\n\t\t\treject(fr);\r\n\t\t};\r\n\r\n\t\tfr.onload = function() {\r\n\t\t\tresolve(this.result);\r\n\t\t};\r\n\t\tfr.readAsArrayBuffer(blob);\r\n\t});\r\n};\r\n\r\nvar createArrayBufferFromURL = function(url) {\r\n\treturn requestFile(url, {\r\n\t\tresponseType: 'arraybuffer'\r\n\t});\r\n};\r\n\r\nvar createJSONFromURL = function(url) {\r\n\treturn requestFile(url).then(function(string) {\r\n\t\treturn JSON.parse(string);\r\n\t});\r\n};\r\n\r\nvar createJSONFromString = function(str) {\r\n\tvar obj = JSON.parse(str);\r\n\treturn Promise.resolve(obj);\r\n};\r\n\r\nvar fileHelper = {\r\n\tcreateJSONFromURL: createJSONFromURL,\r\n\tcreateArrayBufferFromURL: createArrayBufferFromURL,\r\n\tcreateArrayBufferFromBlob: createArrayBufferFromBlob,\r\n\tcreateImageFromBlob: createImageFromBlob,\r\n\tcreateImageFromURL: createImageFromURL,\r\n\r\n\trequestURI: requestFile,\r\n\trequestResource: function(uri, options) {\r\n\t\tvar extension = fileHelper.getExtension(uri);\r\n\t\tvar mimetype = fileHelper.getMimeType(extension);\r\n\r\n\t\tvar responseType = options && options.responseType ? options.responseType.toLowerCase() : undefined;\r\n\t\tif (responseType) return requestFile(uri, options);\r\n\r\n\t\tif (mimetype) {\r\n\t\t\tif (mimetype.match('image')) return createImageFromURL(uri);\r\n\t\t\telse if (mimetype.match('binary')) return createArrayBufferFromURL(uri);\r\n\t\t\telse if (mimetype.match('json')) return createJSONFromURL(uri);\r\n\t\t\telse if (mimetype.match('text')) return requestFile(uri);\r\n\t\t}\r\n\r\n\t\treturn requestFile(uri);\r\n\t},\r\n\r\n\t//     file.png :  url          -> fetch/createImage            ->   Image\r\n\t//     file.png :  blob         -> createImage                  ->   Image\r\n\t//     file.png :  Image        -> passthroug                   ->   Image\r\n\t//     file.txt :  blob         -> FileReader                   ->   String\r\n\t//     file.txt :  string       -> passthroug                   ->   String\r\n\t//     file.txt :  url          -> fetch                        ->   String\r\n\t//     file.json:  string       -> JSON.parse                   ->   Object\r\n\t//     file.json:  url          -> fetch/JSON.parse             ->   Object\r\n\t//     file.json:  blob         -> FileReader/JSON.parse        ->   Object\r\n\t//     file.bin :  blob         -> FileReader/readAsArrayBuffer ->   arrayBuffer\r\n\t//     file.bin :  url          -> fetch as arra yBuffer        ->   arrayBuffer\r\n\t//     file.bin :  arrayBuffer  -> passthroug                   ->   arrayBuffer\r\n\tresolveData: function(uri, data) {\r\n\t\tvar extension = fileHelper.getExtension(uri);\r\n\t\tvar mimetype = fileHelper.getMimeType(extension);\r\n\t\tvar createData;\r\n\r\n\t\tif (mimetype) {\r\n\t\t\tif (mimetype.match('image')) {\r\n\t\t\t\tif (isString(data)) createData = createImageFromURL;\r\n\t\t\t\telse if (data instanceof Blob) createData = createImageFromBlob;\r\n\t\t\t} else if (mimetype.match('json')) {\r\n\t\t\t\tif (isURL(data)) createData = createJSONFromURL;\r\n\t\t\t\telse createData = createJSONFromString;\r\n\t\t\t} else if (mimetype.match('binary')) {\r\n\t\t\t\tif (isString(data)) createData = createArrayBufferFromURL;\r\n\t\t\t\telse if (data instanceof Blob) createData = createArrayBufferFromBlob;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar promise;\r\n\t\tif (createData) {\r\n\t\t\tpromise = createData(data);\r\n\t\t} else {\r\n\t\t\tpromise = Promise.resolve(data);\r\n\t\t}\r\n\t\treturn promise;\r\n\t},\r\n\r\n\tresolveFilesMap: function(filesMap) {\r\n\t\tvar promises = [];\r\n\r\n\t\tfor (var filename in filesMap) {\r\n\t\t\tvar data = filesMap[filename];\r\n\t\t\tvar promise = fileHelper.resolveData(filename, data).then(\r\n\t\t\t\tfunction(fname, dataResolved) {\r\n\t\t\t\t\tthis[fname] = dataResolved;\r\n\t\t\t\t}.bind(filesMap, filename)\r\n\t\t\t);\r\n\t\t\tpromises.push(promise);\r\n\t\t}\r\n\r\n\t\treturn Promise.all(promises).then(function() {\r\n\t\t\treturn filesMap;\r\n\t\t});\r\n\t},\r\n\r\n\t_unzipEntry: function(entry) {\r\n\t\treturn new Promise(function(resolve) {\r\n\t\t\tvar filename = entry.filename;\r\n\t\t\tvar extension = fileHelper.getExtension(filename);\r\n\t\t\tvar mimetype = fileHelper.getMimeType(extension);\r\n\r\n\t\t\tvar Writer = zip.BlobWriter;\r\n\t\t\tif (mimetype.match('text') !== null || mimetype.match('json') !== null) Writer = zip.TextWriter;\r\n\t\t\t// get data from the first file\r\n\t\t\tentry.getData(new Writer(mimetype), function(data) {\r\n\t\t\t\tresolve({\r\n\t\t\t\t\tfilename: filename,\r\n\t\t\t\t\tdata: data\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\r\n\tunzipBlob: function(blob) {\r\n\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\t// use a zip.BlobReader object to read zipped data stored into blob variable\r\n\t\t\tvar filesMap = {};\r\n\t\t\tvar filePromises = [];\r\n\t\t\tzip.createReader(\r\n\t\t\t\tnew zip.BlobReader(blob),\r\n\t\t\t\tfunction(zipReader) {\r\n\t\t\t\t\t// get entries from the zip file\r\n\t\t\t\t\tzipReader.getEntries(function(entries) {\r\n\t\t\t\t\t\tfor (var i = 0; i < entries.length; i++) {\r\n\t\t\t\t\t\t\tif (entries[i].directory) continue;\r\n\r\n\t\t\t\t\t\t\tvar promise = fileHelper._unzipEntry(entries[i]);\r\n\t\t\t\t\t\t\tpromise.then(function(result) {\r\n\t\t\t\t\t\t\t\tfilesMap[result.filename] = result.data;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfilePromises.push(promise);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tPromise.all(filePromises).then(function() {\r\n\t\t\t\t\t\t\tzipReader.close();\r\n\t\t\t\t\t\t\tfileHelper.resolveFilesMap(filesMap).then(function(filesMapResolved) {\r\n\t\t\t\t\t\t\t\tresolve(filesMapResolved);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tfunction() {\r\n\t\t\t\t\treject(this);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t});\r\n\t},\r\n\r\n\tunzip: function(input) {\r\n\t\tif (!zip) return Promise.reject('missing deps to unzip, require https://github.com/gildas-lormeau/zip.js');\r\n\r\n\t\tif (isString(input)) {\r\n\t\t\treturn fileHelper.requestResource(input).then(function(arrayBuffer) {\r\n\t\t\t\tvar blob = new Blob([arrayBuffer], {\r\n\t\t\t\t\ttype: mimeTypes.get('zip')\r\n\t\t\t\t});\r\n\t\t\t\treturn fileHelper.unzipBlob(blob);\r\n\t\t\t});\r\n\t\t} else if (input instanceof Blob) {\r\n\t\t\treturn fileHelper.unzipBlob(input);\r\n\t\t} else if (input instanceof ArrayBuffer) {\r\n\t\t\tvar blob = new Blob([input], {\r\n\t\t\t\ttype: mimeTypes.get('zip')\r\n\t\t\t});\r\n\t\t\treturn fileHelper.unzipBlob(blob);\r\n\t\t}\r\n\t\treturn Promise.reject('cant unzip input');\r\n\t},\r\n\r\n\tgetMimeType: function(extension) {\r\n\t\treturn mimeTypes.get(extension);\r\n\t},\r\n\r\n\tgetExtension: function(url) {\r\n\t\treturn url.substr(url.lastIndexOf('.') + 1);\r\n\t},\r\n\r\n\taddMimeTypeForExtension: function(extension, mimeType) {\r\n\t\tif (mimeTypes.has(extension) !== undefined) {\r\n\t\t\tconsole.warn(\"the '\" + extension + \"' already has a mimetype: \" + mimeTypes.get(extension));\r\n\t\t}\r\n\t\tmimeTypes.set(extension, mimeType);\r\n\t}\r\n};\r\n\r\nmimeTypes.set('bin', 'application/octet-binary');\r\nmimeTypes.set('b3dm', 'application/octet-binary');\r\nmimeTypes.set('glb', 'application/octet-binary');\r\nmimeTypes.set('zip', 'application/octet-binary');\r\nmimeTypes.set('gz', 'application/octet-binary');\r\n// Image\r\nmimeTypes.set('png', 'image/png');\r\nmimeTypes.set('jpg', 'image/jpeg');\r\nmimeTypes.set('jpeg', 'image/jpeg');\r\nmimeTypes.set('gif', 'image/gif');\r\n// Text\r\nmimeTypes.set('json', 'application/json');\r\nmimeTypes.set('gltf', 'application/json');\r\nmimeTypes.set('osgjs', 'application/json');\r\nmimeTypes.set('txt', 'text/plain');\r\nmimeTypes.set('glsl', 'text/plain');\r\n\r\nexport default fileHelper;\r\n","// refer: https://github.com/cedricpinson/osgjs\r\n\r\nimport * as THREE from 'three';\r\nimport EnvironmentCubeMap from './EnvironmentCubeMap';\r\nimport EnvironmentPanorama from './EnvironmentPanorama';\r\nimport IntegrateBRDFMap from './IntegrateBRDFMap';\r\nimport EnvironmentSphericalHarmonics from './EnvironmentSphericalHarmonics';\r\nimport fileHelper from './fileHelper';\r\n\r\nclass Environment {\r\n\tconstructor(viewer) {\r\n\t\tlet { renderer, isMobile } = viewer;\r\n\t\tthis.isMobile = isMobile;\r\n\t\tthis._config = undefined;\r\n\t\tthis._files = {};\r\n\t\tlet ctx = renderer.context;\r\n\t\tthis.textureLODSupport = ctx.getExtension('EXT_shader_texture_lod');\r\n\t}\r\n\r\n\tasync loadPackage(url) {\r\n\t\tthis.url = url;\r\n\t\tconst configSrc = `${url}config.json`;\r\n\t\tlet config = await fileHelper.requestResource(configSrc);\r\n\t\treturn await this.init(config);\r\n\t}\r\n\r\n\tgetImage(type, encoding, format) {\r\n\t\tlet results = this.getTextures(type, encoding, format);\r\n\t\tif (!results.length) return undefined;\r\n\t\t// Add limitSize\r\n\t\tif (results[0].limitSize) results[0].images[0].limitSize = results[0].limitSize;\r\n\t\treturn results[0].images[0];\r\n\t}\r\n\r\n\t// Filter texture by condition\r\n\t// Todo: Sync encoding param\r\n\tgetTextures(type, encoding, format) {\r\n\t\tlet textures = this._config.textures;\r\n\t\tlet results = textures.filter(texture => {\r\n\t\t\treturn texture.encoding === encoding && texture.format === format && texture.type === type;\r\n\t\t});\r\n\t\treturn results;\r\n\t}\r\n\r\n\tasync init(config) {\r\n\t\t// LUV format only (Todo: Support More format)\r\n\t\tthis._config = config;\r\n\r\n\t\tlet envMapFormat = 'panorama';\r\n\t\tif(this.textureLODSupport) envMapFormat = 'cubemap';\r\n\r\n\t\tlet textureData = this.getImage('specular_ue4', 'luv', envMapFormat);\r\n\t\tlet mapFile = textureData.file;\r\n\t\tlet mapSize = textureData.width;\r\n\t\tlet mapData = await fileHelper.requestResource(`${this.url}${mapFile}`);\r\n\t\tif(envMapFormat === 'cubemap'){\r\n\t\t\tthis.mapEnv = new EnvironmentCubeMap(mapData, mapSize, config);\r\n\t\t}else{\r\n\t\t\tthis.mapEnv = new EnvironmentPanorama(mapData, mapSize, config);\r\n\t\t}\r\n\t\tthis.mapEnv.loadPacked();\r\n\t\tlet minTextureSize = textureData.limitSize;\r\n\t\tlet nbLod = Math.log(mapSize) / Math.LN2;\r\n\t\tlet maxLod = nbLod - Math.log(minTextureSize) / Math.LN2;\r\n\t\tthis.uEnvironmentLodRange = [nbLod, maxLod];\r\n\t\tthis.uEnvironmentSize = [mapSize, mapSize];\r\n\t\t\r\n\t\tif(!this.isMobile){\r\n\t\t\t// LUT\r\n\t\t\tlet lutTextureData = this.getImage('brdf_ue4', 'rg16', 'lut');\r\n\t\t\tlet lutFile = lutTextureData.file;\r\n\t\t\tlet lutSize = lutTextureData.width;\r\n\t\t\tlet lutData = await fileHelper.requestResource(`${this.url}${lutFile}`);\r\n\t\t\tthis._integrateBRDF = new IntegrateBRDFMap(lutData, lutSize);\r\n\t\t\tthis.uIntegrateBRDF = this._integrateBRDF.loadPacked();\r\n\t\t}\r\n\r\n\t\t// Background\r\n\t\tlet bgTextureData = this.getImage('background', 'luv', 'cubemap');\r\n\t\tlet bgFile = bgTextureData.file;\r\n\t\tlet bgSize = bgTextureData.width;\r\n\t\tlet bgData = await fileHelper.requestResource(`${this.url}${bgFile}`);\r\n\t\tthis.backgroundEnv = new EnvironmentCubeMap(bgData, bgSize, {\r\n\t\t\tminFilter: THREE.LinearFilter,\r\n            magFilter: THREE.LinearFilter\r\n\t\t});\r\n\t\tthis.backgroundEnv.loadPacked();\r\n\t\tthis.uBGEnvironmentSize = [bgSize, bgSize];\r\n\r\n\t\t// EnvironmentSphericalHarmonics\r\n\t\tthis._spherical = new EnvironmentSphericalHarmonics(config.diffuseSPH);\r\n\t\tthis.uEnvironmentSphericalHarmonics = this._spherical._uniformSpherical;\r\n\r\n\t\t// Light\r\n\t\tif(config.Lights){\r\n\t\t\tlet sunlight = config.Lights[0];\r\n\t\t\tthis.sunlightInfo = {\r\n\t\t\t\tcolor: new THREE.Color().fromArray(sunlight.color),\r\n\t\t\t\tposition: new THREE.Vector3().fromArray(sunlight.direction).negate(),\r\n\t\t\t\tintensity: sunlight.luminosity\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nexport { Environment };\r\n","export default \"#define GLSLIFY 1\\nuniform mat3 uModelNormalMatrix;\\nvarying vec3 vViewPosition;\\n\\nvarying vec3 vNormal;\\n\\n#ifdef USE_TANGENT\\n\\tvarying vec3 vTangent;\\n\\tvarying vec3 vBitangent;\\n#endif\\n\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <color_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n\\nvoid main(){\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n    #include <color_vertex>\\n    #include <beginnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t// Todo: morph and skin\\n\\n\\tvNormal = normalize( transformedNormal );\\n\\t#ifdef USE_TANGENT\\n\\t\\tvTangent = normalize( transformedTangent );\\n\\t\\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\\n\\t#endif\\n\\n    #include <begin_vertex>\\n\\t#include <project_vertex>\\n\\n    vViewPosition = mvPosition.xyz;\\n\\n\\t#include <worldpos_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";","export default \"#define GLSLIFY 1\\n// refer: \\n// https://github.com/cedricpinson/osgjs\\n// https://google.github.io/filament/Filament.html\\n\\nuniform mat4 uEnvironmentTransform;\\nmat3 environmentTransform;\\nuniform float uEnvBrightness;\\nuniform vec3 uEnvironmentSphericalHarmonics[9];\\n\\nuniform int uSpecularPeak;\\nuniform int uOcclusionHorizon;\\nuniform sampler2D uIntegrateBRDF;\\n\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n\\nuniform vec2 uShadowDepthRange;\\n\\nvarying vec3 vViewPosition;\\n\\n#ifdef CUBEMAP_LOD\\nuniform samplerCube envMap;\\n#endif\\n#ifdef PANORAMA\\nuniform sampler2D envMap;\\n#endif\\nuniform vec2 uEnvironmentSize;\\nuniform vec2 uEnvironmentLodRange;\\n\\n#ifdef SPECULAR_GLOSSINESS\\n    uniform vec3 specularFactor;\\n    uniform float glossinessFactor;\\n    #ifdef USE_SPECULARMAP\\n\\t    uniform sampler2D specularMap;\\n    #endif\\n    #ifdef USE_GLOSSINESSMAP\\n\\t    uniform sampler2D glossinessMap;\\n    #endif\\n#endif\\n\\nvarying vec3 vNormal;\\n#ifdef USE_TANGENT\\n    varying vec3 vTangent;\\n    varying vec3 vBitangent;\\n#endif\\n\\n#include <common>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <color_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <map_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <packing>\\n#include <logdepthbuf_pars_fragment>\\n// ************************************ Shadow ************************************\\nuniform bool receiveShadow;\\n#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHT_SHADOWS > 0\\n\\t\\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\\n\\t#endif\\n\\n\\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare, float shadowDistance) {\\n        vec2 centroidCoord = uv / size;\\n        centroidCoord = centroidCoord + 0.5;\\n        vec2 f = fract(centroidCoord);\\n\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / size;\\n\\t\\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\\n\\n        vec4 fetches;\\n        const vec2 offset = vec2( 0.0, 1.0 );\\n        fetches.x = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.xx ));\\n        fetches.y = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.xy ));\\n        fetches.z = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.yx ));\\n        fetches.w = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.yy ));\\n\\n        // Shadow distance\\n        float _a = mix(fetches.x, fetches.y, f.y);\\n        float _b = mix(fetches.z, fetches.w, f.y);\\n        shadowDistance = mix(_a, _b, f.x);\\n\\n\\t\\tvec4 st = step(fetches, vec4(0.0));\\n\\n        float a = mix(st.x, st.y, f.y);\\n        float b = mix(st.z, st.w, f.y);\\n        return mix(a, b, f.x);\\n\\t}\\n\\n\\tfloat getShadow(bool lighted, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, out float shadowDistance ) {\\n        bool earlyOut = false;\\n        float shadow = 1.0;\\n\\n        if (!lighted){\\n            shadow = 0.0;\\n            earlyOut = true;\\n        }\\n\\n        if(uShadowDepthRange.x == uShadowDepthRange.y){\\n            earlyOut = true;\\n        }\\n\\n        if (!earlyOut) {\\n            shadowCoord.xyz /= shadowCoord.w;\\n            shadowCoord.z += shadowBias;\\n            // if ( something && something ) breaks ATI OpenGL shader compiler\\n            // if ( all( something, something ) ) using this instead\\n            bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n            bool inFrustum = all( inFrustumVec );\\n            bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n            bool frustumTest = all( frustumTestVec );\\n            if ( frustumTest ) {\\n                vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n                // TODO: Shadow jitter\\n                float res = texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z, shadowDistance);\\n                shadow = res;\\n            }\\n        }\\n\\t\\treturn shadow;\\n\\t}\\n#endif\\n\\n// DirectionalLight\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n#endif\\n\\n// Attenuation\\n#if NUM_POINT_LIGHTS > 0 || NUM_SPOT_LIGHTS > 0\\n    // Calculation of the attenuation\\n    float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n    #if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n        // based upon Frostbite 3 Moving to Physically-based Rendering\\n        // page 32, equation 26: E[window1]\\n        // https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\\n        // this is intended to be used on spot and point lights who are represented as luminous intensity\\n        // but who must be converted to luminous irradiance for surface lighting calculation\\n        float distanceFalloff = 1.0 / max( pow( abs(lightDistance), decayExponent ), 0.01 );\\n        if( cutoffDistance > 0.0 ) {\\n            distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n        }\\n        return distanceFalloff;\\n    #else\\n        if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\\n            return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n        }\\n        return 1.0;\\n    #endif\\n    }\\n#endif\\n\\n// PointLight\\n#if NUM_POINT_LIGHTS > 0\\n\\tstruct PointLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t\\tfloat shadowCameraNear;\\n\\t\\tfloat shadowCameraFar;\\n\\t};\\n\\n\\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\\n\\tfloat getPointDirectLightIrradiance( const in PointLight pointLight, vec3 vViewPosition) {\\n\\t\\tvec3 lVector = pointLight.position - vViewPosition;\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\treturn punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\\n\\t}\\n#endif\\n\\n// SpotLight\\n#if NUM_SPOT_LIGHTS > 0\\n\\tstruct SpotLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tfloat coneCos;\\n\\t\\tfloat penumbraCos;\\n\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\n\\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\\n\\tfloat getSpotDirectLightIrradiance( const in SpotLight spotLight, vec3 vViewPosition) {\\n\\t\\tvec3 lVector = spotLight.position - vViewPosition;\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tfloat angleCos = dot( normalize( lVector ), spotLight.direction );\\n\\n\\t\\tif ( angleCos > spotLight.coneCos ) {\\n\\t\\t\\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n            return spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\\n\\t\\t} else {\\n\\t\\t\\treturn 0.0;\\n\\t\\t}\\n\\t}\\n#endif\\n\\n// ************************************ Light ************************************\\n#if NUM_DIR_LIGHTS > 0\\nvoid precomputeDirect(const in vec3 normal, const in vec3 viewDir, DirectionalLight directionalLight, out float attenuation, out vec3 lightDir, out float NoL) {\\n    attenuation = 1.0;\\n    lightDir = directionalLight.direction;\\n    NoL = dot(normal, lightDir);\\n}\\n#endif\\n\\n#if NUM_SPOT_LIGHTS > 0\\nvoid precomputeSpot(const in vec3 normal, const in vec3 viewDir, const in vec3 viewVertex, SpotLight spotLight, out float attenuation, out vec3 lightDir, out float NoL) {\\n    vec3 lightViewPosition = spotLight.position;\\n    lightDir = lightViewPosition - viewVertex;\\n    float dist = length(lightDir);\\n    lightDir = dist > 0.0 ? lightDir / dist : vec3( 0.0, 1.0, 0.0 );\\n    NoL = dot(lightDir, normal);\\n    attenuation = getSpotDirectLightIrradiance(spotLight, vViewPosition);\\n}\\n#endif\\n\\n#if NUM_POINT_LIGHTS > 0\\nvoid precomputePoint(const in vec3 normal, const in vec3 viewDir, const in vec3 viewVertex, PointLight pointLight, out float attenuation, out vec3 lightDir, out float NoL) {\\n    lightDir = pointLight.position - viewVertex;\\n    float dist = length(lightDir);\\n    attenuation = getPointDirectLightIrradiance(pointLight, vViewPosition);\\n    lightDir = dist > 0.0 ? lightDir / dist : vec3( 0.0, 1.0, 0.0 );\\n    NoL = dot(lightDir, normal);\\n}\\n#endif\\n\\nvec3 precomputeLight_0(vec3 normal, vec3 eyeVector, float perceptualRoughness){\\n    // perceptually linear roughness to roughness\\n    float roughness = perceptualRoughness * perceptualRoughness;\\n    float NoV =  clamp(dot(normal, eyeVector), 0., 1.);\\n    return vec3(roughness, roughness * roughness, NoV);\\n}\\n\\n// Isotropy\\nfloat pow5(float x){\\n\\tfloat xx = x*x;\\n\\treturn xx * xx * x;\\n}\\n\\n// ************************************ Specular ************************************\\n// ************************ Normal Distribution Functions(NDF) **************************\\n\\n// [Blinn 1977, \\\"Models of light reflection for computer synthesized pictures\\\"]\\nfloat D_Blinn_1062606552(vec3 precomputeLight, float NoH){\\n    float a2 = precomputeLight.y;\\n    float n = 2.0 / a2 - 2.0;\\n    return (n+2.0) / (2.0* PI) * pow(NoH, n);   // 1 mad, 1 exp, 1 mul, 1 log\\n}\\n\\n// [Beckmann 1963, \\\"The scattering of electromagnetic waves from rough surfaces\\\"]\\nfloat D_Beckmann_1062606552(vec3 precomputeLight, float NoH){\\n    float a2 = precomputeLight.y;\\n    float NoH2 = NoH * NoH;\\n    return exp( (NoH2 - 1.0) / (a2 * NoH2) ) / ( PI * a2 * NoH2 * NoH2 );\\n}\\n\\n// GGX / Trowbridge-Reitz\\n// [Walter et al. 2007, \\\"Microfacet models for refraction through rough surfaces\\\"]\\nfloat D_GGX_1062606552(vec3 precomputeLight, float NoH){\\n    float a2 = precomputeLight.y;\\n    float d = (NoH * a2 - NoH) * NoH + 1.0;\\t// 2 mad\\n    return a2 / (PI * d * d);\\t// 4 mul, 1 rcp\\n}\\n\\nfloat Specular_D_1062606552(vec3 precomputeLight, float NoH){\\n#if defined(NDF_BLINNPHONG)\\n    return D_Blinn_1062606552(precomputeLight, NoH);\\n#elif defined(NDF_BECKMANN)\\n    return D_Beckmann_1062606552(precomputeLight, NoH);\\n#elif defined(NDF_GGX)\\n    return D_GGX_1062606552(precomputeLight, NoH);\\n#else\\n    return D_GGX_1062606552(precomputeLight, NoH);\\n#endif\\n}\\n\\n// ************************************ Fresnel ************************************\\n\\n// [Schlick 1994, \\\"An Inexpensive BRDF Model for Physically-Based Rendering\\\"]\\nvec3 F_Schlick_1062606552(float VoH, vec3 f0, float f90){\\n    return f0 + (vec3(f90) - f0) * pow5(1.0 - VoH);\\n}\\n\\n// [Cook-Torrance 1982]\\nvec3 F_CookTorrance_1062606552(float VoH, vec3 f0, float f90){\\n    vec3 sqrtSpec = sqrt(f0);\\n    vec3 n = (1.0 + sqrtSpec) / (1.0 - sqrtSpec);\\n    float c = clamp( VoH, 0.0, 1.0 );\\n    vec3 g = sqrt(n * n + c * c - 1.0);\\n\\n    vec3 part1 = (g - c)/(g + c);\\n    vec3 part2 = ((g + c) * c - 1.0)/((g - c) * c + 1.0);\\n\\n    return max(vec3(0.0), 0.5 * part1 * part1 * (1.0 + part2 * part2));\\n}\\n\\nvec3 F_None_1062606552(vec3 f0){\\n    return f0;\\n}\\n\\nvec3 Specular_F_1062606552(float VoH, vec3 f0, float f90){\\n#if defined(F_SCHLICK)\\n    return F_Schlick_1062606552(VoH, f0, f90);\\n#elif defined(F_COOKTORRANCE)\\n    return F_CookTorrance_1062606552(VoH, f0, f90);\\n#else // FRESNSEL_NONE\\n    return F_None_1062606552(f0);\\n#endif\\n}\\n\\n// ******************************** Visibility Term *********************************\\nfloat Vis_Implicit_1062606552(){\\n\\treturn 0.25;\\n}\\n\\n// [Neumann et al. 1999, \\\"Compact metallic reflectance models\\\"]\\nfloat Vis_Neumann_1062606552(vec3 precomputeLight, float NoL){\\n\\tfloat NoV = precomputeLight.z;\\n\\treturn 1. / (4. * max(NoL, NoV));\\n}\\n\\n// [Kelemen 2001, \\\"A microfacet based coupled specular-matte brdf model with importance sampling\\\"]\\nfloat Vis_Kelemen_1062606552(float VoH){\\n\\t// constant to prevent NaN\\n\\treturn 1./(4. * VoH * VoH + 1e-5);\\n}\\n\\n// Tuned to match behavior of Vis_Smith\\n// [Schlick 1994, \\\"An Inexpensive BRDF Model for Physically-Based Rendering\\\"]\\nfloat Vis_Schlick_1062606552(vec3 precomputeLight, float NoL){\\n\\tfloat a2 = precomputeLight.y;\\n\\tfloat NoV = precomputeLight.z;\\n\\tfloat k = sqrt(a2) * 0.5;\\n\\tfloat Vis_SchlickV = NoV * (1. - k) + k;\\n\\tfloat Vis_SchlickL = NoL * (1. - k) + k;\\n\\treturn 0.25 / (Vis_SchlickV * Vis_SchlickL);\\n}\\n\\n// Smith term for GGX\\n// [Smith 1967, \\\"Geometrical shadowing of a random rough surface\\\"]\\nfloat Vis_Smith_1062606552(vec3 precomputeLight, float NoL){\\n\\tfloat a2 = precomputeLight.y;\\n\\tfloat NoV = precomputeLight.z;\\n\\tfloat Vis_SmithV = NoV + sqrt(NoV * (NoV - NoV * a2) + a2);\\n\\tfloat Vis_SmithL = NoL + sqrt(NoL * (NoL - NoL * a2) + a2);\\n\\treturn 1./(Vis_SmithV * Vis_SmithL);\\n}\\n\\n// Appoximation of joint Smith term for GGX\\n// [Heitz 2014, \\\"Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs\\\"]\\nfloat Vis_SmithJointApprox_1062606552(vec3 precomputeLight, float NoL){\\n    float roughness = precomputeLight.x;\\n    float NoV = precomputeLight.z;\\n    float Vis_SmithV = NoL * (NoV * (1.0 - roughness) + roughness);\\n    float Vis_SmithL = NoV * (NoL * (1.0 - roughness) + roughness);\\n    return 0.5 / (Vis_SmithV + Vis_SmithL);\\n}\\n\\nfloat Specular_V_1062606552(vec3 precomputeLight, float NoL, float VoH){\\n#if defined(V_IMPLICIT)\\n    return Vis_Implicit_1062606552();\\n#elif defined(V_NEUMANN)\\n    return Vis_Neumann_1062606552(precomputeLight, NoL);\\n#elif defined(V_KELEMEN)\\n    return Vis_Kelemen_1062606552(VoH);\\n#elif defined(V_SCHLICK)\\n    return Vis_Schlick_1062606552(precomputeLight, NoL);\\n#elif defined(V_SMITH)\\n    return Vis_Smith_1062606552(precomputeLight, NoL);\\n#elif defined(V_SMITHJOINTAPPROX)\\n    return Vis_SmithJointApprox_1062606552(precomputeLight, NoL);\\n#else\\n\\treturn 0.25;\\n#endif\\n}\\n\\nvec3 specularCompute(vec3 precomputeLight, vec3 specular, float NoL, float NoH, float VoH, float f90) {\\n    float D = Specular_D_1062606552(precomputeLight, NoH);\\n    vec3 F = Specular_F_1062606552(VoH, specular, f90);\\n    float V = Specular_V_1062606552(precomputeLight, NoL, VoH);\\n\\t\\n    return (D * V) * F;\\n}\\n\\n// ************************************ Diffuse ************************************\\nvec3 Diffuse_Lambert_1062606552(vec3 diffuse){\\n\\treturn diffuse / PI;\\n}\\n\\n// [Burley 2012, \\\"Physically-Based Shading at Disney\\\"]\\nvec3 Diffuse_Burley_1062606552(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\\n    float Roughness = precomputeLight.x;\\n    float NoV =  precomputeLight.z;\\n\\n\\tfloat FD90 = 0.5 + 2. * VoH * VoH * Roughness;\\n\\tfloat FdV = 1. + (FD90 - 1.) * pow5(1. - NoV);\\n\\tfloat FdL = 1. + (FD90 - 1.) * pow5(1. - NoL);\\n\\treturn diffuse * ((1. / PI) * FdV * FdL);\\n}\\n\\n// [Gotanda 2012, \\\"Beyond a Simple Physically Based Blinn-Phong Model in Real-Time\\\"]\\nvec3 Diffuse_OrenNayar_1062606552(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\\n    float Roughness = precomputeLight.x;\\n\\tfloat a = precomputeLight.y;\\n    float NoV = precomputeLight.z;\\n\\tfloat s = a; // / ( 1.29 + 0.5 * a );\\n\\tfloat s2 = s * s;\\n\\tfloat VoL = 2. * VoH * VoH - 1.;  // double angle identity\\n\\tfloat Cosri = VoL - NoV * NoL;\\n\\tfloat C1 = 1. - 0.5 * s2 / (s2 + 0.33);\\n\\tfloat C2 = 0.45 * s2 / (s2 + 0.09) * Cosri * (Cosri >= 0. ? 1./(max(NoL, NoV)) : 1.);\\n\\treturn diffuse / PI * (C1 + C2) * (1. + Roughness * 0.5);\\n}\\n\\n// [Gotanda 2014, \\\"Designing Reflectance Models for New Consoles\\\"]\\nvec3 Diffuse_Gotanda_1062606552(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\\n    float Roughness = precomputeLight.x;\\n\\tfloat a = precomputeLight.y;\\n    float NoV = precomputeLight.z;\\n\\tfloat a2 = a * a;\\n\\tfloat F0 = 0.04;\\n\\tfloat VoL = 2. * VoH * VoH - 1.;    // double angle identity\\n\\tfloat Cosri = VoL - NoV * NoL;\\n\\n\\tfloat a2_13 = a2 + 1.36053;\\n\\tfloat Fr = ( 1. - ( 0.542026*a2 + 0.303573*a ) / a2_13 ) * ( 1. - pow( 1. - NoV, 5. - 4.*a2 ) / a2_13 ) * ( ( -0.733996*a2*a + 1.50912*a2 - 1.16402*a ) * pow( 1. - NoV, 1. + 1./(39.*a2*a2+1.) ) + 1. );\\n\\tfloat Lm = ( max( 1. - 2.*a, 0. ) * ( 1. - pow5( 1. - NoL ) ) + min( 2.*a, 1. ) ) * ( 1. - 0.5*a * (NoL - 1.) ) * NoL;\\n\\tfloat Vd = ( a2 / ( (a2 + 0.09) * (1.31072 + 0.995584 * NoV) ) ) * ( 1. - pow( 1. - NoL, ( 1. - 0.3726732 * NoV * NoV ) / ( 0.188566 + 0.38841 * NoV ) ) );\\n\\tfloat Bp = Cosri < 0. ? 1.4 * NoV * NoL * Cosri : Cosri;\\n\\tfloat Lr = (21.0 / 20.0) * (1. - F0) * ( Fr * Lm + Vd + Bp );\\n\\treturn diffuse / PI * Lr;\\n}\\n\\nvec3 diffuseCompute(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\\n#if defined(DIFFUSE_LAMBERT)\\n    return Diffuse_Lambert_1062606552(diffuse);\\n#elif defined(DIFFUSE_BURLEY)\\n    return Diffuse_Burley_1062606552(precomputeLight, diffuse, NoL, VoH);\\n#elif defined(DIFFUSE_ORENNAYAR)\\n    return Diffuse_OrenNayar_1062606552(precomputeLight, diffuse, NoL, VoH);\\n#elif defined(DIFFUSE_GOTANDA)\\n    return Diffuse_Gotanda_1062606552(precomputeLight, diffuse, NoL, VoH);\\n#else // DIFFUSE_NONE\\n    return vec3(0.0);\\n#endif\\n}\\n\\nvoid computeLight(in vec3 normal, in vec3 viewDir, in float NoL, in vec3 precomputeLight, in vec3 diffuse, in vec3 specular, in float attenuation, in vec3 lightColor, in vec3 lightDir, in float f90, out vec3 diffuseOut, out vec3 specularOut, out bool lighted) {\\n    lighted = NoL > 0.0;\\n    if (!lighted) {\\n        specularOut = diffuseOut = vec3(0.0);\\n        return;\\n    }\\n    vec3 H = normalize(viewDir + lightDir);\\n    float NoH =  clamp(dot(normal, H), 0., 1.);\\n    float VoH =  clamp(dot(viewDir, H), 0., 1.);\\n\\t\\n    vec3 colorAttenuate = attenuation * NoL * lightColor;\\n    diffuseOut = colorAttenuate * diffuseCompute(precomputeLight, diffuse, NoL, VoH);\\n    specularOut = colorAttenuate * specularCompute(precomputeLight, specular, NoL, NoH, VoH, f90);\\n}\\n\\n// ************************************ IBL ************************************\\nmat3 getEnvironmentTransfrom(mat4 transform) {\\n    vec3 x = vec3(transform[0][0], transform[1][0], transform[2][0]);\\n    vec3 y = vec3(transform[0][1], transform[1][1], transform[2][1]);\\n    vec3 z = vec3(transform[0][2], transform[1][2], transform[2][2]);\\n    mat3 m = mat3(x,y,z);\\n    return m;\\n}\\n\\nvec3 computeDiffuseSPH(vec3 normal, vec3 sphericalHarmonics[9]){\\n    float x = normal.x;\\n    float y = normal.y;\\n    float z = normal.z;\\n    vec3 result = (\\n        sphericalHarmonics[0] +\\n        sphericalHarmonics[1] * y +\\n        sphericalHarmonics[2] * z +\\n        sphericalHarmonics[3] * x +\\n        sphericalHarmonics[4] * y * x +\\n        sphericalHarmonics[5] * y * z +\\n        sphericalHarmonics[6] * (3.0 * z * z - 1.0) +\\n        sphericalHarmonics[7] * (z * x) +\\n        sphericalHarmonics[8] * (x*x - y*y)\\n    );\\n    return max(result, vec3(0.0));\\n}\\n\\n#ifdef PANORAMA\\n    // For y up\\nvec2 normalToPanoramaUV(const in vec3 dir){\\n    float n = length(dir.xz);\\n\\n    // to avoid bleeding the max(-1.0,dir.x / n) is needed\\n    vec2 pos = vec2( (n>0.0000001) ? max(-1.0,dir.x / n) : 0.0, dir.y);\\n\\n    // fix edge bleeding\\n    if ( pos.x > 0.0 ) pos.x = min( 0.999999, pos.x );\\n\\n    pos = acos(pos)*0.31830988618; // RECIPROCAL_PI\\n\\n    pos.x = (dir.z > 0.0) ? pos.x*0.5 : 1.0-(pos.x*0.5);\\n\\n    // shift u to center the panorama to -z\\n    pos.x = mod(pos.x-0.25+1.0, 1.0 );\\n    pos.y = 1.0-pos.y;\\n    return pos;\\n}\\n\\nvec2 computeUVForMipmap(const in float level, const in vec2 uv, const in float size, const in float maxLOD){\\n    // width for level\\n    float widthForLevel = exp2( maxLOD-level);\\n\\n    // the height locally for the level in pixel\\n    // to opimitize a bit we scale down the v by two in the inputs uv\\n    float heightForLevel = widthForLevel * 0.5;\\n\\n    // compact version\\n    float texelSize = 1.0/size;\\n    vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, heightForLevel - 2.0);\\n    uvSpaceLocal.y += size - widthForLevel;\\n    return uvSpaceLocal * texelSize;\\n}\\n\\nvec4 texturePanoramaLod(const in sampler2D tex, const in vec2 size , const in vec3 direction, const in float lod, const in float maxLOD){\\n    vec2 uvBase = normalToPanoramaUV(direction);\\n    // we scale down v here because it avoid to do twice in sub functions\\n    // uvBase.y *= 0.5;\\n    float lod0 = floor(lod);\\n    vec2 uv0 = computeUVForMipmap(lod0, uvBase, size.x, maxLOD);\\n    vec4 texel0 = texture2D(tex, uv0.xy);\\n\\n    float lod1 = ceil(lod);\\n    vec2 uv1 = computeUVForMipmap(lod1, uvBase, size.x, maxLOD);\\n    vec4 texel1 = texture2D(tex, uv0.xy);\\n\\n    return mix(texel0, texel1, fract(lod));\\n}\\n\\n#endif\\n\\n#ifdef MOBILE\\n    // https://www.unrealengine.com/blog/physically-based-shading-on-mobile\\nvec3 integrateBRDF(vec3 specular, float roughness, float NoV, float f90) {\\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\\n    const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\\n    vec4 r = roughness * c0 + c1;\\n    float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\\n    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\\n    return specular * AB.x + AB.y * f90;\\n}\\n\\n#else\\nvec3 integrateBRDF(const in vec3 specular, const in float roughness, const in float NoV, const in float f90) {\\n    vec4 rgba = texture2D(uIntegrateBRDF, vec2(NoV, roughness));\\n    float b = (rgba[3] * 65280.0 + rgba[2] * 255.0);\\n    float a = (rgba[1] * 65280.0 + rgba[0] * 255.0);\\n    const float div = 1.0 / 65535.0;\\n    return (specular * a + b * f90) * div;\\n}\\n#endif\\n\\n// frostbite, lagarde paper p67\\n// http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf\\nfloat linRoughnessToMipmap(float roughnessLinear){\\n    return sqrt(roughnessLinear);\\n}\\n\\nvec3 prefilterEnvMap(const in float rLinear, const in vec3 R) {\\n    vec3 dir = R;\\n    float lod = linRoughnessToMipmap(rLinear) * uEnvironmentLodRange[1]; //(uEnvironmentMaxLod - 1.0);\\n    lod = min(uEnvironmentLodRange[0], lod);\\n#ifdef CUBEMAP_LOD\\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\\n    float scale = 1.0 - exp2(lod) / uEnvironmentSize[0];\\n    vec3 absDir = abs(dir);\\n    float M = max(max(absDir.x, absDir.y), absDir.z);\\n    // cubemapSeamlessFixDirection\\n    if (absDir.x != M) dir.x *= scale;\\n    if (absDir.y != M) dir.y *= scale;\\n    if (absDir.z != M) dir.z *= scale;\\n\\treturn LogLuvToLinear(textureCubeLodEXT(envMap, dir, lod)).rgb;\\n#else\\n    return LogLuvToLinear(texturePanoramaLod(envMap, uEnvironmentSize, R, lod, uEnvironmentLodRange[0])).rgb;\\n\\t#endif\\n\\n}\\n\\n// From Sebastien Lagarde Moving Frostbite to PBR page 69\\n// We have a better approximation of the off specular peak\\n// but due to the other approximations we found this one performs better.\\n// N is the normal direction\\n// R is the mirror vector\\n// This approximation works fine for G smith correlated and uncorrelated\\nvec3 getSpecularDominantDir(const in vec3 N, const in vec3 R, const in float realRoughness) {\\n    float smoothness = 1.0 - realRoughness;\\n    float lerpFactor = smoothness * (sqrt(smoothness) + realRoughness);\\n    return mix(N, R, lerpFactor);\\n}\\n\\nvec3 getPrefilteredEnvMapColor(const in vec3 normal, const in vec3 viewDir, const in float roughness, const in vec3 frontNormal) {\\n    vec3 R = reflect(-viewDir, normal);\\n    // From Sebastien Lagarde Moving Frostbite to PBR page 69\\n    // so roughness = linRoughness * linRoughness\\n    R = getSpecularDominantDir(normal, R, roughness);\\n\\n    vec3 prefilteredColor = prefilterEnvMap(roughness, environmentTransform * R);\\n\\n    float factor = clamp(1.0 + dot(R, frontNormal), 0.0, 1.0);\\n    prefilteredColor *= factor * factor;\\n    return prefilteredColor;\\n}\\n\\nvec3 computeIBLSpecularUE4(const in vec3 normal, const in vec3 viewDir, const in float roughness, const in vec3 specular, const in vec3 frontNormal, const in float f90) {\\n    float NoV = dot(normal, viewDir);\\n    return getPrefilteredEnvMapColor(normal, viewDir, roughness, frontNormal) * integrateBRDF(specular, roughness, NoV, f90);\\n}\\n\\nfloat occlusionHorizon(const in float ao, const in vec3 normal, const in vec3 viewDir) {\\n    if (uOcclusionHorizon == 0) return 1.0;\\n    // http://marmosetco.tumblr.com/post/81245981087\\n    float d = dot(normal, viewDir) + ao;\\n    return clamp((d * d) - 1.0 + ao, 0.0, 1.0);\\n}\\n\\nvoid main(){\\n    vec3 viewDir = -normalize(vViewPosition);\\n    environmentTransform = getEnvironmentTransfrom(uEnvironmentTransform);\\n\\n    vec4 diffuseColor = vec4(diffuse, opacity);\\n    vec3 totalEmissiveRadiance = emissive;\\n    #include <logdepthbuf_fragment>\\n    #include <color_fragment>\\n    #include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n    #include <map_fragment>\\n    #include <emissivemap_fragment>\\n\\n    float roughnessVal;\\n    #ifdef SPECULAR_GLOSSINESS\\n        roughnessVal = glossinessFactor;\\n        #ifdef USE_GLOSSINESSMAP\\n            roughnessVal = texture2D(glossinessMap, vUv).a * glossinessFactor;\\n        #endif\\n        roughnessVal = 1.0 - roughnessVal;\\n    #else\\n        #include <roughnessmap_fragment>\\n        roughnessVal = roughnessFactor;\\n    #endif\\n\\n    vec3 materialSpecular;\\n    vec3 materialDiffuse = diffuseColor.rgb;\\n    #ifdef SPECULAR_GLOSSINESS\\n        materialSpecular = specularFactor;\\n        #ifdef USE_SPECULARMAP\\n            materialSpecular = sRGBToLinear(texture2D(specularMap, vUv)).rgb * specularFactor;\\n        #endif\\n    #else\\n        #include <metalnessmap_fragment>\\n        float f0 = 0.04;\\n        materialSpecular = mix(vec3(f0), diffuseColor.rgb, metalnessFactor);\\n        materialDiffuse = diffuseColor.rgb * (1.0 - metalnessFactor);\\n    #endif\\n\\n    float materialF90 = clamp(50.0 * materialSpecular.g, 0.0, 1.0);\\n    // Roughness\\n    const float minRoughness = 0.001;\\n    float materialRoughness = max(minRoughness , roughnessVal);\\n\\n    // IBL\\n    vec3 transformedNormal = environmentTransform * normal;\\n    vec3 diffuseIBL = materialDiffuse * computeDiffuseSPH(transformedNormal, uEnvironmentSphericalHarmonics);\\n    vec3 specularIBL = computeIBLSpecularUE4(normal, viewDir, materialRoughness, materialSpecular, normal, materialF90);\\n    // AO\\n    float materialAO = 1.0;\\n    #ifdef USE_AOMAP\\n\\tmaterialAO = (texture2D(aoMap, vUv2).r - 1.0) * aoMapIntensity + 1.0;\\n    #endif\\n    diffuseIBL *= uEnvBrightness * materialAO;\\n\\n    float aoSpec = 1.0;\\n    aoSpec = occlusionHorizon(materialAO, normal, viewDir);\\n    specularIBL *= uEnvBrightness * aoSpec;\\n\\n    // Light\\n    float attenuation, NoL;\\n    vec3 lightDir;\\n    vec3 lightSpecular;\\n    vec3 lightDiffuse;\\n    vec3 resultLightSpecular;\\n    vec3 resultLightDiffuse;\\n    bool lighted;\\n    float shadow = 1.0;\\n    vec3 prepCompute = precomputeLight_0(normal, viewDir, max(0.045, materialRoughness));\\n    float shadowDistance;\\n\\n    #if NUM_DIR_LIGHTS > 0\\n        DirectionalLight directionalLight;\\n        #pragma unroll_loop\\n\\t    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n            directionalLight = directionalLights[ i ];\\n            precomputeDirect(normal, viewDir, directionalLight, attenuation, lightDir, NoL);\\n            computeLight(normal, viewDir, NoL, prepCompute, materialDiffuse, materialSpecular, attenuation, directionalLights[ i ].color, lightDir, materialF90, lightDiffuse, lightSpecular, lighted);\\n            // Shadow\\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\\n            shadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( lighted, directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ], shadowDistance ) : 1.0;\\n            lightDiffuse *= shadow;\\n            lightSpecular *= shadow;\\n            #endif\\n\\n            resultLightDiffuse += lightDiffuse;\\n            resultLightSpecular += lightSpecular;\\n        }\\n    #endif\\n    #if NUM_SPOT_LIGHTS > 0\\n        SpotLight spotLight;\\n        #pragma unroll_loop\\n\\t    for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n            spotLight = spotLights[ i ];\\n            precomputeSpot(normal, viewDir, vViewPosition, spotLight, attenuation, lightDir, NoL);\\n            computeLight(normal, viewDir, NoL, prepCompute, materialDiffuse, materialSpecular, attenuation, spotLight.color, lightDir, materialF90, lightDiffuse, lightSpecular, lighted);\\n            // TODO: Shadow && Anisotropy\\n            resultLightDiffuse += lightDiffuse;\\n            resultLightSpecular += lightSpecular;\\n        }\\n    #endif\\n    #if NUM_POINT_LIGHTS > 0\\n        PointLight pointLight;\\n        #pragma unroll_loop\\n\\t    for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n            pointLight = pointLights[ i ];\\n            // TODO: Shadow && Anisotropy\\n            precomputePoint(normal, viewDir, vViewPosition, pointLight, attenuation, lightDir, NoL);\\n            computeLight(normal, viewDir, NoL, prepCompute, materialDiffuse, materialSpecular, attenuation, pointLight.color, lightDir, materialF90, lightDiffuse, lightSpecular, lighted);\\n            resultLightDiffuse += lightDiffuse;\\n            resultLightSpecular += lightSpecular;\\n        }\\n    #endif\\n\\n    // Test\\n    #ifndef ENABLE_IBL\\n        diffuseIBL = vec3(0.);\\n        specularIBL = vec3(0.);\\n    #endif\\n    #ifndef ENABLE_LIGHT\\n        resultLightDiffuse = vec3(0.);\\n        resultLightSpecular = vec3(0.);\\n    #endif\\n\\n    vec3 resultDiffuse = diffuseIBL + resultLightDiffuse;\\n    vec3 resultSpecular = specularIBL + resultLightSpecular;\\n\\n    vec3 totalResult = resultDiffuse + resultSpecular + totalEmissiveRadiance;\\n    vec4 frag = vec4( totalResult, diffuseColor.a );\\n    gl_FragColor = LinearTosRGB(frag);\\n\\n    #include <tonemapping_fragment>\\n    #include <encodings_fragment>\\n}\";","import * as THREE from 'three';\r\n\r\nconst syncMapArr = [\r\n\t'map',\r\n\t'normalMap',\r\n\t'lightMap',\r\n\t'bumpMap',\r\n\t'roughnessMap',\r\n\t'metalnessMap',\r\n\t'aoMap',\r\n\t'emissiveMap',\r\n\t'displacementmap',\r\n];\r\n\r\nconst syncUniformArr = [\r\n\t'color',\r\n\t'roughness',\r\n\t'metalness',\r\n\t'emissive',\r\n]\r\n\r\nconst bgDefaultUniforms = {\r\n\tuBrightness:{\r\n\t\tvalue: 1.0\r\n\t},\r\n\tuEnvironmentTransform: {\r\n\t\tvalue: new THREE.Matrix4()\r\n\t},\r\n}\r\n\r\nconst pbrDefaultUniforms = {\r\n\troughness: {\r\n\t\tvalue: 1.0\r\n\t},\r\n\tmetalness: {\r\n\t\tvalue: 0.5\r\n\t},\r\n\tcolor: {\r\n\t\tvalue: new THREE.Color(0xffffff)\r\n\t},\r\n\temissive: {\r\n\t\tvalue: new THREE.Color(0x000000)\r\n\t},\r\n\tuEnvironmentTransform: {\r\n\t\tvalue: new THREE.Matrix4()\r\n\t},\r\n\tuBrightness:{\r\n\t\tvalue: 1.0\r\n\t},\r\n\tuSpecularPeak:{\r\n\t\tvalue: 1.0\r\n\t},\r\n\tuOcclusionHorizon: {\r\n\t\tvalue: 0\r\n\t},\r\n};\r\n\r\nconst pbrDefaultDefines = {\r\n\tENABLE_IBL: 1,\r\n\tENABLE_LIGHT: 1,\r\n\tDIFFUSE_LAMBERT: 1,\r\n\tNDF_GGX: 1,\r\n\tF_SCHLICK: 1,\r\n\tV_SMITHJOINTAPPROX: 1,\r\n};\r\n\r\nexport { syncMapArr, syncUniformArr, pbrDefaultUniforms, bgDefaultUniforms, pbrDefaultDefines };\r\n","import * as THREE from 'three';\r\nimport pbrVS from '../shaders/pbrVS';\r\nimport pbrFS from '../shaders/pbrFS';\r\nimport { syncMapArr, syncUniformArr, pbrDefaultUniforms, pbrDefaultDefines } from '../const/defaultParams';\r\n\r\nclass PBRMaterial extends THREE.ShaderMaterial {\r\n\tconstructor(mesh, environment, uniformsOpt) {\r\n\t\tlet sourceMaterial = mesh.material;\r\n\t\tsuper();\r\n\t\tthis.modelNormalMatrix = new THREE.Matrix3();\r\n\t\tthis.copy(sourceMaterial);\r\n\r\n\t\tthis.defines = Object.assign({}, pbrDefaultDefines);\r\n\t\t// VertexTangents rely on (vertexTangents && normalMap) in threejs\r\n\t\t// if(this.vertexTangents) this.defines.USE_TANGENT = 1;\r\n\t\t// Copy method no include normalMapType\r\n\t\tthis.normalMapType = sourceMaterial.normalMapType;\r\n\r\n\t\t// Uniforms\r\n\t\tlet UniformsLib = THREE.UniformsLib;\r\n\t\tthis.uniforms = THREE.UniformsUtils.merge([\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.normalmap,\r\n\t\t\tUniformsLib.lightmap,\r\n\t\t\tUniformsLib.bumpmap,\r\n\t\t\tUniformsLib.roughnessmap,\r\n\t\t\tUniformsLib.metalnessmap,\r\n\t\t\tUniformsLib.aomap,\r\n\t\t\tUniformsLib.emissivemap,\r\n\t\t\tUniformsLib.displacementmap,\r\n\t\t\tUniformsLib.envmap,\r\n\t\t\tUniformsLib.fog,\r\n\t\t\tUniformsLib.lights,\r\n\t\t\tpbrDefaultUniforms\r\n\t\t]);\r\n\t\tthis.uniforms['uShadowDepthRange'] = { value: uniformsOpt.shadowDepthRange };\r\n\t\tthis.uniforms['uModelNormalMatrix'] = { value: this.modelNormalMatrix };\r\n\t\tthis.syncEnvSetting(environment);\r\n\r\n\t\t// PBR param sync\r\n\t\tthis.syncParam(sourceMaterial);\r\n\r\n\t\tthis.vertexShader = pbrVS;\r\n\t\tthis.fragmentShader = pbrFS;\r\n\t\tthis.lights = true;\r\n\r\n\t\t// Other\r\n\t\tif (sourceMaterial.isGLTFSpecularGlossinessMaterial === true) this.initSGWorkflow(sourceMaterial);\r\n\r\n\t\t// Sync worldNormal matrix\r\n\t\tmesh.onBeforeRender = () => {\r\n\t\t\tthis.modelNormalMatrix.getNormalMatrix(mesh.matrixWorld);\r\n\t\t};\r\n\r\n\t\tthis.needsUpdate = true;\r\n\t}\r\n\r\n\tsyncEnvSetting(environment) {\r\n\t\tlet { mapEnv, uEnvironmentSphericalHarmonics, uEnvironmentLodRange, uEnvironmentSize, textureLODSupport } = environment;\r\n\t\tif (textureLODSupport) {\r\n\t\t\t// CubeMap\r\n\t\t\tthis.defines[`CUBEMAP_LOD`] = 1;\r\n\t\t} else {\r\n\t\t\t// Panorama\r\n\t\t\tthis.defines[`PANORAMA`] = 1;\r\n\t\t}\r\n\t\t// Common\r\n\t\tthis.envMap = mapEnv.texture;\r\n\t\tthis.uniforms['envMap'] = { value: mapEnv.texture };\r\n\t\tthis.uniforms['uEnvironmentSphericalHarmonics'] = { value: uEnvironmentSphericalHarmonics };\r\n\t\tthis.uniforms['uEnvironmentLodRange'] = { value: uEnvironmentLodRange };\r\n\t\tthis.uniforms['uEnvironmentSize'] = { value: uEnvironmentSize };\r\n\t\t// Mobile optimize\r\n\t\tif (environment.isMobile) {\r\n\t\t\tthis.defines[`MOBILE`] = 1;\r\n\t\t} else {\r\n\t\t\tthis.uniforms['uIntegrateBRDF'] = { value: environment.uIntegrateBRDF };\r\n\t\t}\r\n\t}\r\n\r\n\tsyncParam(sourceMaterial) {\r\n\t\t// Map sync\r\n\t\tsyncMapArr.forEach(key => {\r\n\t\t\tif (sourceMaterial[key] != undefined) {\r\n\t\t\t\tthis[key] = sourceMaterial[key];\r\n\t\t\t\tthis.uniforms[key].value = sourceMaterial[key];\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Uniform sync\r\n\t\tsyncUniformArr.forEach(key => {\r\n\t\t\tif (sourceMaterial[key] != undefined) {\r\n\t\t\t\tthis.uniforms[key].value = sourceMaterial[key];\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Special key\r\n\t\tthis.uniforms.diffuse.value = sourceMaterial.color || new Color(0xffffff);\r\n\t}\r\n\r\n\tinitSGWorkflow(sourceMaterial) {\r\n\t\tconsole.log('SpecularGlossinessMaterial');\r\n\t\tthis.defines[`SPECULAR_GLOSSINESS`] = 1;\r\n\t\tlet { specular, glossiness, specularMap, glossinessMap } = sourceMaterial._extraUniforms;\r\n\t\tif (specularMap.value) {\r\n\t\t\tthis.defines[`USE_SPECULARMAP`] = 1;\r\n\t\t\tthis.uniforms[`specularMap`] = specularMap;\r\n\t\t}\r\n\t\tif (glossinessMap.value) {\r\n\t\t\tthis.defines[`USE_GLOSSINESSMAP`] = 1;\r\n\t\t\tthis.uniforms[`glossinessMap`] = glossinessMap;\r\n\t\t}\r\n\t\tthis.uniforms[`specularFactor`] = specular;\r\n\t\tthis.uniforms[`glossinessFactor`] = glossiness;\r\n\t}\r\n}\r\n\r\nexport { PBRMaterial };\r\n","export default \"#define GLSLIFY 1\\nvarying vec3 vViewNormal;\\n\\nvoid main() {\\n    vViewNormal = position;\\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\\n    pos.z = 1.;\\n    gl_Position = pos;\\n}\\n\";","export default \"#define GLSLIFY 1\\nuniform samplerCube envMap;\\nuniform mat4 uEnvironmentTransform;\\nuniform float uEnvBrightness;\\nuniform vec2 uEnvironmentSize;\\n\\nvarying vec3 vViewNormal;\\n\\nmat3 getEnvironmentTransfrom(mat4 transform) {\\n    vec3 x = vec3(transform[0][0], transform[1][0], transform[2][0]);\\n    vec3 y = vec3(transform[0][1], transform[1][1], transform[2][1]);\\n    vec3 z = vec3(transform[0][2], transform[1][2], transform[2][2]);\\n    mat3 m = mat3(x,y,z);\\n    return m;\\n}\\n\\nvec3 cubemapSeamlessFixDirection(const in vec3 direction, const in float scale ){\\n    vec3 dir = direction;\\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\\n    float M = max(max(abs(dir.x), abs(dir.y)), abs(dir.z));\\n\\n    if (abs(dir.x) != M) dir.x *= scale;\\n    if (abs(dir.y) != M) dir.y *= scale;\\n    if (abs(dir.z) != M) dir.z *= scale;\\n\\n    return dir;\\n}\\n\\nvec4 textureCubemap(const in samplerCube tex, const in vec3 dir){\\n    vec4 rgba = textureCube(tex, dir);\\n    return LogLuvToLinear(rgba);\\n}\\n\\n// Seamless cubemap for background\\nvec4 textureCubeFixed(const in samplerCube tex, const in vec3 direction){\\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\\n    float scale = 1.0 - 1.0 / uEnvironmentSize[0];\\n    vec3 dir = cubemapSeamlessFixDirection(direction, scale);\\n    return textureCubemap(tex, dir);\\n}\\n\\nvoid main(){\\n    vec3 direction = normalize(vViewNormal);\\n    direction = getEnvironmentTransfrom(uEnvironmentTransform) * direction;\\n    vec4 samplerColor = uEnvBrightness * textureCubeFixed(envMap, direction);\\n    gl_FragColor = LinearTosRGB(samplerColor);\\n    \\n    #include <tonemapping_fragment>\\n}\\n\";","import * as THREE from 'three';\r\nimport { bgDefaultUniforms } from '../../const/defaultParams';\r\nimport backgroundVS from './shaders/backgroundVS';\r\nimport backgroundFS from './shaders/backgroundFS';\r\n\r\nclass BackgroundMaterial extends THREE.ShaderMaterial {\r\n\tconstructor(options) {\r\n\t\tlet { envMap, uBGEnvironmentSize, uEnvBrightness, debug } = options;\r\n\t\tlet { uEnvironmentTransform } = bgDefaultUniforms;\r\n\t\tlet uniforms = {\r\n\t\t\tenvMap: { value: envMap },\r\n\t\t\tuEnvironmentSize: { value: uBGEnvironmentSize},\r\n\t\t\tuEnvBrightness,\r\n\t\t\tuEnvironmentTransform\r\n\t\t};\r\n\t\tsuper({\r\n\t\t\tuniforms,\r\n\t\t\tvertexShader: backgroundVS,\r\n\t\t\tfragmentShader: backgroundFS,\r\n\t\t\tside: THREE.DoubleSide,\r\n\t\t\tdepthTest: debug ? true : false\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport { BackgroundMaterial }","import * as THREE from 'three';\r\nimport { BackgroundMaterial } from './BackgroundMaterial';\r\n\r\n class Background extends THREE.Mesh {\r\n\tconstructor(uniforms, size = 1000) {\r\n\t\tconst radius = size / 2;\r\n\t\tlet sphere = new THREE.SphereGeometry(radius, 20, 20);\r\n\t\tlet material = new BackgroundMaterial(uniforms);\r\n\t\tsuper(sphere, material);\r\n\t\tthis.radius = radius;\r\n\t\tthis.sphere = sphere;\r\n\t}\r\n\r\n\tget envMap() {\r\n\t\treturn this.material.envMap;\r\n\t}\r\n\t\r\n\tset envMap(envMap) {\r\n\t\tthis.material.envMap = envMap;\r\n\t}\r\n\r\n\tget mesh() {\r\n\t\treturn this.sphere;\r\n\t}\r\n\r\n\tsetSize(size){\r\n\t\tlet scale = size / this.radius;\r\n\t\t// Half\r\n\t\tthis.scale.setScalar(scale);\r\n\t}\r\n}\r\n\r\nexport { Background };","const envMapPath = './assets/envMap/';\r\n\r\nconst envMapList = [\r\n    'Arches',\r\n    'Alexs',\r\n\t'GCanyon',\r\n\t'Industrial',\r\n\t'Milkyway',\r\n\t'Outside',\r\n\t'PaperMill',\r\n\t'Royal',\r\n    'TropicalRuins',\r\n    'Venice',\r\n];\r\n\r\nconst diffuseEquation = [\r\n\t'Lambert',\r\n\t'Burley',\r\n\t'OrenNayar',\r\n\t'Gotanda',\r\n\t'None'\r\n];\r\n\r\nconst specularFresnelEquation = [\r\n\t'Schlick',\r\n\t'CookTorrance',\r\n\t'None',\r\n];\r\n\r\nconst specularNDFEquation = [\r\n\t'GGX',\r\n\t'BlinnPhong',\r\n\t'Beckmann',\r\n];\r\n\r\nconst specularVisEquation = [\r\n\t'SmithJointApprox',\r\n\t'Implicit',\r\n\t'Neumann',\r\n\t'Kelemen',\r\n\t'Schlick',\r\n\t'Smith',\r\n];\r\n\r\nconst toneMappingList = [\r\n\t'ACESFilmic',\r\n\t'Linear',\r\n\t'Reinhard',\r\n\t'Uncharted2',\r\n\t'Cineon',\r\n\t'No',\r\n];\r\n\r\nexport {\r\n    envMapPath,\r\n    envMapList,\r\n    diffuseEquation,\r\n    specularFresnelEquation,\r\n    specularNDFEquation,\r\n\tspecularVisEquation,\r\n\ttoneMappingList\r\n}","import * as THREE from 'three';\r\n\r\nfunction adjustCameraByBox(camera, object, controls, factor = 1.){\r\n\tlet box = new THREE.Box3().setFromObject(object);\r\n\tlet size = box.getSize(new THREE.Vector3());\r\n\tconst maxSize = Math.max( size.x, size.y, size.z );\r\n\tconst fitHeightDistance = maxSize / ( 2 * Math.atan( Math.PI * camera.fov / 360 ) );\r\n\tconst fitWidthDistance = fitHeightDistance / camera.aspect;\r\n\tconst distance = factor * Math.max( fitHeightDistance, fitWidthDistance );\r\n\r\n\tcamera.near = distance / 100;\r\n\tcamera.far = distance * 100;\r\n\tcamera.position.set(0, distance/4, distance);\r\n\tcamera.updateProjectionMatrix();\r\n\tif(controls){\r\n\t\tcontrols.maxDistance = distance * 20;\r\n\t\tcontrols.update();\r\n\t}\r\n\treturn distance;\r\n}\r\n\r\nfunction adjustSunLightByBox(light, scene, object, debug){\r\n\tlet box = new THREE.Box3().setFromObject(object);\r\n\tlight.shadow.mapSize.width = 1024;\r\n\tlight.shadow.mapSize.height = 1024;\r\n\t// Shadow Camera\r\n\tlet lightCamera = light.shadow.camera;\r\n\tlightCamera.position.copy(light.position);\r\n\t// Trasnlate => Rotation\r\n\tlightCamera.lookAt(new THREE.Vector3(0, 0, 0));\r\n\tlightCamera.position.set(0, 0, 0);\r\n\tlightCamera.updateMatrixWorld(true);\r\n\r\n\t// Box(near\\far\\top...boundingBox) from world space to lightCamera view space\r\n\tlet cameraInverseMatrix = new THREE.Matrix4();\r\n\tcameraInverseMatrix.getInverse(lightCamera.matrixWorld);\r\n\tbox.applyMatrix4(cameraInverseMatrix);\r\n\r\n\tlightCamera.left = box.min.x - 0.01;\r\n\tlightCamera.right = box.max.x + 0.01;\r\n\tlightCamera.top = box.min.y - 0.01;\r\n\tlightCamera.bottom = box.max.y + 0.01;\r\n\tlightCamera.near = -box.max.z - 0.01;\r\n\tlightCamera.far = -box.min.z + 0.01;\r\n\tlightCamera.updateProjectionMatrix();\r\n\t// Todo: Dynamic compute\r\n\tlight.shadow.bias = -0.01;\r\n\r\n\t// Helper\r\n\tif(debug){\r\n\t\tlet helper = new THREE.DirectionalLightHelper( light, 5, 0xffffff );\r\n\t\tscene.add( helper );\r\n\t\tlet helper1 = new THREE.CameraHelper( lightCamera );\r\n\t\tscene.add( helper1 );\r\n\t}\r\n}\r\n\r\nexport { adjustCameraByBox, adjustSunLightByBox };\r\n","function getEleWidth(element) {\r\n\tlet res;\r\n\tif (element.currentStyle) {\r\n\t\tres = element.currentStyle.width; // For IE\r\n\t} else {\r\n\t\tres = getComputedStyle(element, false).width;\r\n\t}\r\n\t// Get number\r\n\tif (~res.indexOf('px')) res = res.slice(0, -2);\r\n\treturn res;\r\n}\r\n\r\nfunction getEleHeight(element) {\r\n\tlet res;\r\n\tif (element.currentStyle) {\r\n\t\tres = element.currentStyle.height;\r\n\t} else {\r\n\t\tres = getComputedStyle(element, false).height;\r\n\t}\r\n\tif (~res.indexOf('px')) res = res.slice(0, -2);\r\n\treturn res;\r\n}\r\n\r\nfunction isMobile() {\r\n\tlet e = /AppleWebKit/.test(navigator.userAgent) && /Mobile\\/\\w+/.test(navigator.userAgent);\r\n\treturn e || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent);\r\n}\r\n\r\nexport { getEleWidth, getEleHeight, isMobile };\r\n","/**\r\n * dat-gui JavaScript Controller Library\r\n * http://code.google.com/p/dat-gui\r\n *\r\n * Copyright 2011 Data Arts Team, Google Creative Lab\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\nfunction ___$insertStyle( css ) {\r\n\r\n\tif ( ! css ) {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\tif ( typeof window === 'undefined' ) {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tvar style = document.createElement( 'style' );\r\n\r\n\tstyle.setAttribute( 'type', 'text/css' );\r\n\tstyle.innerHTML = css;\r\n\tdocument.head.appendChild( style );\r\n\r\n\treturn css;\r\n\r\n}\r\n\r\nfunction colorToString( color, forceCSSHex ) {\r\n\r\n\tvar colorFormat = color.__state.conversionName.toString();\r\n\tvar r = Math.round( color.r );\r\n\tvar g = Math.round( color.g );\r\n\tvar b = Math.round( color.b );\r\n\tvar a = color.a;\r\n\tvar h = Math.round( color.h );\r\n\tvar s = color.s.toFixed( 1 );\r\n\tvar v = color.v.toFixed( 1 );\r\n\tif ( forceCSSHex || colorFormat === 'THREE_CHAR_HEX' || colorFormat === 'SIX_CHAR_HEX' ) {\r\n\r\n\t\tvar str = color.hex.toString( 16 );\r\n\t\twhile ( str.length < 6 ) {\r\n\r\n\t\t\tstr = '0' + str;\r\n\r\n\t\t}\r\n\t\treturn '#' + str;\r\n\r\n\t} else if ( colorFormat === 'CSS_RGB' ) {\r\n\r\n\t\treturn 'rgb(' + r + ',' + g + ',' + b + ')';\r\n\r\n\t} else if ( colorFormat === 'CSS_RGBA' ) {\r\n\r\n\t\treturn 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\r\n\r\n\t} else if ( colorFormat === 'HEX' ) {\r\n\r\n\t\treturn '0x' + color.hex.toString( 16 );\r\n\r\n\t} else if ( colorFormat === 'RGB_ARRAY' ) {\r\n\r\n\t\treturn '[' + r + ',' + g + ',' + b + ']';\r\n\r\n\t} else if ( colorFormat === 'RGBA_ARRAY' ) {\r\n\r\n\t\treturn '[' + r + ',' + g + ',' + b + ',' + a + ']';\r\n\r\n\t} else if ( colorFormat === 'RGB_OBJ' ) {\r\n\r\n\t\treturn '{r:' + r + ',g:' + g + ',b:' + b + '}';\r\n\r\n\t} else if ( colorFormat === 'RGBA_OBJ' ) {\r\n\r\n\t\treturn '{r:' + r + ',g:' + g + ',b:' + b + ',a:' + a + '}';\r\n\r\n\t} else if ( colorFormat === 'HSV_OBJ' ) {\r\n\r\n\t\treturn '{h:' + h + ',s:' + s + ',v:' + v + '}';\r\n\r\n\t} else if ( colorFormat === 'HSVA_OBJ' ) {\r\n\r\n\t\treturn '{h:' + h + ',s:' + s + ',v:' + v + ',a:' + a + '}';\r\n\r\n\t}\r\n\treturn 'unknown format';\r\n\r\n}\r\n\r\nvar ARR_EACH = Array.prototype.forEach;\r\nvar ARR_SLICE = Array.prototype.slice;\r\nvar Common = {\r\n\tBREAK: {},\r\n\textend: function extend( target ) {\r\n\r\n\t\tthis.each( ARR_SLICE.call( arguments, 1 ), function ( obj ) {\r\n\r\n\t\t\tvar keys = this.isObject( obj ) ? Object.keys( obj ) : [];\r\n\t\t\tkeys.forEach( function ( key ) {\r\n\r\n\t\t\t\tif ( ! this.isUndefined( obj[ key ] ) ) {\r\n\r\n\t\t\t\t\ttarget[ key ] = obj[ key ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}.bind( this ) );\r\n\r\n\t\t}, this );\r\n\t\treturn target;\r\n\r\n\t},\r\n\tdefaults: function defaults( target ) {\r\n\r\n\t\tthis.each( ARR_SLICE.call( arguments, 1 ), function ( obj ) {\r\n\r\n\t\t\tvar keys = this.isObject( obj ) ? Object.keys( obj ) : [];\r\n\t\t\tkeys.forEach( function ( key ) {\r\n\r\n\t\t\t\tif ( this.isUndefined( target[ key ] ) ) {\r\n\r\n\t\t\t\t\ttarget[ key ] = obj[ key ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}.bind( this ) );\r\n\r\n\t\t}, this );\r\n\t\treturn target;\r\n\r\n\t},\r\n\tcompose: function compose() {\r\n\r\n\t\tvar toCall = ARR_SLICE.call( arguments );\r\n\t\treturn function () {\r\n\r\n\t\t\tvar args = ARR_SLICE.call( arguments );\r\n\t\t\tfor ( var i = toCall.length - 1; i >= 0; i -- ) {\r\n\r\n\t\t\t\targs = [ toCall[ i ].apply( this, args ) ];\r\n\r\n\t\t\t}\r\n\t\t\treturn args[ 0 ];\r\n\r\n\t\t};\r\n\r\n\t},\r\n\teach: function each( obj, itr, scope ) {\r\n\r\n\t\tif ( ! obj ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\t\tif ( ARR_EACH && obj.forEach && obj.forEach === ARR_EACH ) {\r\n\r\n\t\t\tobj.forEach( itr, scope );\r\n\r\n\t\t} else if ( obj.length === obj.length + 0 ) {\r\n\r\n\t\t\tvar key = void 0;\r\n\t\t\tvar l = void 0;\r\n\t\t\tfor ( key = 0, l = obj.length; key < l; key ++ ) {\r\n\r\n\t\t\t\tif ( key in obj && itr.call( scope, obj[ key ], key ) === this.BREAK ) {\r\n\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( var _key in obj ) {\r\n\r\n\t\t\t\tif ( itr.call( scope, obj[ _key ], _key ) === this.BREAK ) {\r\n\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\tdefer: function defer( fnc ) {\r\n\r\n\t\tsetTimeout( fnc, 0 );\r\n\r\n\t},\r\n\tdebounce: function debounce( func, threshold, callImmediately ) {\r\n\r\n\t\tvar timeout = void 0;\r\n\t\treturn function () {\r\n\r\n\t\t\tvar obj = this;\r\n\t\t\tvar args = arguments;\r\n\t\t\tfunction delayed() {\r\n\r\n\t\t\t\ttimeout = null;\r\n\t\t\t\tif ( ! callImmediately ) func.apply( obj, args );\r\n\r\n\t\t\t}\r\n\t\t\tvar callNow = callImmediately || ! timeout;\r\n\t\t\tclearTimeout( timeout );\r\n\t\t\ttimeout = setTimeout( delayed, threshold );\r\n\t\t\tif ( callNow ) {\r\n\r\n\t\t\t\tfunc.apply( obj, args );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t},\r\n\ttoArray: function toArray( obj ) {\r\n\r\n\t\tif ( obj.toArray ) return obj.toArray();\r\n\t\treturn ARR_SLICE.call( obj );\r\n\r\n\t},\r\n\tisUndefined: function isUndefined( obj ) {\r\n\r\n\t\treturn obj === undefined;\r\n\r\n\t},\r\n\tisNull: function isNull( obj ) {\r\n\r\n\t\treturn obj === null;\r\n\r\n\t},\r\n\tisNaN: function ( _isNaN ) {\r\n\r\n\t\tfunction isNaN() {\r\n\r\n\t\t\treturn _isNaN.apply( this, arguments );\r\n\r\n\t\t}\r\n\t\tisNaN.toString = function () {\r\n\r\n\t\t\treturn _isNaN.toString();\r\n\r\n\t\t};\r\n\t\treturn isNaN;\r\n\r\n\t}( function ( obj ) {\r\n\r\n\t\treturn isNaN( obj );\r\n\r\n\t} ),\r\n\tisArray: Array.isArray || function ( obj ) {\r\n\r\n\t\treturn obj.constructor === Array;\r\n\r\n\t},\r\n\tisObject: function isObject( obj ) {\r\n\r\n\t\treturn obj === Object( obj );\r\n\r\n\t},\r\n\tisNumber: function isNumber( obj ) {\r\n\r\n\t\treturn obj === obj + 0;\r\n\r\n\t},\r\n\tisString: function isString( obj ) {\r\n\r\n\t\treturn obj === obj + '';\r\n\r\n\t},\r\n\tisBoolean: function isBoolean( obj ) {\r\n\r\n\t\treturn obj === false || obj === true;\r\n\r\n\t},\r\n\tisFunction: function isFunction( obj ) {\r\n\r\n\t\treturn Object.prototype.toString.call( obj ) === '[object Function]';\r\n\r\n\t}\r\n};\r\n\r\nvar INTERPRETATIONS = [\r\n\t{\r\n\t\tlitmus: Common.isString,\r\n\t\tconversions: {\r\n\t\t\tTHREE_CHAR_HEX: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tvar test = original.match( /^#([A-F0-9])([A-F0-9])([A-F0-9])$/i );\r\n\t\t\t\t\tif ( test === null ) {\r\n\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'HEX',\r\n\t\t\t\t\t\thex: parseInt( '0x' + test[ 1 ].toString() + test[ 1 ].toString() + test[ 2 ].toString() + test[ 2 ].toString() + test[ 3 ].toString() + test[ 3 ].toString(), 0 )\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: colorToString\r\n\t\t\t},\r\n\t\t\tSIX_CHAR_HEX: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tvar test = original.match( /^#([A-F0-9]{6})$/i );\r\n\t\t\t\t\tif ( test === null ) {\r\n\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'HEX',\r\n\t\t\t\t\t\thex: parseInt( '0x' + test[ 1 ].toString(), 0 )\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: colorToString\r\n\t\t\t},\r\n\t\t\tCSS_RGB: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tvar test = original.match( /^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/ );\r\n\t\t\t\t\tif ( test === null ) {\r\n\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\tr: parseFloat( test[ 1 ] ),\r\n\t\t\t\t\t\tg: parseFloat( test[ 2 ] ),\r\n\t\t\t\t\t\tb: parseFloat( test[ 3 ] )\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: colorToString\r\n\t\t\t},\r\n\t\t\tCSS_RGBA: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tvar test = original.match( /^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/ );\r\n\t\t\t\t\tif ( test === null ) {\r\n\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\tr: parseFloat( test[ 1 ] ),\r\n\t\t\t\t\t\tg: parseFloat( test[ 2 ] ),\r\n\t\t\t\t\t\tb: parseFloat( test[ 3 ] ),\r\n\t\t\t\t\t\ta: parseFloat( test[ 4 ] )\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: colorToString\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tlitmus: Common.isNumber,\r\n\t\tconversions: {\r\n\t\t\tHEX: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'HEX',\r\n\t\t\t\t\t\thex: original,\r\n\t\t\t\t\t\tconversionName: 'HEX'\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn color.hex;\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tlitmus: Common.isArray,\r\n\t\tconversions: {\r\n\t\t\tRGB_ARRAY: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( original.length !== 3 ) {\r\n\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\tr: original[ 0 ],\r\n\t\t\t\t\t\tg: original[ 1 ],\r\n\t\t\t\t\t\tb: original[ 2 ]\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn [ color.r, color.g, color.b ];\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tRGBA_ARRAY: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( original.length !== 4 ) return false;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\tr: original[ 0 ],\r\n\t\t\t\t\t\tg: original[ 1 ],\r\n\t\t\t\t\t\tb: original[ 2 ],\r\n\t\t\t\t\t\ta: original[ 3 ]\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn [ color.r, color.g, color.b, color.a ];\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tlitmus: Common.isObject,\r\n\t\tconversions: {\r\n\t\t\tRGBA_OBJ: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( Common.isNumber( original.r ) && Common.isNumber( original.g ) && Common.isNumber( original.b ) && Common.isNumber( original.a ) ) {\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\t\tr: original.r,\r\n\t\t\t\t\t\t\tg: original.g,\r\n\t\t\t\t\t\t\tb: original.b,\r\n\t\t\t\t\t\t\ta: original.a\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tr: color.r,\r\n\t\t\t\t\t\tg: color.g,\r\n\t\t\t\t\t\tb: color.b,\r\n\t\t\t\t\t\ta: color.a\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tRGB_OBJ: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( Common.isNumber( original.r ) && Common.isNumber( original.g ) && Common.isNumber( original.b ) ) {\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tspace: 'RGB',\r\n\t\t\t\t\t\t\tr: original.r,\r\n\t\t\t\t\t\t\tg: original.g,\r\n\t\t\t\t\t\t\tb: original.b\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tr: color.r,\r\n\t\t\t\t\t\tg: color.g,\r\n\t\t\t\t\t\tb: color.b\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tHSVA_OBJ: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( Common.isNumber( original.h ) && Common.isNumber( original.s ) && Common.isNumber( original.v ) && Common.isNumber( original.a ) ) {\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tspace: 'HSV',\r\n\t\t\t\t\t\t\th: original.h,\r\n\t\t\t\t\t\t\ts: original.s,\r\n\t\t\t\t\t\t\tv: original.v,\r\n\t\t\t\t\t\t\ta: original.a\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\th: color.h,\r\n\t\t\t\t\t\ts: color.s,\r\n\t\t\t\t\t\tv: color.v,\r\n\t\t\t\t\t\ta: color.a\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tHSV_OBJ: {\r\n\t\t\t\tread: function read( original ) {\r\n\r\n\t\t\t\t\tif ( Common.isNumber( original.h ) && Common.isNumber( original.s ) && Common.isNumber( original.v ) ) {\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tspace: 'HSV',\r\n\t\t\t\t\t\t\th: original.h,\r\n\t\t\t\t\t\t\ts: original.s,\r\n\t\t\t\t\t\t\tv: original.v\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t},\r\n\t\t\t\twrite: function write( color ) {\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\th: color.h,\r\n\t\t\t\t\t\ts: color.s,\r\n\t\t\t\t\t\tv: color.v\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} ];\r\nvar result = void 0;\r\nvar toReturn = void 0;\r\nvar interpret = function interpret() {\r\n\r\n\ttoReturn = false;\r\n\tvar original = arguments.length > 1 ? Common.toArray( arguments ) : arguments[ 0 ];\r\n\tCommon.each( INTERPRETATIONS, function ( family ) {\r\n\r\n\t\tif ( family.litmus( original ) ) {\r\n\r\n\t\t\tCommon.each( family.conversions, function ( conversion, conversionName ) {\r\n\r\n\t\t\t\tresult = conversion.read( original );\r\n\t\t\t\tif ( toReturn === false && result !== false ) {\r\n\r\n\t\t\t\t\ttoReturn = result;\r\n\t\t\t\t\tresult.conversionName = conversionName;\r\n\t\t\t\t\tresult.conversion = conversion;\r\n\t\t\t\t\treturn Common.BREAK;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\t\t\treturn Common.BREAK;\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\treturn toReturn;\r\n\r\n};\r\n\r\nvar tmpComponent = void 0;\r\nvar ColorMath = {\r\n\thsv_to_rgb: function hsv_to_rgb( h, s, v ) {\r\n\r\n\t\tvar hi = Math.floor( h / 60 ) % 6;\r\n\t\tvar f = h / 60 - Math.floor( h / 60 );\r\n\t\tvar p = v * ( 1.0 - s );\r\n\t\tvar q = v * ( 1.0 - f * s );\r\n\t\tvar t = v * ( 1.0 - ( 1.0 - f ) * s );\r\n\t\tvar c = [[ v, t, p ], [ q, v, p ], [ p, v, t ], [ p, q, v ], [ t, p, v ], [ v, p, q ]][ hi ];\r\n\t\treturn {\r\n\t\t\tr: c[ 0 ] * 255,\r\n\t\t\tg: c[ 1 ] * 255,\r\n\t\t\tb: c[ 2 ] * 255\r\n\t\t};\r\n\r\n\t},\r\n\trgb_to_hsv: function rgb_to_hsv( r, g, b ) {\r\n\r\n\t\tvar min = Math.min( r, g, b );\r\n\t\tvar max = Math.max( r, g, b );\r\n\t\tvar delta = max - min;\r\n\t\tvar h = void 0;\r\n\t\tvar s = void 0;\r\n\t\tif ( max !== 0 ) {\r\n\r\n\t\t\ts = delta / max;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn {\r\n\t\t\t\th: NaN,\r\n\t\t\t\ts: 0,\r\n\t\t\t\tv: 0\r\n\t\t\t};\r\n\r\n\t\t}\r\n\t\tif ( r === max ) {\r\n\r\n\t\t\th = ( g - b ) / delta;\r\n\r\n\t\t} else if ( g === max ) {\r\n\r\n\t\t\th = 2 + ( b - r ) / delta;\r\n\r\n\t\t} else {\r\n\r\n\t\t\th = 4 + ( r - g ) / delta;\r\n\r\n\t\t}\r\n\t\th /= 6;\r\n\t\tif ( h < 0 ) {\r\n\r\n\t\t\th += 1;\r\n\r\n\t\t}\r\n\t\treturn {\r\n\t\t\th: h * 360,\r\n\t\t\ts: s,\r\n\t\t\tv: max / 255\r\n\t\t};\r\n\r\n\t},\r\n\trgb_to_hex: function rgb_to_hex( r, g, b ) {\r\n\r\n\t\tvar hex = this.hex_with_component( 0, 2, r );\r\n\t\thex = this.hex_with_component( hex, 1, g );\r\n\t\thex = this.hex_with_component( hex, 0, b );\r\n\t\treturn hex;\r\n\r\n\t},\r\n\tcomponent_from_hex: function component_from_hex( hex, componentIndex ) {\r\n\r\n\t\treturn hex >> componentIndex * 8 & 0xFF;\r\n\r\n\t},\r\n\thex_with_component: function hex_with_component( hex, componentIndex, value ) {\r\n\r\n\t\treturn value << ( tmpComponent = componentIndex * 8 ) | hex & ~ ( 0xFF << tmpComponent );\r\n\r\n\t}\r\n};\r\n\r\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function ( obj ) {\r\n\r\n\treturn typeof obj;\r\n\r\n} : function ( obj ) {\r\n\r\n\treturn obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar classCallCheck = function ( instance, Constructor ) {\r\n\r\n\tif ( ! ( instance instanceof Constructor ) ) {\r\n\r\n\t\tthrow new TypeError( \"Cannot call a class as a function\" );\r\n\r\n\t}\r\n\r\n};\r\n\r\nvar createClass = function () {\r\n\r\n\tfunction defineProperties( target, props ) {\r\n\r\n\t\tfor ( var i = 0; i < props.length; i ++ ) {\r\n\r\n\t\t\tvar descriptor = props[ i ];\r\n\t\t\tdescriptor.enumerable = descriptor.enumerable || false;\r\n\t\t\tdescriptor.configurable = true;\r\n\t\t\tif ( \"value\" in descriptor ) descriptor.writable = true;\r\n\t\t\tObject.defineProperty( target, descriptor.key, descriptor );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn function ( Constructor, protoProps, staticProps ) {\r\n\r\n\t\tif ( protoProps ) defineProperties( Constructor.prototype, protoProps );\r\n\t\tif ( staticProps ) defineProperties( Constructor, staticProps );\r\n\t\treturn Constructor;\r\n\r\n\t};\r\n\r\n}();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar get = function get( object, property, receiver ) {\r\n\r\n\tif ( object === null ) object = Function.prototype;\r\n\tvar desc = Object.getOwnPropertyDescriptor( object, property );\r\n\r\n\tif ( desc === undefined ) {\r\n\r\n\t\tvar parent = Object.getPrototypeOf( object );\r\n\r\n\t\tif ( parent === null ) {\r\n\r\n\t\t\treturn undefined;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn get( parent, property, receiver );\r\n\r\n\t\t}\r\n\r\n\t} else if ( \"value\" in desc ) {\r\n\r\n\t\treturn desc.value;\r\n\r\n\t} else {\r\n\r\n\t\tvar getter = desc.get;\r\n\r\n\t\tif ( getter === undefined ) {\r\n\r\n\t\t\treturn undefined;\r\n\r\n\t\t}\r\n\r\n\t\treturn getter.call( receiver );\r\n\r\n\t}\r\n\r\n};\r\n\r\nvar inherits = function ( subClass, superClass ) {\r\n\r\n\tif ( typeof superClass !== \"function\" && superClass !== null ) {\r\n\r\n\t\tthrow new TypeError( \"Super expression must either be null or a function, not \" + typeof superClass );\r\n\r\n\t}\r\n\r\n\tsubClass.prototype = Object.create( superClass && superClass.prototype, {\r\n\t\tconstructor: {\r\n\t\t\tvalue: subClass,\r\n\t\t\tenumerable: false,\r\n\t\t\twritable: true,\r\n\t\t\tconfigurable: true\r\n\t\t}\r\n\t} );\r\n\tif ( superClass ) Object.setPrototypeOf ? Object.setPrototypeOf( subClass, superClass ) : subClass.__proto__ = superClass;\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar possibleConstructorReturn = function ( self, call ) {\r\n\r\n\tif ( ! self ) {\r\n\r\n\t\tthrow new ReferenceError( \"this hasn't been initialised - super() hasn't been called\" );\r\n\r\n\t}\r\n\r\n\treturn call && ( typeof call === \"object\" || typeof call === \"function\" ) ? call : self;\r\n\r\n};\r\n\r\nvar Color = function () {\r\n\r\n\tfunction Color() {\r\n\r\n\t\tclassCallCheck( this, Color );\r\n\t\tthis.__state = interpret.apply( this, arguments );\r\n\t\tif ( this.__state === false ) {\r\n\r\n\t\t\tthrow new Error( 'Failed to interpret color arguments' );\r\n\r\n\t\t}\r\n\t\tthis.__state.a = this.__state.a || 1;\r\n\r\n\t}\r\n\tcreateClass( Color, [ {\r\n\t\tkey: 'toString',\r\n\t\tvalue: function toString() {\r\n\r\n\t\t\treturn colorToString( this );\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'toHexString',\r\n\t\tvalue: function toHexString() {\r\n\r\n\t\t\treturn colorToString( this, true );\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'toOriginal',\r\n\t\tvalue: function toOriginal() {\r\n\r\n\t\t\treturn this.__state.conversion.write( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn Color;\r\n\r\n}();\r\nfunction defineRGBComponent( target, component, componentHexIndex ) {\r\n\r\n\tObject.defineProperty( target, component, {\r\n\t\tget: function get$$1() {\r\n\r\n\t\t\tif ( this.__state.space === 'RGB' ) {\r\n\r\n\t\t\t\treturn this.__state[ component ];\r\n\r\n\t\t\t}\r\n\t\t\tColor.recalculateRGB( this, component, componentHexIndex );\r\n\t\t\treturn this.__state[ component ];\r\n\r\n\t\t},\r\n\t\tset: function set$$1( v ) {\r\n\r\n\t\t\tif ( this.__state.space !== 'RGB' ) {\r\n\r\n\t\t\t\tColor.recalculateRGB( this, component, componentHexIndex );\r\n\t\t\t\tthis.__state.space = 'RGB';\r\n\r\n\t\t\t}\r\n\t\t\tthis.__state[ component ] = v;\r\n\r\n\t\t}\r\n\t} );\r\n\r\n}\r\nfunction defineHSVComponent( target, component ) {\r\n\r\n\tObject.defineProperty( target, component, {\r\n\t\tget: function get$$1() {\r\n\r\n\t\t\tif ( this.__state.space === 'HSV' ) {\r\n\r\n\t\t\t\treturn this.__state[ component ];\r\n\r\n\t\t\t}\r\n\t\t\tColor.recalculateHSV( this );\r\n\t\t\treturn this.__state[ component ];\r\n\r\n\t\t},\r\n\t\tset: function set$$1( v ) {\r\n\r\n\t\t\tif ( this.__state.space !== 'HSV' ) {\r\n\r\n\t\t\t\tColor.recalculateHSV( this );\r\n\t\t\t\tthis.__state.space = 'HSV';\r\n\r\n\t\t\t}\r\n\t\t\tthis.__state[ component ] = v;\r\n\r\n\t\t}\r\n\t} );\r\n\r\n}\r\nColor.recalculateRGB = function ( color, component, componentHexIndex ) {\r\n\r\n\tif ( color.__state.space === 'HEX' ) {\r\n\r\n\t\tcolor.__state[ component ] = ColorMath.component_from_hex( color.__state.hex, componentHexIndex );\r\n\r\n\t} else if ( color.__state.space === 'HSV' ) {\r\n\r\n\t\tCommon.extend( color.__state, ColorMath.hsv_to_rgb( color.__state.h, color.__state.s, color.__state.v ) );\r\n\r\n\t} else {\r\n\r\n\t\tthrow new Error( 'Corrupted color state' );\r\n\r\n\t}\r\n\r\n};\r\nColor.recalculateHSV = function ( color ) {\r\n\r\n\tvar result = ColorMath.rgb_to_hsv( color.r, color.g, color.b );\r\n\tCommon.extend( color.__state, {\r\n\t\ts: result.s,\r\n\t\tv: result.v\r\n\t} );\r\n\tif ( ! Common.isNaN( result.h ) ) {\r\n\r\n\t\tcolor.__state.h = result.h;\r\n\r\n\t} else if ( Common.isUndefined( color.__state.h ) ) {\r\n\r\n\t\tcolor.__state.h = 0;\r\n\r\n\t}\r\n\r\n};\r\nColor.COMPONENTS = [ 'r', 'g', 'b', 'h', 's', 'v', 'hex', 'a' ];\r\ndefineRGBComponent( Color.prototype, 'r', 2 );\r\ndefineRGBComponent( Color.prototype, 'g', 1 );\r\ndefineRGBComponent( Color.prototype, 'b', 0 );\r\ndefineHSVComponent( Color.prototype, 'h' );\r\ndefineHSVComponent( Color.prototype, 's' );\r\ndefineHSVComponent( Color.prototype, 'v' );\r\nObject.defineProperty( Color.prototype, 'a', {\r\n\tget: function get$$1() {\r\n\r\n\t\treturn this.__state.a;\r\n\r\n\t},\r\n\tset: function set$$1( v ) {\r\n\r\n\t\tthis.__state.a = v;\r\n\r\n\t}\r\n} );\r\nObject.defineProperty( Color.prototype, 'hex', {\r\n\tget: function get$$1() {\r\n\r\n\t\tif ( ! this.__state.space !== 'HEX' ) {\r\n\r\n\t\t\tthis.__state.hex = ColorMath.rgb_to_hex( this.r, this.g, this.b );\r\n\r\n\t\t}\r\n\t\treturn this.__state.hex;\r\n\r\n\t},\r\n\tset: function set$$1( v ) {\r\n\r\n\t\tthis.__state.space = 'HEX';\r\n\t\tthis.__state.hex = v;\r\n\r\n\t}\r\n} );\r\n\r\nvar Controller = function () {\r\n\r\n\tfunction Controller( object, property ) {\r\n\r\n\t\tclassCallCheck( this, Controller );\r\n\t\tthis.initialValue = object[ property ];\r\n\t\tthis.domElement = document.createElement( 'div' );\r\n\t\tthis.object = object;\r\n\t\tthis.property = property;\r\n\t\tthis.__onChange = undefined;\r\n\t\tthis.__onFinishChange = undefined;\r\n\r\n\t}\r\n\tcreateClass( Controller, [ {\r\n\t\tkey: 'onChange',\r\n\t\tvalue: function onChange( fnc ) {\r\n\r\n\t\t\tthis.__onChange = fnc;\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'onFinishChange',\r\n\t\tvalue: function onFinishChange( fnc ) {\r\n\r\n\t\t\tthis.__onFinishChange = fnc;\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'setValue',\r\n\t\tvalue: function setValue( newValue ) {\r\n\r\n\t\t\tthis.object[ this.property ] = newValue;\r\n\t\t\tif ( this.__onChange ) {\r\n\r\n\t\t\t\tthis.__onChange.call( this, newValue );\r\n\r\n\t\t\t}\r\n\t\t\tthis.updateDisplay();\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'getValue',\r\n\t\tvalue: function getValue() {\r\n\r\n\t\t\treturn this.object[ this.property ];\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'isModified',\r\n\t\tvalue: function isModified() {\r\n\r\n\t\t\treturn this.initialValue !== this.getValue();\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn Controller;\r\n\r\n}();\r\n\r\nvar EVENT_MAP = {\r\n\tHTMLEvents: [ 'change' ],\r\n\tMouseEvents: [ 'click', 'mousemove', 'mousedown', 'mouseup', 'mouseover' ],\r\n\tKeyboardEvents: [ 'keydown' ]\r\n};\r\nvar EVENT_MAP_INV = {};\r\nCommon.each( EVENT_MAP, function ( v, k ) {\r\n\r\n\tCommon.each( v, function ( e ) {\r\n\r\n\t\tEVENT_MAP_INV[ e ] = k;\r\n\r\n\t} );\r\n\r\n} );\r\nvar CSS_VALUE_PIXELS = /(\\d+(\\.\\d+)?)px/;\r\nfunction cssValueToPixels( val ) {\r\n\r\n\tif ( val === '0' || Common.isUndefined( val ) ) {\r\n\r\n\t\treturn 0;\r\n\r\n\t}\r\n\tvar match = val.match( CSS_VALUE_PIXELS );\r\n\tif ( ! Common.isNull( match ) ) {\r\n\r\n\t\treturn parseFloat( match[ 1 ] );\r\n\r\n\t}\r\n\treturn 0;\r\n\r\n}\r\nvar dom = {\r\n\tmakeSelectable: function makeSelectable( elem, selectable ) {\r\n\r\n\t\tif ( elem === undefined || elem.style === undefined ) return;\r\n\t\telem.onselectstart = selectable ? function () {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t} : function () {};\r\n\t\telem.style.MozUserSelect = selectable ? 'auto' : 'none';\r\n\t\telem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\r\n\t\telem.unselectable = selectable ? 'on' : 'off';\r\n\r\n\t},\r\n\tmakeFullscreen: function makeFullscreen( elem, hor, vert ) {\r\n\r\n\t\tvar vertical = vert;\r\n\t\tvar horizontal = hor;\r\n\t\tif ( Common.isUndefined( horizontal ) ) {\r\n\r\n\t\t\thorizontal = true;\r\n\r\n\t\t}\r\n\t\tif ( Common.isUndefined( vertical ) ) {\r\n\r\n\t\t\tvertical = true;\r\n\r\n\t\t}\r\n\t\telem.style.position = 'absolute';\r\n\t\tif ( horizontal ) {\r\n\r\n\t\t\telem.style.left = 0;\r\n\t\t\telem.style.right = 0;\r\n\r\n\t\t}\r\n\t\tif ( vertical ) {\r\n\r\n\t\t\telem.style.top = 0;\r\n\t\t\telem.style.bottom = 0;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\tfakeEvent: function fakeEvent( elem, eventType, pars, aux ) {\r\n\r\n\t\tvar params = pars || {};\r\n\t\tvar className = EVENT_MAP_INV[ eventType ];\r\n\t\tif ( ! className ) {\r\n\r\n\t\t\tthrow new Error( 'Event type ' + eventType + ' not supported.' );\r\n\r\n\t\t}\r\n\t\tvar evt = document.createEvent( className );\r\n\t\tswitch ( className ) {\r\n\r\n\t\t\tcase 'MouseEvents':\r\n\t\t\t{\r\n\r\n\t\t\t\tvar clientX = params.x || params.clientX || 0;\r\n\t\t\t\tvar clientY = params.y || params.clientY || 0;\r\n\t\t\t\tevt.initMouseEvent( eventType, params.bubbles || false, params.cancelable || true, window, params.clickCount || 1, 0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\tclientX,\r\n\t\t\t\t\tclientY,\r\n\t\t\t\t\tfalse, false, false, false, 0, null );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\tcase 'KeyboardEvents':\r\n\t\t\t{\r\n\r\n\t\t\t\tvar init = evt.initKeyboardEvent || evt.initKeyEvent;\r\n\t\t\t\tCommon.defaults( params, {\r\n\t\t\t\t\tcancelable: true,\r\n\t\t\t\t\tctrlKey: false,\r\n\t\t\t\t\taltKey: false,\r\n\t\t\t\t\tshiftKey: false,\r\n\t\t\t\t\tmetaKey: false,\r\n\t\t\t\t\tkeyCode: undefined,\r\n\t\t\t\t\tcharCode: undefined\r\n\t\t\t\t} );\r\n\t\t\t\tinit( eventType, params.bubbles || false, params.cancelable, window, params.ctrlKey, params.altKey, params.shiftKey, params.metaKey, params.keyCode, params.charCode );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\tdefault:\r\n\t\t\t{\r\n\r\n\t\t\t\tevt.initEvent( eventType, params.bubbles || false, params.cancelable || true );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tCommon.defaults( evt, aux );\r\n\t\telem.dispatchEvent( evt );\r\n\r\n\t},\r\n\tbind: function bind( elem, event, func, newBool ) {\r\n\r\n\t\tvar bool = newBool || false;\r\n\t\tif ( elem.addEventListener ) {\r\n\r\n\t\t\telem.addEventListener( event, func, bool );\r\n\r\n\t\t} else if ( elem.attachEvent ) {\r\n\r\n\t\t\telem.attachEvent( 'on' + event, func );\r\n\r\n\t\t}\r\n\t\treturn dom;\r\n\r\n\t},\r\n\tunbind: function unbind( elem, event, func, newBool ) {\r\n\r\n\t\tvar bool = newBool || false;\r\n\t\tif ( elem.removeEventListener ) {\r\n\r\n\t\t\telem.removeEventListener( event, func, bool );\r\n\r\n\t\t} else if ( elem.detachEvent ) {\r\n\r\n\t\t\telem.detachEvent( 'on' + event, func );\r\n\r\n\t\t}\r\n\t\treturn dom;\r\n\r\n\t},\r\n\taddClass: function addClass( elem, className ) {\r\n\r\n\t\tif ( elem.className === undefined ) {\r\n\r\n\t\t\telem.className = className;\r\n\r\n\t\t} else if ( elem.className !== className ) {\r\n\r\n\t\t\tvar classes = elem.className.split( / +/ );\r\n\t\t\tif ( classes.indexOf( className ) === - 1 ) {\r\n\r\n\t\t\t\tclasses.push( className );\r\n\t\t\t\telem.className = classes.join( ' ' ).replace( /^\\s+/, '' ).replace( /\\s+$/, '' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn dom;\r\n\r\n\t},\r\n\tremoveClass: function removeClass( elem, className ) {\r\n\r\n\t\tif ( className ) {\r\n\r\n\t\t\tif ( elem.className === className ) {\r\n\r\n\t\t\t\telem.removeAttribute( 'class' );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar classes = elem.className.split( / +/ );\r\n\t\t\t\tvar index = classes.indexOf( className );\r\n\t\t\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\t\t\tclasses.splice( index, 1 );\r\n\t\t\t\t\telem.className = classes.join( ' ' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\telem.className = undefined;\r\n\r\n\t\t}\r\n\t\treturn dom;\r\n\r\n\t},\r\n\thasClass: function hasClass( elem, className ) {\r\n\r\n\t\treturn new RegExp( '(?:^|\\\\s+)' + className + '(?:\\\\s+|$)' ).test( elem.className ) || false;\r\n\r\n\t},\r\n\tgetWidth: function getWidth( elem ) {\r\n\r\n\t\tvar style = getComputedStyle( elem );\r\n\t\treturn cssValueToPixels( style[ 'border-left-width' ] ) + cssValueToPixels( style[ 'border-right-width' ] ) + cssValueToPixels( style[ 'padding-left' ] ) + cssValueToPixels( style[ 'padding-right' ] ) + cssValueToPixels( style.width );\r\n\r\n\t},\r\n\tgetHeight: function getHeight( elem ) {\r\n\r\n\t\tvar style = getComputedStyle( elem );\r\n\t\treturn cssValueToPixels( style[ 'border-top-width' ] ) + cssValueToPixels( style[ 'border-bottom-width' ] ) + cssValueToPixels( style[ 'padding-top' ] ) + cssValueToPixels( style[ 'padding-bottom' ] ) + cssValueToPixels( style.height );\r\n\r\n\t},\r\n\tgetOffset: function getOffset( el ) {\r\n\r\n\t\tvar elem = el;\r\n\t\tvar offset = { left: 0, top: 0 };\r\n\t\tif ( elem.offsetParent ) {\r\n\r\n\t\t\tdo {\r\n\r\n\t\t\t\toffset.left += elem.offsetLeft;\r\n\t\t\t\toffset.top += elem.offsetTop;\r\n\t\t\t\telem = elem.offsetParent;\r\n\r\n\t\t\t} while ( elem );\r\n\r\n\t\t}\r\n\t\treturn offset;\r\n\r\n\t},\r\n\tisActive: function isActive( elem ) {\r\n\r\n\t\treturn elem === document.activeElement && ( elem.type || elem.href );\r\n\r\n\t}\r\n};\r\n\r\nvar BooleanController = function ( _Controller ) {\r\n\r\n\tinherits( BooleanController, _Controller );\r\n\tfunction BooleanController( object, property ) {\r\n\r\n\t\tclassCallCheck( this, BooleanController );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( BooleanController.__proto__ || Object.getPrototypeOf( BooleanController ) ).call( this, object, property ) );\r\n\t\tvar _this = _this2;\r\n\t\t_this2.__prev = _this2.getValue();\r\n\t\t_this2.__checkbox = document.createElement( 'input' );\r\n\t\t_this2.__checkbox.setAttribute( 'type', 'checkbox' );\r\n\t\tfunction onChange() {\r\n\r\n\t\t\t_this.setValue( ! _this.__prev );\r\n\r\n\t\t}\r\n\t\tdom.bind( _this2.__checkbox, 'change', onChange, false );\r\n\t\t_this2.domElement.appendChild( _this2.__checkbox );\r\n\t\t_this2.updateDisplay();\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( BooleanController, [ {\r\n\t\tkey: 'setValue',\r\n\t\tvalue: function setValue( v ) {\r\n\r\n\t\t\tvar toReturn = get( BooleanController.prototype.__proto__ || Object.getPrototypeOf( BooleanController.prototype ), 'setValue', this ).call( this, v );\r\n\t\t\tif ( this.__onFinishChange ) {\r\n\r\n\t\t\t\tthis.__onFinishChange.call( this, this.getValue() );\r\n\r\n\t\t\t}\r\n\t\t\tthis.__prev = this.getValue();\r\n\t\t\treturn toReturn;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tif ( this.getValue() === true ) {\r\n\r\n\t\t\t\tthis.__checkbox.setAttribute( 'checked', 'checked' );\r\n\t\t\t\tthis.__checkbox.checked = true;\r\n\t\t\t\tthis.__prev = true;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.__checkbox.checked = false;\r\n\t\t\t\tthis.__prev = false;\r\n\r\n\t\t\t}\r\n\t\t\treturn get( BooleanController.prototype.__proto__ || Object.getPrototypeOf( BooleanController.prototype ), 'updateDisplay', this ).call( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn BooleanController;\r\n\r\n}( Controller );\r\n\r\nvar OptionController = function ( _Controller ) {\r\n\r\n\tinherits( OptionController, _Controller );\r\n\tfunction OptionController( object, property, opts ) {\r\n\r\n\t\tclassCallCheck( this, OptionController );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( OptionController.__proto__ || Object.getPrototypeOf( OptionController ) ).call( this, object, property ) );\r\n\t\tvar options = opts;\r\n\t\tvar _this = _this2;\r\n\t\t_this2.__select = document.createElement( 'select' );\r\n\t\tif ( Common.isArray( options ) ) {\r\n\r\n\t\t\tvar map = {};\r\n\t\t\tCommon.each( options, function ( element ) {\r\n\r\n\t\t\t\tmap[ element ] = element;\r\n\r\n\t\t\t} );\r\n\t\t\toptions = map;\r\n\r\n\t\t}\r\n\t\tCommon.each( options, function ( value, key ) {\r\n\r\n\t\t\tvar opt = document.createElement( 'option' );\r\n\t\t\topt.innerHTML = key;\r\n\t\t\topt.setAttribute( 'value', value );\r\n\t\t\t_this.__select.appendChild( opt );\r\n\r\n\t\t} );\r\n\t\t_this2.updateDisplay();\r\n\t\tdom.bind( _this2.__select, 'change', function () {\r\n\r\n\t\t\tvar desiredValue = this.options[ this.selectedIndex ].value;\r\n\t\t\t_this.setValue( desiredValue );\r\n\r\n\t\t} );\r\n\t\t_this2.domElement.appendChild( _this2.__select );\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( OptionController, [ {\r\n\t\tkey: 'setValue',\r\n\t\tvalue: function setValue( v ) {\r\n\r\n\t\t\tvar toReturn = get( OptionController.prototype.__proto__ || Object.getPrototypeOf( OptionController.prototype ), 'setValue', this ).call( this, v );\r\n\t\t\tif ( this.__onFinishChange ) {\r\n\r\n\t\t\t\tthis.__onFinishChange.call( this, this.getValue() );\r\n\r\n\t\t\t}\r\n\t\t\treturn toReturn;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tif ( dom.isActive( this.__select ) ) return this;\r\n\t\t\tthis.__select.value = this.getValue();\r\n\t\t\treturn get( OptionController.prototype.__proto__ || Object.getPrototypeOf( OptionController.prototype ), 'updateDisplay', this ).call( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn OptionController;\r\n\r\n}( Controller );\r\n\r\nvar StringController = function ( _Controller ) {\r\n\r\n\tinherits( StringController, _Controller );\r\n\tfunction StringController( object, property ) {\r\n\r\n\t\tclassCallCheck( this, StringController );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( StringController.__proto__ || Object.getPrototypeOf( StringController ) ).call( this, object, property ) );\r\n\t\tvar _this = _this2;\r\n\t\tfunction onChange() {\r\n\r\n\t\t\t_this.setValue( _this.__input.value );\r\n\r\n\t\t}\r\n\t\tfunction onBlur() {\r\n\r\n\t\t\tif ( _this.__onFinishChange ) {\r\n\r\n\t\t\t\t_this.__onFinishChange.call( _this, _this.getValue() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t_this2.__input = document.createElement( 'input' );\r\n\t\t_this2.__input.setAttribute( 'type', 'text' );\r\n\t\tdom.bind( _this2.__input, 'keyup', onChange );\r\n\t\tdom.bind( _this2.__input, 'change', onChange );\r\n\t\tdom.bind( _this2.__input, 'blur', onBlur );\r\n\t\tdom.bind( _this2.__input, 'keydown', function ( e ) {\r\n\r\n\t\t\tif ( e.keyCode === 13 ) {\r\n\r\n\t\t\t\tthis.blur();\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\t\t_this2.updateDisplay();\r\n\t\t_this2.domElement.appendChild( _this2.__input );\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( StringController, [ {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tif ( ! dom.isActive( this.__input ) ) {\r\n\r\n\t\t\t\tthis.__input.value = this.getValue();\r\n\r\n\t\t\t}\r\n\t\t\treturn get( StringController.prototype.__proto__ || Object.getPrototypeOf( StringController.prototype ), 'updateDisplay', this ).call( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn StringController;\r\n\r\n}( Controller );\r\n\r\nfunction numDecimals( x ) {\r\n\r\n\tvar _x = x.toString();\r\n\tif ( _x.indexOf( '.' ) > - 1 ) {\r\n\r\n\t\treturn _x.length - _x.indexOf( '.' ) - 1;\r\n\r\n\t}\r\n\treturn 0;\r\n\r\n}\r\nvar NumberController = function ( _Controller ) {\r\n\r\n\tinherits( NumberController, _Controller );\r\n\tfunction NumberController( object, property, params ) {\r\n\r\n\t\tclassCallCheck( this, NumberController );\r\n\t\tvar _this = possibleConstructorReturn( this, ( NumberController.__proto__ || Object.getPrototypeOf( NumberController ) ).call( this, object, property ) );\r\n\t\tvar _params = params || {};\r\n\t\t_this.__min = _params.min;\r\n\t\t_this.__max = _params.max;\r\n\t\t_this.__step = _params.step;\r\n\t\tif ( Common.isUndefined( _this.__step ) ) {\r\n\r\n\t\t\tif ( _this.initialValue === 0 ) {\r\n\r\n\t\t\t\t_this.__impliedStep = 1;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_this.__impliedStep = Math.pow( 10, Math.floor( Math.log( Math.abs( _this.initialValue ) ) / Math.LN10 ) ) / 10;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_this.__impliedStep = _this.__step;\r\n\r\n\t\t}\r\n\t\t_this.__precision = numDecimals( _this.__impliedStep );\r\n\t\treturn _this;\r\n\r\n\t}\r\n\tcreateClass( NumberController, [ {\r\n\t\tkey: 'setValue',\r\n\t\tvalue: function setValue( v ) {\r\n\r\n\t\t\tvar _v = v;\r\n\t\t\tif ( this.__min !== undefined && _v < this.__min ) {\r\n\r\n\t\t\t\t_v = this.__min;\r\n\r\n\t\t\t} else if ( this.__max !== undefined && _v > this.__max ) {\r\n\r\n\t\t\t\t_v = this.__max;\r\n\r\n\t\t\t}\r\n\t\t\tif ( this.__step !== undefined && _v % this.__step !== 0 ) {\r\n\r\n\t\t\t\t_v = Math.round( _v / this.__step ) * this.__step;\r\n\r\n\t\t\t}\r\n\t\t\treturn get( NumberController.prototype.__proto__ || Object.getPrototypeOf( NumberController.prototype ), 'setValue', this ).call( this, _v );\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'min',\r\n\t\tvalue: function min( minValue ) {\r\n\r\n\t\t\tthis.__min = minValue;\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'max',\r\n\t\tvalue: function max( maxValue ) {\r\n\r\n\t\t\tthis.__max = maxValue;\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'step',\r\n\t\tvalue: function step( stepValue ) {\r\n\r\n\t\t\tthis.__step = stepValue;\r\n\t\t\tthis.__impliedStep = stepValue;\r\n\t\t\tthis.__precision = numDecimals( stepValue );\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn NumberController;\r\n\r\n}( Controller );\r\n\r\nfunction roundToDecimal( value, decimals ) {\r\n\r\n\tvar tenTo = Math.pow( 10, decimals );\r\n\treturn Math.round( value * tenTo ) / tenTo;\r\n\r\n}\r\nvar NumberControllerBox = function ( _NumberController ) {\r\n\r\n\tinherits( NumberControllerBox, _NumberController );\r\n\tfunction NumberControllerBox( object, property, params ) {\r\n\r\n\t\tclassCallCheck( this, NumberControllerBox );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( NumberControllerBox.__proto__ || Object.getPrototypeOf( NumberControllerBox ) ).call( this, object, property, params ) );\r\n\t\t_this2.__truncationSuspended = false;\r\n\t\tvar _this = _this2;\r\n\t\tvar prevY = void 0;\r\n\t\tfunction onChange() {\r\n\r\n\t\t\tvar attempted = parseFloat( _this.__input.value );\r\n\t\t\tif ( ! Common.isNaN( attempted ) ) {\r\n\r\n\t\t\t\t_this.setValue( attempted );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tfunction onFinish() {\r\n\r\n\t\t\tif ( _this.__onFinishChange ) {\r\n\r\n\t\t\t\t_this.__onFinishChange.call( _this, _this.getValue() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tfunction onBlur() {\r\n\r\n\t\t\tonFinish();\r\n\r\n\t\t}\r\n\t\tfunction onMouseDrag( e ) {\r\n\r\n\t\t\tvar diff = prevY - e.clientY;\r\n\t\t\t_this.setValue( _this.getValue() + diff * _this.__impliedStep );\r\n\t\t\tprevY = e.clientY;\r\n\r\n\t\t}\r\n\t\tfunction onMouseUp() {\r\n\r\n\t\t\tdom.unbind( window, 'mousemove', onMouseDrag );\r\n\t\t\tdom.unbind( window, 'mouseup', onMouseUp );\r\n\t\t\tonFinish();\r\n\r\n\t\t}\r\n\t\tfunction onMouseDown( e ) {\r\n\r\n\t\t\tdom.bind( window, 'mousemove', onMouseDrag );\r\n\t\t\tdom.bind( window, 'mouseup', onMouseUp );\r\n\t\t\tprevY = e.clientY;\r\n\r\n\t\t}\r\n\t\t_this2.__input = document.createElement( 'input' );\r\n\t\t_this2.__input.setAttribute( 'type', 'text' );\r\n\t\tdom.bind( _this2.__input, 'change', onChange );\r\n\t\tdom.bind( _this2.__input, 'blur', onBlur );\r\n\t\tdom.bind( _this2.__input, 'mousedown', onMouseDown );\r\n\t\tdom.bind( _this2.__input, 'keydown', function ( e ) {\r\n\r\n\t\t\tif ( e.keyCode === 13 ) {\r\n\r\n\t\t\t\t_this.__truncationSuspended = true;\r\n\t\t\t\tthis.blur();\r\n\t\t\t\t_this.__truncationSuspended = false;\r\n\t\t\t\tonFinish();\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\t\t_this2.updateDisplay();\r\n\t\t_this2.domElement.appendChild( _this2.__input );\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( NumberControllerBox, [ {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tthis.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal( this.getValue(), this.__precision );\r\n\t\t\treturn get( NumberControllerBox.prototype.__proto__ || Object.getPrototypeOf( NumberControllerBox.prototype ), 'updateDisplay', this ).call( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn NumberControllerBox;\r\n\r\n}( NumberController );\r\n\r\nfunction map( v, i1, i2, o1, o2 ) {\r\n\r\n\treturn o1 + ( o2 - o1 ) * ( ( v - i1 ) / ( i2 - i1 ) );\r\n\r\n}\r\nvar NumberControllerSlider = function ( _NumberController ) {\r\n\r\n\tinherits( NumberControllerSlider, _NumberController );\r\n\tfunction NumberControllerSlider( object, property, min, max, step ) {\r\n\r\n\t\tclassCallCheck( this, NumberControllerSlider );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( NumberControllerSlider.__proto__ || Object.getPrototypeOf( NumberControllerSlider ) ).call( this, object, property, { min: min, max: max, step: step } ) );\r\n\t\tvar _this = _this2;\r\n\t\t_this2.__background = document.createElement( 'div' );\r\n\t\t_this2.__foreground = document.createElement( 'div' );\r\n\t\tdom.bind( _this2.__background, 'mousedown', onMouseDown );\r\n\t\tdom.bind( _this2.__background, 'touchstart', onTouchStart );\r\n\t\tdom.addClass( _this2.__background, 'slider' );\r\n\t\tdom.addClass( _this2.__foreground, 'slider-fg' );\r\n\t\tfunction onMouseDown( e ) {\r\n\r\n\t\t\tdocument.activeElement.blur();\r\n\t\t\tdom.bind( window, 'mousemove', onMouseDrag );\r\n\t\t\tdom.bind( window, 'mouseup', onMouseUp );\r\n\t\t\tonMouseDrag( e );\r\n\r\n\t\t}\r\n\t\tfunction onMouseDrag( e ) {\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\tvar bgRect = _this.__background.getBoundingClientRect();\r\n\t\t\t_this.setValue( map( e.clientX, bgRect.left, bgRect.right, _this.__min, _this.__max ) );\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\t\tfunction onMouseUp() {\r\n\r\n\t\t\tdom.unbind( window, 'mousemove', onMouseDrag );\r\n\t\t\tdom.unbind( window, 'mouseup', onMouseUp );\r\n\t\t\tif ( _this.__onFinishChange ) {\r\n\r\n\t\t\t\t_this.__onFinishChange.call( _this, _this.getValue() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tfunction onTouchStart( e ) {\r\n\r\n\t\t\tif ( e.touches.length !== 1 ) {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\t\t\tdom.bind( window, 'touchmove', onTouchMove );\r\n\t\t\tdom.bind( window, 'touchend', onTouchEnd );\r\n\t\t\tonTouchMove( e );\r\n\r\n\t\t}\r\n\t\tfunction onTouchMove( e ) {\r\n\r\n\t\t\tvar clientX = e.touches[ 0 ].clientX;\r\n\t\t\tvar bgRect = _this.__background.getBoundingClientRect();\r\n\t\t\t_this.setValue( map( clientX, bgRect.left, bgRect.right, _this.__min, _this.__max ) );\r\n\r\n\t\t}\r\n\t\tfunction onTouchEnd() {\r\n\r\n\t\t\tdom.unbind( window, 'touchmove', onTouchMove );\r\n\t\t\tdom.unbind( window, 'touchend', onTouchEnd );\r\n\t\t\tif ( _this.__onFinishChange ) {\r\n\r\n\t\t\t\t_this.__onFinishChange.call( _this, _this.getValue() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t_this2.updateDisplay();\r\n\t\t_this2.__background.appendChild( _this2.__foreground );\r\n\t\t_this2.domElement.appendChild( _this2.__background );\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( NumberControllerSlider, [ {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tvar pct = ( this.getValue() - this.__min ) / ( this.__max - this.__min );\r\n\t\t\tthis.__foreground.style.width = pct * 100 + '%';\r\n\t\t\treturn get( NumberControllerSlider.prototype.__proto__ || Object.getPrototypeOf( NumberControllerSlider.prototype ), 'updateDisplay', this ).call( this );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn NumberControllerSlider;\r\n\r\n}( NumberController );\r\n\r\nvar FunctionController = function ( _Controller ) {\r\n\r\n\tinherits( FunctionController, _Controller );\r\n\tfunction FunctionController( object, property, text ) {\r\n\r\n\t\tclassCallCheck( this, FunctionController );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( FunctionController.__proto__ || Object.getPrototypeOf( FunctionController ) ).call( this, object, property ) );\r\n\t\tvar _this = _this2;\r\n\t\t_this2.__button = document.createElement( 'div' );\r\n\t\t_this2.__button.innerHTML = text === undefined ? 'Fire' : text;\r\n\t\tdom.bind( _this2.__button, 'click', function ( e ) {\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\t_this.fire();\r\n\t\t\treturn false;\r\n\r\n\t\t} );\r\n\t\tdom.addClass( _this2.__button, 'button' );\r\n\t\t_this2.domElement.appendChild( _this2.__button );\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( FunctionController, [ {\r\n\t\tkey: 'fire',\r\n\t\tvalue: function fire() {\r\n\r\n\t\t\tif ( this.__onChange ) {\r\n\r\n\t\t\t\tthis.__onChange.call( this );\r\n\r\n\t\t\t}\r\n\t\t\tthis.getValue().call( this.object );\r\n\t\t\tif ( this.__onFinishChange ) {\r\n\r\n\t\t\t\tthis.__onFinishChange.call( this, this.getValue() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn FunctionController;\r\n\r\n}( Controller );\r\n\r\nvar ColorController = function ( _Controller ) {\r\n\r\n\tinherits( ColorController, _Controller );\r\n\tfunction ColorController( object, property ) {\r\n\r\n\t\tclassCallCheck( this, ColorController );\r\n\t\tvar _this2 = possibleConstructorReturn( this, ( ColorController.__proto__ || Object.getPrototypeOf( ColorController ) ).call( this, object, property ) );\r\n\t\t_this2.__color = new Color( _this2.getValue() );\r\n\t\t_this2.__temp = new Color( 0 );\r\n\t\tvar _this = _this2;\r\n\t\t_this2.domElement = document.createElement( 'div' );\r\n\t\tdom.makeSelectable( _this2.domElement, false );\r\n\t\t_this2.__selector = document.createElement( 'div' );\r\n\t\t_this2.__selector.className = 'selector';\r\n\t\t_this2.__saturation_field = document.createElement( 'div' );\r\n\t\t_this2.__saturation_field.className = 'saturation-field';\r\n\t\t_this2.__field_knob = document.createElement( 'div' );\r\n\t\t_this2.__field_knob.className = 'field-knob';\r\n\t\t_this2.__field_knob_border = '2px solid ';\r\n\t\t_this2.__hue_knob = document.createElement( 'div' );\r\n\t\t_this2.__hue_knob.className = 'hue-knob';\r\n\t\t_this2.__hue_field = document.createElement( 'div' );\r\n\t\t_this2.__hue_field.className = 'hue-field';\r\n\t\t_this2.__input = document.createElement( 'input' );\r\n\t\t_this2.__input.type = 'text';\r\n\t\t_this2.__input_textShadow = '0 1px 1px ';\r\n\t\tdom.bind( _this2.__input, 'keydown', function ( e ) {\r\n\r\n\t\t\tif ( e.keyCode === 13 ) {\r\n\r\n\t\t\t\tonBlur.call( this );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\t\tdom.bind( _this2.__input, 'blur', onBlur );\r\n\t\tdom.bind( _this2.__selector, 'mousedown', function () {\r\n\r\n\t\t\tdom.addClass( this, 'drag' ).bind( window, 'mouseup', function () {\r\n\r\n\t\t\t\tdom.removeClass( _this.__selector, 'drag' );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\t\tdom.bind( _this2.__selector, 'touchstart', function () {\r\n\r\n\t\t\tdom.addClass( this, 'drag' ).bind( window, 'touchend', function () {\r\n\r\n\t\t\t\tdom.removeClass( _this.__selector, 'drag' );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\t\tvar valueField = document.createElement( 'div' );\r\n\t\tCommon.extend( _this2.__selector.style, {\r\n\t\t\twidth: '122px',\r\n\t\t\theight: '102px',\r\n\t\t\tpadding: '3px',\r\n\t\t\tbackgroundColor: '#222',\r\n\t\t\tboxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\r\n\t\t} );\r\n\t\tCommon.extend( _this2.__field_knob.style, {\r\n\t\t\tposition: 'absolute',\r\n\t\t\twidth: '12px',\r\n\t\t\theight: '12px',\r\n\t\t\tborder: _this2.__field_knob_border + ( _this2.__color.v < 0.5 ? '#fff' : '#000' ),\r\n\t\t\tboxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\r\n\t\t\tborderRadius: '12px',\r\n\t\t\tzIndex: 1\r\n\t\t} );\r\n\t\tCommon.extend( _this2.__hue_knob.style, {\r\n\t\t\tposition: 'absolute',\r\n\t\t\twidth: '15px',\r\n\t\t\theight: '2px',\r\n\t\t\tborderRight: '4px solid #fff',\r\n\t\t\tzIndex: 1\r\n\t\t} );\r\n\t\tCommon.extend( _this2.__saturation_field.style, {\r\n\t\t\twidth: '100px',\r\n\t\t\theight: '100px',\r\n\t\t\tborder: '1px solid #555',\r\n\t\t\tmarginRight: '3px',\r\n\t\t\tdisplay: 'inline-block',\r\n\t\t\tcursor: 'pointer'\r\n\t\t} );\r\n\t\tCommon.extend( valueField.style, {\r\n\t\t\twidth: '100%',\r\n\t\t\theight: '100%',\r\n\t\t\tbackground: 'none'\r\n\t\t} );\r\n\t\tlinearGradient( valueField, 'top', 'rgba(0,0,0,0)', '#000' );\r\n\t\tCommon.extend( _this2.__hue_field.style, {\r\n\t\t\twidth: '15px',\r\n\t\t\theight: '100px',\r\n\t\t\tborder: '1px solid #555',\r\n\t\t\tcursor: 'ns-resize',\r\n\t\t\tposition: 'absolute',\r\n\t\t\ttop: '3px',\r\n\t\t\tright: '3px'\r\n\t\t} );\r\n\t\thueGradient( _this2.__hue_field );\r\n\t\tCommon.extend( _this2.__input.style, {\r\n\t\t\toutline: 'none',\r\n\t\t\ttextAlign: 'center',\r\n\t\t\tcolor: '#fff',\r\n\t\t\tborder: 0,\r\n\t\t\tfontWeight: 'bold',\r\n\t\t\ttextShadow: _this2.__input_textShadow + 'rgba(0,0,0,0.7)'\r\n\t\t} );\r\n\t\tdom.bind( _this2.__saturation_field, 'mousedown', fieldDown );\r\n\t\tdom.bind( _this2.__saturation_field, 'touchstart', fieldDown );\r\n\t\tdom.bind( _this2.__field_knob, 'mousedown', fieldDown );\r\n\t\tdom.bind( _this2.__field_knob, 'touchstart', fieldDown );\r\n\t\tdom.bind( _this2.__hue_field, 'mousedown', fieldDownH );\r\n\t\tdom.bind( _this2.__hue_field, 'touchstart', fieldDownH );\r\n\t\tfunction fieldDown( e ) {\r\n\r\n\t\t\tsetSV( e );\r\n\t\t\tdom.bind( window, 'mousemove', setSV );\r\n\t\t\tdom.bind( window, 'touchmove', setSV );\r\n\t\t\tdom.bind( window, 'mouseup', fieldUpSV );\r\n\t\t\tdom.bind( window, 'touchend', fieldUpSV );\r\n\r\n\t\t}\r\n\t\tfunction fieldDownH( e ) {\r\n\r\n\t\t\tsetH( e );\r\n\t\t\tdom.bind( window, 'mousemove', setH );\r\n\t\t\tdom.bind( window, 'touchmove', setH );\r\n\t\t\tdom.bind( window, 'mouseup', fieldUpH );\r\n\t\t\tdom.bind( window, 'touchend', fieldUpH );\r\n\r\n\t\t}\r\n\t\tfunction fieldUpSV() {\r\n\r\n\t\t\tdom.unbind( window, 'mousemove', setSV );\r\n\t\t\tdom.unbind( window, 'touchmove', setSV );\r\n\t\t\tdom.unbind( window, 'mouseup', fieldUpSV );\r\n\t\t\tdom.unbind( window, 'touchend', fieldUpSV );\r\n\t\t\tonFinish();\r\n\r\n\t\t}\r\n\t\tfunction fieldUpH() {\r\n\r\n\t\t\tdom.unbind( window, 'mousemove', setH );\r\n\t\t\tdom.unbind( window, 'touchmove', setH );\r\n\t\t\tdom.unbind( window, 'mouseup', fieldUpH );\r\n\t\t\tdom.unbind( window, 'touchend', fieldUpH );\r\n\t\t\tonFinish();\r\n\r\n\t\t}\r\n\t\tfunction onBlur() {\r\n\r\n\t\t\tvar i = interpret( this.value );\r\n\t\t\tif ( i !== false ) {\r\n\r\n\t\t\t\t_this.__color.__state = i;\r\n\t\t\t\t_this.setValue( _this.__color.toOriginal() );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.value = _this.__color.toString();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tfunction onFinish() {\r\n\r\n\t\t\tif ( _this.__onFinishChange ) {\r\n\r\n\t\t\t\t_this.__onFinishChange.call( _this, _this.__color.toOriginal() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t_this2.__saturation_field.appendChild( valueField );\r\n\t\t_this2.__selector.appendChild( _this2.__field_knob );\r\n\t\t_this2.__selector.appendChild( _this2.__saturation_field );\r\n\t\t_this2.__selector.appendChild( _this2.__hue_field );\r\n\t\t_this2.__hue_field.appendChild( _this2.__hue_knob );\r\n\t\t_this2.domElement.appendChild( _this2.__input );\r\n\t\t_this2.domElement.appendChild( _this2.__selector );\r\n\t\t_this2.updateDisplay();\r\n\t\tfunction setSV( e ) {\r\n\r\n\t\t\tif ( e.type.indexOf( 'touch' ) === - 1 ) {\r\n\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t}\r\n\t\t\tvar fieldRect = _this.__saturation_field.getBoundingClientRect();\r\n\t\t\tvar _ref = e.touches && e.touches[ 0 ] || e,\r\n\t\t\t\tclientX = _ref.clientX,\r\n\t\t\t\tclientY = _ref.clientY;\r\n\t\t\tvar s = ( clientX - fieldRect.left ) / ( fieldRect.right - fieldRect.left );\r\n\t\t\tvar v = 1 - ( clientY - fieldRect.top ) / ( fieldRect.bottom - fieldRect.top );\r\n\t\t\tif ( v > 1 ) {\r\n\r\n\t\t\t\tv = 1;\r\n\r\n\t\t\t} else if ( v < 0 ) {\r\n\r\n\t\t\t\tv = 0;\r\n\r\n\t\t\t}\r\n\t\t\tif ( s > 1 ) {\r\n\r\n\t\t\t\ts = 1;\r\n\r\n\t\t\t} else if ( s < 0 ) {\r\n\r\n\t\t\t\ts = 0;\r\n\r\n\t\t\t}\r\n\t\t\t_this.__color.v = v;\r\n\t\t\t_this.__color.s = s;\r\n\t\t\t_this.setValue( _this.__color.toOriginal() );\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\t\tfunction setH( e ) {\r\n\r\n\t\t\tif ( e.type.indexOf( 'touch' ) === - 1 ) {\r\n\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t}\r\n\t\t\tvar fieldRect = _this.__hue_field.getBoundingClientRect();\r\n\t\t\tvar _ref2 = e.touches && e.touches[ 0 ] || e,\r\n\t\t\t\tclientY = _ref2.clientY;\r\n\t\t\tvar h = 1 - ( clientY - fieldRect.top ) / ( fieldRect.bottom - fieldRect.top );\r\n\t\t\tif ( h > 1 ) {\r\n\r\n\t\t\t\th = 1;\r\n\r\n\t\t\t} else if ( h < 0 ) {\r\n\r\n\t\t\t\th = 0;\r\n\r\n\t\t\t}\r\n\t\t\t_this.__color.h = h * 360;\r\n\t\t\t_this.setValue( _this.__color.toOriginal() );\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\t\treturn _this2;\r\n\r\n\t}\r\n\tcreateClass( ColorController, [ {\r\n\t\tkey: 'updateDisplay',\r\n\t\tvalue: function updateDisplay() {\r\n\r\n\t\t\tvar i = interpret( this.getValue() );\r\n\t\t\tif ( i !== false ) {\r\n\r\n\t\t\t\tvar mismatch = false;\r\n\t\t\t\tCommon.each( Color.COMPONENTS, function ( component ) {\r\n\r\n\t\t\t\t\tif ( ! Common.isUndefined( i[ component ] ) && ! Common.isUndefined( this.__color.__state[ component ] ) && i[ component ] !== this.__color.__state[ component ] ) {\r\n\r\n\t\t\t\t\t\tmismatch = true;\r\n\t\t\t\t\t\treturn {};\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}, this );\r\n\t\t\t\tif ( mismatch ) {\r\n\r\n\t\t\t\t\tCommon.extend( this.__color.__state, i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tCommon.extend( this.__temp.__state, this.__color.__state );\r\n\t\t\tthis.__temp.a = 1;\r\n\t\t\tvar flip = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0;\r\n\t\t\tvar _flip = 255 - flip;\r\n\t\t\tCommon.extend( this.__field_knob.style, {\r\n\t\t\t\tmarginLeft: 100 * this.__color.s - 7 + 'px',\r\n\t\t\t\tmarginTop: 100 * ( 1 - this.__color.v ) - 7 + 'px',\r\n\t\t\t\tbackgroundColor: this.__temp.toHexString(),\r\n\t\t\t\tborder: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip + ')'\r\n\t\t\t} );\r\n\t\t\tthis.__hue_knob.style.marginTop = ( 1 - this.__color.h / 360 ) * 100 + 'px';\r\n\t\t\tthis.__temp.s = 1;\r\n\t\t\tthis.__temp.v = 1;\r\n\t\t\tlinearGradient( this.__saturation_field, 'left', '#fff', this.__temp.toHexString() );\r\n\t\t\tthis.__input.value = this.__color.toString();\r\n\t\t\tCommon.extend( this.__input.style, {\r\n\t\t\t\tbackgroundColor: this.__color.toHexString(),\r\n\t\t\t\tcolor: 'rgb(' + flip + ',' + flip + ',' + flip + ')',\r\n\t\t\t\ttextShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip + ',.7)'\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn ColorController;\r\n\r\n}( Controller );\r\nvar vendors = [ '-moz-', '-o-', '-webkit-', '-ms-', '' ];\r\nfunction linearGradient( elem, x, a, b ) {\r\n\r\n\telem.style.background = '';\r\n\tCommon.each( vendors, function ( vendor ) {\r\n\r\n\t\telem.style.cssText += 'background: ' + vendor + 'linear-gradient(' + x + ', ' + a + ' 0%, ' + b + ' 100%); ';\r\n\r\n\t} );\r\n\r\n}\r\nfunction hueGradient( elem ) {\r\n\r\n\telem.style.background = '';\r\n\telem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\r\n\telem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\r\n\telem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\r\n\telem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\r\n\telem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\r\n\r\n}\r\n\r\nvar css = {\r\n\tload: function load( url, indoc ) {\r\n\r\n\t\tvar doc = indoc || document;\r\n\t\tvar link = doc.createElement( 'link' );\r\n\t\tlink.type = 'text/css';\r\n\t\tlink.rel = 'stylesheet';\r\n\t\tlink.href = url;\r\n\t\tdoc.getElementsByTagName( 'head' )[ 0 ].appendChild( link );\r\n\r\n\t},\r\n\tinject: function inject( cssContent, indoc ) {\r\n\r\n\t\tvar doc = indoc || document;\r\n\t\tvar injected = document.createElement( 'style' );\r\n\t\tinjected.type = 'text/css';\r\n\t\tinjected.innerHTML = cssContent;\r\n\t\tvar head = doc.getElementsByTagName( 'head' )[ 0 ];\r\n\t\ttry {\r\n\r\n\t\t\thead.appendChild( injected );\r\n\r\n\t\t} catch ( e ) {\r\n\t\t}\r\n\r\n\t}\r\n};\r\n\r\nvar saveDialogContents = \"<div id=\\\"dg-save\\\" class=\\\"dg dialogue\\\">\\n\\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\\n\\n  <textarea id=\\\"dg-new-constructor\\\"></textarea>\\n\\n  <div id=\\\"dg-save-locally\\\">\\n\\n    <input id=\\\"dg-local-storage\\\" type=\\\"checkbox\\\"/> Automatically save\\n    values to <code>localStorage</code> on exit.\\n\\n    <div id=\\\"dg-local-explain\\\">The values saved to <code>localStorage</code> will\\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\\n      easier to work incrementally, but <code>localStorage</code> is fragile,\\n      and your friends may not see the same values you do.\\n\\n    </div>\\n\\n  </div>\\n\\n</div>\";\r\n\r\nvar ControllerFactory = function ControllerFactory( object, property ) {\r\n\r\n\tvar initialValue = object[ property ];\r\n\tif ( Common.isArray( arguments[ 2 ] ) || Common.isObject( arguments[ 2 ] ) ) {\r\n\r\n\t\treturn new OptionController( object, property, arguments[ 2 ] );\r\n\r\n\t}\r\n\tif ( Common.isNumber( initialValue ) ) {\r\n\r\n\t\tif ( Common.isNumber( arguments[ 2 ] ) && Common.isNumber( arguments[ 3 ] ) ) {\r\n\r\n\t\t\tif ( Common.isNumber( arguments[ 4 ] ) ) {\r\n\r\n\t\t\t\treturn new NumberControllerSlider( object, property, arguments[ 2 ], arguments[ 3 ], arguments[ 4 ] );\r\n\r\n\t\t\t}\r\n\t\t\treturn new NumberControllerSlider( object, property, arguments[ 2 ], arguments[ 3 ] );\r\n\r\n\t\t}\r\n\t\tif ( Common.isNumber( arguments[ 4 ] ) ) {\r\n\r\n\t\t\treturn new NumberControllerBox( object, property, { min: arguments[ 2 ], max: arguments[ 3 ], step: arguments[ 4 ] } );\r\n\r\n\t\t}\r\n\t\treturn new NumberControllerBox( object, property, { min: arguments[ 2 ], max: arguments[ 3 ] } );\r\n\r\n\t}\r\n\tif ( Common.isString( initialValue ) ) {\r\n\r\n\t\treturn new StringController( object, property );\r\n\r\n\t}\r\n\tif ( Common.isFunction( initialValue ) ) {\r\n\r\n\t\treturn new FunctionController( object, property, '' );\r\n\r\n\t}\r\n\tif ( Common.isBoolean( initialValue ) ) {\r\n\r\n\t\treturn new BooleanController( object, property );\r\n\r\n\t}\r\n\treturn null;\r\n\r\n};\r\n\r\nfunction requestAnimationFrame( callback ) {\r\n\r\n\tsetTimeout( callback, 1000 / 60 );\r\n\r\n}\r\nvar requestAnimationFrame$1 = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || requestAnimationFrame;\r\n\r\nvar CenteredDiv = function () {\r\n\r\n\tfunction CenteredDiv() {\r\n\r\n\t\tclassCallCheck( this, CenteredDiv );\r\n\t\tthis.backgroundElement = document.createElement( 'div' );\r\n\t\tCommon.extend( this.backgroundElement.style, {\r\n\t\t\tbackgroundColor: 'rgba(0,0,0,0.8)',\r\n\t\t\ttop: 0,\r\n\t\t\tleft: 0,\r\n\t\t\tdisplay: 'none',\r\n\t\t\tzIndex: '1000',\r\n\t\t\topacity: 0,\r\n\t\t\tWebkitTransition: 'opacity 0.2s linear',\r\n\t\t\ttransition: 'opacity 0.2s linear'\r\n\t\t} );\r\n\t\tdom.makeFullscreen( this.backgroundElement );\r\n\t\tthis.backgroundElement.style.position = 'fixed';\r\n\t\tthis.domElement = document.createElement( 'div' );\r\n\t\tCommon.extend( this.domElement.style, {\r\n\t\t\tposition: 'fixed',\r\n\t\t\tdisplay: 'none',\r\n\t\t\tzIndex: '1001',\r\n\t\t\topacity: 0,\r\n\t\t\tWebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear',\r\n\t\t\ttransition: 'transform 0.2s ease-out, opacity 0.2s linear'\r\n\t\t} );\r\n\t\tdocument.body.appendChild( this.backgroundElement );\r\n\t\tdocument.body.appendChild( this.domElement );\r\n\t\tvar _this = this;\r\n\t\tdom.bind( this.backgroundElement, 'click', function () {\r\n\r\n\t\t\t_this.hide();\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\tcreateClass( CenteredDiv, [ {\r\n\t\tkey: 'show',\r\n\t\tvalue: function show() {\r\n\r\n\t\t\tvar _this = this;\r\n\t\t\tthis.backgroundElement.style.display = 'block';\r\n\t\t\tthis.domElement.style.display = 'block';\r\n\t\t\tthis.domElement.style.opacity = 0;\r\n\t\t\tthis.domElement.style.webkitTransform = 'scale(1.1)';\r\n\t\t\tthis.layout();\r\n\t\t\tCommon.defer( function () {\r\n\r\n\t\t\t\t_this.backgroundElement.style.opacity = 1;\r\n\t\t\t\t_this.domElement.style.opacity = 1;\r\n\t\t\t\t_this.domElement.style.webkitTransform = 'scale(1)';\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'hide',\r\n\t\tvalue: function hide() {\r\n\r\n\t\t\tvar _this = this;\r\n\t\t\tvar hide = function hide() {\r\n\r\n\t\t\t\t_this.domElement.style.display = 'none';\r\n\t\t\t\t_this.backgroundElement.style.display = 'none';\r\n\t\t\t\tdom.unbind( _this.domElement, 'webkitTransitionEnd', hide );\r\n\t\t\t\tdom.unbind( _this.domElement, 'transitionend', hide );\r\n\t\t\t\tdom.unbind( _this.domElement, 'oTransitionEnd', hide );\r\n\r\n\t\t\t};\r\n\t\t\tdom.bind( this.domElement, 'webkitTransitionEnd', hide );\r\n\t\t\tdom.bind( this.domElement, 'transitionend', hide );\r\n\t\t\tdom.bind( this.domElement, 'oTransitionEnd', hide );\r\n\t\t\tthis.backgroundElement.style.opacity = 0;\r\n\t\t\tthis.domElement.style.opacity = 0;\r\n\t\t\tthis.domElement.style.webkitTransform = 'scale(1.1)';\r\n\r\n\t\t}\r\n\t}, {\r\n\t\tkey: 'layout',\r\n\t\tvalue: function layout() {\r\n\r\n\t\t\tthis.domElement.style.left = window.innerWidth / 2 - dom.getWidth( this.domElement ) / 2 + 'px';\r\n\t\t\tthis.domElement.style.top = window.innerHeight / 2 - dom.getHeight( this.domElement ) / 2 + 'px';\r\n\r\n\t\t}\r\n\t} ] );\r\n\treturn CenteredDiv;\r\n\r\n}();\r\n\r\nvar styleSheet = ___$insertStyle( \".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\\n\" );\r\n\r\ncss.inject( styleSheet );\r\nvar CSS_NAMESPACE = 'dg';\r\nvar HIDE_KEY_CODE = 72;\r\nvar CLOSE_BUTTON_HEIGHT = 20;\r\nvar DEFAULT_DEFAULT_PRESET_NAME = 'Default';\r\nvar SUPPORTS_LOCAL_STORAGE = function () {\r\n\r\n\ttry {\r\n\r\n\t\treturn !! window.localStorage;\r\n\r\n\t} catch ( e ) {\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n}();\r\nvar SAVE_DIALOGUE = void 0;\r\nvar autoPlaceVirgin = true;\r\nvar autoPlaceContainer = void 0;\r\nvar hide = false;\r\nvar hideableGuis = [];\r\nvar GUI = function GUI( pars ) {\r\n\r\n\tvar _this = this;\r\n\tvar params = pars || {};\r\n\tthis.domElement = document.createElement( 'div' );\r\n\tthis.__ul = document.createElement( 'ul' );\r\n\tthis.domElement.appendChild( this.__ul );\r\n\tdom.addClass( this.domElement, CSS_NAMESPACE );\r\n\tthis.__folders = {};\r\n\tthis.__controllers = [];\r\n\tthis.__rememberedObjects = [];\r\n\tthis.__rememberedObjectIndecesToControllers = [];\r\n\tthis.__listening = [];\r\n\tparams = Common.defaults( params, {\r\n\t\tcloseOnTop: false,\r\n\t\tautoPlace: true,\r\n\t\twidth: GUI.DEFAULT_WIDTH\r\n\t} );\r\n\tparams = Common.defaults( params, {\r\n\t\tresizable: params.autoPlace,\r\n\t\thideable: params.autoPlace\r\n\t} );\r\n\tif ( ! Common.isUndefined( params.load ) ) {\r\n\r\n\t\tif ( params.preset ) {\r\n\r\n\t\t\tparams.load.preset = params.preset;\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tparams.load = { preset: DEFAULT_DEFAULT_PRESET_NAME };\r\n\r\n\t}\r\n\tif ( Common.isUndefined( params.parent ) && params.hideable ) {\r\n\r\n\t\thideableGuis.push( this );\r\n\r\n\t}\r\n\tparams.resizable = Common.isUndefined( params.parent ) && params.resizable;\r\n\tif ( params.autoPlace && Common.isUndefined( params.scrollable ) ) {\r\n\r\n\t\tparams.scrollable = true;\r\n\r\n\t}\r\n\tvar useLocalStorage = SUPPORTS_LOCAL_STORAGE && localStorage.getItem( getLocalStorageHash( this, 'isLocal' ) ) === 'true';\r\n\tvar saveToLocalStorage = void 0;\r\n\tvar titleRow = void 0;\r\n\tObject.defineProperties( this,\r\n\t\t{\r\n\t\t\tparent: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.parent;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tscrollable: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.scrollable;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tautoPlace: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.autoPlace;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcloseOnTop: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.closeOnTop;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpreset: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\tif ( _this.parent ) {\r\n\r\n\t\t\t\t\t\treturn _this.getRoot().preset;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn params.load.preset;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function set$$1( v ) {\r\n\r\n\t\t\t\t\tif ( _this.parent ) {\r\n\r\n\t\t\t\t\t\t_this.getRoot().preset = v;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tparams.load.preset = v;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsetPresetSelectIndex( this );\r\n\t\t\t\t\t_this.revert();\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\twidth: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.width;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function set$$1( v ) {\r\n\r\n\t\t\t\t\tparams.width = v;\r\n\t\t\t\t\tsetWidth( _this, v );\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tname: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.name;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function set$$1( v ) {\r\n\r\n\t\t\t\t\tparams.name = v;\r\n\t\t\t\t\tif ( titleRow ) {\r\n\r\n\t\t\t\t\t\ttitleRow.innerHTML = params.name;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclosed: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.closed;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function set$$1( v ) {\r\n\r\n\t\t\t\t\tparams.closed = v;\r\n\t\t\t\t\tif ( params.closed ) {\r\n\r\n\t\t\t\t\t\tdom.addClass( _this.__ul, GUI.CLASS_CLOSED );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdom.removeClass( _this.__ul, GUI.CLASS_CLOSED );\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.onResize();\r\n\t\t\t\t\tif ( _this.__closeButton ) {\r\n\r\n\t\t\t\t\t\t_this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tload: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn params.load;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tuseLocalStorage: {\r\n\t\t\t\tget: function get$$1() {\r\n\r\n\t\t\t\t\treturn useLocalStorage;\r\n\r\n\t\t\t\t},\r\n\t\t\t\tset: function set$$1( bool ) {\r\n\r\n\t\t\t\t\tif ( SUPPORTS_LOCAL_STORAGE ) {\r\n\r\n\t\t\t\t\t\tuseLocalStorage = bool;\r\n\t\t\t\t\t\tif ( bool ) {\r\n\r\n\t\t\t\t\t\t\tdom.bind( window, 'unload', saveToLocalStorage );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tdom.unbind( window, 'unload', saveToLocalStorage );\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlocalStorage.setItem( getLocalStorageHash( _this, 'isLocal' ), bool );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\tif ( Common.isUndefined( params.parent ) ) {\r\n\r\n\t\tthis.closed = params.closed || false;\r\n\t\tdom.addClass( this.domElement, GUI.CLASS_MAIN );\r\n\t\tdom.makeSelectable( this.domElement, false );\r\n\t\tif ( SUPPORTS_LOCAL_STORAGE ) {\r\n\r\n\t\t\tif ( useLocalStorage ) {\r\n\r\n\t\t\t\t_this.useLocalStorage = true;\r\n\t\t\t\tvar savedGui = localStorage.getItem( getLocalStorageHash( this, 'gui' ) );\r\n\t\t\t\tif ( savedGui ) {\r\n\r\n\t\t\t\t\tparams.load = JSON.parse( savedGui );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tthis.__closeButton = document.createElement( 'div' );\r\n\t\tthis.__closeButton.innerHTML = GUI.TEXT_CLOSED;\r\n\t\tdom.addClass( this.__closeButton, GUI.CLASS_CLOSE_BUTTON );\r\n\t\tif ( params.closeOnTop ) {\r\n\r\n\t\t\tdom.addClass( this.__closeButton, GUI.CLASS_CLOSE_TOP );\r\n\t\t\tthis.domElement.insertBefore( this.__closeButton, this.domElement.childNodes[ 0 ] );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tdom.addClass( this.__closeButton, GUI.CLASS_CLOSE_BOTTOM );\r\n\t\t\tthis.domElement.appendChild( this.__closeButton );\r\n\r\n\t\t}\r\n\t\tdom.bind( this.__closeButton, 'click', function () {\r\n\r\n\t\t\t_this.closed = ! _this.closed;\r\n\r\n\t\t} );\r\n\r\n\t} else {\r\n\r\n\t\tif ( params.closed === undefined ) {\r\n\r\n\t\t\tparams.closed = true;\r\n\r\n\t\t}\r\n\t\tvar titleRowName = document.createTextNode( params.name );\r\n\t\tdom.addClass( titleRowName, 'controller-name' );\r\n\t\ttitleRow = addRow( _this, titleRowName );\r\n\t\tvar onClickTitle = function onClickTitle( e ) {\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\t_this.closed = ! _this.closed;\r\n\t\t\treturn false;\r\n\r\n\t\t};\r\n\t\tdom.addClass( this.__ul, GUI.CLASS_CLOSED );\r\n\t\tdom.addClass( titleRow, 'title' );\r\n\t\tdom.bind( titleRow, 'click', onClickTitle );\r\n\t\tif ( ! params.closed ) {\r\n\r\n\t\t\tthis.closed = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\tif ( params.autoPlace ) {\r\n\r\n\t\tif ( Common.isUndefined( params.parent ) ) {\r\n\r\n\t\t\tif ( autoPlaceVirgin ) {\r\n\r\n\t\t\t\tautoPlaceContainer = document.createElement( 'div' );\r\n\t\t\t\tdom.addClass( autoPlaceContainer, CSS_NAMESPACE );\r\n\t\t\t\tdom.addClass( autoPlaceContainer, GUI.CLASS_AUTO_PLACE_CONTAINER );\r\n\t\t\t\tdocument.body.appendChild( autoPlaceContainer );\r\n\t\t\t\tautoPlaceVirgin = false;\r\n\r\n\t\t\t}\r\n\t\t\tautoPlaceContainer.appendChild( this.domElement );\r\n\t\t\tdom.addClass( this.domElement, GUI.CLASS_AUTO_PLACE );\r\n\r\n\t\t}\r\n\t\tif ( ! this.parent ) {\r\n\r\n\t\t\tsetWidth( _this, params.width );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\tthis.__resizeHandler = function () {\r\n\r\n\t\t_this.onResizeDebounced();\r\n\r\n\t};\r\n\tdom.bind( window, 'resize', this.__resizeHandler );\r\n\tdom.bind( this.__ul, 'webkitTransitionEnd', this.__resizeHandler );\r\n\tdom.bind( this.__ul, 'transitionend', this.__resizeHandler );\r\n\tdom.bind( this.__ul, 'oTransitionEnd', this.__resizeHandler );\r\n\tthis.onResize();\r\n\tif ( params.resizable ) {\r\n\r\n\t\taddResizeHandle( this );\r\n\r\n\t}\r\n\tsaveToLocalStorage = function saveToLocalStorage() {\r\n\r\n\t\tif ( SUPPORTS_LOCAL_STORAGE && localStorage.getItem( getLocalStorageHash( _this, 'isLocal' ) ) === 'true' ) {\r\n\r\n\t\t\tlocalStorage.setItem( getLocalStorageHash( _this, 'gui' ), JSON.stringify( _this.getSaveObject() ) );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\tthis.saveToLocalStorageIfPossible = saveToLocalStorage;\r\n\tfunction resetWidth() {\r\n\r\n\t\tvar root = _this.getRoot();\r\n\t\troot.width += 1;\r\n\t\tCommon.defer( function () {\r\n\r\n\t\t\troot.width -= 1;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\tif ( ! params.parent ) {\r\n\r\n\t\tresetWidth();\r\n\r\n\t}\r\n\r\n};\r\nGUI.toggleHide = function () {\r\n\r\n\thide = ! hide;\r\n\tCommon.each( hideableGuis, function ( gui ) {\r\n\r\n\t\tgui.domElement.style.display = hide ? 'none' : '';\r\n\r\n\t} );\r\n\r\n};\r\nGUI.CLASS_AUTO_PLACE = 'a';\r\nGUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';\r\nGUI.CLASS_MAIN = 'main';\r\nGUI.CLASS_CONTROLLER_ROW = 'cr';\r\nGUI.CLASS_TOO_TALL = 'taller-than-window';\r\nGUI.CLASS_CLOSED = 'closed';\r\nGUI.CLASS_CLOSE_BUTTON = 'close-button';\r\nGUI.CLASS_CLOSE_TOP = 'close-top';\r\nGUI.CLASS_CLOSE_BOTTOM = 'close-bottom';\r\nGUI.CLASS_DRAG = 'drag';\r\nGUI.DEFAULT_WIDTH = 245;\r\nGUI.TEXT_CLOSED = 'Close Controls';\r\nGUI.TEXT_OPEN = 'Open Controls';\r\nGUI._keydownHandler = function ( e ) {\r\n\r\n\tif ( document.activeElement.type !== 'text' && ( e.which === HIDE_KEY_CODE || e.keyCode === HIDE_KEY_CODE ) ) {\r\n\r\n\t\tGUI.toggleHide();\r\n\r\n\t}\r\n\r\n};\r\ndom.bind( window, 'keydown', GUI._keydownHandler, false );\r\nCommon.extend( GUI.prototype,\r\n\t{\r\n\t\tadd: function add( object, property ) {\r\n\r\n\t\t\treturn _add( this, object, property, {\r\n\t\t\t\tfactoryArgs: Array.prototype.slice.call( arguments, 2 )\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\t\taddColor: function addColor( object, property ) {\r\n\r\n\t\t\treturn _add( this, object, property, {\r\n\t\t\t\tcolor: true\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\t\tremove: function remove( controller ) {\r\n\r\n\t\t\tthis.__ul.removeChild( controller.__li );\r\n\t\t\tthis.__controllers.splice( this.__controllers.indexOf( controller ), 1 );\r\n\t\t\tvar _this = this;\r\n\t\t\tCommon.defer( function () {\r\n\r\n\t\t\t\t_this.onResize();\r\n\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\t\tdestroy: function destroy() {\r\n\r\n\t\t\tif ( this.parent ) {\r\n\r\n\t\t\t\tthrow new Error( 'Only the root GUI should be removed with .destroy(). ' + 'For subfolders, use gui.removeFolder(folder) instead.' );\r\n\r\n\t\t\t}\r\n\t\t\tif ( this.autoPlace ) {\r\n\r\n\t\t\t\tautoPlaceContainer.removeChild( this.domElement );\r\n\r\n\t\t\t}\r\n\t\t\tvar _this = this;\r\n\t\t\tCommon.each( this.__folders, function ( subfolder ) {\r\n\r\n\t\t\t\t_this.removeFolder( subfolder );\r\n\r\n\t\t\t} );\r\n\t\t\tdom.unbind( window, 'keydown', GUI._keydownHandler, false );\r\n\t\t\tremoveListeners( this );\r\n\r\n\t\t},\r\n\t\taddFolder: function addFolder( name ) {\r\n\r\n\t\t\tif ( this.__folders[ name ] !== undefined ) {\r\n\r\n\t\t\t\tthrow new Error( 'You already have a folder in this GUI by the' + ' name \"' + name + '\"' );\r\n\r\n\t\t\t}\r\n\t\t\tvar newGuiParams = { name: name, parent: this };\r\n\t\t\tnewGuiParams.autoPlace = this.autoPlace;\r\n\t\t\tif ( this.load &&\r\n    this.load.folders &&\r\n    this.load.folders[ name ] ) {\r\n\r\n\t\t\t\tnewGuiParams.closed = this.load.folders[ name ].closed;\r\n\t\t\t\tnewGuiParams.load = this.load.folders[ name ];\r\n\r\n\t\t\t}\r\n\t\t\tvar gui = new GUI( newGuiParams );\r\n\t\t\tthis.__folders[ name ] = gui;\r\n\t\t\tvar li = addRow( this, gui.domElement );\r\n\t\t\tdom.addClass( li, 'folder' );\r\n\t\t\treturn gui;\r\n\r\n\t\t},\r\n\t\tremoveFolder: function removeFolder( folder ) {\r\n\r\n\t\t\tthis.__ul.removeChild( folder.domElement.parentElement );\r\n\t\t\tdelete this.__folders[ folder.name ];\r\n\t\t\tif ( this.load &&\r\n    this.load.folders &&\r\n    this.load.folders[ folder.name ] ) {\r\n\r\n\t\t\t\tdelete this.load.folders[ folder.name ];\r\n\r\n\t\t\t}\r\n\t\t\tremoveListeners( folder );\r\n\t\t\tvar _this = this;\r\n\t\t\tCommon.each( folder.__folders, function ( subfolder ) {\r\n\r\n\t\t\t\tfolder.removeFolder( subfolder );\r\n\r\n\t\t\t} );\r\n\t\t\tCommon.defer( function () {\r\n\r\n\t\t\t\t_this.onResize();\r\n\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\t\topen: function open() {\r\n\r\n\t\t\tthis.closed = false;\r\n\r\n\t\t},\r\n\t\tclose: function close() {\r\n\r\n\t\t\tthis.closed = true;\r\n\r\n\t\t},\r\n\t\thide: function hide() {\r\n\r\n\t\t\tthis.domElement.style.display = 'none';\r\n\r\n\t\t},\r\n\t\tshow: function show() {\r\n\r\n\t\t\tthis.domElement.style.display = '';\r\n\r\n\t\t},\r\n\t\tonResize: function onResize() {\r\n\r\n\t\t\tvar root = this.getRoot();\r\n\t\t\tif ( root.scrollable ) {\r\n\r\n\t\t\t\tvar top = dom.getOffset( root.__ul ).top;\r\n\t\t\t\tvar h = 0;\r\n\t\t\t\tCommon.each( root.__ul.childNodes, function ( node ) {\r\n\r\n\t\t\t\t\tif ( ! ( root.autoPlace && node === root.__save_row ) ) {\r\n\r\n\t\t\t\t\t\th += dom.getHeight( node );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\t\t\t\tif ( window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h ) {\r\n\r\n\t\t\t\t\tdom.addClass( root.domElement, GUI.CLASS_TOO_TALL );\r\n\t\t\t\t\troot.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tdom.removeClass( root.domElement, GUI.CLASS_TOO_TALL );\r\n\t\t\t\t\troot.__ul.style.height = 'auto';\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tif ( root.__resize_handle ) {\r\n\r\n\t\t\t\tCommon.defer( function () {\r\n\r\n\t\t\t\t\troot.__resize_handle.style.height = root.__ul.offsetHeight + 'px';\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\t\t\tif ( root.__closeButton ) {\r\n\r\n\t\t\t\troot.__closeButton.style.width = root.width + 'px';\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tonResizeDebounced: Common.debounce( function () {\r\n\r\n\t\t\tthis.onResize();\r\n\r\n\t\t}, 50 ),\r\n\t\tremember: function remember() {\r\n\r\n\t\t\tif ( Common.isUndefined( SAVE_DIALOGUE ) ) {\r\n\r\n\t\t\t\tSAVE_DIALOGUE = new CenteredDiv();\r\n\t\t\t\tSAVE_DIALOGUE.domElement.innerHTML = saveDialogContents;\r\n\r\n\t\t\t}\r\n\t\t\tif ( this.parent ) {\r\n\r\n\t\t\t\tthrow new Error( 'You can only call remember on a top level GUI.' );\r\n\r\n\t\t\t}\r\n\t\t\tvar _this = this;\r\n\t\t\tCommon.each( Array.prototype.slice.call( arguments ), function ( object ) {\r\n\r\n\t\t\t\tif ( _this.__rememberedObjects.length === 0 ) {\r\n\r\n\t\t\t\t\taddSaveMenu( _this );\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( _this.__rememberedObjects.indexOf( object ) === - 1 ) {\r\n\r\n\t\t\t\t\t_this.__rememberedObjects.push( object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\t\t\tif ( this.autoPlace ) {\r\n\r\n\t\t\t\tsetWidth( this, this.width );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tgetRoot: function getRoot() {\r\n\r\n\t\t\tvar gui = this;\r\n\t\t\twhile ( gui.parent ) {\r\n\r\n\t\t\t\tgui = gui.parent;\r\n\r\n\t\t\t}\r\n\t\t\treturn gui;\r\n\r\n\t\t},\r\n\t\tgetSaveObject: function getSaveObject() {\r\n\r\n\t\t\tvar toReturn = this.load;\r\n\t\t\ttoReturn.closed = this.closed;\r\n\t\t\tif ( this.__rememberedObjects.length > 0 ) {\r\n\r\n\t\t\t\ttoReturn.preset = this.preset;\r\n\t\t\t\tif ( ! toReturn.remembered ) {\r\n\r\n\t\t\t\t\ttoReturn.remembered = {};\r\n\r\n\t\t\t\t}\r\n\t\t\t\ttoReturn.remembered[ this.preset ] = getCurrentPreset( this );\r\n\r\n\t\t\t}\r\n\t\t\ttoReturn.folders = {};\r\n\t\t\tCommon.each( this.__folders, function ( element, key ) {\r\n\r\n\t\t\t\ttoReturn.folders[ key ] = element.getSaveObject();\r\n\r\n\t\t\t} );\r\n\t\t\treturn toReturn;\r\n\r\n\t\t},\r\n\t\tsave: function save() {\r\n\r\n\t\t\tif ( ! this.load.remembered ) {\r\n\r\n\t\t\t\tthis.load.remembered = {};\r\n\r\n\t\t\t}\r\n\t\t\tthis.load.remembered[ this.preset ] = getCurrentPreset( this );\r\n\t\t\tmarkPresetModified( this, false );\r\n\t\t\tthis.saveToLocalStorageIfPossible();\r\n\r\n\t\t},\r\n\t\tsaveAs: function saveAs( presetName ) {\r\n\r\n\t\t\tif ( ! this.load.remembered ) {\r\n\r\n\t\t\t\tthis.load.remembered = {};\r\n\t\t\t\tthis.load.remembered[ DEFAULT_DEFAULT_PRESET_NAME ] = getCurrentPreset( this, true );\r\n\r\n\t\t\t}\r\n\t\t\tthis.load.remembered[ presetName ] = getCurrentPreset( this );\r\n\t\t\tthis.preset = presetName;\r\n\t\t\taddPresetOption( this, presetName, true );\r\n\t\t\tthis.saveToLocalStorageIfPossible();\r\n\r\n\t\t},\r\n\t\trevert: function revert( gui ) {\r\n\r\n\t\t\tCommon.each( this.__controllers, function ( controller ) {\r\n\r\n\t\t\t\tif ( ! this.getRoot().load.remembered ) {\r\n\r\n\t\t\t\t\tcontroller.setValue( controller.initialValue );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\trecallSavedValue( gui || this.getRoot(), controller );\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( controller.__onFinishChange ) {\r\n\r\n\t\t\t\t\tcontroller.__onFinishChange.call( controller, controller.getValue() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}, this );\r\n\t\t\tCommon.each( this.__folders, function ( folder ) {\r\n\r\n\t\t\t\tfolder.revert( folder );\r\n\r\n\t\t\t} );\r\n\t\t\tif ( ! gui ) {\r\n\r\n\t\t\t\tmarkPresetModified( this.getRoot(), false );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tlisten: function listen( controller ) {\r\n\r\n\t\t\tvar init = this.__listening.length === 0;\r\n\t\t\tthis.__listening.push( controller );\r\n\t\t\tif ( init ) {\r\n\r\n\t\t\t\tupdateDisplays( this.__listening );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tupdateDisplay: function updateDisplay() {\r\n\r\n\t\t\tCommon.each( this.__controllers, function ( controller ) {\r\n\r\n\t\t\t\tcontroller.updateDisplay();\r\n\r\n\t\t\t} );\r\n\t\t\tCommon.each( this.__folders, function ( folder ) {\r\n\r\n\t\t\t\tfolder.updateDisplay();\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\t} );\r\nfunction addRow( gui, newDom, liBefore ) {\r\n\r\n\tvar li = document.createElement( 'li' );\r\n\tif ( newDom ) {\r\n\r\n\t\tli.appendChild( newDom );\r\n\r\n\t}\r\n\tif ( liBefore ) {\r\n\r\n\t\tgui.__ul.insertBefore( li, liBefore );\r\n\r\n\t} else {\r\n\r\n\t\tgui.__ul.appendChild( li );\r\n\r\n\t}\r\n\tgui.onResize();\r\n\treturn li;\r\n\r\n}\r\nfunction removeListeners( gui ) {\r\n\r\n\tdom.unbind( window, 'resize', gui.__resizeHandler );\r\n\tif ( gui.saveToLocalStorageIfPossible ) {\r\n\r\n\t\tdom.unbind( window, 'unload', gui.saveToLocalStorageIfPossible );\r\n\r\n\t}\r\n\r\n}\r\nfunction markPresetModified( gui, modified ) {\r\n\r\n\tvar opt = gui.__preset_select[ gui.__preset_select.selectedIndex ];\r\n\tif ( modified ) {\r\n\r\n\t\topt.innerHTML = opt.value + '*';\r\n\r\n\t} else {\r\n\r\n\t\topt.innerHTML = opt.value;\r\n\r\n\t}\r\n\r\n}\r\nfunction augmentController( gui, li, controller ) {\r\n\r\n\tcontroller.__li = li;\r\n\tcontroller.__gui = gui;\r\n\tCommon.extend( controller, {\r\n\t\toptions: function options( _options ) {\r\n\r\n\t\t\tif ( arguments.length > 1 ) {\r\n\r\n\t\t\t\tvar nextSibling = controller.__li.nextElementSibling;\r\n\t\t\t\tcontroller.remove();\r\n\t\t\t\treturn _add( gui, controller.object, controller.property, {\r\n\t\t\t\t\tbefore: nextSibling,\r\n\t\t\t\t\tfactoryArgs: [ Common.toArray( arguments ) ]\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\t\t\tif ( Common.isArray( _options ) || Common.isObject( _options ) ) {\r\n\r\n\t\t\t\tvar _nextSibling = controller.__li.nextElementSibling;\r\n\t\t\t\tcontroller.remove();\r\n\t\t\t\treturn _add( gui, controller.object, controller.property, {\r\n\t\t\t\t\tbefore: _nextSibling,\r\n\t\t\t\t\tfactoryArgs: [ _options ]\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tname: function name( _name ) {\r\n\r\n\t\t\tcontroller.__li.firstElementChild.firstElementChild.innerHTML = _name;\r\n\t\t\treturn controller;\r\n\r\n\t\t},\r\n\t\tlisten: function listen() {\r\n\r\n\t\t\tcontroller.__gui.listen( controller );\r\n\t\t\treturn controller;\r\n\r\n\t\t},\r\n\t\tremove: function remove() {\r\n\r\n\t\t\tcontroller.__gui.remove( controller );\r\n\t\t\treturn controller;\r\n\r\n\t\t}\r\n\t} );\r\n\tif ( controller instanceof NumberControllerSlider ) {\r\n\r\n\t\tvar box = new NumberControllerBox( controller.object, controller.property, { min: controller.__min, max: controller.__max, step: controller.__step } );\r\n\t\tCommon.each( [ 'updateDisplay', 'onChange', 'onFinishChange', 'step', 'min', 'max' ], function ( method ) {\r\n\r\n\t\t\tvar pc = controller[ method ];\r\n\t\t\tvar pb = box[ method ];\r\n\t\t\tcontroller[ method ] = box[ method ] = function () {\r\n\r\n\t\t\t\tvar args = Array.prototype.slice.call( arguments );\r\n\t\t\t\tpb.apply( box, args );\r\n\t\t\t\treturn pc.apply( controller, args );\r\n\r\n\t\t\t};\r\n\r\n\t\t} );\r\n\t\tdom.addClass( li, 'has-slider' );\r\n\t\tcontroller.domElement.insertBefore( box.domElement, controller.domElement.firstElementChild );\r\n\r\n\t} else if ( controller instanceof NumberControllerBox ) {\r\n\r\n\t\tvar r = function r( returned ) {\r\n\r\n\t\t\tif ( Common.isNumber( controller.__min ) && Common.isNumber( controller.__max ) ) {\r\n\r\n\t\t\t\tvar oldName = controller.__li.firstElementChild.firstElementChild.innerHTML;\r\n\t\t\t\tvar wasListening = controller.__gui.__listening.indexOf( controller ) > - 1;\r\n\t\t\t\tcontroller.remove();\r\n\t\t\t\tvar newController = _add( gui, controller.object, controller.property, {\r\n\t\t\t\t\tbefore: controller.__li.nextElementSibling,\r\n\t\t\t\t\tfactoryArgs: [ controller.__min, controller.__max, controller.__step ]\r\n\t\t\t\t} );\r\n\t\t\t\tnewController.name( oldName );\r\n\t\t\t\tif ( wasListening ) newController.listen();\r\n\t\t\t\treturn newController;\r\n\r\n\t\t\t}\r\n\t\t\treturn returned;\r\n\r\n\t\t};\r\n\t\tcontroller.min = Common.compose( r, controller.min );\r\n\t\tcontroller.max = Common.compose( r, controller.max );\r\n\r\n\t} else if ( controller instanceof BooleanController ) {\r\n\r\n\t\tdom.bind( li, 'click', function () {\r\n\r\n\t\t\tdom.fakeEvent( controller.__checkbox, 'click' );\r\n\r\n\t\t} );\r\n\t\tdom.bind( controller.__checkbox, 'click', function ( e ) {\r\n\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t} );\r\n\r\n\t} else if ( controller instanceof FunctionController ) {\r\n\r\n\t\tdom.bind( li, 'click', function () {\r\n\r\n\t\t\tdom.fakeEvent( controller.__button, 'click' );\r\n\r\n\t\t} );\r\n\t\tdom.bind( li, 'mouseover', function () {\r\n\r\n\t\t\tdom.addClass( controller.__button, 'hover' );\r\n\r\n\t\t} );\r\n\t\tdom.bind( li, 'mouseout', function () {\r\n\r\n\t\t\tdom.removeClass( controller.__button, 'hover' );\r\n\r\n\t\t} );\r\n\r\n\t} else if ( controller instanceof ColorController ) {\r\n\r\n\t\tdom.addClass( li, 'color' );\r\n\t\tcontroller.updateDisplay = Common.compose( function ( val ) {\r\n\r\n\t\t\tli.style.borderLeftColor = controller.__color.toString();\r\n\t\t\treturn val;\r\n\r\n\t\t}, controller.updateDisplay );\r\n\t\tcontroller.updateDisplay();\r\n\r\n\t}\r\n\tcontroller.setValue = Common.compose( function ( val ) {\r\n\r\n\t\tif ( gui.getRoot().__preset_select && controller.isModified() ) {\r\n\r\n\t\t\tmarkPresetModified( gui.getRoot(), true );\r\n\r\n\t\t}\r\n\t\treturn val;\r\n\r\n\t}, controller.setValue );\r\n\r\n}\r\nfunction recallSavedValue( gui, controller ) {\r\n\r\n\tvar root = gui.getRoot();\r\n\tvar matchedIndex = root.__rememberedObjects.indexOf( controller.object );\r\n\tif ( matchedIndex !== - 1 ) {\r\n\r\n\t\tvar controllerMap = root.__rememberedObjectIndecesToControllers[ matchedIndex ];\r\n\t\tif ( controllerMap === undefined ) {\r\n\r\n\t\t\tcontrollerMap = {};\r\n\t\t\troot.__rememberedObjectIndecesToControllers[ matchedIndex ] = controllerMap;\r\n\r\n\t\t}\r\n\t\tcontrollerMap[ controller.property ] = controller;\r\n\t\tif ( root.load && root.load.remembered ) {\r\n\r\n\t\t\tvar presetMap = root.load.remembered;\r\n\t\t\tvar preset = void 0;\r\n\t\t\tif ( presetMap[ gui.preset ] ) {\r\n\r\n\t\t\t\tpreset = presetMap[ gui.preset ];\r\n\r\n\t\t\t} else if ( presetMap[ DEFAULT_DEFAULT_PRESET_NAME ] ) {\r\n\r\n\t\t\t\tpreset = presetMap[ DEFAULT_DEFAULT_PRESET_NAME ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\t\t\tif ( preset[ matchedIndex ] && preset[ matchedIndex ][ controller.property ] !== undefined ) {\r\n\r\n\t\t\t\tvar value = preset[ matchedIndex ][ controller.property ];\r\n\t\t\t\tcontroller.initialValue = value;\r\n\t\t\t\tcontroller.setValue( value );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\nfunction _add( gui, object, property, params ) {\r\n\r\n\tif ( object[ property ] === undefined ) {\r\n\r\n\t\tthrow new Error( 'Object \"' + object + '\" has no property \"' + property + '\"' );\r\n\r\n\t}\r\n\tvar controller = void 0;\r\n\tif ( params.color ) {\r\n\r\n\t\tcontroller = new ColorController( object, property );\r\n\r\n\t} else {\r\n\r\n\t\tvar factoryArgs = [ object, property ].concat( params.factoryArgs );\r\n\t\tcontroller = ControllerFactory.apply( gui, factoryArgs );\r\n\r\n\t}\r\n\tif ( params.before instanceof Controller ) {\r\n\r\n\t\tparams.before = params.before.__li;\r\n\r\n\t}\r\n\trecallSavedValue( gui, controller );\r\n\tdom.addClass( controller.domElement, 'c' );\r\n\tvar name = document.createElement( 'span' );\r\n\tdom.addClass( name, 'property-name' );\r\n\tname.innerHTML = controller.property;\r\n\tvar container = document.createElement( 'div' );\r\n\tcontainer.appendChild( name );\r\n\tcontainer.appendChild( controller.domElement );\r\n\tvar li = addRow( gui, container, params.before );\r\n\tdom.addClass( li, GUI.CLASS_CONTROLLER_ROW );\r\n\tif ( controller instanceof ColorController ) {\r\n\r\n\t\tdom.addClass( li, 'color' );\r\n\r\n\t} else {\r\n\r\n\t\tdom.addClass( li, _typeof( controller.getValue() ) );\r\n\r\n\t}\r\n\taugmentController( gui, li, controller );\r\n\tgui.__controllers.push( controller );\r\n\treturn controller;\r\n\r\n}\r\nfunction getLocalStorageHash( gui, key ) {\r\n\r\n\treturn document.location.href + '.' + key;\r\n\r\n}\r\nfunction addPresetOption( gui, name, setSelected ) {\r\n\r\n\tvar opt = document.createElement( 'option' );\r\n\topt.innerHTML = name;\r\n\topt.value = name;\r\n\tgui.__preset_select.appendChild( opt );\r\n\tif ( setSelected ) {\r\n\r\n\t\tgui.__preset_select.selectedIndex = gui.__preset_select.length - 1;\r\n\r\n\t}\r\n\r\n}\r\nfunction showHideExplain( gui, explain ) {\r\n\r\n\texplain.style.display = gui.useLocalStorage ? 'block' : 'none';\r\n\r\n}\r\nfunction addSaveMenu( gui ) {\r\n\r\n\tvar div = gui.__save_row = document.createElement( 'li' );\r\n\tdom.addClass( gui.domElement, 'has-save' );\r\n\tgui.__ul.insertBefore( div, gui.__ul.firstChild );\r\n\tdom.addClass( div, 'save-row' );\r\n\tvar gears = document.createElement( 'span' );\r\n\tgears.innerHTML = '&nbsp;';\r\n\tdom.addClass( gears, 'button gears' );\r\n\tvar button = document.createElement( 'span' );\r\n\tbutton.innerHTML = 'Save';\r\n\tdom.addClass( button, 'button' );\r\n\tdom.addClass( button, 'save' );\r\n\tvar button2 = document.createElement( 'span' );\r\n\tbutton2.innerHTML = 'New';\r\n\tdom.addClass( button2, 'button' );\r\n\tdom.addClass( button2, 'save-as' );\r\n\tvar button3 = document.createElement( 'span' );\r\n\tbutton3.innerHTML = 'Revert';\r\n\tdom.addClass( button3, 'button' );\r\n\tdom.addClass( button3, 'revert' );\r\n\tvar select = gui.__preset_select = document.createElement( 'select' );\r\n\tif ( gui.load && gui.load.remembered ) {\r\n\r\n\t\tCommon.each( gui.load.remembered, function ( value, key ) {\r\n\r\n\t\t\taddPresetOption( gui, key, key === gui.preset );\r\n\r\n\t\t} );\r\n\r\n\t} else {\r\n\r\n\t\taddPresetOption( gui, DEFAULT_DEFAULT_PRESET_NAME, false );\r\n\r\n\t}\r\n\tdom.bind( select, 'change', function () {\r\n\r\n\t\tfor ( var index = 0; index < gui.__preset_select.length; index ++ ) {\r\n\r\n\t\t\tgui.__preset_select[ index ].innerHTML = gui.__preset_select[ index ].value;\r\n\r\n\t\t}\r\n\t\tgui.preset = this.value;\r\n\r\n\t} );\r\n\tdiv.appendChild( select );\r\n\tdiv.appendChild( gears );\r\n\tdiv.appendChild( button );\r\n\tdiv.appendChild( button2 );\r\n\tdiv.appendChild( button3 );\r\n\tif ( SUPPORTS_LOCAL_STORAGE ) {\r\n\r\n\t\tvar explain = document.getElementById( 'dg-local-explain' );\r\n\t\tvar localStorageCheckBox = document.getElementById( 'dg-local-storage' );\r\n\t\tvar saveLocally = document.getElementById( 'dg-save-locally' );\r\n\t\tsaveLocally.style.display = 'block';\r\n\t\tif ( localStorage.getItem( getLocalStorageHash( gui, 'isLocal' ) ) === 'true' ) {\r\n\r\n\t\t\tlocalStorageCheckBox.setAttribute( 'checked', 'checked' );\r\n\r\n\t\t}\r\n\t\tshowHideExplain( gui, explain );\r\n\t\tdom.bind( localStorageCheckBox, 'change', function () {\r\n\r\n\t\t\tgui.useLocalStorage = ! gui.useLocalStorage;\r\n\t\t\tshowHideExplain( gui, explain );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\tvar newConstructorTextArea = document.getElementById( 'dg-new-constructor' );\r\n\tdom.bind( newConstructorTextArea, 'keydown', function ( e ) {\r\n\r\n\t\tif ( e.metaKey && ( e.which === 67 || e.keyCode === 67 ) ) {\r\n\r\n\t\t\tSAVE_DIALOGUE.hide();\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\tdom.bind( gears, 'click', function () {\r\n\r\n\t\tnewConstructorTextArea.innerHTML = JSON.stringify( gui.getSaveObject(), undefined, 2 );\r\n\t\tSAVE_DIALOGUE.show();\r\n\t\tnewConstructorTextArea.focus();\r\n\t\tnewConstructorTextArea.select();\r\n\r\n\t} );\r\n\tdom.bind( button, 'click', function () {\r\n\r\n\t\tgui.save();\r\n\r\n\t} );\r\n\tdom.bind( button2, 'click', function () {\r\n\r\n\t\tvar presetName = prompt( 'Enter a new preset name.' );\r\n\t\tif ( presetName ) {\r\n\r\n\t\t\tgui.saveAs( presetName );\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\tdom.bind( button3, 'click', function () {\r\n\r\n\t\tgui.revert();\r\n\r\n\t} );\r\n\r\n}\r\nfunction addResizeHandle( gui ) {\r\n\r\n\tvar pmouseX = void 0;\r\n\tgui.__resize_handle = document.createElement( 'div' );\r\n\tCommon.extend( gui.__resize_handle.style, {\r\n\t\twidth: '6px',\r\n\t\tmarginLeft: '-3px',\r\n\t\theight: '200px',\r\n\t\tcursor: 'ew-resize',\r\n\t\tposition: 'absolute'\r\n\t} );\r\n\tfunction drag( e ) {\r\n\r\n\t\te.preventDefault();\r\n\t\tgui.width += pmouseX - e.clientX;\r\n\t\tgui.onResize();\r\n\t\tpmouseX = e.clientX;\r\n\t\treturn false;\r\n\r\n\t}\r\n\tfunction dragStop() {\r\n\r\n\t\tdom.removeClass( gui.__closeButton, GUI.CLASS_DRAG );\r\n\t\tdom.unbind( window, 'mousemove', drag );\r\n\t\tdom.unbind( window, 'mouseup', dragStop );\r\n\r\n\t}\r\n\tfunction dragStart( e ) {\r\n\r\n\t\te.preventDefault();\r\n\t\tpmouseX = e.clientX;\r\n\t\tdom.addClass( gui.__closeButton, GUI.CLASS_DRAG );\r\n\t\tdom.bind( window, 'mousemove', drag );\r\n\t\tdom.bind( window, 'mouseup', dragStop );\r\n\t\treturn false;\r\n\r\n\t}\r\n\tdom.bind( gui.__resize_handle, 'mousedown', dragStart );\r\n\tdom.bind( gui.__closeButton, 'mousedown', dragStart );\r\n\tgui.domElement.insertBefore( gui.__resize_handle, gui.domElement.firstElementChild );\r\n\r\n}\r\nfunction setWidth( gui, w ) {\r\n\r\n\tgui.domElement.style.width = w + 'px';\r\n\tif ( gui.__save_row && gui.autoPlace ) {\r\n\r\n\t\tgui.__save_row.style.width = w + 'px';\r\n\r\n\t}\r\n\tif ( gui.__closeButton ) {\r\n\r\n\t\tgui.__closeButton.style.width = w + 'px';\r\n\r\n\t}\r\n\r\n}\r\nfunction getCurrentPreset( gui, useInitialValues ) {\r\n\r\n\tvar toReturn = {};\r\n\tCommon.each( gui.__rememberedObjects, function ( val, index ) {\r\n\r\n\t\tvar savedValues = {};\r\n\t\tvar controllerMap = gui.__rememberedObjectIndecesToControllers[ index ];\r\n\t\tCommon.each( controllerMap, function ( controller, property ) {\r\n\r\n\t\t\tsavedValues[ property ] = useInitialValues ? controller.initialValue : controller.getValue();\r\n\r\n\t\t} );\r\n\t\ttoReturn[ index ] = savedValues;\r\n\r\n\t} );\r\n\treturn toReturn;\r\n\r\n}\r\nfunction setPresetSelectIndex( gui ) {\r\n\r\n\tfor ( var index = 0; index < gui.__preset_select.length; index ++ ) {\r\n\r\n\t\tif ( gui.__preset_select[ index ].value === gui.preset ) {\r\n\r\n\t\t\tgui.__preset_select.selectedIndex = index;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\nfunction updateDisplays( controllerArray ) {\r\n\r\n\tif ( controllerArray.length !== 0 ) {\r\n\r\n\t\trequestAnimationFrame$1.call( window, function () {\r\n\r\n\t\t\tupdateDisplays( controllerArray );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\tCommon.each( controllerArray, function ( c ) {\r\n\r\n\t\tc.updateDisplay();\r\n\r\n\t} );\r\n\r\n}\r\n\r\nvar color = {\r\n\tColor: Color,\r\n\tmath: ColorMath,\r\n\tinterpret: interpret\r\n};\r\nvar controllers = {\r\n\tController: Controller,\r\n\tBooleanController: BooleanController,\r\n\tOptionController: OptionController,\r\n\tStringController: StringController,\r\n\tNumberController: NumberController,\r\n\tNumberControllerBox: NumberControllerBox,\r\n\tNumberControllerSlider: NumberControllerSlider,\r\n\tFunctionController: FunctionController,\r\n\tColorController: ColorController\r\n};\r\nvar dom$1 = { dom: dom };\r\nvar gui = { GUI: GUI };\r\nvar GUI$1 = GUI;\r\nvar index = {\r\n\tcolor: color,\r\n\tcontrollers: controllers,\r\n\tdom: dom$1,\r\n\tgui: gui,\r\n\tGUI: GUI$1\r\n};\r\n\r\nexport { color, controllers, dom$1 as dom, gui, GUI$1 as GUI };\r\nexport default index;\r\n","import * as THREE from 'three';\r\n// Control\r\nimport { OrbitControls } from 'LIB/threejs/controls/OrbitControls';\r\n// Environment\r\nimport { Environment } from '../modules/environment/Environment';\r\nimport { PBRMaterial } from './PBRMaterial';\r\nimport { Background } from '../modules/background/Background';\r\nimport {\r\n\tenvMapList,\r\n\tenvMapPath,\r\n\tdiffuseEquation,\r\n\tspecularNDFEquation,\r\n\tspecularFresnelEquation,\r\n\tspecularVisEquation,\r\n\ttoneMappingList\r\n} from '../const/config';\r\nimport { pbrDefaultDefines } from '../const/defaultParams';\r\n// Utils\r\nimport { adjustCameraByBox, adjustSunLightByBox } from './ThreeUtils';\r\nimport { isMobile } from './Utils';\r\n\r\n// Test\r\nimport { GUI } from 'LIB/threejs/libs/dat.gui.module.js';\r\n\r\nexport default class ModelViewer {\r\n\tconstructor(mainScene, gltf, callBack) {\r\n\t\tthis.gltfScene = gltf.scene;\r\n\t\tthis.time = 0;\r\n\t\tthis.debug = false;\r\n\t\tthis.isMobile = isMobile();\r\n\t\t// Env Rotation\r\n\t\tthis.envRotation = 0;\r\n\t\tthis.envRotationMat = { value: new THREE.Matrix4().makeRotationY(this.envRotation) };\r\n\t\tthis.envBrightness = { value: 1.0 };\r\n\r\n\t\tthis.renderer = mainScene.renderer;\r\n\t\tthis.renderer.toneMapping = THREE[`${toneMappingList[0]}ToneMapping`];\r\n\t\tthis.scene = mainScene.scene;\r\n\t\tthis.camera = mainScene.camera;\r\n\t\tthis.container = mainScene.container;\r\n\t\tthis.width = mainScene.width;\r\n\t\tthis.height = mainScene.height;\r\n\t\tthis.callBack = callBack;\r\n\r\n\t\tthis.control = new OrbitControls(this.camera, this.container);\r\n\t\tthis.initScene();\r\n\t}\r\n\r\n\tloadEnvMap(envMapName = envMapList[0]) {\r\n\t\tconst envMapSrc = `${envMapPath}${envMapName}/`;\r\n\t\treturn new Environment(this).loadPackage(envMapSrc);\r\n\t}\r\n\r\n\tloadSunLight(sunlightInfo) {\r\n\t\tif (!this.sunLight) this.sunLight = new THREE.DirectionalLight(0xffffff, 1);\r\n\t\tthis.sunLight.position.copy(sunlightInfo.position);\r\n\t\tthis.sunLight.castShadow = true;\r\n\t\tthis.scene.add(this.sunLight);\r\n\t}\r\n\r\n\tloadBackground(backgroundEnv, uBGEnvironmentSize) {\r\n\t\tif (!this.background) {\r\n\t\t\tthis.background = new Background(\r\n\t\t\t\t{\r\n\t\t\t\t\tenvMap: backgroundEnv.texture,\r\n\t\t\t\t\tuBGEnvironmentSize,\r\n\t\t\t\t\tuEnvBrightness: this.envBrightness,\r\n\t\t\t\t\tdebug: this.debug\r\n\t\t\t\t},\r\n\t\t\t\t500\r\n\t\t\t);\r\n\t\t\tthis.background.material.uniforms.uEnvironmentTransform = this.envRotationMat;\r\n\t\t} else {\r\n\t\t\t// Update new background\r\n\t\t\tthis.background.material.uniforms.envMap.value = backgroundEnv.texture;\r\n\t\t\tthis.background.material.uniforms.uEnvironmentSize.value = uBGEnvironmentSize;\r\n\t\t}\r\n\t}\r\n\r\n\tasync updateEnvMap(envMapName, callBack) {\r\n\t\tlet environment = await this.loadEnvMap(envMapName);\r\n\t\tlet {\r\n\t\t\tmapEnv,\r\n\t\t\tbackgroundEnv,\r\n\t\t\tuEnvironmentSphericalHarmonics,\r\n\t\t\tuEnvironmentLodRange,\r\n\t\t\tuEnvironmentSize,\r\n\t\t\tuBGEnvironmentSize,\r\n\t\t\tsunlightInfo\r\n\t\t} = environment;\r\n\r\n\t\tthis.loadSunLight(sunlightInfo);\r\n\t\tthis.sunLightStartPos = this.sunLight.position.clone();\r\n\t\tthis.loadBackground(backgroundEnv, uBGEnvironmentSize);\r\n\r\n\t\t// Sync new envmap param\r\n\t\tthis.gltfScene.traverse(child => {\r\n\t\t\tif (child.isMesh) {\r\n\t\t\t\tchild.material.uniforms.envMap.value = mapEnv.texture;\r\n\t\t\t\tchild.material.uniforms['uEnvironmentSphericalHarmonics'] = { value: uEnvironmentSphericalHarmonics };\r\n\t\t\t\tchild.material.uniforms['uEnvironmentLodRange'] = { value: uEnvironmentLodRange };\r\n\t\t\t\tchild.material.uniforms['uEnvironmentSize'] = { value: uEnvironmentSize };\r\n\t\t\t\tchild.material.needsUpdate = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\ttypeof callBack == 'function' && callBack();\r\n\t}\r\n\r\n\tasync initScene() {\r\n\t\tlet environment = await this.loadEnvMap();\r\n\t\tlet {\r\n\t\t\tbackgroundEnv,\r\n\t\t\tuBGEnvironmentSize,\r\n\t\t\tsunlightInfo\r\n\t\t} = environment;\r\n\t\tlet { scene } = this;\r\n\r\n\t\tthis.loadSunLight(sunlightInfo);\r\n\t\tthis.loadBackground(backgroundEnv, uBGEnvironmentSize);\r\n\t\tscene.add(this.background);\r\n\r\n\t\t// Load Model\r\n\t\tlet gltfScene = this.gltfScene;\r\n\t\tscene.add(gltfScene);\r\n\t\tthis.adjustFactorFromBox(gltfScene);\r\n\t\tlet shadowDepthRange = (this.shadowDepthRange = new THREE.Vector2(\r\n\t\t\tthis.sunLight.shadow.camera.near,\r\n\t\t\tthis.sunLight.shadow.camera.far\r\n\t\t));\r\n\t\t// Replace PBR Material\r\n\t\tgltfScene.traverse(child => {\r\n\t\t\tif (child.isMesh) {\r\n\t\t\t\tchild.material = new PBRMaterial(child, environment, {\r\n\t\t\t\t\tshadowDepthRange,\r\n\t\t\t\t});\r\n\t\t\t\tchild.material.uniforms.uEnvironmentTransform = this.envRotationMat;\r\n\t\t\t\tchild.material.uniforms.uEnvBrightness = this.envBrightness;\r\n\t\t\t\tchild.castShadow = true;\r\n\t\t\t\tchild.receiveShadow = true;\r\n\t\t\t\t// Test\r\n\t\t\t\tchild.material.uniforms.uEnableIBL = this.enableIBL;\r\n\t\t\t\tchild.material.uniforms.uEnableLight = this.enableLight;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.initEvent();\r\n\t\tthis.initGUI();\r\n\t\ttypeof this.callBack === 'function' && this.callBack();\r\n\t}\r\n\r\n\tadjustFactorFromBox(object) {\r\n\t\t// Compute box for scale\r\n\t\tlet box = (this.box = new THREE.Box3().setFromObject(object));\r\n\t\tlet size = box.getSize(new THREE.Vector3());\r\n\t\tconst maxSize = Math.max(size.x, size.y, size.z);\r\n\t\t// At least 100\r\n\t\tif (maxSize < 100) {\r\n\t\t\tlet scale = 100 / maxSize;\r\n\t\t\tobject.scale.setScalar(scale);\r\n\t\t}\r\n\t\t// Recompute box for center\r\n\t\tbox = this.box = new THREE.Box3().setFromObject(object);\r\n\t\tlet center = box.getCenter(new THREE.Vector3());\r\n\t\t// Move object to origin\r\n\t\tobject.position.sub(center);\r\n\t\tif (this.debug) {\r\n\t\t\tlet boxObj = new THREE.BoxHelper(object, 0xffff00);\r\n\t\t\tthis.scene.add(boxObj);\r\n\t\t}\r\n\t\t// Camera\r\n\t\tadjustCameraByBox(this.camera, object, this.control, 2);\r\n\t\t// Background\r\n\t\tthis.background.setSize(this.camera.far);\r\n\t\t// Light/Shadow\r\n\t\tadjustSunLightByBox(this.sunLight, this.scene, object, this.debug);\r\n\t\tthis.sunLightStartPos = this.sunLight.position.clone();\r\n\t\t// Material factor\r\n\t}\r\n\r\n\tinitEvent() {\r\n\t\tlet lastMousePosition = { x: 0 };\r\n\t\twindow.addEventListener(\r\n\t\t\t'mousemove',\r\n\t\t\tevent => {\r\n\t\t\t\tlet button = event.which || event.button;\r\n\t\t\t\tif (event.altKey && button) {\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tlet deltaX = event.clientX - lastMousePosition.x;\r\n\t\t\t\t\tthis.envRotation += deltaX * 0.01;\r\n\t\t\t\t}\r\n\t\t\t\tlastMousePosition.x = event.clientX;\r\n\t\t\t},\r\n\t\t\ttrue\r\n\t\t);\r\n\t}\r\n\r\n\tinitGUI() {\r\n\t\tlet gui = new GUI();\r\n\t\tlet gltfScene = this.gltfScene;\r\n\t\tlet params = (this.guiParams = {\r\n\t\t\tenableIBL: !!pbrDefaultDefines.ENABLE_IBL,\r\n\t\t\tenableLight: !!pbrDefaultDefines.ENABLE_LIGHT,\r\n\t\t\tenvRotation: this.envRotation,\r\n\t\t\tenvBrightness: this.envBrightness.value,\r\n\t\t\tenvMap: envMapList[0],\r\n\t\t\tmetalness: 0,\r\n\t\t\troughness: 0.5,\r\n\t\t\t// Equations\r\n\t\t\tdiffuseEquation: diffuseEquation[0],\r\n\t\t\tspecularFresnelEquation: specularFresnelEquation[0],\r\n\t\t\tspecularNDFEquation: specularNDFEquation[0],\r\n\t\t\tspecularVisEquation: specularVisEquation[0],\r\n\t\t\t// Post\r\n\t\t\ttoneMapping: toneMappingList[0]\r\n\t\t});\r\n\t\t// PBR\r\n\t\tconst pbrFolder = gui.addFolder('PBR');\r\n\t\tpbrFolder.add(params, 'enableIBL').onChange(value => {\r\n\t\t\tthis.guiParams.enableIBL = value;\r\n\t\t\tthis.reCompileShader();\r\n\t\t});\r\n\t\tpbrFolder\r\n\t\t\t.add(params, 'enableLight')\r\n\t\t\t.name('enableSunLight')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.enableLight = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tpbrFolder.add(params, 'envMap', envMapList).onChange(value => {\r\n\t\t\tdocument.querySelector('#wrapper').classList.add('isLoading');\r\n\t\t\tthis.updateEnvMap(value, () => {\r\n\t\t\t\tdocument.querySelector('#wrapper').classList.remove('isLoading');\r\n\t\t\t});\r\n\t\t});\r\n\t\tpbrFolder\r\n\t\t\t.add(params, 'envRotation', -Math.PI, Math.PI)\r\n\t\t\t.step(0.1)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.envRotation = value;\r\n\t\t\t});\r\n\t\tpbrFolder\r\n\t\t\t.add(params, 'envBrightness', 0, 2)\r\n\t\t\t.step(0.1)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.envBrightness.value = value;\r\n\t\t\t});\r\n\t\tpbrFolder\r\n\t\t\t.add(params, 'metalness', 0, 1)\r\n\t\t\t.step(0.01)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tgltfScene.traverse(child => {\r\n\t\t\t\t\tif (child.isMesh) {\r\n\t\t\t\t\t\tchild.material.uniforms.metalness.value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\tpbrFolder\r\n\t\t\t.add(params, 'roughness', 0, 1)\r\n\t\t\t.step(0.01)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tgltfScene.traverse(child => {\r\n\t\t\t\t\tif (child.isMesh) {\r\n\t\t\t\t\t\tchild.material.uniforms.roughness.value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\tpbrFolder.open();\r\n\r\n\t\tconst equationsFolder = gui.addFolder('Equations');\r\n\t\tequationsFolder.add(params, 'diffuseEquation', diffuseEquation).name('diffuse').onChange(value => {\r\n\t\t\tthis.guiParams.diffuseEquation = value;\r\n\t\t\tthis.reCompileShader();\r\n\t\t});\r\n\t\tequationsFolder.add(params, 'specularFresnelEquation', specularFresnelEquation).name('fresnel').onChange(value => {\r\n\t\t\tthis.guiParams.specularFresnelEquation = value;\r\n\t\t\tthis.reCompileShader();\r\n\t\t});\r\n\t\tequationsFolder.add(params, 'specularNDFEquation', specularNDFEquation).name('NDF').onChange(value => {\r\n\t\t\tthis.guiParams.specularNDFEquation = value;\r\n\t\t\tthis.reCompileShader();\r\n\t\t});\r\n\t\tequationsFolder.add(params, 'specularVisEquation', specularVisEquation).name('geometry').onChange(value => {\r\n\t\t\tthis.guiParams.specularVisEquation = value;\r\n\t\t\tthis.reCompileShader();\r\n\t\t});\r\n\t\tequationsFolder.open();\r\n\r\n\t\tconst postFolder = gui.addFolder('Post-Processing');\r\n\t\tpostFolder.add(params, 'toneMapping', toneMappingList).onChange(value => {\r\n\t\t\tthis.renderer.toneMapping = THREE[`${value}ToneMapping`];\r\n\t\t\tthis.reCompileShader(true);\r\n\t\t});\r\n\t}\r\n\r\n\tsetDefinesFromGUI(defines) {\r\n\t\tlet guiParams = this.guiParams;\r\n\t\t// Clean\r\n\t\tlet reg = /(ENABLE_IBL)|(ENABLE_LIGHT)|(DIFFUSE_*)|(F_*)|(NDF_*)|(V_*)/g;\r\n\t\tObject.keys(defines).map(key => {\r\n\t\t\tif(reg.test(key)) delete defines[key];\r\n\t\t});\r\n\t\t// Reset\r\n\t\tif (guiParams.enableIBL) defines.ENABLE_IBL = 1;\r\n\t\tif (guiParams.enableLight) defines.ENABLE_LIGHT = 1;\r\n\t\tdefines[`DIFFUSE_${guiParams.diffuseEquation.toUpperCase()}`] = 1;\r\n\t\tdefines[`F_${guiParams.specularFresnelEquation.toUpperCase()}`] = 1;\r\n\t\tdefines[`NDF_${guiParams.specularNDFEquation.toUpperCase()}`] = 1;\r\n\t\tdefines[`V_${guiParams.specularVisEquation.toUpperCase()}`] = 1;\r\n\t\t\r\n\t\treturn defines;\r\n\t}\r\n\r\n\treCompileShader(updateBG) {\r\n\t\tthis.gltfScene.traverse(child => {\r\n\t\t\tif (child.isMesh && child.material) {\r\n\t\t\t\tthis.setDefinesFromGUI(child.material.defines);\r\n\t\t\t\tchild.material.needsUpdate = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(updateBG) this.background.material.needsUpdate = true;\r\n\t}\r\n\r\n\tupdateEnvironmentRotation(value) {\r\n\t\t// Get panel rotation\r\n\t\tthis.envRotationMat.value.makeRotationY(value);\r\n\t\t// Direction compute by position\r\n\t\tlet resultSunlight = this.sunLightStartPos.clone();\r\n\t\tresultSunlight.applyMatrix4(this.envRotationMat.value);\r\n\t\tthis.sunLight.position.copy(resultSunlight);\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tthis.updateEnvironmentRotation(this.envRotation);\r\n\t\tthis.renderer.render(this.scene, this.camera);\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport ModelViewer from './js/ModelViewer';\r\n// Utils\r\nimport { getEleWidth, getEleHeight } from './js/Utils';\r\n\r\nexport default class MainScene {\r\n\tconstructor(container, gltf, callback) {\r\n\t\tthis.container = container;\r\n\t\tthis.time = 0;\r\n\t\tthis.width = getEleWidth(container);\r\n\t\tthis.height = getEleHeight(container);\r\n\t\t// Camera\r\n\t\tconst camera = (this.camera = new THREE.PerspectiveCamera(45, this.width / this.height, 0.1, 1000));\r\n\t\tcamera.position.set(0, 0, 10);\r\n\t\t// Renderer\r\n\t\tconst renderer = (this.renderer = new THREE.WebGLRenderer({\r\n\t\t\tantialias: false\r\n\t\t}));\r\n\t\trenderer.domElement.id = 'canvasWebGL';\r\n\t\trenderer.setPixelRatio(window.devicePixelRatio);\r\n\t\trenderer.setSize(this.width, this.height);\r\n\t\trenderer.gammaFactor = 2.2;\r\n\t\trenderer.setClearColor(0xffffff, 1.0);\r\n\t\trenderer.shadowMap.enabled = true;\r\n\t\tcontainer.appendChild(renderer.domElement);\r\n\t\t// Scene\r\n\t\tthis.initScene(gltf, callback);\r\n\t\t// Events\r\n\t\tthis.initEvents();\r\n\t}\r\n\r\n\tinitScene(gltf, callback) {\r\n\t\tthis.scene = new THREE.Scene();\r\n\t\tthis.modelViewer = new ModelViewer(this, gltf, () => {\r\n\t\t\tthis.loaded = true;\r\n\t\t\tthis.onWindowResize();\r\n\t\t\ttypeof callback === 'function' && callback();\r\n\t\t});\r\n\t\tthis.animete();\r\n\t}\r\n\r\n\tinitEvents() {\r\n\t\twindow.addEventListener('resize', this.onWindowResize.bind(this), false);\r\n\t}\r\n\r\n\tonWindowResize() {\r\n\t\tthis.width = getEleWidth(this.container);\r\n\t\tthis.height = getEleHeight(this.container);\r\n\t\tthis.camera.aspect = this.width / this.height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\t\tthis.renderer.setPixelRatio(window.devicePixelRatio);\r\n\t\tthis.renderer.setSize(this.width, this.height);\r\n\t}\r\n\r\n\tanimete() {\r\n\t\tif(this.loaded) this.modelViewer.update();\r\n\t\trequestAnimationFrame(this.animete.bind(this));\r\n\t}\r\n}\r\n","/**\r\n * @author Rich Tibbett / https://github.com/richtr\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Tony Parisi / http://www.tonyparisi.com/\r\n * @author Takahiro / https://github.com/takahirox\r\n * @author Don McCurdy / https://www.donmccurdy.com\r\n */\r\n\r\nimport {\r\n\tAnimationClip,\r\n\tBone,\r\n\tBox3,\r\n\tBufferAttribute,\r\n\tBufferGeometry,\r\n\tClampToEdgeWrapping,\r\n\tColor,\r\n\tDirectionalLight,\r\n\tDoubleSide,\r\n\tFileLoader,\r\n\tFrontSide,\r\n\tGroup,\r\n\tInterleavedBuffer,\r\n\tInterleavedBufferAttribute,\r\n\tInterpolant,\r\n\tInterpolateDiscrete,\r\n\tInterpolateLinear,\r\n\tLine,\r\n\tLineBasicMaterial,\r\n\tLineLoop,\r\n\tLineSegments,\r\n\tLinearFilter,\r\n\tLinearMipmapLinearFilter,\r\n\tLinearMipmapNearestFilter,\r\n\tLoader,\r\n\tLoaderUtils,\r\n\tMaterial,\r\n\tMathUtils,\r\n\tMatrix4,\r\n\tMesh,\r\n\tMeshBasicMaterial,\r\n\tMeshStandardMaterial,\r\n\tMirroredRepeatWrapping,\r\n\tNearestFilter,\r\n\tNearestMipmapLinearFilter,\r\n\tNearestMipmapNearestFilter,\r\n\tNumberKeyframeTrack,\r\n\tObject3D,\r\n\tOrthographicCamera,\r\n\tPerspectiveCamera,\r\n\tPointLight,\r\n\tPoints,\r\n\tPointsMaterial,\r\n\tPropertyBinding,\r\n\tQuaternionKeyframeTrack,\r\n\tRGBAFormat,\r\n\tRGBFormat,\r\n\tRepeatWrapping,\r\n\tScene,\r\n\tSkeleton,\r\n\tSkinnedMesh,\r\n\tSphere,\r\n\tSpotLight,\r\n\tTangentSpaceNormalMap,\r\n\tTextureLoader,\r\n\tTriangleFanDrawMode,\r\n\tTriangleStripDrawMode,\r\n\tVector2,\r\n\tVector3,\r\n\tVectorKeyframeTrack,\r\n\tVertexColors,\r\n\tsRGBEncoding\r\n} from \"three\";\r\n\r\nvar GLTFLoader = ( function () {\r\n\r\n\tfunction GLTFLoader( manager ) {\r\n\r\n\t\tLoader.call( this, manager );\r\n\r\n\t\tthis.dracoLoader = null;\r\n\t\tthis.ddsLoader = null;\r\n\r\n\t}\r\n\r\n\tGLTFLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\r\n\r\n\t\tconstructor: GLTFLoader,\r\n\r\n\t\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tvar resourcePath;\r\n\r\n\t\t\tif ( this.resourcePath !== '' ) {\r\n\r\n\t\t\t\tresourcePath = this.resourcePath;\r\n\r\n\t\t\t} else if ( this.path !== '' ) {\r\n\r\n\t\t\t\tresourcePath = this.path;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Tells the LoadingManager to track an extra item, which resolves after\r\n\t\t\t// the model is fully loaded. This means the count of items loaded will\r\n\t\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\r\n\t\t\tscope.manager.itemStart( url );\r\n\r\n\t\t\tvar _onError = function ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\t\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar loader = new FileLoader( scope.manager );\r\n\r\n\t\t\tloader.setPath( this.path );\r\n\t\t\tloader.setResponseType( 'arraybuffer' );\r\n\r\n\t\t\tif ( scope.crossOrigin === 'use-credentials' ) {\r\n\r\n\t\t\t\tloader.setWithCredentials( true );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tloader.load( url, function ( data ) {\r\n\r\n\t\t\t\ttry {\r\n\r\n\t\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\r\n\r\n\t\t\t\t\t\tonLoad( gltf );\r\n\r\n\t\t\t\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t\t\t\t}, _onError );\r\n\r\n\t\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t\t_onError( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}, onProgress, _onError );\r\n\r\n\t\t},\r\n\r\n\t\tsetDRACOLoader: function ( dracoLoader ) {\r\n\r\n\t\t\tthis.dracoLoader = dracoLoader;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tsetDDSLoader: function ( ddsLoader ) {\r\n\r\n\t\t\tthis.ddsLoader = ddsLoader;\r\n\t\t\treturn this;\r\n\r\n\t\t},\r\n\r\n\t\tparse: function ( data, path, onLoad, onError ) {\r\n\r\n\t\t\tvar content;\r\n\t\t\tvar extensions = {};\r\n\r\n\t\t\tif ( typeof data === 'string' ) {\r\n\r\n\t\t\t\tcontent = data;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar magic = LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\r\n\r\n\t\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\t\t\ttry {\r\n\r\n\t\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\r\n\r\n\t\t\t\t\t} catch ( error ) {\r\n\r\n\t\t\t\t\t\tif ( onError ) onError( error );\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontent = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcontent = LoaderUtils.decodeText( new Uint8Array( data ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar json = JSON.parse( content );\r\n\r\n\t\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\r\n\r\n\t\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( json.extensionsUsed ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < json.extensionsUsed.length; ++ i ) {\r\n\r\n\t\t\t\t\tvar extensionName = json.extensionsUsed[ i ];\r\n\t\t\t\t\tvar extensionsRequired = json.extensionsRequired || [];\r\n\r\n\t\t\t\t\tswitch ( extensionName ) {\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_LIGHTS_PUNCTUAL:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFLightsExtension( json );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.MSFT_TEXTURE_DDS:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureDDSExtension( this.ddsLoader );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\r\n\t\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 ) {\r\n\r\n\t\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar parser = new GLTFParser( json, extensions, {\r\n\r\n\t\t\t\tpath: path || this.resourcePath || '',\r\n\t\t\t\tcrossOrigin: this.crossOrigin,\r\n\t\t\t\tmanager: this.manager\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tparser.parse( onLoad, onError );\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n\t/* GLTFREGISTRY */\r\n\r\n\tfunction GLTFRegistry() {\r\n\r\n\t\tvar objects = {};\r\n\r\n\t\treturn\t{\r\n\r\n\t\t\tget: function ( key ) {\r\n\r\n\t\t\t\treturn objects[ key ];\r\n\r\n\t\t\t},\r\n\r\n\t\t\tadd: function ( key, object ) {\r\n\r\n\t\t\t\tobjects[ key ] = object;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremove: function ( key ) {\r\n\r\n\t\t\t\tdelete objects[ key ];\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremoveAll: function () {\r\n\r\n\t\t\t\tobjects = {};\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** EXTENSIONS ***********/\r\n\t/*********************************/\r\n\r\n\tvar EXTENSIONS = {\r\n\t\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\r\n\t\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\r\n\t\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\r\n\t\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness',\r\n\t\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\r\n\t\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\r\n\t\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\r\n\t\tMSFT_TEXTURE_DDS: 'MSFT_texture_dds'\r\n\t};\r\n\r\n\t/**\r\n\t * DDS Texture Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/MSFT_texture_dds\r\n\t *\r\n\t */\r\n\tfunction GLTFTextureDDSExtension( ddsLoader ) {\r\n\r\n\t\tif ( ! ddsLoader ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.name = EXTENSIONS.MSFT_TEXTURE_DDS;\r\n\t\tthis.ddsLoader = ddsLoader;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Punctual Lights Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\r\n\t */\r\n\tfunction GLTFLightsExtension( json ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\r\n\r\n\t\tvar extension = ( json.extensions && json.extensions[ EXTENSIONS.KHR_LIGHTS_PUNCTUAL ] ) || {};\r\n\t\tthis.lightDefs = extension.lights || [];\r\n\r\n\t}\r\n\r\n\tGLTFLightsExtension.prototype.loadLight = function ( lightIndex ) {\r\n\r\n\t\tvar lightDef = this.lightDefs[ lightIndex ];\r\n\t\tvar lightNode;\r\n\r\n\t\tvar color = new Color( 0xffffff );\r\n\t\tif ( lightDef.color !== undefined ) color.fromArray( lightDef.color );\r\n\r\n\t\tvar range = lightDef.range !== undefined ? lightDef.range : 0;\r\n\r\n\t\tswitch ( lightDef.type ) {\r\n\r\n\t\t\tcase 'directional':\r\n\t\t\t\tlightNode = new DirectionalLight( color );\r\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\r\n\t\t\t\tlightNode.add( lightNode.target );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'point':\r\n\t\t\t\tlightNode = new PointLight( color );\r\n\t\t\t\tlightNode.distance = range;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'spot':\r\n\t\t\t\tlightNode = new SpotLight( color );\r\n\t\t\t\tlightNode.distance = range;\r\n\t\t\t\t// Handle spotlight properties.\r\n\t\t\t\tlightDef.spot = lightDef.spot || {};\r\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\r\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\r\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\r\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\r\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\r\n\t\t\t\tlightNode.add( lightNode.target );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type, \"' + lightDef.type + '\".' );\r\n\r\n\t\t}\r\n\r\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\r\n\t\t// here, because node-level parsing will only override position if explicitly specified.\r\n\t\tlightNode.position.set( 0, 0, 0 );\r\n\r\n\t\tlightNode.decay = 2;\r\n\r\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\r\n\r\n\t\tlightNode.name = lightDef.name || ( 'light_' + lightIndex );\r\n\r\n\t\treturn Promise.resolve( lightNode );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Unlit Materials Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\r\n\t */\r\n\tfunction GLTFMaterialsUnlitExtension() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\r\n\r\n\t}\r\n\r\n\tGLTFMaterialsUnlitExtension.prototype.getMaterialType = function () {\r\n\r\n\t\treturn MeshBasicMaterial;\r\n\r\n\t};\r\n\r\n\tGLTFMaterialsUnlitExtension.prototype.extendParams = function ( materialParams, materialDef, parser ) {\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\tvar metallicRoughness = materialDef.pbrMetallicRoughness;\r\n\r\n\t\tif ( metallicRoughness ) {\r\n\r\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\r\n\r\n\t\t\t\tvar array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/* BINARY EXTENSION */\r\n\tvar BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\r\n\tvar BINARY_EXTENSION_HEADER_LENGTH = 12;\r\n\tvar BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\r\n\r\n\tfunction GLTFBinaryExtension( data ) {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\r\n\t\tthis.content = null;\r\n\t\tthis.body = null;\r\n\r\n\t\tvar headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\r\n\r\n\t\tthis.header = {\r\n\t\t\tmagic: LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\r\n\t\t\tversion: headerView.getUint32( 4, true ),\r\n\t\t\tlength: headerView.getUint32( 8, true )\r\n\t\t};\r\n\r\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\r\n\r\n\t\t} else if ( this.header.version < 2.0 ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\r\n\r\n\t\t}\r\n\r\n\t\tvar chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\r\n\t\tvar chunkIndex = 0;\r\n\r\n\t\twhile ( chunkIndex < chunkView.byteLength ) {\r\n\r\n\t\t\tvar chunkLength = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tvar chunkType = chunkView.getUint32( chunkIndex, true );\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\r\n\r\n\t\t\t\tvar contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\r\n\t\t\t\tthis.content = LoaderUtils.decodeText( contentArray );\r\n\r\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\r\n\r\n\t\t\t\tvar byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\r\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Clients must ignore chunks with unknown types.\r\n\r\n\t\t\tchunkIndex += chunkLength;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.content === null ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * DRACO Mesh Compression Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\r\n\t */\r\n\tfunction GLTFDracoMeshCompressionExtension( json, dracoLoader ) {\r\n\r\n\t\tif ( ! dracoLoader ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\r\n\t\tthis.json = json;\r\n\t\tthis.dracoLoader = dracoLoader;\r\n\t\tthis.dracoLoader.preload();\r\n\r\n\t}\r\n\r\n\tGLTFDracoMeshCompressionExtension.prototype.decodePrimitive = function ( primitive, parser ) {\r\n\r\n\t\tvar json = this.json;\r\n\t\tvar dracoLoader = this.dracoLoader;\r\n\t\tvar bufferViewIndex = primitive.extensions[ this.name ].bufferView;\r\n\t\tvar gltfAttributeMap = primitive.extensions[ this.name ].attributes;\r\n\t\tvar threeAttributeMap = {};\r\n\t\tvar attributeNormalizedMap = {};\r\n\t\tvar attributeTypeMap = {};\r\n\r\n\t\tfor ( var attributeName in gltfAttributeMap ) {\r\n\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\r\n\r\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\r\n\r\n\t\t}\r\n\r\n\t\tfor ( attributeName in primitive.attributes ) {\r\n\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\r\n\r\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\r\n\r\n\t\t\t\tvar accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\r\n\t\t\t\tvar componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\r\n\r\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType;\r\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\r\n\r\n\t\t\treturn new Promise( function ( resolve ) {\r\n\r\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\r\n\r\n\t\t\t\t\tfor ( var attributeName in geometry.attributes ) {\r\n\r\n\t\t\t\t\t\tvar attribute = geometry.attributes[ attributeName ];\r\n\t\t\t\t\t\tvar normalized = attributeNormalizedMap[ attributeName ];\r\n\r\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tresolve( geometry );\r\n\r\n\t\t\t\t}, threeAttributeMap, attributeTypeMap );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Texture Transform Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\r\n\t */\r\n\tfunction GLTFTextureTransformExtension() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\r\n\r\n\t}\r\n\r\n\tGLTFTextureTransformExtension.prototype.extendTexture = function ( texture, transform ) {\r\n\r\n\t\ttexture = texture.clone();\r\n\r\n\t\tif ( transform.offset !== undefined ) {\r\n\r\n\t\t\ttexture.offset.fromArray( transform.offset );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.rotation !== undefined ) {\r\n\r\n\t\t\ttexture.rotation = transform.rotation;\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.scale !== undefined ) {\r\n\r\n\t\t\ttexture.repeat.fromArray( transform.scale );\r\n\r\n\t\t}\r\n\r\n\t\tif ( transform.texCoord !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.' );\r\n\r\n\t\t}\r\n\r\n\t\ttexture.needsUpdate = true;\r\n\r\n\t\treturn texture;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specular-Glossiness Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness\r\n\t */\r\n\r\n\t/**\r\n\t * A sub class of StandardMaterial with some of the functionality\r\n\t * changed via the `onBeforeCompile` callback\r\n\t * @pailhead\r\n\t */\r\n\r\n\tfunction GLTFMeshStandardSGMaterial( params ) {\r\n\r\n\t\tMeshStandardMaterial.call( this );\r\n\r\n\t\tthis.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n\t\t//various chunks that need replacing\r\n\t\tvar specularMapParsFragmentChunk = [\r\n\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t'\tuniform sampler2D specularMap;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar glossinessMapParsFragmentChunk = [\r\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t'\tuniform sampler2D glossinessMap;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar specularMapFragmentChunk = [\r\n\t\t\t'vec3 specularFactor = specular;',\r\n\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t'\tvec4 texelSpecular = texture2D( specularMap, vUv );',\r\n\t\t\t'\ttexelSpecular = sRGBToLinear( texelSpecular );',\r\n\t\t\t'\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t'\tspecularFactor *= texelSpecular.rgb;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar glossinessMapFragmentChunk = [\r\n\t\t\t'float glossinessFactor = glossiness;',\r\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t'\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\r\n\t\t\t'\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t'\tglossinessFactor *= texelGlossiness.a;',\r\n\t\t\t'#endif'\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar lightPhysicalFragmentChunk = [\r\n\t\t\t'PhysicalMaterial material;',\r\n\t\t\t'material.diffuseColor = diffuseColor.rgb;',\r\n\t\t\t'vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );',\r\n\t\t\t'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );',\r\n\t\t\t'material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.',\r\n\t\t\t'material.specularRoughness += geometryRoughness;',\r\n\t\t\t'material.specularRoughness = min( material.specularRoughness, 1.0 );',\r\n\t\t\t'material.specularColor = specularFactor.rgb;',\r\n\t\t].join( '\\n' );\r\n\r\n\t\tvar uniforms = {\r\n\t\t\tspecular: { value: new Color().setHex( 0xffffff ) },\r\n\t\t\tglossiness: { value: 1 },\r\n\t\t\tspecularMap: { value: null },\r\n\t\t\tglossinessMap: { value: null }\r\n\t\t};\r\n\r\n\t\tthis._extraUniforms = uniforms;\r\n\r\n\t\t// please see #14031 or #13198 for an alternate approach\r\n\t\tthis.onBeforeCompile = function ( shader ) {\r\n\r\n\t\t\tfor ( var uniformName in uniforms ) {\r\n\r\n\t\t\t\tshader.uniforms[ uniformName ] = uniforms[ uniformName ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace( 'uniform float roughness;', 'uniform vec3 specular;' );\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace( 'uniform float metalness;', 'uniform float glossiness;' );\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk );\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk );\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk );\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk );\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\r\n\r\n\t\t};\r\n\r\n\t\t/*eslint-disable*/\r\n\t\tObject.defineProperties(\r\n\t\t\tthis,\r\n\t\t\t{\t\r\n\t\t\t\tspecular: {\r\n\t\t\t\t\tget: function () { return uniforms.specular.value; },\r\n\t\t\t\t\tset: function ( v ) { uniforms.specular.value = v; }\r\n\t\t\t\t},\r\n\t\t\t\tspecularMap: {\r\n\t\t\t\t\tget: function () { return uniforms.specularMap.value; },\r\n\t\t\t\t\tset: function ( v ) { uniforms.specularMap.value = v; }\r\n\t\t\t\t},\r\n\t\t\t\tglossiness: {\r\n\t\t\t\t\tget: function () { return uniforms.glossiness.value; },\r\n\t\t\t\t\tset: function ( v ) { uniforms.glossiness.value = v; }\r\n\t\t\t\t},\r\n\t\t\t\tglossinessMap: {\r\n\t\t\t\t\tget: function () { return uniforms.glossinessMap.value; },\r\n\t\t\t\t\tset: function ( v ) {\r\n\r\n\t\t\t\t\t\tuniforms.glossinessMap.value = v;\r\n\t\t\t\t\t\t//how about something like this - @pailhead\r\n\t\t\t\t\t\tif ( v ) {\r\n\r\n\t\t\t\t\t\t\tthis.defines.USE_GLOSSINESSMAP = '';\r\n\t\t\t\t\t\t\t// set USE_ROUGHNESSMAP to enable vUv\r\n\t\t\t\t\t\t\tthis.defines.USE_ROUGHNESSMAP = '';\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tdelete this.defines.USE_ROUGHNESSMAP;\r\n\t\t\t\t\t\t\tdelete this.defines.USE_GLOSSINESSMAP;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\t/*eslint-enable*/\r\n\t\tdelete this.metalness;\r\n\t\tdelete this.roughness;\r\n\t\tdelete this.metalnessMap;\r\n\t\tdelete this.roughnessMap;\r\n\r\n\t\tthis.setValues( params );\r\n\r\n\t}\r\n\r\n\tGLTFMeshStandardSGMaterial.prototype = Object.create( MeshStandardMaterial.prototype );\r\n\tGLTFMeshStandardSGMaterial.prototype.constructor = GLTFMeshStandardSGMaterial;\r\n\r\n\tGLTFMeshStandardSGMaterial.prototype.copy = function ( source ) {\r\n\r\n\t\tMeshStandardMaterial.prototype.copy.call( this, source );\r\n\t\tthis.specularMap = source.specularMap;\r\n\t\tthis.specular.copy( source.specular );\r\n\t\tthis.glossinessMap = source.glossinessMap;\r\n\t\tthis.glossiness = source.glossiness;\r\n\t\tdelete this.metalness;\r\n\t\tdelete this.roughness;\r\n\t\tdelete this.metalnessMap;\r\n\t\tdelete this.roughnessMap;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tfunction GLTFMaterialsPbrSpecularGlossinessExtension() {\r\n\r\n\t\treturn {\r\n\r\n\t\t\tname: EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,\r\n\r\n\t\t\tspecularGlossinessParams: [\r\n\t\t\t\t'color',\r\n\t\t\t\t'map',\r\n\t\t\t\t'lightMap',\r\n\t\t\t\t'lightMapIntensity',\r\n\t\t\t\t'aoMap',\r\n\t\t\t\t'aoMapIntensity',\r\n\t\t\t\t'emissive',\r\n\t\t\t\t'emissiveIntensity',\r\n\t\t\t\t'emissiveMap',\r\n\t\t\t\t'bumpMap',\r\n\t\t\t\t'bumpScale',\r\n\t\t\t\t'normalMap',\r\n\t\t\t\t'normalMapType',\r\n\t\t\t\t'displacementMap',\r\n\t\t\t\t'displacementScale',\r\n\t\t\t\t'displacementBias',\r\n\t\t\t\t'specularMap',\r\n\t\t\t\t'specular',\r\n\t\t\t\t'glossinessMap',\r\n\t\t\t\t'glossiness',\r\n\t\t\t\t'alphaMap',\r\n\t\t\t\t'envMap',\r\n\t\t\t\t'envMapIntensity',\r\n\t\t\t\t'refractionRatio',\r\n\t\t\t],\r\n\r\n\t\t\tgetMaterialType: function () {\r\n\r\n\t\t\t\treturn GLTFMeshStandardSGMaterial;\r\n\r\n\t\t\t},\r\n\r\n\t\t\textendParams: function ( materialParams, materialDef, parser ) {\r\n\r\n\t\t\t\tvar pbrSpecularGlossiness = materialDef.extensions[ this.name ];\r\n\r\n\t\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\t\tvar pending = [];\r\n\r\n\t\t\t\tif ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\r\n\r\n\t\t\t\t\tvar array = pbrSpecularGlossiness.diffuseFactor;\r\n\r\n\t\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\r\n\r\n\t\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', pbrSpecularGlossiness.diffuseTexture ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmaterialParams.emissive = new Color( 0.0, 0.0, 0.0 );\r\n\t\t\t\tmaterialParams.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\r\n\t\t\t\tmaterialParams.specular = new Color( 1.0, 1.0, 1.0 );\r\n\r\n\t\t\t\tif ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\r\n\r\n\t\t\t\t\tmaterialParams.specular.fromArray( pbrSpecularGlossiness.specularFactor );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\r\n\r\n\t\t\t\t\tvar specGlossMapDef = pbrSpecularGlossiness.specularGlossinessTexture;\r\n\t\t\t\t\tpending.push( parser.assignTexture( materialParams, 'glossinessMap', specGlossMapDef ) );\r\n\t\t\t\t\tpending.push( parser.assignTexture( materialParams, 'specularMap', specGlossMapDef ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Promise.all( pending );\r\n\r\n\t\t\t},\r\n\r\n\t\t\tcreateMaterial: function ( materialParams ) {\r\n\r\n\t\t\t\tvar material = new GLTFMeshStandardSGMaterial( materialParams );\r\n\t\t\t\tmaterial.fog = true;\r\n\r\n\t\t\t\tmaterial.color = materialParams.color;\r\n\r\n\t\t\t\tmaterial.map = materialParams.map === undefined ? null : materialParams.map;\r\n\r\n\t\t\t\tmaterial.lightMap = null;\r\n\t\t\t\tmaterial.lightMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.aoMap = materialParams.aoMap === undefined ? null : materialParams.aoMap;\r\n\t\t\t\tmaterial.aoMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.emissive = materialParams.emissive;\r\n\t\t\t\tmaterial.emissiveIntensity = 1.0;\r\n\t\t\t\tmaterial.emissiveMap = materialParams.emissiveMap === undefined ? null : materialParams.emissiveMap;\r\n\r\n\t\t\t\tmaterial.bumpMap = materialParams.bumpMap === undefined ? null : materialParams.bumpMap;\r\n\t\t\t\tmaterial.bumpScale = 1;\r\n\r\n\t\t\t\tmaterial.normalMap = materialParams.normalMap === undefined ? null : materialParams.normalMap;\r\n\t\t\t\tmaterial.normalMapType = TangentSpaceNormalMap;\r\n\r\n\t\t\t\tif ( materialParams.normalScale ) material.normalScale = materialParams.normalScale;\r\n\r\n\t\t\t\tmaterial.displacementMap = null;\r\n\t\t\t\tmaterial.displacementScale = 1;\r\n\t\t\t\tmaterial.displacementBias = 0;\r\n\r\n\t\t\t\tmaterial.specularMap = materialParams.specularMap === undefined ? null : materialParams.specularMap;\r\n\t\t\t\tmaterial.specular = materialParams.specular;\r\n\r\n\t\t\t\tmaterial.glossinessMap = materialParams.glossinessMap === undefined ? null : materialParams.glossinessMap;\r\n\t\t\t\tmaterial.glossiness = materialParams.glossiness;\r\n\r\n\t\t\t\tmaterial.alphaMap = null;\r\n\r\n\t\t\t\tmaterial.envMap = materialParams.envMap === undefined ? null : materialParams.envMap;\r\n\t\t\t\tmaterial.envMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.refractionRatio = 0.98;\r\n\r\n\t\t\t\treturn material;\r\n\r\n\t\t\t},\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Mesh Quantization Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\r\n\t */\r\n\tfunction GLTFMeshQuantizationExtension() {\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\r\n\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** INTERPOLATION ********/\r\n\t/*********************************/\r\n\r\n\t// Spline Interpolation\r\n\t// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\r\n\tfunction GLTFCubicSplineInterpolant( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\r\n\r\n\t\tInterpolant.call( this, parameterPositions, sampleValues, sampleSize, resultBuffer );\r\n\r\n\t}\r\n\r\n\tGLTFCubicSplineInterpolant.prototype = Object.create( Interpolant.prototype );\r\n\tGLTFCubicSplineInterpolant.prototype.constructor = GLTFCubicSplineInterpolant;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.copySampleValue_ = function ( index ) {\r\n\r\n\t\t// Copies a sample value to the result buffer. See description of glTF\r\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\r\n\r\n\t\tvar result = this.resultBuffer,\r\n\t\t\tvalues = this.sampleValues,\r\n\t\t\tvalueSize = this.valueSize,\r\n\t\t\toffset = index * valueSize * 3 + valueSize;\r\n\r\n\t\tfor ( var i = 0; i !== valueSize; i ++ ) {\r\n\r\n\t\t\tresult[ i ] = values[ offset + i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t};\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.beforeStart_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.afterEnd_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.interpolate_ = function ( i1, t0, t, t1 ) {\r\n\r\n\t\tvar result = this.resultBuffer;\r\n\t\tvar values = this.sampleValues;\r\n\t\tvar stride = this.valueSize;\r\n\r\n\t\tvar stride2 = stride * 2;\r\n\t\tvar stride3 = stride * 3;\r\n\r\n\t\tvar td = t1 - t0;\r\n\r\n\t\tvar p = ( t - t0 ) / td;\r\n\t\tvar pp = p * p;\r\n\t\tvar ppp = pp * p;\r\n\r\n\t\tvar offset1 = i1 * stride3;\r\n\t\tvar offset0 = offset1 - stride3;\r\n\r\n\t\tvar s2 = - 2 * ppp + 3 * pp;\r\n\t\tvar s3 = ppp - pp;\r\n\t\tvar s0 = 1 - s2;\r\n\t\tvar s1 = s3 - pp + p;\r\n\r\n\t\t// Layout of keyframe output values for CUBICSPLINE animations:\r\n\t\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\r\n\t\tfor ( var i = 0; i !== stride; i ++ ) {\r\n\r\n\t\t\tvar p0 = values[ offset0 + i + stride ]; // splineVertex_k\r\n\t\t\tvar m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\r\n\t\t\tvar p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\r\n\t\t\tvar m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\r\n\r\n\t\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t};\r\n\r\n\t/*********************************/\r\n\t/********** INTERNALS ************/\r\n\t/*********************************/\r\n\r\n\t/* CONSTANTS */\r\n\r\n\tvar WEBGL_CONSTANTS = {\r\n\t\tFLOAT: 5126,\r\n\t\t//FLOAT_MAT2: 35674,\r\n\t\tFLOAT_MAT3: 35675,\r\n\t\tFLOAT_MAT4: 35676,\r\n\t\tFLOAT_VEC2: 35664,\r\n\t\tFLOAT_VEC3: 35665,\r\n\t\tFLOAT_VEC4: 35666,\r\n\t\tLINEAR: 9729,\r\n\t\tREPEAT: 10497,\r\n\t\tSAMPLER_2D: 35678,\r\n\t\tPOINTS: 0,\r\n\t\tLINES: 1,\r\n\t\tLINE_LOOP: 2,\r\n\t\tLINE_STRIP: 3,\r\n\t\tTRIANGLES: 4,\r\n\t\tTRIANGLE_STRIP: 5,\r\n\t\tTRIANGLE_FAN: 6,\r\n\t\tUNSIGNED_BYTE: 5121,\r\n\t\tUNSIGNED_SHORT: 5123\r\n\t};\r\n\r\n\tvar WEBGL_COMPONENT_TYPES = {\r\n\t\t5120: Int8Array,\r\n\t\t5121: Uint8Array,\r\n\t\t5122: Int16Array,\r\n\t\t5123: Uint16Array,\r\n\t\t5125: Uint32Array,\r\n\t\t5126: Float32Array\r\n\t};\r\n\r\n\tvar WEBGL_FILTERS = {\r\n\t\t9728: NearestFilter,\r\n\t\t9729: LinearFilter,\r\n\t\t9984: NearestMipmapNearestFilter,\r\n\t\t9985: LinearMipmapNearestFilter,\r\n\t\t9986: NearestMipmapLinearFilter,\r\n\t\t9987: LinearMipmapLinearFilter\r\n\t};\r\n\r\n\tvar WEBGL_WRAPPINGS = {\r\n\t\t33071: ClampToEdgeWrapping,\r\n\t\t33648: MirroredRepeatWrapping,\r\n\t\t10497: RepeatWrapping\r\n\t};\r\n\r\n\tvar WEBGL_TYPE_SIZES = {\r\n\t\t'SCALAR': 1,\r\n\t\t'VEC2': 2,\r\n\t\t'VEC3': 3,\r\n\t\t'VEC4': 4,\r\n\t\t'MAT2': 4,\r\n\t\t'MAT3': 9,\r\n\t\t'MAT4': 16\r\n\t};\r\n\r\n\tvar ATTRIBUTES = {\r\n\t\tPOSITION: 'position',\r\n\t\tNORMAL: 'normal',\r\n\t\tTANGENT: 'tangent',\r\n\t\tTEXCOORD_0: 'uv',\r\n\t\tTEXCOORD_1: 'uv2',\r\n\t\tCOLOR_0: 'color',\r\n\t\tWEIGHTS_0: 'skinWeight',\r\n\t\tJOINTS_0: 'skinIndex',\r\n\t};\r\n\r\n\tvar PATH_PROPERTIES = {\r\n\t\tscale: 'scale',\r\n\t\ttranslation: 'position',\r\n\t\trotation: 'quaternion',\r\n\t\tweights: 'morphTargetInfluences'\r\n\t};\r\n\r\n\tvar INTERPOLATION = {\r\n\t\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\r\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\r\n\t\tLINEAR: InterpolateLinear,\r\n\t\tSTEP: InterpolateDiscrete\r\n\t};\r\n\r\n\tvar ALPHA_MODES = {\r\n\t\tOPAQUE: 'OPAQUE',\r\n\t\tMASK: 'MASK',\r\n\t\tBLEND: 'BLEND'\r\n\t};\r\n\r\n\tvar MIME_TYPE_FORMATS = {\r\n\t\t'image/png': RGBAFormat,\r\n\t\t'image/jpeg': RGBFormat\r\n\t};\r\n\r\n\t/* UTILITY FUNCTIONS */\r\n\r\n\tfunction resolveURL( url, path ) {\r\n\r\n\t\t// Invalid URL\r\n\t\tif ( typeof url !== 'string' || url === '' ) return '';\r\n\r\n\t\t// Host Relative URL\r\n\t\tif ( /^https?:\\/\\//i.test( path ) && /^\\//.test( url ) ) {\r\n\r\n\t\t\tpath = path.replace( /(^https?:\\/\\/[^\\/]+).*/i, '$1' );\r\n\r\n\t\t}\r\n\r\n\t\t// Absolute URL http://,https://,//\r\n\t\tif ( /^(https?:)?\\/\\//i.test( url ) ) return url;\r\n\r\n\t\t// Data URI\r\n\t\tif ( /^data:.*,.*$/i.test( url ) ) return url;\r\n\r\n\t\t// Blob URL\r\n\t\tif ( /^blob:.*$/i.test( url ) ) return url;\r\n\r\n\t\t// Relative URL\r\n\t\treturn path + url;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\r\n\t */\r\n\tfunction createDefaultMaterial( cache ) {\r\n\r\n\t\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\r\n\r\n\t\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\r\n\t\t\t\tcolor: 0xFFFFFF,\r\n\t\t\t\temissive: 0x000000,\r\n\t\t\t\tmetalness: 1,\r\n\t\t\t\troughness: 1,\r\n\t\t\t\ttransparent: false,\r\n\t\t\t\tdepthTest: true,\r\n\t\t\t\tside: FrontSide\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn cache[ 'DefaultMaterial' ];\r\n\r\n\t}\r\n\r\n\tfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\r\n\r\n\t\t// Add unknown glTF extensions to an object's userData.\r\n\r\n\t\tfor ( var name in objectDef.extensions ) {\r\n\r\n\t\t\tif ( knownExtensions[ name ] === undefined ) {\r\n\r\n\t\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\r\n\t\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object3D|Material|BufferGeometry} object\r\n\t * @param {GLTF.definition} gltfDef\r\n\t */\r\n\tfunction assignExtrasToUserData( object, gltfDef ) {\r\n\r\n\t\tif ( gltfDef.extras !== undefined ) {\r\n\r\n\t\t\tif ( typeof gltfDef.extras === 'object' ) {\r\n\r\n\t\t\t\tObject.assign( object.userData, gltfDef.extras );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\r\n\t *\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {Array<GLTF.Target>} targets\r\n\t * @param {GLTFParser} parser\r\n\t * @return {Promise<BufferGeometry>}\r\n\t */\r\n\tfunction addMorphTargets( geometry, targets, parser ) {\r\n\r\n\t\tvar hasMorphPosition = false;\r\n\t\tvar hasMorphNormal = false;\r\n\r\n\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\r\n\t\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\r\n\r\n\t\t\tif ( hasMorphPosition && hasMorphNormal ) break;\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! hasMorphPosition && ! hasMorphNormal ) return Promise.resolve( geometry );\r\n\r\n\t\tvar pendingPositionAccessors = [];\r\n\t\tvar pendingNormalAccessors = [];\r\n\r\n\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\tif ( hasMorphPosition ) {\r\n\r\n\t\t\t\tvar pendingAccessor = target.POSITION !== undefined\r\n\t\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\r\n\t\t\t\t\t: geometry.attributes.position;\r\n\r\n\t\t\t\tpendingPositionAccessors.push( pendingAccessor );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasMorphNormal ) {\r\n\r\n\t\t\t\tvar pendingAccessor = target.NORMAL !== undefined\r\n\t\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\r\n\t\t\t\t\t: geometry.attributes.normal;\r\n\r\n\t\t\t\tpendingNormalAccessors.push( pendingAccessor );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( [\r\n\t\t\tPromise.all( pendingPositionAccessors ),\r\n\t\t\tPromise.all( pendingNormalAccessors )\r\n\t\t] ).then( function ( accessors ) {\r\n\r\n\t\t\tvar morphPositions = accessors[ 0 ];\r\n\t\t\tvar morphNormals = accessors[ 1 ];\r\n\r\n\t\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\r\n\t\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\r\n\t\t\tgeometry.morphTargetsRelative = true;\r\n\r\n\t\t\treturn geometry;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Mesh} mesh\r\n\t * @param {GLTF.Mesh} meshDef\r\n\t */\r\n\tfunction updateMorphTargets( mesh, meshDef ) {\r\n\r\n\t\tmesh.updateMorphTargets();\r\n\r\n\t\tif ( meshDef.weights !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, il = meshDef.weights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// .extras has user-defined data, so check that .extras.targetNames is an array.\r\n\t\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\r\n\r\n\t\t\tvar targetNames = meshDef.extras.targetNames;\r\n\r\n\t\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\r\n\r\n\t\t\t\tmesh.morphTargetDictionary = {};\r\n\r\n\t\t\t\tfor ( var i = 0, il = targetNames.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction createPrimitiveKey( primitiveDef ) {\r\n\r\n\t\tvar dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\r\n\t\tvar geometryKey;\r\n\r\n\t\tif ( dracoExtension ) {\r\n\r\n\t\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\r\n\t\t\t\t+ ':' + dracoExtension.indices\r\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\r\n\r\n\t\t}\r\n\r\n\t\treturn geometryKey;\r\n\r\n\t}\r\n\r\n\tfunction createAttributesKey( attributes ) {\r\n\r\n\t\tvar attributesKey = '';\r\n\r\n\t\tvar keys = Object.keys( attributes ).sort();\r\n\r\n\t\tfor ( var i = 0, il = keys.length; i < il; i ++ ) {\r\n\r\n\t\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\r\n\r\n\t\t}\r\n\r\n\t\treturn attributesKey;\r\n\r\n\t}\r\n\r\n\t/* GLTF PARSER */\r\n\r\n\tfunction GLTFParser( json, extensions, options ) {\r\n\r\n\t\tthis.json = json || {};\r\n\t\tthis.extensions = extensions || {};\r\n\t\tthis.options = options || {};\r\n\r\n\t\t// loader object cache\r\n\t\tthis.cache = new GLTFRegistry();\r\n\r\n\t\t// BufferGeometry caching\r\n\t\tthis.primitiveCache = {};\r\n\r\n\t\tthis.textureLoader = new TextureLoader( this.options.manager );\r\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\r\n\r\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\r\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\r\n\r\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\r\n\r\n\t\t\tthis.fileLoader.setWithCredentials( true );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tGLTFParser.prototype.parse = function ( onLoad, onError ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\t// Clear the loader cache\r\n\t\tthis.cache.removeAll();\r\n\r\n\t\t// Mark the special nodes/meshes in json for efficient parse\r\n\t\tthis.markDefs();\r\n\r\n\t\tPromise.all( [\r\n\r\n\t\t\tthis.getDependencies( 'scene' ),\r\n\t\t\tthis.getDependencies( 'animation' ),\r\n\t\t\tthis.getDependencies( 'camera' ),\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar result = {\r\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\r\n\t\t\t\tscenes: dependencies[ 0 ],\r\n\t\t\t\tanimations: dependencies[ 1 ],\r\n\t\t\t\tcameras: dependencies[ 2 ],\r\n\t\t\t\tasset: json.asset,\r\n\t\t\t\tparser: parser,\r\n\t\t\t\tuserData: {}\r\n\t\t\t};\r\n\r\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\r\n\r\n\t\t\tassignExtrasToUserData( result, json );\r\n\r\n\t\t\tonLoad( result );\r\n\r\n\t\t} ).catch( onError );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Marks the special nodes/meshes in json for efficient parse.\r\n\t */\r\n\tGLTFParser.prototype.markDefs = function () {\r\n\r\n\t\tvar nodeDefs = this.json.nodes || [];\r\n\t\tvar skinDefs = this.json.skins || [];\r\n\t\tvar meshDefs = this.json.meshes || [];\r\n\r\n\t\tvar meshReferences = {};\r\n\t\tvar meshUses = {};\r\n\r\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\r\n\t\t// Object3D. Use the skins' joint references to mark bones.\r\n\t\tfor ( var skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\r\n\r\n\t\t\tvar joints = skinDefs[ skinIndex ].joints;\r\n\r\n\t\t\tfor ( var i = 0, il = joints.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Meshes can (and should) be reused by multiple nodes in a glTF asset. To\r\n\t\t// avoid having more than one Mesh with the same name, count\r\n\t\t// references and rename instances below.\r\n\t\t//\r\n\t\t// Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\r\n\t\tfor ( var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\r\n\r\n\t\t\tvar nodeDef = nodeDefs[ nodeIndex ];\r\n\r\n\t\t\tif ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tif ( meshReferences[ nodeDef.mesh ] === undefined ) {\r\n\r\n\t\t\t\t\tmeshReferences[ nodeDef.mesh ] = meshUses[ nodeDef.mesh ] = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmeshReferences[ nodeDef.mesh ] ++;\r\n\r\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\r\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\r\n\t\t\t\t// to mark SkinnedMesh if node has skin.\r\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\r\n\r\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.json.meshReferences = meshReferences;\r\n\t\tthis.json.meshUses = meshUses;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests the specified dependency asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @param {number} index\r\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\r\n\t */\r\n\tGLTFParser.prototype.getDependency = function ( type, index ) {\r\n\r\n\t\tvar cacheKey = type + ':' + index;\r\n\t\tvar dependency = this.cache.get( cacheKey );\r\n\r\n\t\tif ( ! dependency ) {\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase 'scene':\r\n\t\t\t\t\tdependency = this.loadScene( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'node':\r\n\t\t\t\t\tdependency = this.loadNode( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'mesh':\r\n\t\t\t\t\tdependency = this.loadMesh( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'accessor':\r\n\t\t\t\t\tdependency = this.loadAccessor( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'bufferView':\r\n\t\t\t\t\tdependency = this.loadBufferView( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'buffer':\r\n\t\t\t\t\tdependency = this.loadBuffer( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'material':\r\n\t\t\t\t\tdependency = this.loadMaterial( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'texture':\r\n\t\t\t\t\tdependency = this.loadTexture( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'skin':\r\n\t\t\t\t\tdependency = this.loadSkin( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'animation':\r\n\t\t\t\t\tdependency = this.loadAnimation( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'camera':\r\n\t\t\t\t\tdependency = this.loadCamera( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'light':\r\n\t\t\t\t\tdependency = this.extensions[ EXTENSIONS.KHR_LIGHTS_PUNCTUAL ].loadLight( index );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.cache.add( cacheKey, dependency );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependency;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Requests all dependencies of the specified type asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @return {Promise<Array<Object>>}\r\n\t */\r\n\tGLTFParser.prototype.getDependencies = function ( type ) {\r\n\r\n\t\tvar dependencies = this.cache.get( type );\r\n\r\n\t\tif ( ! dependencies ) {\r\n\r\n\t\t\tvar parser = this;\r\n\t\t\tvar defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\r\n\r\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\r\n\r\n\t\t\t\treturn parser.getDependency( type, index );\r\n\r\n\t\t\t} ) );\r\n\r\n\t\t\tthis.cache.add( type, dependencies );\r\n\r\n\t\t}\r\n\r\n\t\treturn dependencies;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBuffer = function ( bufferIndex ) {\r\n\r\n\t\tvar bufferDef = this.json.buffers[ bufferIndex ];\r\n\t\tvar loader = this.fileLoader;\r\n\r\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\r\n\r\n\t\t}\r\n\r\n\t\t// If present, GLB container is required to be the first buffer.\r\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\r\n\r\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\r\n\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\tloader.load( resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\r\n\r\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferViewIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBufferView = function ( bufferViewIndex ) {\r\n\r\n\t\tvar bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\r\n\r\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\r\n\r\n\t\t\tvar byteLength = bufferViewDef.byteLength || 0;\r\n\t\t\tvar byteOffset = bufferViewDef.byteOffset || 0;\r\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\r\n\t * @param {number} accessorIndex\r\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\r\n\t */\r\n\tGLTFParser.prototype.loadAccessor = function ( accessorIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar accessorDef = this.json.accessors[ accessorIndex ];\r\n\r\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\r\n\r\n\t\t\t// Ignore empty accessors, which may be used to declare runtime\r\n\t\t\t// information about attributes coming from another source (e.g. Draco\r\n\t\t\t// compression extension).\r\n\t\t\treturn Promise.resolve( null );\r\n\r\n\t\t}\r\n\r\n\t\tvar pendingBufferViews = [];\r\n\r\n\t\tif ( accessorDef.bufferView !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tpendingBufferViews.push( null );\r\n\r\n\t\t}\r\n\r\n\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\r\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\r\n\r\n\t\t\tvar bufferView = bufferViews[ 0 ];\r\n\r\n\t\t\tvar itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\r\n\t\t\tvar TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\r\n\r\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\r\n\t\t\tvar elementBytes = TypedArray.BYTES_PER_ELEMENT;\r\n\t\t\tvar itemBytes = elementBytes * itemSize;\r\n\t\t\tvar byteOffset = accessorDef.byteOffset || 0;\r\n\t\t\tvar byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\r\n\t\t\tvar normalized = accessorDef.normalized === true;\r\n\t\t\tvar array, bufferAttribute;\r\n\r\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\r\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\r\n\r\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\r\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\r\n\t\t\t\tvar ibSlice = Math.floor( byteOffset / byteStride );\r\n\t\t\t\tvar ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\r\n\t\t\t\tvar ib = parser.cache.get( ibCacheKey );\r\n\r\n\t\t\t\tif ( ! ib ) {\r\n\r\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\r\n\r\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\r\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\r\n\r\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( bufferView === null ) {\r\n\r\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\r\n\t\t\tif ( accessorDef.sparse !== undefined ) {\r\n\r\n\t\t\t\tvar itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\r\n\t\t\t\tvar TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\r\n\r\n\t\t\t\tvar byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\r\n\t\t\t\tvar byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\r\n\r\n\t\t\t\tvar sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\r\n\t\t\t\tvar sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\r\n\r\n\t\t\t\tif ( bufferView !== null ) {\r\n\r\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\r\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var i = 0, il = sparseIndices.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar index = sparseIndices[ i ];\r\n\r\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\r\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\r\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\r\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\r\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn bufferAttribute;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\r\n\t * @param {number} textureIndex\r\n\t * @return {Promise<THREE.Texture>}\r\n\t */\r\n\tGLTFParser.prototype.loadTexture = function ( textureIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar options = this.options;\r\n\t\tvar textureLoader = this.textureLoader;\r\n\r\n\t\tvar URL = window.URL || window.webkitURL;\r\n\r\n\t\tvar textureDef = json.textures[ textureIndex ];\r\n\r\n\t\tvar textureExtensions = textureDef.extensions || {};\r\n\r\n\t\tvar source;\r\n\r\n\t\tif ( textureExtensions[ EXTENSIONS.MSFT_TEXTURE_DDS ] ) {\r\n\r\n\t\t\tsource = json.images[ textureExtensions[ EXTENSIONS.MSFT_TEXTURE_DDS ].source ];\r\n\r\n\t\t} else {\r\n\r\n\t\t\tsource = json.images[ textureDef.source ];\r\n\r\n\t\t}\r\n\r\n\t\tvar sourceURI = source.uri;\r\n\t\tvar isObjectURL = false;\r\n\r\n\t\tif ( source.bufferView !== undefined ) {\r\n\r\n\t\t\t// Load binary image data from bufferView, if provided.\r\n\r\n\t\t\tsourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\r\n\r\n\t\t\t\tisObjectURL = true;\r\n\t\t\t\tvar blob = new Blob( [ bufferView ], { type: source.mimeType } );\r\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\r\n\t\t\t\treturn sourceURI;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve( sourceURI ).then( function ( sourceURI ) {\r\n\r\n\t\t\t// Load Texture resource.\r\n\r\n\t\t\tvar loader = options.manager.getHandler( sourceURI );\r\n\r\n\t\t\tif ( ! loader ) {\r\n\r\n\t\t\t\tloader = textureExtensions[ EXTENSIONS.MSFT_TEXTURE_DDS ]\r\n\t\t\t\t\t? parser.extensions[ EXTENSIONS.MSFT_TEXTURE_DDS ].ddsLoader\r\n\t\t\t\t\t: textureLoader;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn new Promise( function ( resolve, reject ) {\r\n\r\n\t\t\t\tloader.load( resolveURL( sourceURI, options.path ), resolve, undefined, reject );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} ).then( function ( texture ) {\r\n\r\n\t\t\t// Clean up resources and configure Texture.\r\n\r\n\t\t\tif ( isObjectURL === true ) {\r\n\r\n\t\t\t\tURL.revokeObjectURL( sourceURI );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.flipY = false;\r\n\r\n\t\t\tif ( textureDef.name !== undefined ) texture.name = textureDef.name;\r\n\r\n\t\t\t// Ignore unknown mime types, like DDS files.\r\n\t\t\tif ( source.mimeType in MIME_TYPE_FORMATS ) {\r\n\r\n\t\t\t\ttexture.format = MIME_TYPE_FORMATS[ source.mimeType ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar samplers = json.samplers || {};\r\n\t\t\tvar sampler = samplers[ textureDef.sampler ] || {};\r\n\r\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\r\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\r\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\r\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Asynchronously assigns a texture to the given material parameters.\r\n\t * @param {Object} materialParams\r\n\t * @param {string} mapName\r\n\t * @param {Object} mapDef\r\n\t * @return {Promise}\r\n\t */\r\n\tGLTFParser.prototype.assignTexture = function ( materialParams, mapName, mapDef ) {\r\n\r\n\t\tvar parser = this;\r\n\r\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\r\n\r\n\t\t\tif ( ! texture.isCompressedTexture ) {\r\n\r\n\t\t\t\tswitch ( mapName ) {\r\n\r\n\t\t\t\t\tcase 'aoMap':\r\n\t\t\t\t\tcase 'emissiveMap':\r\n\t\t\t\t\tcase 'metalnessMap':\r\n\t\t\t\t\tcase 'normalMap':\r\n\t\t\t\t\tcase 'roughnessMap':\r\n\t\t\t\t\t\ttexture.format = RGBFormat;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\r\n\t\t\t// However, we will copy UV set 0 to UV set 1 on demand for aoMap\r\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord != 0 && ! ( mapName === 'aoMap' && mapDef.texCoord == 1 ) ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV set ' + mapDef.texCoord + ' for texture ' + mapName + ' not yet supported.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\r\n\r\n\t\t\t\tvar transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\r\n\r\n\t\t\t\tif ( transform ) {\r\n\r\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams[ mapName ] = texture;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\r\n\t * already has a material (generated from the glTF material options alone)\r\n\t * but reuse of the same glTF material may require multiple threejs materials\r\n\t * to accomodate different primitive types, defines, etc. New materials will\r\n\t * be created if necessary, and reused from a cache.\r\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\r\n\t */\r\n\tGLTFParser.prototype.assignFinalMaterial = function ( mesh ) {\r\n\r\n\t\tvar geometry = mesh.geometry;\r\n\t\tvar material = mesh.material;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\tvar useVertexTangents = geometry.attributes.tangent !== undefined;\r\n\t\tvar useVertexColors = geometry.attributes.color !== undefined;\r\n\t\tvar useFlatShading = geometry.attributes.normal === undefined;\r\n\t\tvar useSkinning = mesh.isSkinnedMesh === true;\r\n\t\tvar useMorphTargets = Object.keys( geometry.morphAttributes ).length > 0;\r\n\t\tvar useMorphNormals = useMorphTargets && geometry.morphAttributes.normal !== undefined;\r\n\r\n\t\tif ( mesh.isPoints ) {\r\n\r\n\t\t\tvar cacheKey = 'PointsMaterial:' + material.uuid;\r\n\r\n\t\t\tvar pointsMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! pointsMaterial ) {\r\n\r\n\t\t\t\tpointsMaterial = new PointsMaterial();\r\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\r\n\t\t\t\tpointsMaterial.color.copy( material.color );\r\n\t\t\t\tpointsMaterial.map = material.map;\r\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = pointsMaterial;\r\n\r\n\t\t} else if ( mesh.isLine ) {\r\n\r\n\t\t\tvar cacheKey = 'LineBasicMaterial:' + material.uuid;\r\n\r\n\t\t\tvar lineMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! lineMaterial ) {\r\n\r\n\t\t\t\tlineMaterial = new LineBasicMaterial();\r\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\r\n\t\t\t\tlineMaterial.color.copy( material.color );\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = lineMaterial;\r\n\r\n\t\t}\r\n\r\n\t\t// Clone the material if it will be modified\r\n\t\tif ( useVertexTangents || useVertexColors || useFlatShading || useSkinning || useMorphTargets ) {\r\n\r\n\t\t\tvar cacheKey = 'ClonedMaterial:' + material.uuid + ':';\r\n\r\n\t\t\tif ( material.isGLTFSpecularGlossinessMaterial ) cacheKey += 'specular-glossiness:';\r\n\t\t\tif ( useSkinning ) cacheKey += 'skinning:';\r\n\t\t\tif ( useVertexTangents ) cacheKey += 'vertex-tangents:';\r\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\r\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\r\n\t\t\tif ( useMorphTargets ) cacheKey += 'morph-targets:';\r\n\t\t\tif ( useMorphNormals ) cacheKey += 'morph-normals:';\r\n\r\n\t\t\tvar cachedMaterial = this.cache.get( cacheKey );\r\n\r\n\t\t\tif ( ! cachedMaterial ) {\r\n\r\n\t\t\t\tcachedMaterial = material.clone();\r\n\r\n\t\t\t\tif ( useSkinning ) cachedMaterial.skinning = true;\r\n\t\t\t\tif ( useVertexTangents ) cachedMaterial.vertexTangents = true;\r\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = VertexColors;\r\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\r\n\t\t\t\tif ( useMorphTargets ) cachedMaterial.morphTargets = true;\r\n\t\t\t\tif ( useMorphNormals ) cachedMaterial.morphNormals = true;\r\n\r\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = cachedMaterial;\r\n\r\n\t\t}\r\n\r\n\t\t// workarounds for mesh and geometry\r\n\r\n\t\tif ( material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined ) {\r\n\r\n\t\t\tgeometry.setAttribute( 'uv2', new BufferAttribute( geometry.attributes.uv.array, 2 ) );\r\n\r\n\t\t}\r\n\r\n\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\r\n\t\tif ( material.normalScale && ! useVertexTangents ) {\r\n\r\n\t\t\tmaterial.normalScale.y = - material.normalScale.y;\r\n\r\n\t\t}\r\n\r\n\t\tmesh.material = material;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\r\n\t * @param {number} materialIndex\r\n\t * @return {Promise<Material>}\r\n\t */\r\n\tGLTFParser.prototype.loadMaterial = function ( materialIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar materialDef = json.materials[ materialIndex ];\r\n\r\n\t\tvar materialType;\r\n\t\tvar materialParams = {};\r\n\t\tvar materialExtensions = materialDef.extensions || {};\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\r\n\r\n\t\t\tvar sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\r\n\t\t\tmaterialType = sgExtension.getMaterialType();\r\n\t\t\tpending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\r\n\r\n\t\t\tvar kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\r\n\t\t\tmaterialType = kmuExtension.getMaterialType();\r\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// Specification:\r\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\r\n\r\n\t\t\tmaterialType = MeshStandardMaterial;\r\n\r\n\t\t\tvar metallicRoughness = materialDef.pbrMetallicRoughness || {};\r\n\r\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\r\n\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\r\n\r\n\t\t\t\tvar array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray( array );\r\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\r\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\r\n\r\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\r\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.doubleSided === true ) {\r\n\r\n\t\t\tmaterialParams.side = DoubleSide;\r\n\r\n\t\t}\r\n\r\n\t\tvar alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\r\n\r\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\r\n\r\n\t\t\tmaterialParams.transparent = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterialParams.transparent = false;\r\n\r\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\r\n\r\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\r\n\r\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\r\n\r\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.normalScale.set( materialDef.normalTexture.scale, materialDef.normalTexture.scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\r\n\r\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\r\n\r\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tmaterialParams.emissive = new Color().fromArray( materialDef.emissiveFactor );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\r\n\r\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\tvar material;\r\n\r\n\t\t\tif ( materialType === GLTFMeshStandardSGMaterial ) {\r\n\r\n\t\t\t\tmaterial = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterial = new materialType( materialParams );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialDef.name !== undefined ) material.name = materialDef.name;\r\n\r\n\t\t\t// baseColorTexture, emissiveTexture, and specularGlossinessTexture use sRGB encoding.\r\n\t\t\tif ( material.map ) material.map.encoding = sRGBEncoding;\r\n\t\t\tif ( material.emissiveMap ) material.emissiveMap.encoding = sRGBEncoding;\r\n\r\n\t\t\tassignExtrasToUserData( material, materialDef );\r\n\r\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\r\n\r\n\t\t\treturn material;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {GLTF.Primitive} primitiveDef\r\n\t * @param {GLTFParser} parser\r\n\t */\r\n\tfunction computeBounds( geometry, primitiveDef, parser ) {\r\n\r\n\t\tvar attributes = primitiveDef.attributes;\r\n\r\n\t\tvar box = new Box3();\r\n\r\n\t\tif ( attributes.POSITION !== undefined ) {\r\n\r\n\t\t\tvar accessor = parser.json.accessors[ attributes.POSITION ];\r\n\r\n\t\t\tvar min = accessor.min;\r\n\t\t\tvar max = accessor.max;\r\n\r\n\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n\t\t\tif ( min !== undefined && max !== undefined ) {\r\n\r\n\t\t\t\tbox.set(\r\n\t\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\r\n\t\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar targets = primitiveDef.targets;\r\n\r\n\t\tif ( targets !== undefined ) {\r\n\r\n\t\t\tvar vector = new Vector3();\r\n\r\n\t\t\tfor ( var i = 0, il = targets.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\t\tif ( target.POSITION !== undefined ) {\r\n\r\n\t\t\t\t\tvar accessor = parser.json.accessors[ target.POSITION ];\r\n\t\t\t\t\tvar min = accessor.min;\r\n\t\t\t\t\tvar max = accessor.max;\r\n\r\n\t\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n\t\t\t\t\tif ( min !== undefined && max !== undefined ) {\r\n\r\n\t\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\r\n\t\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\r\n\t\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\r\n\t\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\r\n\r\n\t\t\t\t\t\tbox.expandByVector( vector );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.boundingBox = box;\r\n\r\n\t\tvar sphere = new Sphere();\r\n\r\n\t\tbox.getCenter( sphere.center );\r\n\t\tsphere.radius = box.min.distanceTo( box.max ) / 2;\r\n\r\n\t\tgeometry.boundingSphere = sphere;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {GLTF.Primitive} primitiveDef\r\n\t * @param {GLTFParser} parser\r\n\t * @return {Promise<BufferGeometry>}\r\n\t */\r\n\tfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\r\n\r\n\t\tvar attributes = primitiveDef.attributes;\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\r\n\r\n\t\t\treturn parser.getDependency( 'accessor', accessorIndex )\r\n\t\t\t\t.then( function ( accessor ) {\r\n\r\n\t\t\t\t\tgeometry.setAttribute( attributeName, accessor );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var gltfAttributeName in attributes ) {\r\n\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\r\n\r\n\t\t\t// Skip attributes already provided by e.g. Draco extension.\r\n\t\t\tif ( threeAttributeName in geometry.attributes ) continue;\r\n\r\n\t\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\r\n\r\n\t\t\tvar accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\r\n\r\n\t\t\t\tgeometry.setIndex( accessor );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tpending.push( accessor );\r\n\r\n\t\t}\r\n\r\n\t\tassignExtrasToUserData( geometry, primitiveDef );\r\n\r\n\t\tcomputeBounds( geometry, primitiveDef, parser );\r\n\r\n\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\treturn primitiveDef.targets !== undefined\r\n\t\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\r\n\t\t\t\t: geometry;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {Number} drawMode\r\n\t * @return {BufferGeometry}\r\n\t */\r\n\tfunction toTrianglesDrawMode( geometry, drawMode ) {\r\n\r\n\t\tvar index = geometry.getIndex();\r\n\r\n\t\t// generate index if not present\r\n\r\n\t\tif ( index === null ) {\r\n\r\n\t\t\tvar indices = [];\r\n\r\n\t\t\tvar position = geometry.getAttribute( 'position' );\r\n\r\n\t\t\tif ( position !== undefined ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < position.count; i ++ ) {\r\n\r\n\t\t\t\t\tindices.push( i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.setIndex( indices );\r\n\t\t\t\tindex = geometry.getIndex();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\r\n\t\t\t\treturn geometry;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar numberOfTriangles = index.count - 2;\r\n\t\tvar newIndices = [];\r\n\r\n\t\tif ( drawMode === TriangleFanDrawMode ) {\r\n\r\n\t\t\t// gl.TRIANGLE_FAN\r\n\r\n\t\t\tfor ( var i = 1; i <= numberOfTriangles; i ++ ) {\r\n\r\n\t\t\t\tnewIndices.push( index.getX( 0 ) );\r\n\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// gl.TRIANGLE_STRIP\r\n\r\n\t\t\tfor ( var i = 0; i < numberOfTriangles; i ++ ) {\r\n\r\n\t\t\t\tif ( i % 2 === 0 ) {\r\n\r\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\r\n\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\r\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\r\n\r\n\t\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\r\n\r\n\t\t}\r\n\r\n\t\t// build final geometry\r\n\r\n\t\tvar newGeometry = geometry.clone();\r\n\t\tnewGeometry.setIndex( newIndices );\r\n\r\n\t\treturn newGeometry;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\r\n\t *\r\n\t * Creates BufferGeometries from primitives.\r\n\t *\r\n\t * @param {Array<GLTF.Primitive>} primitives\r\n\t * @return {Promise<Array<BufferGeometry>>}\r\n\t */\r\n\tGLTFParser.prototype.loadGeometries = function ( primitives ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar cache = this.primitiveCache;\r\n\r\n\t\tfunction createDracoPrimitive( primitive ) {\r\n\r\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\r\n\t\t\t\t.decodePrimitive( primitive, parser )\r\n\t\t\t\t.then( function ( geometry ) {\r\n\r\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfor ( var i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar primitive = primitives[ i ];\r\n\t\t\tvar cacheKey = createPrimitiveKey( primitive );\r\n\r\n\t\t\t// See if we've already created this geometry\r\n\t\t\tvar cached = cache[ cacheKey ];\r\n\r\n\t\t\tif ( cached ) {\r\n\r\n\t\t\t\t// Use the cached geometry if it exists\r\n\t\t\t\tpending.push( cached.promise );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar geometryPromise;\r\n\r\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\r\n\r\n\t\t\t\t\t// Use DRACO geometry if available\r\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Otherwise create a new geometry\r\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Cache this geometry\r\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\r\n\r\n\t\t\t\tpending.push( geometryPromise );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( pending );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\r\n\t * @param {number} meshIndex\r\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\r\n\t */\r\n\tGLTFParser.prototype.loadMesh = function ( meshIndex ) {\r\n\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar meshDef = json.meshes[ meshIndex ];\r\n\t\tvar primitives = meshDef.primitives;\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfor ( var i = 0, il = primitives.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar material = primitives[ i ].material === undefined\r\n\t\t\t\t? createDefaultMaterial( this.cache )\r\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\r\n\r\n\t\t\tpending.push( material );\r\n\r\n\t\t}\r\n\r\n\t\tpending.push( parser.loadGeometries( primitives ) );\r\n\r\n\t\treturn Promise.all( pending ).then( function ( results ) {\r\n\r\n\t\t\tvar materials = results.slice( 0, results.length - 1 );\r\n\t\t\tvar geometries = results[ results.length - 1 ];\r\n\r\n\t\t\tvar meshes = [];\r\n\r\n\t\t\tfor ( var i = 0, il = geometries.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar geometry = geometries[ i ];\r\n\t\t\t\tvar primitive = primitives[ i ];\r\n\r\n\t\t\t\t// 1. create Mesh\r\n\r\n\t\t\t\tvar mesh;\r\n\r\n\t\t\t\tvar material = materials[ i ];\r\n\r\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\r\n\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\r\n\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\r\n\t\t\t\t\tprimitive.mode === undefined ) {\r\n\r\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See .markDefs()\r\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\r\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\r\n\t\t\t\t\t\t: new Mesh( geometry, material );\r\n\r\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true && ! mesh.geometry.attributes.skinWeight.normalized ) {\r\n\r\n\t\t\t\t\t\t// we normalize floating point skin weight array to fix malformed assets (see #15319)\r\n\t\t\t\t\t\t// it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\r\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\r\n\r\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\r\n\r\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\r\n\r\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\r\n\r\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\r\n\r\n\t\t\t\t\tmesh = new Line( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\r\n\r\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\r\n\r\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\r\n\r\n\t\t\t\t\tmesh = new Points( geometry, material );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\r\n\r\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.name = meshDef.name || ( 'mesh_' + meshIndex );\r\n\r\n\t\t\t\tif ( geometries.length > 1 ) mesh.name += '_' + i;\r\n\r\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\r\n\r\n\t\t\t\tparser.assignFinalMaterial( mesh );\r\n\r\n\t\t\t\tmeshes.push( mesh );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( meshes.length === 1 ) {\r\n\r\n\t\t\t\treturn meshes[ 0 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar group = new Group();\r\n\r\n\t\t\tfor ( var i = 0, il = meshes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tgroup.add( meshes[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn group;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\r\n\t * @param {number} cameraIndex\r\n\t * @return {Promise<THREE.Camera>}\r\n\t */\r\n\tGLTFParser.prototype.loadCamera = function ( cameraIndex ) {\r\n\r\n\t\tvar camera;\r\n\t\tvar cameraDef = this.json.cameras[ cameraIndex ];\r\n\t\tvar params = cameraDef[ cameraDef.type ];\r\n\r\n\t\tif ( ! params ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.type === 'perspective' ) {\r\n\r\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\r\n\r\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\r\n\r\n\t\t\tcamera = new OrthographicCamera( params.xmag / - 2, params.xmag / 2, params.ymag / 2, params.ymag / - 2, params.znear, params.zfar );\r\n\r\n\t\t}\r\n\r\n\t\tif ( cameraDef.name !== undefined ) camera.name = cameraDef.name;\r\n\r\n\t\tassignExtrasToUserData( camera, cameraDef );\r\n\r\n\t\treturn Promise.resolve( camera );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\r\n\t * @param {number} skinIndex\r\n\t * @return {Promise<Object>}\r\n\t */\r\n\tGLTFParser.prototype.loadSkin = function ( skinIndex ) {\r\n\r\n\t\tvar skinDef = this.json.skins[ skinIndex ];\r\n\r\n\t\tvar skinEntry = { joints: skinDef.joints };\r\n\r\n\t\tif ( skinDef.inverseBindMatrices === undefined ) {\r\n\r\n\t\t\treturn Promise.resolve( skinEntry );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\r\n\r\n\t\t\tskinEntry.inverseBindMatrices = accessor;\r\n\r\n\t\t\treturn skinEntry;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\r\n\t * @param {number} animationIndex\r\n\t * @return {Promise<AnimationClip>}\r\n\t */\r\n\tGLTFParser.prototype.loadAnimation = function ( animationIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar animationDef = json.animations[ animationIndex ];\r\n\r\n\t\tvar pendingNodes = [];\r\n\t\tvar pendingInputAccessors = [];\r\n\t\tvar pendingOutputAccessors = [];\r\n\t\tvar pendingSamplers = [];\r\n\t\tvar pendingTargets = [];\r\n\r\n\t\tfor ( var i = 0, il = animationDef.channels.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar channel = animationDef.channels[ i ];\r\n\t\t\tvar sampler = animationDef.samplers[ channel.sampler ];\r\n\t\t\tvar target = channel.target;\r\n\t\t\tvar name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\r\n\t\t\tvar input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\r\n\t\t\tvar output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\r\n\r\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\r\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\r\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\r\n\t\t\tpendingSamplers.push( sampler );\r\n\t\t\tpendingTargets.push( target );\r\n\r\n\t\t}\r\n\r\n\t\treturn Promise.all( [\r\n\r\n\t\t\tPromise.all( pendingNodes ),\r\n\t\t\tPromise.all( pendingInputAccessors ),\r\n\t\t\tPromise.all( pendingOutputAccessors ),\r\n\t\t\tPromise.all( pendingSamplers ),\r\n\t\t\tPromise.all( pendingTargets )\r\n\r\n\t\t] ).then( function ( dependencies ) {\r\n\r\n\t\t\tvar nodes = dependencies[ 0 ];\r\n\t\t\tvar inputAccessors = dependencies[ 1 ];\r\n\t\t\tvar outputAccessors = dependencies[ 2 ];\r\n\t\t\tvar samplers = dependencies[ 3 ];\r\n\t\t\tvar targets = dependencies[ 4 ];\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\tfor ( var i = 0, il = nodes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar node = nodes[ i ];\r\n\t\t\t\tvar inputAccessor = inputAccessors[ i ];\r\n\t\t\t\tvar outputAccessor = outputAccessors[ i ];\r\n\t\t\t\tvar sampler = samplers[ i ];\r\n\t\t\t\tvar target = targets[ i ];\r\n\r\n\t\t\t\tif ( node === undefined ) continue;\r\n\r\n\t\t\t\tnode.updateMatrix();\r\n\t\t\t\tnode.matrixAutoUpdate = true;\r\n\r\n\t\t\t\tvar TypedKeyframeTrack;\r\n\r\n\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.weights:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.rotation:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.position:\r\n\t\t\t\t\tcase PATH_PROPERTIES.scale:\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar targetName = node.name ? node.name : node.uuid;\r\n\r\n\t\t\t\tvar interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\r\n\r\n\t\t\t\tvar targetNames = [];\r\n\r\n\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\r\n\r\n\t\t\t\t\t// Node may be a Group (glTF mesh with several primitives) or a Mesh.\r\n\t\t\t\t\tnode.traverse( function ( object ) {\r\n\r\n\t\t\t\t\t\tif ( object.isMesh === true && object.morphTargetInfluences ) {\r\n\r\n\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttargetNames.push( targetName );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar outputArray = outputAccessor.array;\r\n\r\n\t\t\t\tif ( outputAccessor.normalized ) {\r\n\r\n\t\t\t\t\tvar scale;\r\n\r\n\t\t\t\t\tif ( outputArray.constructor === Int8Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 127;\r\n\r\n\t\t\t\t\t} else if ( outputArray.constructor === Uint8Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 255;\r\n\r\n\t\t\t\t\t} else if ( outputArray.constructor == Int16Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 32767;\r\n\r\n\t\t\t\t\t} else if ( outputArray.constructor === Uint16Array ) {\r\n\r\n\t\t\t\t\t\tscale = 1 / 65535;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported output accessor component type.' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar scaled = new Float32Array( outputArray.length );\r\n\r\n\t\t\t\t\tfor ( var j = 0, jl = outputArray.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toutputArray = scaled;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var j = 0, jl = targetNames.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tvar track = new TypedKeyframeTrack(\r\n\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\r\n\t\t\t\t\t\tinputAccessor.array,\r\n\t\t\t\t\t\toutputArray,\r\n\t\t\t\t\t\tinterpolation\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Override interpolation with custom factory method.\r\n\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\r\n\r\n\t\t\t\t\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\r\n\r\n\t\t\t\t\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\r\n\t\t\t\t\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\r\n\t\t\t\t\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\r\n\r\n\t\t\t\t\t\t\treturn new GLTFCubicSplineInterpolant( this.times, this.values, this.getValueSize() / 3, result );\r\n\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\r\n\t\t\t\t\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttracks.push( track );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar name = animationDef.name !== undefined ? animationDef.name : 'animation_' + animationIndex;\r\n\r\n\t\t\treturn new AnimationClip( name, undefined, tracks );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\r\n\t * @param {number} nodeIndex\r\n\t * @return {Promise<Object3D>}\r\n\t */\r\n\tGLTFParser.prototype.loadNode = function ( nodeIndex ) {\r\n\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar parser = this;\r\n\r\n\t\tvar meshReferences = json.meshReferences;\r\n\t\tvar meshUses = json.meshUses;\r\n\r\n\t\tvar nodeDef = json.nodes[ nodeIndex ];\r\n\r\n\t\treturn ( function () {\r\n\r\n\t\t\tvar pending = [];\r\n\r\n\t\t\tif ( nodeDef.mesh !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\r\n\r\n\t\t\t\t\tvar node;\r\n\r\n\t\t\t\t\tif ( meshReferences[ nodeDef.mesh ] > 1 ) {\r\n\r\n\t\t\t\t\t\tvar instanceNum = meshUses[ nodeDef.mesh ] ++;\r\n\r\n\t\t\t\t\t\tnode = mesh.clone();\r\n\t\t\t\t\t\tnode.name += '_instance_' + instanceNum;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tnode = mesh;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// if weights are provided on the node, override weights on the mesh.\r\n\t\t\t\t\tif ( nodeDef.weights !== undefined ) {\r\n\r\n\t\t\t\t\t\tnode.traverse( function ( o ) {\r\n\r\n\t\t\t\t\t\t\tif ( ! o.isMesh ) return;\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t} ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.camera !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.extensions\r\n\t\t\t\t&& nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS_PUNCTUAL ]\r\n\t\t\t\t&& nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS_PUNCTUAL ].light !== undefined ) {\r\n\r\n\t\t\t\tpending.push( parser.getDependency( 'light', nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS_PUNCTUAL ].light ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.all( pending );\r\n\r\n\t\t}() ).then( function ( objects ) {\r\n\r\n\t\t\tvar node;\r\n\r\n\t\t\t// .isBone isn't in glTF spec. See .markDefs\r\n\t\t\tif ( nodeDef.isBone === true ) {\r\n\r\n\t\t\t\tnode = new Bone();\r\n\r\n\t\t\t} else if ( objects.length > 1 ) {\r\n\r\n\t\t\t\tnode = new Group();\r\n\r\n\t\t\t} else if ( objects.length === 1 ) {\r\n\r\n\t\t\t\tnode = objects[ 0 ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tnode = new Object3D();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( node !== objects[ 0 ] ) {\r\n\r\n\t\t\t\tfor ( var i = 0, il = objects.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tnode.add( objects[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( nodeDef.name !== undefined ) {\r\n\r\n\t\t\t\tnode.userData.name = nodeDef.name;\r\n\t\t\t\tnode.name = PropertyBinding.sanitizeNodeName( nodeDef.name );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tassignExtrasToUserData( node, nodeDef );\r\n\r\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\r\n\r\n\t\t\tif ( nodeDef.matrix !== undefined ) {\r\n\r\n\t\t\t\tvar matrix = new Matrix4();\r\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\r\n\t\t\t\tnode.applyMatrix4( matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\r\n\r\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\r\n\r\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\r\n\t * @param {number} sceneIndex\r\n\t * @return {Promise<Scene>}\r\n\t */\r\n\tGLTFParser.prototype.loadScene = function () {\r\n\r\n\t\t// scene node hierachy builder\r\n\r\n\t\tfunction buildNodeHierachy( nodeId, parentObject, json, parser ) {\r\n\r\n\t\t\tvar nodeDef = json.nodes[ nodeId ];\r\n\r\n\t\t\treturn parser.getDependency( 'node', nodeId ).then( function ( node ) {\r\n\r\n\t\t\t\tif ( nodeDef.skin === undefined ) return node;\r\n\r\n\t\t\t\t// build skeleton here as well\r\n\r\n\t\t\t\tvar skinEntry;\r\n\r\n\t\t\t\treturn parser.getDependency( 'skin', nodeDef.skin ).then( function ( skin ) {\r\n\r\n\t\t\t\t\tskinEntry = skin;\r\n\r\n\t\t\t\t\tvar pendingJoints = [];\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = skinEntry.joints.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tpendingJoints.push( parser.getDependency( 'node', skinEntry.joints[ i ] ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn Promise.all( pendingJoints );\r\n\r\n\t\t\t\t} ).then( function ( jointNodes ) {\r\n\r\n\t\t\t\t\tnode.traverse( function ( mesh ) {\r\n\r\n\t\t\t\t\t\tif ( ! mesh.isMesh ) return;\r\n\r\n\t\t\t\t\t\tvar bones = [];\r\n\t\t\t\t\t\tvar boneInverses = [];\r\n\r\n\t\t\t\t\t\tfor ( var j = 0, jl = jointNodes.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar jointNode = jointNodes[ j ];\r\n\r\n\t\t\t\t\t\t\tif ( jointNode ) {\r\n\r\n\t\t\t\t\t\t\t\tbones.push( jointNode );\r\n\r\n\t\t\t\t\t\t\t\tvar mat = new Matrix4();\r\n\r\n\t\t\t\t\t\t\t\tif ( skinEntry.inverseBindMatrices !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\tmat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tboneInverses.push( mat );\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinEntry.joints[ j ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tmesh.bind( new Skeleton( bones, boneInverses ), mesh.matrixWorld );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\treturn node;\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t} ).then( function ( node ) {\r\n\r\n\t\t\t\t// build node hierachy\r\n\r\n\t\t\t\tparentObject.add( node );\r\n\r\n\t\t\t\tvar pending = [];\r\n\r\n\t\t\t\tif ( nodeDef.children ) {\r\n\r\n\t\t\t\t\tvar children = nodeDef.children;\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = children.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar child = children[ i ];\r\n\t\t\t\t\t\tpending.push( buildNodeHierachy( child, node, json, parser ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Promise.all( pending );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn function loadScene( sceneIndex ) {\r\n\r\n\t\t\tvar json = this.json;\r\n\t\t\tvar extensions = this.extensions;\r\n\t\t\tvar sceneDef = this.json.scenes[ sceneIndex ];\r\n\t\t\tvar parser = this;\r\n\r\n\t\t\tvar scene = new Scene();\r\n\t\t\tif ( sceneDef.name !== undefined ) scene.name = sceneDef.name;\r\n\r\n\t\t\tassignExtrasToUserData( scene, sceneDef );\r\n\r\n\t\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\r\n\r\n\t\t\tvar nodeIds = sceneDef.nodes || [];\r\n\r\n\t\t\tvar pending = [];\r\n\r\n\t\t\tfor ( var i = 0, il = nodeIds.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tpending.push( buildNodeHierachy( nodeIds[ i ], scene, json, parser ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.all( pending ).then( function () {\r\n\r\n\t\t\t\treturn scene;\r\n\r\n\t\t\t} );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\treturn GLTFLoader;\r\n\r\n} )();\r\n\r\nexport { GLTFLoader };\r\n","import * as THREE from 'three';\r\nimport { GLTFLoader } from 'LIB/threejs/loaders/GLTFLoader';\r\n\r\nexport default class Loader {\r\n\tconstructor() {}\r\n\r\n\timportGLTF(fileMap) {\r\n\t\tlet rootFile, rootPath;\r\n\t\tArray.from(fileMap).forEach(([path, file]) => {\r\n\t\t\tif (file.name.match(/\\.(gltf|glb)$/)) {\r\n\t\t\t\trootFile = file;\r\n\t\t\t\trootPath = path.replace(file.name, '');\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (!rootFile) {\r\n\t\t\tconsole.error('No .gltf or .glb asset found.');\r\n\t\t}\r\n\t\tconst fileURL = typeof rootFile === 'string' ? rootFile : URL.createObjectURL(rootFile);\r\n\t\treturn this.loadLocalGLTF(fileURL, rootPath, fileMap);\r\n\t}\r\n\r\n\tloadLocalGLTF(url, rootPath, assetMap) {\r\n\t\tconst baseURL = THREE.LoaderUtils.extractUrlBase(url);\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst manager = new THREE.LoadingManager();\r\n\t\t\t// Intercept and override relative URLs.\r\n\t\t\tmanager.setURLModifier((url, path) => {\r\n\t\t\t\tconst normalizedURL = rootPath + url.replace(baseURL, '').replace(/^(\\.?\\/)/, '');\r\n\t\t\t\tif (assetMap.has(normalizedURL)) {\r\n\t\t\t\t\tconst blob = assetMap.get(normalizedURL);\r\n\t\t\t\t\tconst blobURL = URL.createObjectURL(blob);\r\n\t\t\t\t\tblobURLs.push(blobURL);\r\n\t\t\t\t\treturn blobURL;\r\n\t\t\t\t}\r\n\t\t\t\treturn (path || '') + url;\r\n\t\t\t});\r\n\t\t\tconst loader = new GLTFLoader(manager);\r\n\t\t\tloader.setCrossOrigin('anonymous');\r\n\t\t\tconst blobURLs = [];\r\n\t\t\tloader.load(\r\n\t\t\t\turl,\r\n\t\t\t\tgltf => {\r\n\t\t\t\t\tresolve(gltf);\r\n\t\t\t\t},\r\n\t\t\t\tundefined,\r\n\t\t\t\treject\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tloadGLTF(rootPath, fileName='scene.gltf'){\r\n\t\tconst loader = new GLTFLoader();\r\n\t\tloader.setPath(rootPath);\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tloader.load(fileName, gltf => {\r\n\t\t\t\tresolve(gltf);\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\n","<template>\r\n\t<div id=\"wrapper\" class=\"isLoading\">\r\n\t\t<div id=\"canvasContainer\"></div>\r\n\t\t<p class=\"loadingText\">Loading...</p>\r\n\t\t<main class=\"dropWrap\" v-show=\"openImportPage\">\r\n\t\t\t<div class=\"dropzone\">\r\n\t\t\t\t<div class=\"innerArea\">\r\n\t\t\t\t\t<div class=\"placeholder\">\r\n\t\t\t\t\t\t<p>Please drag the glTF file or folder (zip supported) to this page</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"btnArea\">\r\n\t\t\t\t\t\t<div class=\"uploadBtn\">\r\n\t\t\t\t\t\t\t<input type=\"file\" name=\"file-input[]\" id=\"file-input\" multiple />\r\n\t\t\t\t\t\t\t<label for=\"file-input\">\r\n\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"17\" viewBox=\"0 0 20 17\">\r\n\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\td=\"M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z\"\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t<span>Upload</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"uploadBtn\" @click='loadDefaultMode'>\r\n\t\t\t\t\t\t\t<span>Defalut(3.5MB)</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</main>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport MainScene from './MainScene';\r\nimport Loader from './js/Loader';\r\nimport { SimpleDropzone } from 'simple-dropzone';\r\nexport default {\r\n\tname: 'container',\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\topenImportPage: true\r\n\t\t};\r\n\t},\r\n\tmounted() {\r\n\t\tthis.initEvent();\r\n\t},\r\n\tmethods: {\r\n\t\tinitScene(gltf) {\r\n\t\t\tlet containerEle = document.querySelector('#canvasContainer');\r\n\t\t\tthis.scene = new MainScene(containerEle, gltf, () => {\r\n\t\t\t\tdocument.querySelector(\"#wrapper\").classList.remove(\"isLoading\");\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitEvent() {\r\n\t\t\tlet _this = this;\r\n\t\t\tlet loader = new Loader();\r\n\t\t\tlet inputEle1 = document.body.querySelector('#file-input');\r\n\t\t\tlet dropEl = document.body.querySelector('.dropzone');\r\n\t\t\tconst dropCtrl = new SimpleDropzone(dropEl, inputEle1);\r\n\t\t\tdropCtrl.on('drop', ({ files }) =>\r\n\t\t\t\tloader.importGLTF(files).then(gltf => {\r\n\t\t\t\t\tthis.initScene(gltf);\r\n\t\t\t\t\t_this.openImportPage = false;\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t},\r\n\t\tloadDefaultMode(){\r\n\t\t\tlet loader = new Loader();\r\n\t\t\tthis.openImportPage = false;\r\n\t\t\tloader.loadGLTF('./assets/models/damagedHelmet/').then(gltf => {\r\n\t\t\t\tthis.initScene(gltf);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\nhtml,\r\nbody {\r\n\tmargin: 0;\r\n\tpadding: 0;\r\n\tbox-sizing: border-box;\r\n\tbackground: #000;\r\n}\r\n\r\n#wrapper {\r\n\tfont-family: 'Avenir', Helvetica, Arial, sans-serif;\r\n\t-webkit-font-smoothing: antialiased;\r\n\t-moz-osx-font-smoothing: grayscale;\r\n}\r\n\r\n#wrapper {\r\n\twidth: 100vw;\r\n\theight: 100vh;\r\n\tposition: relative;\r\n\toverflow: hidden;\r\n}\r\n\r\n#canvasContainer {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n}\r\n\r\n.loadingText {\r\n    position: absolute;\r\n    z-index: 1;\r\n    width: 100%;\r\n    top: calc(50% - 50px);\r\n    text-align: center;\r\n    letter-spacing: 11px;\r\n    color: #fff;\r\n    opacity: 0;\r\n    transition: opacity .5s ease-out, letter-spacing .5s ease-out;\r\n    pointer-events: none;\r\n}\r\n\r\n.isLoading .loadingText {\r\n    letter-spacing: 10px;\r\n    opacity: 1;\r\n}\r\n\r\n.dropWrap {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tbottom: 0;\r\n\tz-index: 1;\r\n\tbackground: #ffffff;\r\n\r\n\t.dropzone {\r\n\t\tposition: absolute;\r\n\t\ttop: 5%;\r\n\t\tleft: 5%;\r\n\t\tright: 5%;\r\n\t\tbottom: 5%;\r\n\t\tborder: 3px dashed #e6e6e6;\r\n\t\tcolor: #cccccc;\r\n\t\ttext-align: center;\r\n\t}\r\n\t.innerArea{\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\tflex-grow: 1;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.placeholder{\r\n\t\tfont-size: 22px;\r\n\t}\r\n\r\n\t/* Upload Button */\r\n\t.uploadBtn {\r\n\t\tdisplay: inline-block;\r\n\t\tfont-size: 18px;\r\n\t\tbackground: #00b7ee;\r\n\t\tborder-radius: 3px;\r\n\t\tline-height: 44px;\r\n\t\tpadding: 0 30px;\r\n\t\tcolor: #fff;\r\n\t\tmargin: 20px;\r\n\t\tcursor: pointer;\r\n\t\tbox-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);\r\n\t\t&:hover{\r\n\t\t\tbackground: #3bc8f2;\r\n\t\t}\r\n\t}\r\n\r\n\t.uploadBtn label{\r\n\t\tcursor: pointer;\r\n\t}\r\n\r\n\t.uploadBtn input {\r\n\t\twidth: 0.1px;\r\n\t\theight: 0.1px;\r\n\t\topacity: 0;\r\n\t\toverflow: hidden;\r\n\t\tposition: absolute;\r\n\t\tz-index: -1;\r\n\t}\r\n\r\n\t.uploadBtn svg {\r\n\t\twidth: 1em;\r\n\t\theight: 1em;\r\n\t\tvertical-align: middle;\r\n\t\tfill: currentColor;\r\n\t\tmargin-top: -0.25em;\r\n\t\tmargin-right: 0.25em;\r\n\t}\r\n}\r\n</style>\r\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=6eca532c&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue'\r\nimport App from './index.vue'\r\n\r\nnew Vue({\r\n  render: h => h(App),\r\n}).$mount('#container')\r\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=less&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=less&\""],"sourceRoot":""}