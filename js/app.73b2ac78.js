(function(e){function t(t){for(var r,a,s=t[0],l=t[1],c=t[2],d=0,p=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={app:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/three-viewer/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},3468:function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"isLoading",attrs:{id:"wrapper"}},[n("div",{attrs:{id:"canvasContainer"}}),n("p",{staticClass:"loadingText"},[e._v("Loading...")]),n("main",{directives:[{name:"show",rawName:"v-show",value:e.openImportPage,expression:"openImportPage"}],staticClass:"dropWrap"},[n("div",{staticClass:"dropzone"},[n("div",{staticClass:"innerArea"},[e._m(0),n("div",{staticClass:"btnArea"},[n("div",{staticClass:"uploadBtn"},[n("input",{attrs:{type:"file",name:"file-input[]",id:"file-input",multiple:""}}),n("label",{attrs:{for:"file-input"}},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"17",viewBox:"0 0 20 17"}},[n("path",{attrs:{d:"M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"}})]),n("span",[e._v("Upload")])])]),n("div",{staticClass:"uploadBtn",on:{click:e.loadDefaultMode}},[n("span",[e._v("Defalut(3.5MB)")])])])])])])])},i=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"placeholder"},[n("p",[e._v("Please drag the glTF file or folder (zip supported) to this page")])])}],a=(n("c0b6"),n("d4ec")),s=n("bee2"),l=n("5a89"),c=(n("99af"),n("d81d"),n("b0c0"),n("b64b"),n("4c53"),n("96cf"),n("1da1")),u=(n("b8bf"),n("d3b7"),n("ddb0"),function(e,t){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new l["Vector3"],this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:l["MOUSE"].ROTATE,MIDDLE:l["MOUSE"].DOLLY,RIGHT:l["MOUSE"].PAN},this.touches={ONE:l["TOUCH"].ROTATE,TWO:l["TOUCH"].DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),s=a.NONE},this.update=function(){var t=new l["Vector3"],o=(new l["Quaternion"]).setFromUnitVectors(e.up,new l["Vector3"](0,1,0)),i=o.clone().inverse(),m=new l["Vector3"],g=new l["Quaternion"];return function(){var e=n.object.position;return t.copy(e).sub(n.target),t.applyQuaternion(o),u.setFromVector3(t),n.autoRotate&&s===a.NONE&&A(E()),n.enableDamping?(u.theta+=d.theta*n.dampingFactor,u.phi+=d.phi*n.dampingFactor):(u.theta+=d.theta,u.phi+=d.phi),u.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=p,u.radius=Math.max(n.minDistance,Math.min(n.maxDistance,u.radius)),!0===n.enableDamping?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),t.setFromSpherical(u),t.applyQuaternion(i),e.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(d.theta*=1-n.dampingFactor,d.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(d.set(0,0,0),h.set(0,0,0)),p=1,!!(f||m.distanceToSquared(n.object.position)>c||8*(1-g.dot(n.object.quaternion))>c)&&(n.dispatchEvent(r),m.copy(n.object.position),g.copy(n.object.quaternion),f=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",se,!1),n.domElement.removeEventListener("mousedown",$,!1),n.domElement.removeEventListener("wheel",ne,!1),n.domElement.removeEventListener("touchstart",oe,!1),n.domElement.removeEventListener("touchend",ae,!1),n.domElement.removeEventListener("touchmove",ie,!1),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",te,!1),n.domElement.removeEventListener("keydown",re,!1)};var n=this,r={type:"change"},o={type:"start"},i={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},s=a.NONE,c=1e-6,u=new l["Spherical"],d=new l["Spherical"],p=1,h=new l["Vector3"],f=!1,m=new l["Vector2"],g=new l["Vector2"],v=new l["Vector2"],_=new l["Vector2"],b=new l["Vector2"],y=new l["Vector2"],w=new l["Vector2"],S=new l["Vector2"],x=new l["Vector2"];function E(){return 2*Math.PI/60/60*n.autoRotateSpeed}function L(){return Math.pow(.95,n.zoomSpeed)}function A(e){d.theta-=e}function T(e){d.phi-=e}var M=function(){var e=new l["Vector3"];return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),h.add(e)}}(),R=function(){var e=new l["Vector3"];return function(t,r){!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),h.add(e)}}(),O=function(){var e=new l["Vector3"];return function(t,r){var o=n.domElement;if(n.object.isPerspectiveCamera){var i=n.object.position;e.copy(i).sub(n.target);var a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),M(2*t*a/o.clientHeight,n.object.matrix),R(2*r*a/o.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(M(t*(n.object.right-n.object.left)/n.object.zoom/o.clientWidth,n.object.matrix),R(r*(n.object.top-n.object.bottom)/n.object.zoom/o.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function C(e){n.object.isPerspectiveCamera?p/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function N(e){n.object.isPerspectiveCamera?p*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function k(e){m.set(e.clientX,e.clientY)}function D(e){w.set(e.clientX,e.clientY)}function P(e){_.set(e.clientX,e.clientY)}function F(e){g.set(e.clientX,e.clientY),v.subVectors(g,m).multiplyScalar(n.rotateSpeed);var t=n.domElement;A(2*Math.PI*v.x/t.clientHeight),T(2*Math.PI*v.y/t.clientHeight),m.copy(g),n.update()}function I(e){S.set(e.clientX,e.clientY),x.subVectors(S,w),x.y>0?C(L()):x.y<0&&N(L()),w.copy(S),n.update()}function H(e){b.set(e.clientX,e.clientY),y.subVectors(b,_).multiplyScalar(n.panSpeed),O(y.x,y.y),_.copy(b),n.update()}function B(){}function V(e){e.deltaY<0?N(L()):e.deltaY>0&&C(L()),n.update()}function U(e){var t=!1;switch(e.keyCode){case n.keys.UP:O(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:O(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:O(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:O(-n.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),n.update())}function j(e){if(1==e.touches.length)m.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);m.set(t,n)}}function G(e){if(1==e.touches.length)_.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(t,n)}}function z(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);w.set(0,r)}function K(e){n.enableZoom&&z(e),n.enablePan&&G(e)}function X(e){n.enableZoom&&z(e),n.enableRotate&&j(e)}function Y(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,r)}v.subVectors(g,m).multiplyScalar(n.rotateSpeed);var o=n.domElement;A(2*Math.PI*v.x/o.clientHeight),T(2*Math.PI*v.y/o.clientHeight),m.copy(g)}function W(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,r)}y.subVectors(b,_).multiplyScalar(n.panSpeed),O(y.x,y.y),_.copy(b)}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+r*r);S.set(0,o),x.set(0,Math.pow(S.y/w.y,n.zoomSpeed)),C(x.y),w.copy(S)}function J(e){n.enableZoom&&q(e),n.enablePan&&W(e)}function Z(e){n.enableZoom&&q(e),n.enableRotate&&Y(e)}function Q(){}function $(e){if(!1!==n.enabled){switch(e.preventDefault(),n.domElement.focus?n.domElement.focus():window.focus(),e.button){case 0:switch(n.mouseButtons.LEFT){case l["MOUSE"].ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;P(e),s=a.PAN}else{if(!1===n.enableRotate)return;k(e),s=a.ROTATE}break;case l["MOUSE"].PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;k(e),s=a.ROTATE}else{if(!1===n.enablePan)return;P(e),s=a.PAN}break;default:s=a.NONE}break;case 1:switch(n.mouseButtons.MIDDLE){case l["MOUSE"].DOLLY:if(!1===n.enableZoom)return;D(e),s=a.DOLLY;break;default:s=a.NONE}break;case 2:switch(n.mouseButtons.RIGHT){case l["MOUSE"].ROTATE:if(!1===n.enableRotate)return;k(e),s=a.ROTATE;break;case l["MOUSE"].PAN:if(!1===n.enablePan)return;P(e),s=a.PAN;break;default:s=a.NONE}break}s!==a.NONE&&(document.addEventListener("mousemove",ee,!1),document.addEventListener("mouseup",te,!1),n.dispatchEvent(o))}}function ee(e){if(!1!==n.enabled)switch(e.preventDefault(),s){case a.ROTATE:if(!1===n.enableRotate)return;F(e);break;case a.DOLLY:if(!1===n.enableZoom)return;I(e);break;case a.PAN:if(!1===n.enablePan)return;H(e);break}}function te(e){!1!==n.enabled&&(B(e),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",te,!1),n.dispatchEvent(i),s=a.NONE)}function ne(e){!1===n.enabled||!1===n.enableZoom||s!==a.NONE&&s!==a.ROTATE||(e.preventDefault(),e.stopPropagation(),n.dispatchEvent(o),V(e),n.dispatchEvent(i))}function re(e){!1!==n.enabled&&!1!==n.enableKeys&&!1!==n.enablePan&&U(e)}function oe(e){if(!1!==n.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(n.touches.ONE){case l["TOUCH"].ROTATE:if(!1===n.enableRotate)return;j(e),s=a.TOUCH_ROTATE;break;case l["TOUCH"].PAN:if(!1===n.enablePan)return;G(e),s=a.TOUCH_PAN;break;default:s=a.NONE}break;case 2:switch(n.touches.TWO){case l["TOUCH"].DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;K(e),s=a.TOUCH_DOLLY_PAN;break;case l["TOUCH"].DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;X(e),s=a.TOUCH_DOLLY_ROTATE;break;default:s=a.NONE}break;default:s=a.NONE}s!==a.NONE&&n.dispatchEvent(o)}}function ie(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),s){case a.TOUCH_ROTATE:if(!1===n.enableRotate)return;Y(e),n.update();break;case a.TOUCH_PAN:if(!1===n.enablePan)return;W(e),n.update();break;case a.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;J(e),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;Z(e),n.update();break;default:s=a.NONE}}function ae(e){!1!==n.enabled&&(Q(e),n.dispatchEvent(i),s=a.NONE)}function se(e){!1!==n.enabled&&e.preventDefault()}n.domElement.addEventListener("contextmenu",se,!1),n.domElement.addEventListener("mousedown",$,!1),n.domElement.addEventListener("wheel",ne,!1),n.domElement.addEventListener("touchstart",oe,!1),n.domElement.addEventListener("touchend",ae,!1),n.domElement.addEventListener("touchmove",ie,!1),n.domElement.addEventListener("keydown",re,!1),-1===n.domElement.tabIndex&&(n.domElement.tabIndex=0),this.update()});u.prototype=Object.create(l["EventDispatcher"].prototype),u.prototype.constructor=u;var d=function(e,t){u.call(this,e,t),this.mouseButtons.LEFT=l["MOUSE"].PAN,this.mouseButtons.RIGHT=l["MOUSE"].ROTATE,this.touches.ONE=l["TOUCH"].PAN,this.touches.TWO=l["TOUCH"].DOLLY_ROTATE};d.prototype=Object.create(l["EventDispatcher"].prototype),d.prototype.constructor=d;n("4de4"),n("ace4"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7");var p=window.Zlib;function h(e){var t=new Uint8Array(e);return 31===t[0]&&139===t[1]}function f(e){var t=new Uint8Array(e);if(p){var n=new p.Gunzip(t),r=n.decompress();return r.buffer}console.error("Lack of necessary dependencies: gunzip.min.js.\n You can add this vendors to enable this feature or get it at https://github.com/imaya/zlib.js/blob/master/bin/gunzip.min.js")}var m=function(){function e(t,n,r){Object(a["a"])(this,e),this._options=r||{},this._size=n,this._data=t}return Object(s["a"])(e,[{key:"deinterleaveImage4",value:function(e,t,n){for(var r=e*e,o=2*e*e,i=3*e*e,a=0,s=0;s<r;s++)n[a++]=t[s],n[a++]=t[s+r],n[a++]=t[s+o],n[a++]=t[s+i]}},{key:"loadPacked",value:function(){var e=this,t=function(t){var n=t;h(n)&&(n=f(n));for(var r=Math.log(e._size)/Math.LN2,o=0,i={},a=0;a<=r;a++){var s=Math.pow(2,r-a),l=void 0;if(o>=n.byteLength)break;for(var c=0;c<6;c++){i[c]||(i[c]=[]);var u=void 0,d=void 0;l=s*s*4,u=new Uint8Array(n,o,l),d=new Uint8Array(l),e.deinterleaveImage4(s,u,d),u=d,i[c].push(u),o+=l}}e._packedImages=i,e.createRGBA8Packed()};return t(this._data)}},{key:"createRGBA8Packed",value:function(){for(var e=this.cubeTextures=[],t=this._size,n=this._packedImages,r=n[0].length,o=l["LogLuvEncoding"],i=0;i<r;i++){var a=new l["CubeTexture"];e.push(a),a.format=l["RGBAFormat"],a.encoding=o,a.minFilter=l["LinearMipMapLinearFilter"],a.magFilter=l["LinearFilter"],a.generateMipmaps=!1;for(var s=0;s<6;s++){var c=new l["DataTexture"](n[s][i],t,t,l["RGBAFormat"]);c.format=a.format,c.encoding=o,c.type=a.type,c.generateMipmaps=!1,a.images[s]=c,a.needsUpdate=!0}a.needsUpdate=!0,t/=2}this.texture=new l["CubeTexture"],this.texture.format=l["RGBAFormat"],this.texture.encoding=o,this.texture.minFilter=this._options.minFilter||l["LinearMipMapLinearFilter"],this.texture.magFilter=this._options.magFilter||l["LinearFilter"],this.texture.generateMipmaps=!1;for(var u=0;u<6;u++){this.texture.image[u]=this.cubeTextures[0].images[u];for(var d=1;d<r;d++)this.texture.mipmaps[d-1]=this.cubeTextures[d],this.cubeTextures[d].needsUpdate=!0}this.texture.needsUpdate=!0}}]),e}(),g=function(){function e(t,n,r){Object(a["a"])(this,e),this._options=r||{},this._size=n,this._data=t,this._texture=null}return Object(s["a"])(e,[{key:"deinterleaveImage4",value:function(e,t,n){for(var r=e*e,o=2*e*e,i=3*e*e,a=0,s=0;s<r;s++)n[a++]=t[s],n[a++]=t[s+r],n[a++]=t[s+o],n[a++]=t[s+i]}},{key:"loadPacked",value:function(){var e=this,t=function(t){var n=t;h(n)&&(n=f(n));var r,o,i=e._size;r=new Uint8Array(n),o=new Uint8Array(n.byteLength),e.deinterleaveImage4(i,r,o),r=o;var a=new l["DataTexture"](r,i,i,l["RGBAFormat"]);a.encoding=l["LogLuvEncoding"],a.flipY=!0,a.needsUpdate=!0,e._texture=a};return t(this._data)}},{key:"texture",get:function(){return this._texture}}]),e}(),v=function(){function e(t,n){Object(a["a"])(this,e),this._data=t,this._size=n}return Object(s["a"])(e,[{key:"loadPacked",value:function(){var e=this,t=function(t){var n=e._size,r=t;h(r)&&(r=f(r));var o=n*n*4,i=new Uint8Array(r,0,o),a=new l["DataTexture"](i,n,n,l["RGBAFormat"]);return a};return t(this._data)}}]),e}(),_=(n("fb6a"),n("cfc3"),function(){function e(t){Object(a["a"])(this,e),this._file=t,this.initSHCoef(t)}return Object(s["a"])(e,[{key:"initSHCoef",value:function(e){var t=this;this._sphCoef=e.slice(0,27);var n=1/(2*Math.sqrt(Math.PI)),r=-.5*Math.sqrt(3/Math.PI),o=-r,i=r,a=.5*Math.sqrt(15/Math.PI),s=-a,l=.25*Math.sqrt(5/Math.PI),c=s,u=.25*Math.sqrt(15/Math.PI),d=[n,n,n,r,r,r,o,o,o,i,i,i,a,a,a,s,s,s,l,l,l,c,c,c,u,u,u];this._sphCoef=d.map((function(e,n){return e*t._sphCoef[n]})),this._uniformSpherical=new Float32Array(27);for(var p=0;p<9;p++)this._uniformSpherical[3*p]=this._sphCoef[3*p],this._uniformSpherical[3*p+1]=this._sphCoef[3*p+1],this._uniformSpherical[3*p+2]=this._sphCoef[3*p+2]}}]),e}());n("baa5"),n("4ec9"),n("ac1f"),n("3ca3"),n("466d"),n("2b3d");function b(e,t){return new Promise((function(n,r){var o=new XMLHttpRequest;o.open("GET",e,!0);var i=t&&t.responseType?t.responseType.toLowerCase():void 0;i&&(o.responseType=i),t&&t.progress&&o.addEventListener("progress",t.progress,!1),o.addEventListener("error",r,!1),o.addEventListener("load",(function(){"arraybuffer"===o.responseType||"blob"===o.responseType?n(o.response):n(o.responseText)})),o.send(null)}))}function y(e,t){return new Promise((function(n){var r=t&&t.responseType?t.responseType.toLowerCase():void 0,o=new window.FileReader;o.onload=function(e){n(e.target.result)},r?"arraybuffer"===r?o.readAsArrayBuffer(e):"blob"===r?n(e):"string"===r?o.readAsText(e):o.readAsDataURL(e):o.readAsText(e)}))}function w(e,t){return"string"===typeof e?b(e,t):y(e,t)}var S=w,x=new Map,E=function(e){return"string"===typeof e||e instanceof String},L=function(e){return"blob:http"===e.substr(0,9)},A=function(e){return"http://"===e.substr(0,7)||"https://"===e.substr(0,8)},T=function(e){return!!E(e)&&(L(e)||A(e))},M=function(e){return new Promise((function(t,n){var r=new Image;r.onerror=function(){n(r)},r.onload=function(){t(r)},r.src=e}))},R=function(e){var t=window.URL.createObjectURL(e),n=M(t);return n["finally"]((function(){window.URL.revokeObjectURL(t)})),n},O=function(e){return new Promise((function(t,n){var r=new FileReader;r.onerror=function(){n(r)},r.onload=function(){t(this.result)},r.readAsArrayBuffer(e)}))},C=function(e){return S(e,{responseType:"arraybuffer"})},N=function(e){return S(e).then((function(e){return JSON.parse(e)}))},k=function(e){var t=JSON.parse(e);return Promise.resolve(t)},D={createJSONFromURL:N,createArrayBufferFromURL:C,createArrayBufferFromBlob:O,createImageFromBlob:R,createImageFromURL:M,requestURI:S,requestResource:function(e,t){var n=D.getExtension(e),r=D.getMimeType(n),o=t&&t.responseType?t.responseType.toLowerCase():void 0;if(o)return S(e,t);if(r){if(r.match("image"))return M(e);if(r.match("binary"))return C(e);if(r.match("json"))return N(e);if(r.match("text"))return S(e)}return S(e)},resolveData:function(e,t){var n,r,o=D.getExtension(e),i=D.getMimeType(o);return i&&(i.match("image")?E(t)?n=M:t instanceof Blob&&(n=R):i.match("json")?n=T(t)?N:k:i.match("binary")&&(E(t)?n=C:t instanceof Blob&&(n=O))),r=n?n(t):Promise.resolve(t),r},resolveFilesMap:function(e){var t=[];for(var n in e){var r=e[n],o=D.resolveData(n,r).then(function(e,t){this[e]=t}.bind(e,n));t.push(o)}return Promise.all(t).then((function(){return e}))},getMimeType:function(e){return x.get(e)},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1)},addMimeTypeForExtension:function(e,t){void 0!==x.has(e)&&console.warn("the '"+e+"' already has a mimetype: "+x.get(e)),x.set(e,t)}};x.set("bin","application/octet-binary"),x.set("b3dm","application/octet-binary"),x.set("glb","application/octet-binary"),x.set("zip","application/octet-binary"),x.set("gz","application/octet-binary"),x.set("png","image/png"),x.set("jpg","image/jpeg"),x.set("jpeg","image/jpeg"),x.set("gif","image/gif"),x.set("json","application/json"),x.set("gltf","application/json"),x.set("osgjs","application/json"),x.set("txt","text/plain"),x.set("glsl","text/plain");var P=D,F="./assets/envMap/brdf_ue4.bin.gz",I=function(){function e(t){Object(a["a"])(this,e);var n=t.renderer,r=t.isMobile;this.isMobile=r,this._config=void 0,this._files={};var o=n.getContext();this.textureLODSupport=o.getExtension("EXT_shader_texture_lod"),this.uIntegrateBRDF=null}return Object(s["a"])(e,[{key:"loadPackage",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.url=t,n="".concat(t,"config.json"),e.next=4,P.requestResource(n);case 4:return r=e.sent,e.next=7,this.init(r);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getImage",value:function(e,t,n){var r=this.getTextures(e,t,n);if(r.length)return r[0].limitSize&&(r[0].images[0].limitSize=r[0].limitSize),r[0].images[0]}},{key:"getTextures",value:function(e,t,n){var r=this._config.textures,o=r.filter((function(r){return r.encoding===t&&r.format===n&&r.type===e}));return o}},{key:"init",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,i,a,s,c,u,d,p,h,f,b,y,w,S;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._config=t,n="panorama",this.textureLODSupport&&(n="cubemap"),r=this.getImage("specular_ue4","luv",n),o=r.file,i=r.width,e.next=8,P.requestResource("".concat(this.url).concat(o));case 8:if(a=e.sent,this.mapEnv="cubemap"===n?new m(a,i,t):new g(a,i,t),this.mapEnv.loadPacked(),s=r.limitSize,c=Math.log(i)/Math.LN2,u=c-Math.log(s)/Math.LN2,this.uEnvironmentLodRange=[c,u],this.uEnvironmentSize=[i,i],this.uIntegrateBRDF){e.next=24;break}return d=this.getImage("brdf_ue4","rg16","lut"),p=d.width,e.next=21,P.requestResource(F);case 21:h=e.sent,this._integrateBRDF=new v(h,p),this.uIntegrateBRDF=this._integrateBRDF.loadPacked();case 24:return f=this.getImage("background","luv","cubemap"),b=f.file,y=f.width,e.next=29,P.requestResource("".concat(this.url).concat(b));case 29:return w=e.sent,this.backgroundEnv=new m(w,y,{minFilter:l["LinearFilter"],magFilter:l["LinearFilter"]}),this.backgroundEnv.loadPacked(),this.uBGEnvironmentSize=[y,y],this._spherical=new _(t.diffuseSPH),this.uEnvironmentSphericalHarmonics=this._spherical._uniformSpherical,t.Lights&&(S=t.Lights[0],this.sunlightInfo={color:(new l["Color"]).fromArray(S.color),position:(new l["Vector3"]).fromArray(S.direction).negate(),intensity:S.luminosity}),e.abrupt("return",this);case 37:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),H=(n("4160"),n("159b"),n("99de")),B=n("7e84"),V=n("262e"),U=["map","normalMap","lightMap","bumpMap","roughnessMap","metalnessMap","aoMap","emissiveMap","displacementmap"],j=["color","roughness","metalness","emissive"],G={uBrightness:{value:1},uEnvironmentTransform:{value:new l["Matrix4"]}},z={roughness:{value:1},metalness:{value:.5},color:{value:new l["Color"](16777215)},emissive:{value:new l["Color"](0)},uEnvironmentTransform:{value:new l["Matrix4"]},uBrightness:{value:1}},K={ENABLE_IBL:1,ENABLE_LIGHT:1,ENERGY_COMPENSATION:1,DIFFUSE_LAMBERT:1,NDF_GGX:1,F_SCHLICK:1,V_SMITHJOINTAPPROX:1,SPECULAR_AO_MARMOSETCO:1},X=function(e){function t(e,n,r){var o;Object(a["a"])(this,t);var i=e.material;o=Object(H["a"])(this,Object(B["a"])(t).call(this)),o.modelNormalMatrix=new l["Matrix3"],o.copy(i),o.defines=Object.assign({},K),o.normalMapType=i.normalMapType;var s=l["UniformsLib"];return o.uniforms=l["UniformsUtils"].merge([s.common,s.normalmap,s.lightmap,s.bumpmap,s.roughnessmap,s.metalnessmap,s.aomap,s.emissivemap,s.displacementmap,s.envmap,s.fog,s.lights,z]),o.uniforms["uShadowDepthRange"]={value:r.shadowDepthRange},o.uniforms["uModelNormalMatrix"]={value:o.modelNormalMatrix},o.syncEnvSetting(n),o.syncParam(i),o.vertexShader=r.pbrVS,o.fragmentShader=r.pbrFS,o.lights=!0,!0===i.isGLTFSpecularGlossinessMaterial&&o.initSGWorkflow(i),e.onBeforeRender=function(){o.modelNormalMatrix.getNormalMatrix(e.matrixWorld)},o.needsUpdate=!0,o}return Object(V["a"])(t,e),Object(s["a"])(t,[{key:"syncEnvSetting",value:function(e){var t=e.mapEnv,n=e.uEnvironmentSphericalHarmonics,r=e.uEnvironmentLodRange,o=e.uEnvironmentSize,i=e.textureLODSupport;i?this.defines["CUBEMAP_LOD"]=1:this.defines["PANORAMA"]=1,this.envMap=t.texture,this.uniforms["envMap"]={value:t.texture},this.uniforms["uEnvironmentSphericalHarmonics"]={value:n},this.uniforms["uEnvironmentLodRange"]={value:r},this.uniforms["uEnvironmentSize"]={value:o},this.uniforms["uIntegrateBRDF"]={value:e.uIntegrateBRDF},e.isMobile&&(this.defines["MOBILE"]=1)}},{key:"syncParam",value:function(e){var t=this;U.forEach((function(n){void 0!=e[n]&&(t[n]=e[n],t.uniforms[n].value=e[n])})),j.forEach((function(n){void 0!=e[n]&&(t.uniforms[n].value=e[n])})),this.uniforms.diffuse.value=e.color||new Color(16777215)}},{key:"initSGWorkflow",value:function(e){this.defines["SPECULAR_GLOSSINESS"]=1;var t=e._extraUniforms,n=t.specular,r=t.glossiness,o=t.specularMap,i=t.glossinessMap;o.value&&(this.defines["USE_SPECULARMAP"]=1,this.uniforms["specularMap"]=o),i.value&&(this.defines["USE_GLOSSINESSMAP"]=1,this.uniforms["glossinessMap"]=i),this.uniforms["specularFactor"]=n,this.uniforms["glossinessFactor"]=r}}]),t}(l["ShaderMaterial"]),Y="varying vec3 vViewNormal;\r\n\r\nvoid main() {\r\n    vViewNormal = position;\r\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n    pos.z = 1.;\r\n    gl_Position = pos;\r\n}\r\n",W="uniform samplerCube envMap;\r\nuniform mat4 uEnvironmentTransform;\r\nuniform float uEnvBrightness;\r\nuniform vec2 uEnvironmentSize;\r\n\r\nvarying vec3 vViewNormal;\r\n\r\nmat3 getEnvironmentTransfrom(mat4 transform) {\r\n    vec3 x = vec3(transform[0][0], transform[1][0], transform[2][0]);\r\n    vec3 y = vec3(transform[0][1], transform[1][1], transform[2][1]);\r\n    vec3 z = vec3(transform[0][2], transform[1][2], transform[2][2]);\r\n    mat3 m = mat3(x,y,z);\r\n    return m;\r\n}\r\n\r\nvec3 cubemapSeamlessFixDirection(const in vec3 direction, const in float scale ){\r\n    vec3 dir = direction;\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float M = max(max(abs(dir.x), abs(dir.y)), abs(dir.z));\r\n\r\n    if (abs(dir.x) != M) dir.x *= scale;\r\n    if (abs(dir.y) != M) dir.y *= scale;\r\n    if (abs(dir.z) != M) dir.z *= scale;\r\n\r\n    return dir;\r\n}\r\n\r\nvec4 textureCubemap(const in samplerCube tex, const in vec3 dir){\r\n    vec4 rgba = textureCube(tex, dir);\r\n    return LogLuvToLinear(rgba);\r\n}\r\n\r\n// Seamless cubemap for background\r\nvec4 textureCubeFixed(const in samplerCube tex, const in vec3 direction){\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float scale = 1.0 - 1.0 / uEnvironmentSize[0];\r\n    vec3 dir = cubemapSeamlessFixDirection(direction, scale);\r\n    return textureCubemap(tex, dir);\r\n}\r\n\r\nvoid main(){\r\n    vec3 direction = normalize(vViewNormal);\r\n    direction = getEnvironmentTransfrom(uEnvironmentTransform) * direction;\r\n    vec4 samplerColor = uEnvBrightness * textureCubeFixed(envMap, direction);\r\n    \r\n    gl_FragColor = samplerColor;\r\n    #include <tonemapping_fragment>\r\n    #include <encodings_fragment>\r\n}\r\n",q=function(e){function t(e){Object(a["a"])(this,t);var n=e.envMap,r=e.uBGEnvironmentSize,o=e.uEnvBrightness,i=e.debug,s=G.uEnvironmentTransform,c={envMap:{value:n},uEnvironmentSize:{value:r},uEnvBrightness:o,uEnvironmentTransform:s};return Object(H["a"])(this,Object(B["a"])(t).call(this,{uniforms:c,vertexShader:Y,fragmentShader:W,side:l["DoubleSide"],depthTest:!!i}))}return Object(V["a"])(t,e),t}(l["ShaderMaterial"]),J=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;Object(a["a"])(this,t);var o=r/2,i=new l["SphereGeometry"](o,20,20),s=new q(e);return n=Object(H["a"])(this,Object(B["a"])(t).call(this,i,s)),n.radius=o,n.sphere=i,n}return Object(V["a"])(t,e),Object(s["a"])(t,[{key:"setSize",value:function(e){var t=e/this.radius;this.scale.setScalar(t)}},{key:"envMap",get:function(){return this.material.envMap},set:function(e){this.material.envMap=e}},{key:"mesh",get:function(){return this.sphere}}]),t}(l["Mesh"]),Z=(n("5319"),"vec3 computeDiffuseSPH(vec3 normal, vec3 sphericalHarmonics[9]){\r\n    float x = normal.x;\r\n    float y = normal.y;\r\n    float z = normal.z;\r\n    vec3 result = (\r\n        sphericalHarmonics[0] +\r\n        sphericalHarmonics[1] * y +\r\n        sphericalHarmonics[2] * z +\r\n        sphericalHarmonics[3] * x +\r\n        sphericalHarmonics[4] * y * x +\r\n        sphericalHarmonics[5] * y * z +\r\n        sphericalHarmonics[6] * (3.0 * z * z - 1.0) +\r\n        sphericalHarmonics[7] * (z * x) +\r\n        sphericalHarmonics[8] * (x*x - y*y)\r\n    );\r\n    return max(result, vec3(0.0));\r\n}"),Q="// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\r\nvec3 integrateBRDF(vec3 specular, float roughness, float NoV, float f90) {\r\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\r\n    const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\r\n    vec4 r = roughness * c0 + c1;\r\n    float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\r\n    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\r\n    return specular * AB.x + AB.y * f90;\r\n}",$="// For y up\r\nvec2 normalToPanoramaUV(vec3 dir){\r\n    float n = length(dir.xz);\r\n\r\n    // to avoid bleeding the max(-1.0,dir.x / n) is needed\r\n    vec2 pos = vec2( (n>0.0000001) ? max(-1.0,dir.x / n) : 0.0, dir.y);\r\n\r\n    // fix edge bleeding\r\n    if ( pos.x > 0.0 ) pos.x = min( 0.999999, pos.x );\r\n\r\n    pos = acos(pos)*0.31830988618; // RECIPROCAL_PI\r\n\r\n    pos.x = (dir.z > 0.0) ? pos.x*0.5 : 1.0-(pos.x*0.5);\r\n\r\n    // shift u to center the panorama to -z\r\n    pos.x = mod(pos.x-0.25+1.0, 1.0 );\r\n    pos.y = 1.0-pos.y;\r\n    return pos;\r\n}\r\n\r\n\r\nvec2 computeUVForMipmap(float level, vec2 uv, float size, float maxLOD){\r\n    // width for level\r\n    float widthForLevel = exp2( maxLOD-level);\r\n\r\n    // the height locally for the level in pixel\r\n    // to opimitize a bit we scale down the v by two in the inputs uv\r\n    float heightForLevel = widthForLevel * 0.5;\r\n\r\n    // compact version\r\n    float texelSize = 1.0/size;\r\n    vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, heightForLevel - 2.0);\r\n    uvSpaceLocal.y += size - widthForLevel;\r\n    return uvSpaceLocal * texelSize;\r\n}\r\n\r\nvec4 texturePanoramaLod(sampler2D tex, vec2 size , vec3 direction, float lod, float maxLOD){\r\n    vec2 uvBase = normalToPanoramaUV(direction);\r\n    // we scale down v here because it avoid to do twice in sub functions\r\n    // uvBase.y *= 0.5;\r\n    float lod0 = floor(lod);\r\n    vec2 uv0 = computeUVForMipmap(lod0, uvBase, size.x, maxLOD);\r\n    vec4 texel0 = texture2D(tex, uv0.xy);\r\n\r\n    float lod1 = ceil(lod);\r\n    vec2 uv1 = computeUVForMipmap(lod1, uvBase, size.x, maxLOD);\r\n    vec4 texel1 = texture2D(tex, uv0.xy);\r\n\r\n    return mix(texel0, texel1, fract(lod));\r\n}",ee="vec3 precomputeLight(vec3 normal, vec3 eyeVector, float perceptualRoughness){\r\n    // perceptually linear roughness to roughness\r\n    float roughness = perceptualRoughness * perceptualRoughness;\r\n    float NoV =  saturate(dot(normal, eyeVector));\r\n    return vec3(roughness, roughness * roughness, NoV);\r\n}",te='// Refer: UE4\r\n\r\n// ************************ Normal Distribution Functions(NDF) **************************\r\n\r\n// [Blinn 1977, "Models of light reflection for computer synthesized pictures"]\r\nfloat D_Blinn(vec3 precomputeLight, float NoH){\r\n    float a2 = precomputeLight.y;\r\n    float n = 2.0 / a2 - 2.0;\r\n    return (n+2.0) / (2.0* PI) * pow(NoH, n);   // 1 mad, 1 exp, 1 mul, 1 log\r\n}\r\n\r\n// [Beckmann 1963, "The scattering of electromagnetic waves from rough surfaces"]\r\nfloat D_Beckmann(vec3 precomputeLight, float NoH){\r\n    float a2 = precomputeLight.y;\r\n    float NoH2 = NoH * NoH;\r\n    return exp( (NoH2 - 1.0) / (a2 * NoH2) ) / ( PI * a2 * NoH2 * NoH2 );\r\n}\r\n\r\n// GGX / Trowbridge-Reitz\r\n// [Walter et al. 2007, "Microfacet models for refraction through rough surfaces"]\r\nfloat D_GGX(vec3 precomputeLight, float NoH){\r\n    float a2 = precomputeLight.y;\r\n    float d = (NoH * a2 - NoH) * NoH + 1.0;\t// 2 mad\r\n    return a2 / (PI * d * d);\t// 4 mul, 1 rcp\r\n}\r\n\r\nfloat Specular_D(vec3 precomputeLight, float NoH){\r\n#if defined(NDF_BLINNPHONG)\r\n    return D_Blinn(precomputeLight, NoH);\r\n#elif defined(NDF_BECKMANN)\r\n    return D_Beckmann(precomputeLight, NoH);\r\n#elif defined(NDF_GGX)\r\n    return D_GGX(precomputeLight, NoH);\r\n#else\r\n    return D_GGX(precomputeLight, NoH);\r\n#endif\r\n}\r\n\r\n// ************************************ Fresnel ************************************\r\n\r\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\r\nvec3 F_Schlick(float VoH, vec3 f0, float f90){\r\n    return f0 + (vec3(f90) - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\n// [Cook-Torrance 1982]\r\nvec3 F_CookTorrance(float VoH, vec3 f0, float f90){\r\n    vec3 sqrtSpec = sqrt(f0);\r\n    vec3 n = (1.0 + sqrtSpec) / (1.0 - sqrtSpec);\r\n    float c = saturate(VoH);\r\n    vec3 g = sqrt(n * n + c * c - 1.0);\r\n\r\n    vec3 part1 = (g - c)/(g + c);\r\n    vec3 part2 = ((g + c) * c - 1.0)/((g - c) * c + 1.0);\r\n\r\n    return max(vec3(0.0), 0.5 * part1 * part1 * (1.0 + part2 * part2));\r\n}\r\n\r\nvec3 F_None(vec3 f0){\r\n    return f0;\r\n}\r\n\r\nvec3 Specular_F(float VoH, vec3 f0, float f90){\r\n#if defined(F_SCHLICK)\r\n    return F_Schlick(VoH, f0, f90);\r\n#elif defined(F_COOKTORRANCE)\r\n    return F_CookTorrance(VoH, f0, f90);\r\n#else // FRESNSEL_NONE\r\n    return F_None(f0);\r\n#endif\r\n}\r\n\r\n// ******************************** Visibility Term *********************************\r\nfloat Vis_Implicit(){\r\n\treturn 0.25;\r\n}\r\n\r\n// [Neumann et al. 1999, "Compact metallic reflectance models"]\r\nfloat Vis_Neumann(vec3 precomputeLight, float NoL){\r\n\tfloat NoV = precomputeLight.z;\r\n\treturn 1. / (4. * max(NoL, NoV));\r\n}\r\n\r\n// [Kelemen 2001, "A microfacet based coupled specular-matte brdf model with importance sampling"]\r\nfloat Vis_Kelemen(float VoH){\r\n\t// constant to prevent NaN\r\n\treturn 1./(4. * VoH * VoH + 1e-5);\r\n}\r\n\r\n// Tuned to match behavior of Vis_Smith\r\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\r\nfloat Vis_Schlick(vec3 precomputeLight, float NoL){\r\n\tfloat a2 = precomputeLight.y;\r\n\tfloat NoV = precomputeLight.z;\r\n\tfloat k = sqrt(a2) * 0.5;\r\n\tfloat Vis_SchlickV = NoV * (1. - k) + k;\r\n\tfloat Vis_SchlickL = NoL * (1. - k) + k;\r\n\treturn 0.25 / (Vis_SchlickV * Vis_SchlickL);\r\n}\r\n\r\n// Smith term for GGX\r\n// [Smith 1967, "Geometrical shadowing of a random rough surface"]\r\nfloat Vis_Smith(vec3 precomputeLight, float NoL){\r\n\tfloat a2 = precomputeLight.y;\r\n\tfloat NoV = precomputeLight.z;\r\n\tfloat Vis_SmithV = NoV + sqrt(NoV * (NoV - NoV * a2) + a2);\r\n\tfloat Vis_SmithL = NoL + sqrt(NoL * (NoL - NoL * a2) + a2);\r\n\treturn 1./(Vis_SmithV * Vis_SmithL);\r\n}\r\n\r\n// Appoximation of joint Smith term for GGX\r\n// [Heitz 2014, "Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs"]\r\nfloat Vis_SmithJointApprox(vec3 precomputeLight, float NoL){\r\n    float roughness = precomputeLight.x;\r\n    float NoV = precomputeLight.z;\r\n    float Vis_SmithV = NoL * (NoV * (1.0 - roughness) + roughness);\r\n    float Vis_SmithL = NoV * (NoL * (1.0 - roughness) + roughness);\r\n    return 0.5 / (Vis_SmithV + Vis_SmithL);\r\n}\r\n\r\n// Hammon 2017, "PBR Diffuse Lighting for GGX+Smith Microsurfaces"\r\nfloat Vis_SmithJointApprox_Hammon(vec3 precomputeLight, float NoL) {\r\n    float roughness = precomputeLight.x;\r\n    float NoV = precomputeLight.z;\r\n\r\n    float v = 0.5 / mix(2.0 * NoL * NoV, NoL + NoV, roughness);\r\n    return v;\r\n}\r\n\r\nfloat Specular_V(vec3 precomputeLight, float NoL, float VoH){\r\n#if defined(V_IMPLICIT)\r\n    return Vis_Implicit();\r\n#elif defined(V_NEUMANN)\r\n    return Vis_Neumann(precomputeLight, NoL);\r\n#elif defined(V_KELEMEN)\r\n    return Vis_Kelemen(VoH);\r\n#elif defined(V_SCHLICK)\r\n    return Vis_Schlick(precomputeLight, NoL);\r\n#elif defined(V_SMITH)\r\n    return Vis_Smith(precomputeLight, NoL);\r\n#elif defined(V_SMITHJOINTAPPROX)\r\n    return Vis_SmithJointApprox(precomputeLight, NoL);\r\n#elif defined(V_HAMMONAPPROX)\r\n    return Vis_SmithJointApprox_Hammon(precomputeLight, NoL);\r\n#else\r\n\treturn 0.25;\r\n#endif\r\n}\r\n\r\nvec3 specularLobe(vec3 precomputeLight, vec3 specular, float NoL, float NoH, float VoH, float f90) {\r\n    float D = Specular_D(precomputeLight, NoH);\r\n    vec3 F = Specular_F(VoH, specular, f90);\r\n    float V = Specular_V(precomputeLight, NoL, VoH);\r\n\t\r\n    return (D * V) * F;\r\n}\r\n\r\n// ************************************ Diffuse ************************************\r\nvec3 Diffuse_Lambert(vec3 diffuse){\r\n\treturn diffuse / PI;\r\n}\r\n\r\n// [Burley 2012, "Physically-Based Shading at Disney"]\r\nvec3 Diffuse_Burley(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\r\n    float Roughness = precomputeLight.x;\r\n    float NoV =  precomputeLight.z;\r\n\r\n\tfloat FD90 = 0.5 + 2. * VoH * VoH * Roughness;\r\n\tfloat FdV = 1. + (FD90 - 1.) * pow5(1. - NoV);\r\n\tfloat FdL = 1. + (FD90 - 1.) * pow5(1. - NoL);\r\n\treturn diffuse * ((1. / PI) * FdV * FdL);\r\n}\r\n\r\n// [Gotanda 2012, "Beyond a Simple Physically Based Blinn-Phong Model in Real-Time"]\r\nvec3 Diffuse_OrenNayar(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\r\n    float Roughness = precomputeLight.x;\r\n\tfloat a = precomputeLight.y;\r\n    float NoV = precomputeLight.z;\r\n\tfloat s = a; // / ( 1.29 + 0.5 * a );\r\n\tfloat s2 = s * s;\r\n\tfloat VoL = 2. * VoH * VoH - 1.;  // double angle identity\r\n\tfloat Cosri = VoL - NoV * NoL;\r\n\tfloat C1 = 1. - 0.5 * s2 / (s2 + 0.33);\r\n\tfloat C2 = 0.45 * s2 / (s2 + 0.09) * Cosri * (Cosri >= 0. ? 1./(max(NoL, NoV)) : 1.);\r\n\treturn diffuse / PI * (C1 + C2) * (1. + Roughness * 0.5);\r\n}\r\n\r\n// [Gotanda 2014, "Designing Reflectance Models for New Consoles"]\r\nvec3 Diffuse_Gotanda(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\r\n    float Roughness = precomputeLight.x;\r\n\tfloat a = precomputeLight.y;\r\n    float NoV = precomputeLight.z;\r\n\tfloat a2 = a * a;\r\n\tfloat F0 = 0.04;\r\n\tfloat VoL = 2. * VoH * VoH - 1.;    // double angle identity\r\n\tfloat Cosri = VoL - NoV * NoL;\r\n\r\n\tfloat a2_13 = a2 + 1.36053;\r\n\tfloat Fr = ( 1. - ( 0.542026*a2 + 0.303573*a ) / a2_13 ) * ( 1. - pow( 1. - NoV, 5. - 4.*a2 ) / a2_13 ) * ( ( -0.733996*a2*a + 1.50912*a2 - 1.16402*a ) * pow( 1. - NoV, 1. + 1./(39.*a2*a2+1.) ) + 1. );\r\n\tfloat Lm = ( max( 1. - 2.*a, 0. ) * ( 1. - pow5( 1. - NoL ) ) + min( 2.*a, 1. ) ) * ( 1. - 0.5*a * (NoL - 1.) ) * NoL;\r\n\tfloat Vd = ( a2 / ( (a2 + 0.09) * (1.31072 + 0.995584 * NoV) ) ) * ( 1. - pow( 1. - NoL, ( 1. - 0.3726732 * NoV * NoV ) / ( 0.188566 + 0.38841 * NoV ) ) );\r\n\tfloat Bp = Cosri < 0. ? 1.4 * NoV * NoL * Cosri : Cosri;\r\n\tfloat Lr = (21.0 / 20.0) * (1. - F0) * ( Fr * Lm + Vd + Bp );\r\n\treturn diffuse / PI * Lr;\r\n}\r\n\r\nvec3 diffuseLobe(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\r\n#if defined(DIFFUSE_LAMBERT)\r\n    return Diffuse_Lambert(diffuse);\r\n#elif defined(DIFFUSE_BURLEY)\r\n    return Diffuse_Burley(precomputeLight, diffuse, NoL, VoH);\r\n#elif defined(DIFFUSE_ORENNAYAR)\r\n    return Diffuse_OrenNayar(precomputeLight, diffuse, NoL, VoH);\r\n#elif defined(DIFFUSE_GOTANDA)\r\n    return Diffuse_Gotanda(precomputeLight, diffuse, NoL, VoH);\r\n#else // DIFFUSE_NONE\r\n    return vec3(0.0);\r\n#endif\r\n}\r\n\r\nvoid surfaceShading(in vec3 normal, in vec3 viewDir, in float NoL, in vec3 precomputeLight, in vec3 diffuse, in vec3 specular, in float attenuation, in vec3 lightColor, in vec3 lightDir, in float f90, out vec3 diffuseOut, out vec3 specularOut, out bool lighted) {\r\n    lighted = NoL > 0.0;\r\n    if (!lighted) {\r\n        specularOut = diffuseOut = vec3(0.0);\r\n        return;\r\n    }\r\n    vec3 H = normalize(viewDir + lightDir);\r\n    float NoH =  saturate(dot(normal, H));\r\n    float VoH =  saturate(dot(viewDir, H));\r\n\t\r\n    vec3 colorAttenuate = attenuation * NoL * lightColor;\r\n    diffuseOut = colorAttenuate * diffuseLobe(precomputeLight, diffuse, NoL, VoH);\r\n    specularOut = colorAttenuate * specularLobe(precomputeLight, specular, NoL, NoH, VoH, f90);\r\n}',ne="float pow5(float x) {\r\n\tfloat xx = x * x;\r\n\treturn xx * xx * x;\r\n}\r\n\r\nmat3 getEnvironmentTransfrom(mat4 transform) {\r\n    vec3 x = vec3(transform[0][0], transform[1][0], transform[2][0]);\r\n    vec3 y = vec3(transform[0][1], transform[1][1], transform[2][1]);\r\n    vec3 z = vec3(transform[0][2], transform[1][2], transform[2][2]);\r\n    mat3 m = mat3(x,y,z);\r\n    return m;\r\n}",re="// Shadow\r\nuniform bool receiveShadow;\r\n#ifdef USE_SHADOWMAP\r\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\r\n        struct DirectionalLightShadow {\r\n\t\t\tfloat shadowBias;\r\n\t\t\tfloat shadowRadius;\r\n\t\t\tvec2 shadowMapSize;\r\n\t\t};\r\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\r\n        \r\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\r\n\t#endif\r\n\t\r\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare, float shadowDistance) {\r\n        vec2 centroidCoord = uv / size;\r\n        centroidCoord = centroidCoord + 0.5;\r\n        vec2 f = fract(centroidCoord);\r\n\r\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\r\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\r\n\r\n        vec4 fetches;\r\n        const vec2 offset = vec2( 0.0, 1.0 );\r\n        fetches.x = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.xx ));\r\n        fetches.y = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.xy ));\r\n        fetches.z = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.yx ));\r\n        fetches.w = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.yy ));\r\n\r\n        // Shadow distance\r\n        float _a = mix(fetches.x, fetches.y, f.y);\r\n        float _b = mix(fetches.z, fetches.w, f.y);\r\n        shadowDistance = mix(_a, _b, f.x);\r\n\r\n\t\tvec4 st = step(fetches, vec4(0.0));\r\n\r\n        float a = mix(st.x, st.y, f.y);\r\n        float b = mix(st.z, st.w, f.y);\r\n        return mix(a, b, f.x);\r\n\t}\r\n\r\n\tfloat getShadow(bool lighted, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, out float shadowDistance ) {\r\n        bool earlyOut = false;\r\n        float shadow = 1.0;\r\n\r\n        if (!lighted){\r\n            shadow = 0.0;\r\n            earlyOut = true;\r\n        }\r\n\r\n        if(uShadowDepthRange.x == uShadowDepthRange.y){\r\n            earlyOut = true;\r\n        }\r\n\r\n        if (!earlyOut) {\r\n            shadowCoord.xyz /= shadowCoord.w;\r\n            shadowCoord.z += shadowBias;\r\n            // if ( something && something ) breaks ATI OpenGL shader compiler\r\n            // if ( all( something, something ) ) using this instead\r\n            bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n            bool inFrustum = all( inFrustumVec );\r\n            bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n            bool frustumTest = all( frustumTestVec );\r\n            if ( frustumTest ) {\r\n                vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\r\n                // TODO: Shadow jitter\r\n                float res = texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z, shadowDistance);\r\n                shadow = res;\r\n            }\r\n        }\r\n\t\treturn shadow;\r\n\t}\r\n#endif",oe="// Light\r\n// DirectionalLight\r\n#if NUM_DIR_LIGHTS > 0\r\n\tstruct DirectionalLight {\r\n\t\tvec3 direction;\r\n\t\tvec3 color;\r\n\t\tbool visible;\r\n\t};\r\n\r\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\r\n\r\n    void precomputeDirect(vec3 normal, vec3 viewDir, inout DirectionalLight directionalLight, out float attenuation, out vec3 lightDir, out float NoL) {\r\n        attenuation = 1.0;\r\n        lightDir = directionalLight.direction;\r\n        NoL = dot(normal, lightDir);\r\n\t\tdirectionalLight.visible = true;\r\n    }\r\n#endif\r\n// Todo: Spot/Point Light",ie="#preImport <isotropyLightCompute>",ae="// IBL\r\n#preImport <precomputeLight>\r\n#preImport <computeDiffuseSPH>\r\n\r\n#ifdef PANORAMA\r\n    #preImport <panoramaSampler>\r\n#endif\r\n\r\nvec3 integrateBRDF(vec3 specular, float roughness, float NoV, inout vec3 specularDFG) {\r\n    vec4 rgba = texture2D(uIntegrateBRDF, vec2(NoV, roughness));\r\n    float a = (rgba[1] * 65280.0 + rgba[0] * 255.0) / 65535.0;\r\n    float b = (rgba[3] * 65280.0 + rgba[2] * 255.0) / 65535.0;\r\n    specularDFG = (1.-specular) * a + specular * b;\r\n    return specularDFG;\r\n}\r\n\r\n// frostbite, lagarde paper p67\r\n// http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf\r\nfloat linRoughnessToMipmap(float roughnessLinear){\r\n    return sqrt(roughnessLinear);\r\n}\r\n\r\nvec3 prefilterEnvMap(float rLinear, vec3 R) {\r\n    vec3 dir = R;\r\n    float lod = linRoughnessToMipmap(rLinear) * uEnvironmentLodRange[1]; //(uEnvironmentMaxLod - 1.0);\r\n    lod = min(uEnvironmentLodRange[0], lod);\r\n#ifdef CUBEMAP_LOD\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float scale = 1.0 - exp2(lod) / uEnvironmentSize[0];\r\n    vec3 absDir = abs(dir);\r\n    float M = max(max(absDir.x, absDir.y), absDir.z);\r\n    // cubemapSeamlessFixDirection\r\n    if (absDir.x != M) dir.x *= scale;\r\n    if (absDir.y != M) dir.y *= scale;\r\n    if (absDir.z != M) dir.z *= scale;\r\n\treturn LogLuvToLinear(textureCubeLodEXT(envMap, dir, lod)).rgb;\r\n#else\r\n    return LogLuvToLinear(panoramaSampler(envMap, uEnvironmentSize, R, lod, uEnvironmentLodRange[0])).rgb;\r\n\t#endif\r\n}\r\n\r\n// From Sebastien Lagarde Moving Frostbite to PBR page 69\r\n// We have a better approximation of the off specular peak\r\n// but due to the other approximations we found this one performs better.\r\n// N is the normal direction\r\n// R is the mirror vector\r\n// This approximation works fine for G smith correlated and uncorrelated\r\nvec3 getSpecularDominantDir(vec3 N, vec3 R, float realRoughness) {\r\n    float smoothness = 1.0 - realRoughness;\r\n    float lerpFactor = smoothness * (sqrt(smoothness) + realRoughness);\r\n    return mix(N, R, lerpFactor);\r\n}\r\n\r\nvec3 getPrefilteredEnvMapColor(vec3 normal, vec3 viewDir, float roughness, vec3 frontNormal) {\r\n    vec3 R = reflect(-viewDir, normal);\r\n    // From Sebastien Lagarde Moving Frostbite to PBR page 69\r\n    // so roughness = linRoughness * linRoughness\r\n    R = getSpecularDominantDir(normal, R, roughness);\r\n\r\n    vec3 prefilteredColor = prefilterEnvMap(roughness, environmentTransform * R);\r\n    return prefilteredColor;\r\n}\r\n\r\nvec3 computeIBLSpecularUE4(vec3 normal, vec3 viewDir, float roughness, vec3 specular, vec3 frontNormal, inout vec3 specularDFG) {\r\n    float NoV = dot(normal, viewDir);\r\n    vec3 brdfLUT = integrateBRDF(specular, roughness, NoV, specularDFG);\r\n    return getPrefilteredEnvMapColor(normal, viewDir, roughness, frontNormal) * brdfLUT;\r\n}\r\n",se="// http://marmosetco.tumblr.com/post/81245981087\r\nfloat occlusionHorizon(float ao, vec3 normal, vec3 viewDir) {\r\n    float d = dot(normal, viewDir) + ao;\r\n    return clamp((d * d) - 1.0 + ao, 0.0, 1.0);\r\n}\r\n\r\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\nfloat computeSpecularAO(float ao, vec3 precomputeLight) {\r\n    float roughness = precomputeLight.x;\r\n    float NoV =  precomputeLight.z;\r\n    return clamp(pow(NoV + ao, exp2(-16.0 * roughness - 1.0)) - 1.0 + ao, 0.0, 1.0);\r\n}\r\n\r\nfloat getEnergyCompensation(vec3 dfg, float f0) {\r\n   return 1.0 + f0 * (1.0 / dfg.y - 1.0);\r\n}\r\n\r\n// Todo: Normal AA Test\r\nfloat adjustRoughness(float roughness, vec3 normal) {\r\n    // Based on The Order : 1886 SIGGRAPH course notes implementation (page 21 notes)\r\n    float normalLen = length(normal * 2.0 - 1.0);\r\n    if ( normalLen < 1.0) {\r\n        float normalLen2 = normalLen * normalLen;\r\n        float kappa = ( 3.0 * normalLen -  normalLen2 * normalLen )/( 1.0 - normalLen2 );\r\n        // http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/\r\n        // page 91 : they use 0.5/kappa instead\r\n        return min(1.0, sqrt(roughness * roughness + 1.0 / kappa));\r\n    }\r\n    return roughness;\r\n}",le={computeDiffuseSPH:Z,integrateBRDFMobile:Q,panoramaSampler:$,precomputeLight:ee,isotropyLightCompute:te,math:ne,shadow:re,light:oe,brdf:ie,ibl:ae,advance:se},ce="uniform mat3 uModelNormalMatrix;\r\nvarying vec3 vViewPosition;\r\n\r\nvarying vec3 vNormal;\r\n\r\n#ifdef USE_TANGENT\r\n\tvarying vec3 vTangent;\r\n\tvarying vec3 vBitangent;\r\n#endif\r\n\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n\r\nvoid main(){\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n    #include <color_vertex>\r\n    #include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\r\n\tvNormal = normalize( transformedNormal );\r\n\t#ifdef USE_TANGENT\r\n\t\tvTangent = normalize( transformedTangent );\r\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\r\n\t#endif\r\n\r\n    #include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <project_vertex>\r\n\r\n    vViewPosition = mvPosition.xyz;\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <shadowmap_vertex>\r\n}\r\n",ue="// refer: \r\n// https://github.com/cedricpinson/osgjs\r\n// https://google.github.io/filament/Filament.html\r\n\r\nuniform mat4 uEnvironmentTransform;\r\nmat3 environmentTransform;\r\nuniform float uEnvBrightness;\r\nuniform vec3 uEnvironmentSphericalHarmonics[9];\r\n\r\nuniform sampler2D uIntegrateBRDF;\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform float roughness;\r\nuniform float metalness;\r\nuniform float opacity;\r\n\r\nuniform vec2 uShadowDepthRange;\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#ifdef CUBEMAP_LOD\r\nuniform samplerCube envMap;\r\n#endif\r\n#ifdef PANORAMA\r\nuniform sampler2D envMap;\r\n#endif\r\nuniform vec2 uEnvironmentSize;\r\nuniform vec2 uEnvironmentLodRange;\r\n\r\n#ifdef SPECULAR_GLOSSINESS\r\n    uniform vec3 specularFactor;\r\n    uniform float glossinessFactor;\r\n    #ifdef USE_SPECULARMAP\r\n\t    uniform sampler2D specularMap;\r\n    #endif\r\n    #ifdef USE_GLOSSINESSMAP\r\n\t    uniform sampler2D glossinessMap;\r\n    #endif\r\n#endif\r\n\r\nvarying vec3 vNormal;\r\n#ifdef USE_TANGENT\r\n    varying vec3 vTangent;\r\n    varying vec3 vBitangent;\r\n#endif\r\n\r\n#include <common>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <roughnessmap_pars_fragment>\r\n#include <metalnessmap_pars_fragment>\r\n#include <packing>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\n#preImport <math>\r\n#preImport <shadow>\r\n#preImport <light>\r\n#preImport <ibl>\r\n#preImport <brdf>\r\n#preImport <advance>\r\n\r\nvoid main(){\r\n    vec3 viewDir = -normalize(vViewPosition);\r\n    environmentTransform = getEnvironmentTransfrom(uEnvironmentTransform);\r\n\r\n    vec4 diffuseColor = vec4(diffuse, opacity);\r\n    vec3 totalEmissiveRadiance = emissive;\r\n    #include <logdepthbuf_fragment>\r\n    #include <color_fragment>\r\n    #include <normal_fragment_begin>\r\n\t#include <normal_fragment_maps>\r\n    #include <map_fragment>\r\n    #include <emissivemap_fragment>\r\n\r\n    float roughnessVal;\r\n    #ifdef SPECULAR_GLOSSINESS\r\n        roughnessVal = glossinessFactor;\r\n        #ifdef USE_GLOSSINESSMAP\r\n            roughnessVal = texture2D(glossinessMap, vUv).a * glossinessFactor;\r\n        #endif\r\n        roughnessVal = 1.0 - roughnessVal;\r\n    #else\r\n        #include <roughnessmap_fragment>\r\n        roughnessVal = roughnessFactor;\r\n    #endif\r\n\r\n    vec3 materialSpecular;\r\n    vec3 materialDiffuse = diffuseColor.rgb;\r\n    #ifdef SPECULAR_GLOSSINESS\r\n        materialSpecular = specularFactor;\r\n        #ifdef USE_SPECULARMAP\r\n            materialSpecular = sRGBToLinear(texture2D(specularMap, vUv)).rgb * specularFactor;\r\n        #endif\r\n    #else\r\n        #include <metalnessmap_fragment>\r\n        float f0 = 0.04;\r\n        materialSpecular = mix(vec3(f0), diffuseColor.rgb, metalnessFactor);\r\n        // materialSpecular = 0.16 * reflectance * reflectance * (1.0 - metallic) + baseColor * metallic;\r\n        materialDiffuse = diffuseColor.rgb * (1.0 - metalnessFactor);\r\n    #endif\r\n\r\n    float materialF90 = 1.0;\r\n    #ifndef MOBILE\r\n    materialF90 = saturate(dot(materialSpecular, vec3(50.0 * 0.33)));\r\n    // cheap luminance approximation\r\n    // materialF90 = saturate(50.0 * materialSpecular.g);\r\n    #endif\r\n\r\n    // Roughness\r\n    const float minRoughness = 0.001;\r\n    float materialRoughness = max(minRoughness, roughnessVal);\r\n\r\n    vec3 prepCompute = precomputeLight(normal, viewDir, max(0.045, materialRoughness));\r\n\r\n    // IBL\r\n    vec3 specularDFG = vec3(1.0);\r\n    vec3 transformedNormal = environmentTransform * normal;\r\n    vec3 diffuseIBL = materialDiffuse * computeDiffuseSPH(transformedNormal, uEnvironmentSphericalHarmonics);\r\n    vec3 specularIBL = computeIBLSpecularUE4(normal, viewDir, materialRoughness, materialSpecular, vNormal, specularDFG);\r\n    \r\n    // Diffuse AO\r\n    float materialAO = 1.0;\r\n    #ifdef USE_AOMAP\r\n\tmaterialAO = (texture2D(aoMap, vUv2).r - 1.0) * aoMapIntensity + 1.0;\r\n    #endif\r\n    diffuseIBL *= uEnvBrightness * materialAO;\r\n\r\n    float energyCompensation = 1.0;\r\n    #ifdef ENERGY_COMPENSATION\r\n    energyCompensation = getEnergyCompensation(specularDFG, materialSpecular.g);\r\n    #endif\r\n    // Specular AO\r\n    float aoSpec = 1.0;\r\n    #ifdef SPECULAR_AO_MARMOSETCO\r\n    aoSpec = occlusionHorizon(materialAO, normal, viewDir);\r\n    #elif defined(SPECULAR_AO_SEBLAGARDE)\r\n    aoSpec = computeSpecularAO(materialAO, prepCompute);\r\n    #endif\r\n    specularIBL *= uEnvBrightness * aoSpec * energyCompensation;\r\n\r\n    // Light\r\n    float attenuation, NoL;\r\n    vec3 lightDir;\r\n    vec3 lightSpecular;\r\n    vec3 lightDiffuse;\r\n    vec3 resultLightSpecular;\r\n    vec3 resultLightDiffuse;\r\n    bool lighted;\r\n    float shadow = 1.0;\r\n    float shadowDistance;\r\n\r\n    #if NUM_DIR_LIGHTS > 0\r\n        DirectionalLight directionalLight;\r\n        #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\r\n        DirectionalLightShadow directionalLightShadow;\r\n        #endif\r\n        #pragma unroll_loop_start\r\n\t    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n            directionalLight = directionalLights[ i ];\r\n            precomputeDirect(normal, viewDir, directionalLight, attenuation, lightDir, NoL);\r\n            surfaceShading(normal, viewDir, NoL, prepCompute, materialDiffuse, materialSpecular, attenuation, directionalLights[ i ].color, lightDir, materialF90, lightDiffuse, lightSpecular, lighted);\r\n            lightSpecular *= energyCompensation;\r\n            // Shadow\r\n            #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\r\n            directionalLightShadow = directionalLightShadows[ i ];\r\n            shadow *= all( bvec2( directionalLight.visible, receiveShadow ) ) ? getShadow( lighted, directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], shadowDistance ) : 1.0;\r\n            lightDiffuse *= shadow;\r\n            lightSpecular *= shadow;\r\n            #endif\r\n\r\n            resultLightDiffuse += lightDiffuse;\r\n            resultLightSpecular += lightSpecular;\r\n        }\r\n        #pragma unroll_loop_end\r\n    #endif\r\n    // Todo: Spot/Point Light\r\n\r\n    // Test\r\n    #ifndef ENABLE_IBL\r\n        diffuseIBL = vec3(0.);\r\n        specularIBL = vec3(0.);\r\n    #endif\r\n    #ifndef ENABLE_LIGHT\r\n        resultLightDiffuse = vec3(0.);\r\n        resultLightSpecular = vec3(0.);\r\n    #endif\r\n\r\n    vec3 resultDiffuse = diffuseIBL + resultLightDiffuse;\r\n    vec3 resultSpecular = specularIBL + resultLightSpecular;\r\n\r\n    vec3 totalResult = resultDiffuse + resultSpecular + totalEmissiveRadiance;\r\n    vec4 frag = vec4(totalResult, diffuseColor.a);\r\n    gl_FragColor = frag;\r\n    #include <tonemapping_fragment>\r\n    #include <encodings_fragment>\r\n}",de=function(){function e(){Object(a["a"])(this,e),this.includePattern=/^[ \t]*#preImport +<([\w\d./]+)>/gm}return Object(s["a"])(e,[{key:"getPBRShader",value:function(){var e=this.preParseShader(ce),t=this.preParseShader(ue);return{pbrVS:e,pbrFS:t}}},{key:"preParseShader",value:function(e){var t=this,n=function(e,n){var r=le[n];if(void 0===r)throw new Error("Can not resolve #preImport <"+n+">");return t.preParseShader(r)};return e.replace(this.includePattern,n)}}]),e}(),pe="./assets/envMap/",he=["Arches","Alexs","GCanyon","Industrial","Milkyway","Outside","PaperMill","Royal","TropicalRuins","Venice"],fe=["Lambert","Burley","OrenNayar","Gotanda","None"],me=["Schlick","CookTorrance","None"],ge=["GGX","BlinnPhong","Beckmann"],ve=["SmithJointApprox","Implicit","Neumann","Kelemen","Schlick","Smith","HammonApprox"],_e=["ACESFilmic","Linear","Reinhard","Uncharted2","Cineon","No"],be=["Marmosetco","Seblagarde","None"];function ye(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=(new l["Box3"]).setFromObject(t),i=o.getSize(new l["Vector3"]),a=Math.max(i.x,i.y,i.z),s=a/(2*Math.atan(Math.PI*e.fov/360)),c=s/e.aspect,u=r*Math.max(s,c);return e.near=u/100,e.far=100*u,e.position.set(0,u/4,u),e.updateProjectionMatrix(),n&&(n.maxDistance=20*u,n.update()),u}function we(e,t,n,r){var o=(new l["Box3"]).setFromObject(n);e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024;var i=e.shadow.camera;i.position.copy(e.position),i.lookAt(new l["Vector3"](0,0,0)),i.position.set(0,0,0),i.updateMatrixWorld(!0);var a=new l["Matrix4"];if(a.getInverse(i.matrixWorld),o.applyMatrix4(a),i.left=o.min.x-.01,i.right=o.max.x+.01,i.top=o.min.y-.01,i.bottom=o.max.y+.01,i.near=-o.max.z-.01,i.far=.01-o.min.z,i.updateProjectionMatrix(),e.shadow.bias=-.01,r){var s=new l["DirectionalLightHelper"](e,5,16777215);t.add(s);var c=new l["CameraHelper"](i);t.add(c)}}n("c975");function Se(e){var t;return t=e.currentStyle?e.currentStyle.width:getComputedStyle(e,!1).width,~t.indexOf("px")&&(t=t.slice(0,-2)),t}function xe(e){var t;return t=e.currentStyle?e.currentStyle.height:getComputedStyle(e,!1).height,~t.indexOf("px")&&(t=t.slice(0,-2)),t}function Ee(){var e=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent);return e||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent)}n("a4d3"),n("e01a"),n("d28b"),n("277d"),n("a15b"),n("a434"),n("0d03"),n("b680"),n("1d1c"),n("7a82"),n("e439"),n("3410"),n("131a"),n("acd8"),n("e25e"),n("4d63"),n("25f0"),n("1276"),n("4795");var Le=n("53ca");function Ae(e){if(e&&"undefined"!==typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}function Te(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),o=Math.round(e.g),i=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){var u=e.hex.toString(16);while(u.length<6)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+r+","+o+","+i+")":"CSS_RGBA"===n?"rgba("+r+","+o+","+i+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+o+","+i+"]":"RGBA_ARRAY"===n?"["+r+","+o+","+i+","+a+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+o+",b:"+i+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+o+",b:"+i+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var Me=Array.prototype.forEach,Re=Array.prototype.slice,Oe={BREAK:{},extend:function(e){return this.each(Re.call(arguments,1),(function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))}),this),e},defaults:function(e){return this.each(Re.call(arguments,1),(function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))}),this),e},compose:function(){var e=Re.call(arguments);return function(){for(var t=Re.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(Me&&e.forEach&&e.forEach===Me)e.forEach(t,n);else if(e.length===e.length+0){var r=void 0,o=void 0;for(r=0,o=e.length;r<o;r++)if(r in e&&t.call(n,e[r],r)===this.BREAK)return}else for(var i in e)if(t.call(n,e[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var o=this,i=arguments;function a(){r=null,n||e.apply(o,i)}var s=n||!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(o,i)}},toArray:function(e){return e.toArray?e.toArray():Re.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},Ce=[{litmus:Oe.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:Te},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:Te},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:Te},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:Te}}},{litmus:Oe.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Oe.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Oe.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(Oe.isNumber(e.r)&&Oe.isNumber(e.g)&&Oe.isNumber(e.b)&&Oe.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(Oe.isNumber(e.r)&&Oe.isNumber(e.g)&&Oe.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(Oe.isNumber(e.h)&&Oe.isNumber(e.s)&&Oe.isNumber(e.v)&&Oe.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(Oe.isNumber(e.h)&&Oe.isNumber(e.s)&&Oe.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Ne=void 0,ke=void 0,De=function(){ke=!1;var e=arguments.length>1?Oe.toArray(arguments):arguments[0];return Oe.each(Ce,(function(t){if(t.litmus(e))return Oe.each(t.conversions,(function(t,n){if(Ne=t.read(e),!1===ke&&!1!==Ne)return ke=Ne,Ne.conversionName=n,Ne.conversion=t,Oe.BREAK})),Oe.BREAK})),ke},Pe=void 0,Fe={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),i=n*(1-t),a=n*(1-o*t),s=n*(1-(1-o)*t),l=[[n,s,i],[a,n,i],[i,n,s],[i,a,n],[s,i,n],[n,i,a]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),o=Math.max(e,t,n),i=o-r,a=void 0,s=void 0;return 0===o?{h:NaN,s:0,v:0}:(s=i/o,a=e===o?(t-n)/i:t===o?2+(n-e)/i:4+(e-t)/i,a/=6,a<0&&(a+=1),{h:360*a,s:s,v:o/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n),r},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(Pe=8*t)|e&~(255<<Pe)}},Ie="function"===typeof Symbol&&"symbol"===Object(Le["a"])(Symbol.iterator)?function(e){return Object(Le["a"])(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":Object(Le["a"])(e)},He=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Be=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Ve=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},Ue=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+Object(Le["a"])(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},je=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==Object(Le["a"])(t)&&"function"!==typeof t?e:t},Ge=function(){function e(){if(He(this,e),this.__state=De.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Be(e,[{key:"toString",value:function(){return Te(this)}},{key:"toHexString",value:function(){return Te(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function ze(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||Ge.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(Ge.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function Ke(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||Ge.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(Ge.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}Ge.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=Fe.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");Oe.extend(e.__state,Fe.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},Ge.recalculateHSV=function(e){var t=Fe.rgb_to_hsv(e.r,e.g,e.b);Oe.extend(e.__state,{s:t.s,v:t.v}),Oe.isNaN(t.h)?Oe.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},Ge.COMPONENTS=["r","g","b","h","s","v","hex","a"],ze(Ge.prototype,"r",2),ze(Ge.prototype,"g",1),ze(Ge.prototype,"b",0),Ke(Ge.prototype,"h"),Ke(Ge.prototype,"s"),Ke(Ge.prototype,"v"),Object.defineProperty(Ge.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(Ge.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=Fe.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Xe=function(){function e(t,n){He(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return Be(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),Ye={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},We={};Oe.each(Ye,(function(e,t){Oe.each(e,(function(e){We[e]=t}))}));var qe=/(\d+(\.\d+)?)px/;function Je(e){if("0"===e||Oe.isUndefined(e))return 0;var t=e.match(qe);return Oe.isNull(t)?0:parseFloat(t[1])}var Ze={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,o=t;Oe.isUndefined(o)&&(o=!0),Oe.isUndefined(r)&&(r=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var o=n||{},i=We[t];if(!i)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(i);switch(i){case"MouseEvents":var s=o.x||o.clientX||0,l=o.y||o.clientY||0;a.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=a.initKeyboardEvent||a.initKeyEvent;Oe.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:a.initEvent(t,o.bubbles||!1,o.cancelable||!0);break}Oe.defaults(a,r),e.dispatchEvent(a)},bind:function(e,t,n,r){var o=r||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),Ze},unbind:function(e,t,n,r){var o=r||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),Ze},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Ze},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return Ze},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return Je(t["border-left-width"])+Je(t["border-right-width"])+Je(t["padding-left"])+Je(t["padding-right"])+Je(t.width)},getHeight:function(e){var t=getComputedStyle(e);return Je(t["border-top-width"])+Je(t["border-bottom-width"])+Je(t["padding-top"])+Je(t["padding-bottom"])+Je(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Qe=function(e){function t(e,n){He(this,t);var r=je(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r;function i(){o.setValue(!o.__prev)}return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),Ze.bind(r.__checkbox,"change",i,!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return Ue(t,e),Be(t,[{key:"setValue",value:function(e){var n=Ve(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Ve(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Xe),$e=function(e){function t(e,n,r){He(this,t);var o=je(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r,a=o;if(o.__select=document.createElement("select"),Oe.isArray(i)){var s={};Oe.each(i,(function(e){s[e]=e})),i=s}return Oe.each(i,(function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),a.__select.appendChild(n)})),o.updateDisplay(),Ze.bind(o.__select,"change",(function(){var e=this.options[this.selectedIndex].value;a.setValue(e)})),o.domElement.appendChild(o.__select),o}return Ue(t,e),Be(t,[{key:"setValue",value:function(e){var n=Ve(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return Ze.isActive(this.__select)?this:(this.__select.value=this.getValue(),Ve(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(Xe),et=function(e){function t(e,n){He(this,t);var r=je(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r;function i(){o.setValue(o.__input.value)}function a(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),Ze.bind(r.__input,"keyup",i),Ze.bind(r.__input,"change",i),Ze.bind(r.__input,"blur",a),Ze.bind(r.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return Ue(t,e),Be(t,[{key:"updateDisplay",value:function(){return Ze.isActive(this.__input)||(this.__input.value=this.getValue()),Ve(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(Xe);function tt(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var nt=function(e){function t(e,n,r){He(this,t);var o=je(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r||{};return o.__min=i.min,o.__max=i.max,o.__step=i.step,Oe.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=tt(o.__impliedStep),o}return Ue(t,e),Be(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!==0&&(n=Math.round(n/this.__step)*this.__step),Ve(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=tt(e),this}}]),t}(Xe);function rt(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var ot=function(e){function t(e,n,r){He(this,t);var o=je(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));o.__truncationSuspended=!1;var i=o,a=void 0;function s(){var e=parseFloat(i.__input.value);Oe.isNaN(e)||i.setValue(e)}function l(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}function c(){l()}function u(e){var t=a-e.clientY;i.setValue(i.getValue()+t*i.__impliedStep),a=e.clientY}function d(){Ze.unbind(window,"mousemove",u),Ze.unbind(window,"mouseup",d),l()}function p(e){Ze.bind(window,"mousemove",u),Ze.bind(window,"mouseup",d),a=e.clientY}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),Ze.bind(o.__input,"change",s),Ze.bind(o.__input,"blur",c),Ze.bind(o.__input,"mousedown",p),Ze.bind(o.__input,"keydown",(function(e){13===e.keyCode&&(i.__truncationSuspended=!0,this.blur(),i.__truncationSuspended=!1,l())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return Ue(t,e),Be(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():rt(this.getValue(),this.__precision),Ve(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(nt);function it(e,t,n,r,o){return r+(e-t)/(n-t)*(o-r)}var at=function(e){function t(e,n,r,o,i){He(this,t);var a=je(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:o,step:i})),s=a;function l(e){document.activeElement.blur(),Ze.bind(window,"mousemove",c),Ze.bind(window,"mouseup",u),c(e)}function c(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(it(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function u(){Ze.unbind(window,"mousemove",c),Ze.unbind(window,"mouseup",u),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function d(e){1===e.touches.length&&(Ze.bind(window,"touchmove",p),Ze.bind(window,"touchend",h),p(e))}function p(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(it(t,n.left,n.right,s.__min,s.__max))}function h(){Ze.unbind(window,"touchmove",p),Ze.unbind(window,"touchend",h),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),Ze.bind(a.__background,"mousedown",l),Ze.bind(a.__background,"touchstart",d),Ze.addClass(a.__background,"slider"),Ze.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return Ue(t,e),Be(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Ve(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(nt),st=function(e){function t(e,n,r){He(this,t);var o=je(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===r?"Fire":r,Ze.bind(o.__button,"click",(function(e){return e.preventDefault(),i.fire(),!1})),Ze.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return Ue(t,e),Be(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(Xe),lt=function(e){function t(e,n){He(this,t);var r=je(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new Ge(r.getValue()),r.__temp=new Ge(0);var o=r;r.domElement=document.createElement("div"),Ze.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",Ze.bind(r.__input,"keydown",(function(e){13===e.keyCode&&u.call(this)})),Ze.bind(r.__input,"blur",u),Ze.bind(r.__selector,"mousedown",(function(){Ze.addClass(this,"drag").bind(window,"mouseup",(function(){Ze.removeClass(o.__selector,"drag")}))})),Ze.bind(r.__selector,"touchstart",(function(){Ze.addClass(this,"drag").bind(window,"touchend",(function(){Ze.removeClass(o.__selector,"drag")}))}));var i=document.createElement("div");function a(e){p(e),Ze.bind(window,"mousemove",p),Ze.bind(window,"touchmove",p),Ze.bind(window,"mouseup",l),Ze.bind(window,"touchend",l)}function s(e){h(e),Ze.bind(window,"mousemove",h),Ze.bind(window,"touchmove",h),Ze.bind(window,"mouseup",c),Ze.bind(window,"touchend",c)}function l(){Ze.unbind(window,"mousemove",p),Ze.unbind(window,"touchmove",p),Ze.unbind(window,"mouseup",l),Ze.unbind(window,"touchend",l),d()}function c(){Ze.unbind(window,"mousemove",h),Ze.unbind(window,"touchmove",h),Ze.unbind(window,"mouseup",c),Ze.unbind(window,"touchend",c),d()}function u(){var e=De(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function d(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function p(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,i=n.clientY,a=(r-t.left)/(t.right-t.left),s=1-(i-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),o.__color.v=s,o.__color.s=a,o.setValue(o.__color.toOriginal()),!1}function h(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientY,i=1-(r-t.top)/(t.bottom-t.top);return i>1?i=1:i<0&&(i=0),o.__color.h=360*i,o.setValue(o.__color.toOriginal()),!1}return Oe.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Oe.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Oe.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Oe.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Oe.extend(i.style,{width:"100%",height:"100%",background:"none"}),ut(i,"top","rgba(0,0,0,0)","#000"),Oe.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),dt(r.__hue_field),Oe.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),Ze.bind(r.__saturation_field,"mousedown",a),Ze.bind(r.__saturation_field,"touchstart",a),Ze.bind(r.__field_knob,"mousedown",a),Ze.bind(r.__field_knob,"touchstart",a),Ze.bind(r.__hue_field,"mousedown",s),Ze.bind(r.__hue_field,"touchstart",s),r.__saturation_field.appendChild(i),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return Ue(t,e),Be(t,[{key:"updateDisplay",value:function(){var e=De(this.getValue());if(!1!==e){var t=!1;Oe.each(Ge.COMPONENTS,(function(n){if(!Oe.isUndefined(e[n])&&!Oe.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}}),this),t&&Oe.extend(this.__color.__state,e)}Oe.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;Oe.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,ut(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Oe.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(Xe),ct=["-moz-","-o-","-webkit-","-ms-",""];function ut(e,t,n,r){e.style.background="",Oe.each(ct,(function(o){e.style.cssText+="background: "+o+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "}))}function dt(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var pt={load:function(e,t){var n=t||document,r=n.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,n.getElementsByTagName("head")[0].appendChild(r)},inject:function(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var o=n.getElementsByTagName("head")[0];try{o.appendChild(r)}catch(i){}}},ht='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',ft=function(e,t){var n=e[t];return Oe.isArray(arguments[2])||Oe.isObject(arguments[2])?new $e(e,t,arguments[2]):Oe.isNumber(n)?Oe.isNumber(arguments[2])&&Oe.isNumber(arguments[3])?Oe.isNumber(arguments[4])?new at(e,t,arguments[2],arguments[3],arguments[4]):new at(e,t,arguments[2],arguments[3]):Oe.isNumber(arguments[4])?new ot(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ot(e,t,{min:arguments[2],max:arguments[3]}):Oe.isString(n)?new et(e,t):Oe.isFunction(n)?new st(e,t,""):Oe.isBoolean(n)?new Qe(e,t):null};function mt(e){setTimeout(e,1e3/60)}var gt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||mt,vt=function(){function e(){He(this,e),this.backgroundElement=document.createElement("div"),Oe.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Ze.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Oe.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;Ze.bind(this.backgroundElement,"click",(function(){t.hide()}))}return Be(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Oe.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",Ze.unbind(e.domElement,"webkitTransitionEnd",t),Ze.unbind(e.domElement,"transitionend",t),Ze.unbind(e.domElement,"oTransitionEnd",t)};Ze.bind(this.domElement,"webkitTransitionEnd",t),Ze.bind(this.domElement,"transitionend",t),Ze.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Ze.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Ze.getHeight(this.domElement)/2+"px"}}]),e}(),_t=Ae(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");pt.inject(_t);var bt="dg",yt=72,wt=20,St="Default",xt=function(){try{return!!window.localStorage}catch(e){return!1}}(),Et=void 0,Lt=!0,At=void 0,Tt=!1,Mt=[],Rt=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Ze.addClass(this.domElement,bt),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=Oe.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=Oe.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),Oe.isUndefined(r.load)?r.load={preset:St}:r.preset&&(r.load.preset=r.preset),Oe.isUndefined(r.parent)&&r.hideable&&Mt.push(this),r.resizable=Oe.isUndefined(r.parent)&&r.resizable,r.autoPlace&&Oe.isUndefined(r.scrollable)&&(r.scrollable=!0);var o=xt&&"true"===localStorage.getItem(Ft(this,"isLocal")),i=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,Gt(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,Ut(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,a&&(a.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?Ze.addClass(n.__ul,e.CLASS_CLOSED):Ze.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return o},set:function(e){xt&&(o=e,e?Ze.bind(window,"unload",i):Ze.unbind(window,"unload",i),localStorage.setItem(Ft(n,"isLocal"),e))}}}),Oe.isUndefined(r.parent)){if(this.closed=r.closed||!1,Ze.addClass(this.domElement,e.CLASS_MAIN),Ze.makeSelectable(this.domElement,!1),xt&&o){n.useLocalStorage=!0;var s=localStorage.getItem(Ft(this,"gui"));s&&(r.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,Ze.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(Ze.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Ze.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Ze.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===r.closed&&(r.closed=!0);var l=document.createTextNode(r.name);Ze.addClass(l,"controller-name"),a=Ot(n,l);var c=function(e){return e.preventDefault(),n.closed=!n.closed,!1};Ze.addClass(this.__ul,e.CLASS_CLOSED),Ze.addClass(a,"title"),Ze.bind(a,"click",c),r.closed||(this.closed=!1)}function u(){var e=n.getRoot();e.width+=1,Oe.defer((function(){e.width-=1}))}r.autoPlace&&(Oe.isUndefined(r.parent)&&(Lt&&(At=document.createElement("div"),Ze.addClass(At,bt),Ze.addClass(At,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(At),Lt=!1),At.appendChild(this.domElement),Ze.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||Ut(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},Ze.bind(window,"resize",this.__resizeHandler),Ze.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Ze.bind(this.__ul,"transitionend",this.__resizeHandler),Ze.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&Vt(this),i=function(){xt&&"true"===localStorage.getItem(Ft(n,"isLocal"))&&localStorage.setItem(Ft(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=i,r.parent||u()};function Ot(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function Ct(e){Ze.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&Ze.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Nt(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function kt(e,t,n){if(n.__li=t,n.__gui=e,Oe.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),Pt(e,n.object,n.property,{before:r,factoryArgs:[Oe.toArray(arguments)]})}if(Oe.isArray(t)||Oe.isObject(t)){var o=n.__li.nextElementSibling;return n.remove(),Pt(e,n.object,n.property,{before:o,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof at){var r=new ot(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});Oe.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=n[e],o=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(r,e),t.apply(n,e)}})),Ze.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof ot){var o=function(t){if(Oe.isNumber(n.__min)&&Oe.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var i=Pt(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return i.name(r),o&&i.listen(),i}return t};n.min=Oe.compose(o,n.min),n.max=Oe.compose(o,n.max)}else n instanceof Qe?(Ze.bind(t,"click",(function(){Ze.fakeEvent(n.__checkbox,"click")})),Ze.bind(n.__checkbox,"click",(function(e){e.stopPropagation()}))):n instanceof st?(Ze.bind(t,"click",(function(){Ze.fakeEvent(n.__button,"click")})),Ze.bind(t,"mouseover",(function(){Ze.addClass(n.__button,"hover")})),Ze.bind(t,"mouseout",(function(){Ze.removeClass(n.__button,"hover")}))):n instanceof lt&&(Ze.addClass(t,"color"),n.updateDisplay=Oe.compose((function(e){return t.style.borderLeftColor=n.__color.toString(),e}),n.updateDisplay),n.updateDisplay());n.setValue=Oe.compose((function(t){return e.getRoot().__preset_select&&n.isModified()&&Nt(e.getRoot(),!0),t}),n.setValue)}function Dt(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var o=n.__rememberedObjectIndecesToControllers[r];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[r]=o),o[t.property]=t,n.load&&n.load.remembered){var i=n.load.remembered,a=void 0;if(i[e.preset])a=i[e.preset];else{if(!i[St])return;a=i[St]}if(a[r]&&void 0!==a[r][t.property]){var s=a[r][t.property];t.initialValue=s,t.setValue(s)}}}}function Pt(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var o=void 0;if(r.color)o=new lt(t,n);else{var i=[t,n].concat(r.factoryArgs);o=ft.apply(e,i)}r.before instanceof Xe&&(r.before=r.before.__li),Dt(e,o),Ze.addClass(o.domElement,"c");var a=document.createElement("span");Ze.addClass(a,"property-name"),a.innerHTML=o.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(o.domElement);var l=Ot(e,s,r.before);return Ze.addClass(l,Rt.CLASS_CONTROLLER_ROW),o instanceof lt?Ze.addClass(l,"color"):Ze.addClass(l,Ie(o.getValue())),kt(e,l,o),e.__controllers.push(o),o}function Ft(e,t){return document.location.href+"."+t}function It(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Ht(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Bt(e){var t=e.__save_row=document.createElement("li");Ze.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),Ze.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",Ze.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",Ze.addClass(r,"button"),Ze.addClass(r,"save");var o=document.createElement("span");o.innerHTML="New",Ze.addClass(o,"button"),Ze.addClass(o,"save-as");var i=document.createElement("span");i.innerHTML="Revert",Ze.addClass(i,"button"),Ze.addClass(i,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?Oe.each(e.load.remembered,(function(t,n){It(e,n,n===e.preset)})):It(e,St,!1),Ze.bind(a,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(a),t.appendChild(n),t.appendChild(r),t.appendChild(o),t.appendChild(i),xt){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block","true"===localStorage.getItem(Ft(e,"isLocal"))&&l.setAttribute("checked","checked"),Ht(e,s),Ze.bind(l,"change",(function(){e.useLocalStorage=!e.useLocalStorage,Ht(e,s)}))}var u=document.getElementById("dg-new-constructor");Ze.bind(u,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Et.hide()})),Ze.bind(n,"click",(function(){u.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Et.show(),u.focus(),u.select()})),Ze.bind(r,"click",(function(){e.save()})),Ze.bind(o,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),Ze.bind(i,"click",(function(){e.revert()}))}function Vt(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){Ze.removeClass(e.__closeButton,Rt.CLASS_DRAG),Ze.unbind(window,"mousemove",n),Ze.unbind(window,"mouseup",r)}function o(o){return o.preventDefault(),t=o.clientX,Ze.addClass(e.__closeButton,Rt.CLASS_DRAG),Ze.bind(window,"mousemove",n),Ze.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),Oe.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Ze.bind(e.__resize_handle,"mousedown",o),Ze.bind(e.__closeButton,"mousedown",o),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function Ut(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function jt(e,t){var n={};return Oe.each(e.__rememberedObjects,(function(r,o){var i={},a=e.__rememberedObjectIndecesToControllers[o];Oe.each(a,(function(e,n){i[n]=t?e.initialValue:e.getValue()})),n[o]=i})),n}function Gt(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function zt(e){0!==e.length&&gt.call(window,(function(){zt(e)})),Oe.each(e,(function(e){e.updateDisplay()}))}Rt.toggleHide=function(){Tt=!Tt,Oe.each(Mt,(function(e){e.domElement.style.display=Tt?"none":""}))},Rt.CLASS_AUTO_PLACE="a",Rt.CLASS_AUTO_PLACE_CONTAINER="ac",Rt.CLASS_MAIN="main",Rt.CLASS_CONTROLLER_ROW="cr",Rt.CLASS_TOO_TALL="taller-than-window",Rt.CLASS_CLOSED="closed",Rt.CLASS_CLOSE_BUTTON="close-button",Rt.CLASS_CLOSE_TOP="close-top",Rt.CLASS_CLOSE_BOTTOM="close-bottom",Rt.CLASS_DRAG="drag",Rt.DEFAULT_WIDTH=245,Rt.TEXT_CLOSED="Close Controls",Rt.TEXT_OPEN="Open Controls",Rt._keydownHandler=function(e){"text"===document.activeElement.type||e.which!==yt&&e.keyCode!==yt||Rt.toggleHide()},Ze.bind(window,"keydown",Rt._keydownHandler,!1),Oe.extend(Rt.prototype,{add:function(e,t){return Pt(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Pt(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Oe.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&At.removeChild(this.domElement);var e=this;Oe.each(this.__folders,(function(t){e.removeFolder(t)})),Ze.unbind(window,"keydown",Rt._keydownHandler,!1),Ct(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Rt(t);this.__folders[e]=n;var r=Ot(this,n.domElement);return Ze.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],Ct(e);var t=this;Oe.each(e.__folders,(function(t){e.removeFolder(t)})),Oe.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=Ze.getOffset(e.__ul).top,n=0;Oe.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(n+=Ze.getHeight(t))})),window.innerHeight-t-wt<n?(Ze.addClass(e.domElement,Rt.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-wt+"px"):(Ze.removeClass(e.domElement,Rt.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Oe.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Oe.debounce((function(){this.onResize()}),50),remember:function(){if(Oe.isUndefined(Et)&&(Et=new vt,Et.domElement.innerHTML=ht),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Oe.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&Bt(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&Ut(this,this.width)},getRoot:function(){var e=this;while(e.parent)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=jt(this)),e.folders={},Oe.each(this.__folders,(function(t,n){e.folders[n]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=jt(this),Nt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[St]=jt(this,!0)),this.load.remembered[e]=jt(this),this.preset=e,It(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Oe.each(this.__controllers,(function(t){this.getRoot().load.remembered?Dt(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),Oe.each(this.__folders,(function(e){e.revert(e)})),e||Nt(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&zt(this.__listening)},updateDisplay:function(){Oe.each(this.__controllers,(function(e){e.updateDisplay()})),Oe.each(this.__folders,(function(e){e.updateDisplay()}))}});var Kt=Rt,Xt=function(){function e(t,n,r){Object(a["a"])(this,e),this.gltf=n,this.gltfScene=n.scene,this.clock=new l["Clock"],this.animationMixer=null,this.debug=!1,this.program=new de,this.isMobile=Ee(),this.envRotation=0,this.envRotationMat={value:(new l["Matrix4"]).makeRotationY(this.envRotation)},this.envBrightness={value:1},this.renderer=t.renderer,this.renderer.toneMapping=l["".concat(_e[0],"ToneMapping")],this.scene=t.scene,this.camera=t.camera,this.container=t.container,this.width=t.width,this.height=t.height,this.callBack=r,this.control=new u(this.camera,this.container),this.initScene()}return Object(s["a"])(e,[{key:"loadEnvMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:he[0],t="".concat(pe).concat(e,"/");return new I(this).loadPackage(t)}},{key:"loadSunLight",value:function(e){this.sunLight||(this.sunLight=new l["DirectionalLight"](16777215,1)),this.sunLight.position.copy(e.position),this.sunLight.castShadow=!0,this.scene.add(this.sunLight)}},{key:"loadBackground",value:function(e,t){this.background?(this.background.material.uniforms.envMap.value=e.texture,this.background.material.uniforms.uEnvironmentSize.value=t):(this.background=new J({envMap:e.texture,uBGEnvironmentSize:t,uEnvBrightness:this.envBrightness,debug:this.debug},500),this.background.material.uniforms.uEnvironmentTransform=this.envRotationMat)}},{key:"updateEnvMap",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t,n){var r,o,i,a,s,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadEnvMap(t);case 2:r=e.sent,o=r.mapEnv,i=r.backgroundEnv,a=r.uEnvironmentSphericalHarmonics,s=r.uEnvironmentLodRange,l=r.uEnvironmentSize,c=r.uBGEnvironmentSize,u=r.sunlightInfo,this.loadSunLight(u),this.sunLightStartPos=this.sunLight.position.clone(),this.loadBackground(i,c),this.gltfScene.traverse((function(e){e.isMesh&&(e.material.uniforms.envMap.value=o.texture,e.material.uniforms["uEnvironmentSphericalHarmonics"]={value:a},e.material.uniforms["uEnvironmentLodRange"]={value:s},e.material.uniforms["uEnvironmentSize"]={value:l},e.material.needsUpdate=!0)})),"function"==typeof n&&n();case 9:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"initScene",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,n,r,o,i,a,s,c,u,d,p,h,f,m,g=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadEnvMap();case 2:if(t=e.sent,n=t.backgroundEnv,r=t.uBGEnvironmentSize,o=t.sunlightInfo,i=this.scene,this.loadSunLight(o),this.loadBackground(n,r),i.add(this.background),a=this.gltfScene,s=this.gltf.animations,s&&s.length)for(this.animationMixer=new l["AnimationMixer"](a),c=0;c<s.length;c++)u=s[c],d=this.animationMixer.clipAction(u),d.play();i.add(a),this.adjustFactorFromBox(a),p=this.program.getPBRShader(),h=p.pbrVS,f=p.pbrFS,m=this.shadowDepthRange=new l["Vector2"](this.sunLight.shadow.camera.near,this.sunLight.shadow.camera.far),a.traverse((function(e){e.isMesh&&(e.material=new X(e,t,{pbrVS:h,pbrFS:f,shadowDepthRange:m}),e.material.uniforms.uEnvironmentTransform=g.envRotationMat,e.material.uniforms.uEnvBrightness=g.envBrightness,e.castShadow=!0,e.receiveShadow=!0,e.material.uniforms.uEnableIBL=g.enableIBL,e.material.uniforms.uEnableLight=g.enableLight)})),this.initEvent(),this.initGUI(),"function"===typeof this.callBack&&this.callBack();case 19:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"adjustFactorFromBox",value:function(e){var t=this.box=(new l["Box3"]).setFromObject(e),n=t.getSize(new l["Vector3"]),r=Math.max(n.x,n.y,n.z);if(r<100){var o=100/r;e.scale.setScalar(o)}t=this.box=(new l["Box3"]).setFromObject(e);var i=t.getCenter(new l["Vector3"]);if(e.position.sub(i),this.debug){var a=new l["BoxHelper"](e,16776960);this.scene.add(a)}ye(this.camera,e,this.control,2),this.background.setSize(this.camera.far),we(this.sunLight,this.scene,e,this.debug),this.sunLightStartPos=this.sunLight.position.clone()}},{key:"initEvent",value:function(){var e=this,t={x:0};window.addEventListener("mousemove",(function(n){var r=n.which||n.button;if(n.altKey&&r){n.stopPropagation();var o=n.clientX-t.x;e.envRotation+=.01*o}t.x=n.clientX}),!0)}},{key:"initGUI",value:function(){var e=this,t=new Kt,n=this.gltfScene,r=this.guiParams={enableIBL:!!K.ENABLE_IBL,enableLight:!!K.ENABLE_LIGHT,envRotation:this.envRotation,envBrightness:this.envBrightness.value,envMap:he[0],metalness:0,roughness:.5,diffuseEquation:fe[0],specularFresnelEquation:me[0],specularNDFEquation:ge[0],specularVisEquation:ve[0],enableCompensation:!!K.ENERGY_COMPENSATION,specularAO:be[0],toneMapping:_e[0]},o=t.addFolder("PBR");o.add(r,"enableIBL").onChange((function(t){e.guiParams.enableIBL=t,e.reCompileShader()})),o.add(r,"enableLight").name("enableSunLight").onChange((function(t){e.guiParams.enableLight=t,e.reCompileShader()})),o.add(r,"envMap",he).onChange((function(t){document.querySelector("#wrapper").classList.add("isLoading"),e.updateEnvMap(t,(function(){document.querySelector("#wrapper").classList.remove("isLoading")}))})),o.add(r,"envRotation",-Math.PI,Math.PI).step(.1).onChange((function(t){e.envRotation=t})),o.add(r,"envBrightness",0,2).step(.1).onChange((function(t){e.envBrightness.value=t})),o.add(r,"metalness",0,1).step(.01).onChange((function(e){n.traverse((function(t){t.isMesh&&(t.material.uniforms.metalness.value=e)}))})),o.add(r,"roughness",0,1).step(.01).onChange((function(e){n.traverse((function(t){t.isMesh&&(t.material.uniforms.roughness.value=e)}))})),o.open();var i=t.addFolder("Equations");i.add(r,"diffuseEquation",fe).name("diffuse").onChange((function(t){e.guiParams.diffuseEquation=t,e.reCompileShader()})),i.add(r,"specularFresnelEquation",me).name("fresnel").onChange((function(t){e.guiParams.specularFresnelEquation=t,e.reCompileShader()})),i.add(r,"specularNDFEquation",ge).name("NDF").onChange((function(t){e.guiParams.specularNDFEquation=t,e.reCompileShader()})),i.add(r,"specularVisEquation",ve).name("geometry").onChange((function(t){e.guiParams.specularVisEquation=t,e.reCompileShader()})),i.open();var a=t.addFolder("Advance");a.add(r,"enableCompensation").name("compensation").onChange((function(t){e.guiParams.enableCompensation=t,e.reCompileShader()})),a.add(r,"specularAO",be).onChange((function(t){e.guiParams.specularAO=t,e.reCompileShader()}));var s=t.addFolder("Post-Processing");s.add(r,"toneMapping",_e).onChange((function(t){e.renderer.toneMapping=l["".concat(t,"ToneMapping")],e.reCompileShader(!0)}))}},{key:"setDefinesFromGUI",value:function(e){var t=this.guiParams,n=/(ENABLE_IBL)|(ENABLE_LIGHT)|(ENERGY_COMPENSATION)|(DIFFUSE_*)|(F_*)|(NDF_*)|(V_*)|(SPECULAR_AO_*)/;return Object.keys(e).map((function(t){n.test(t)&&delete e[t]})),t.enableIBL&&(e.ENABLE_IBL=1),t.enableLight&&(e.ENABLE_LIGHT=1),t.enableCompensation&&(e.ENERGY_COMPENSATION=1),e["DIFFUSE_".concat(t.diffuseEquation.toUpperCase())]=1,e["F_".concat(t.specularFresnelEquation.toUpperCase())]=1,e["NDF_".concat(t.specularNDFEquation.toUpperCase())]=1,e["V_".concat(t.specularVisEquation.toUpperCase())]=1,e["SPECULAR_AO_".concat(t.specularAO.toUpperCase())]=1,e}},{key:"reCompileShader",value:function(e){var t=this;this.gltfScene.traverse((function(e){e.isMesh&&e.material&&(t.setDefinesFromGUI(e.material.defines),e.material.needsUpdate=!0)})),e&&(this.background.material.needsUpdate=!0)}},{key:"updateEnvironmentRotation",value:function(e){this.envRotationMat.value.makeRotationY(e);var t=this.sunLightStartPos.clone();t.applyMatrix4(this.envRotationMat.value),this.sunLight.position.copy(t)}},{key:"update",value:function(){this.updateEnvironmentRotation(this.envRotation),this.animationMixer&&this.animationMixer.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera)}}]),e}(),Yt=function(){function e(t,n,r){Object(a["a"])(this,e),this.container=t,this.time=0,this.width=Se(t),this.height=xe(t);var o=this.camera=new l["PerspectiveCamera"](45,this.width/this.height,.1,1e3);o.position.set(0,0,10);var i=this.renderer=new l["WebGLRenderer"]({antialias:!1});i.domElement.id="canvasWebGL",i.setPixelRatio(window.devicePixelRatio),i.setSize(this.width,this.height),i.setClearColor(16777215,1),i.shadowMap.enabled=!0,i.gammaFactor=2.2,i.outputEncoding=l["sRGBEncoding"],t.appendChild(i.domElement),this.initScene(n,r),this.initEvents()}return Object(s["a"])(e,[{key:"initScene",value:function(e,t){var n=this;this.scene=new l["Scene"],this.modelViewer=new Xt(this,e,(function(){n.loaded=!0,n.onWindowResize(),"function"===typeof t&&t()})),this.animete()}},{key:"initEvents",value:function(){window.addEventListener("resize",this.onWindowResize.bind(this),!1)}},{key:"onWindowResize",value:function(){this.width=Se(this.container),this.height=xe(this.container),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height)}},{key:"animete",value:function(){this.loaded&&this.modelViewer.update(),requestAnimationFrame(this.animete.bind(this))}}]),e}(),Wt=(n("a630"),n("3835")),qt=(n("4e82"),n("b420"),n("38cf"),n("fd87"),n("8b09"),n("84c3"),n("fb2c"),function(){function e(e){l["Loader"].call(this,e),this.dracoLoader=null,this.ddsLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(l["Loader"].prototype),{constructor:e,load:function(e,t,n,r){var o,i=this;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:l["LoaderUtils"].extractUrlBase(e),i.manager.itemStart(e);var a=function(t){r?r(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},s=new l["FileLoader"](i.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===i.crossOrigin&&s.setWithCredentials(!0),s.load(e,(function(n){try{i.parse(n,o,(function(n){t(n),i.manager.itemEnd(e)}),a)}catch(r){a(r)}}),n,a)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,c,u){var f,v={};if("string"===typeof e)f=e;else{var _=l["LoaderUtils"].decodeText(new Uint8Array(e,0,4));if(_===s){try{v[n.KHR_BINARY_GLTF]=new d(e)}catch(E){return void(u&&u(E))}f=v[n.KHR_BINARY_GLTF].content}else f=l["LoaderUtils"].decodeText(new Uint8Array(e))}var b=JSON.parse(f);if(void 0===b.asset||b.asset.version[0]<2)u&&u(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(b.extensionsUsed)for(var y=0;y<b.extensionsUsed.length;++y){var w=b.extensionsUsed[y],S=b.extensionsRequired||[];switch(w){case n.KHR_LIGHTS_PUNCTUAL:v[w]=new o(b);break;case n.KHR_MATERIALS_CLEARCOAT:v[w]=new a;break;case n.KHR_MATERIALS_UNLIT:v[w]=new i;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:v[w]=new m;break;case n.KHR_DRACO_MESH_COMPRESSION:v[w]=new p(b,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:v[w]=new r(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:v[w]=new h;break;case n.KHR_MESH_QUANTIZATION:v[w]=new g;break;default:S.indexOf(w)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+w+'".')}}var x=new F(b,v,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});x.parse(c,u)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=e}function o(e){this.name=n.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[n.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function i(){this.name=n.KHR_MATERIALS_UNLIT}function a(){this.name=n.KHR_MATERIALS_CLEARCOAT}o.prototype.loadLight=function(e){var t,n=this.lightDefs[e],r=new l["Color"](16777215);void 0!==n.color&&r.fromArray(n.color);var o=void 0!==n.range?n.range:0;switch(n.type){case"directional":t=new l["DirectionalLight"](r),t.target.position.set(0,0,-1),t.add(t.target);break;case"point":t=new l["PointLight"](r),t.distance=o;break;case"spot":t=new l["SpotLight"](r),t.distance=o,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,t.angle=n.spot.outerConeAngle,t.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==n.intensity&&(t.intensity=n.intensity),t.name=n.name||"light_"+e,Promise.resolve(t)},i.prototype.getMaterialType=function(){return l["MeshBasicMaterial"]},i.prototype.extendParams=function(e,t,n){var r=[];e.color=new l["Color"](1,1,1),e.opacity=1;var o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){var i=o.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}void 0!==o.baseColorTexture&&r.push(n.assignTexture(e,"map",o.baseColorTexture))}return Promise.all(r)},a.prototype.getMaterialType=function(){return l["MeshPhysicalMaterial"]},a.prototype.extendParams=function(e,t,n){var r=[],o=t.extensions[this.name];if(void 0!==o.clearcoatFactor&&(e.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&r.push(n.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&r.push(n.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(r.push(n.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var i=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new l["Vector2"](i,i)}return Promise.all(r)};var s="glTF",c=12,u={JSON:1313821514,BIN:5130562};function d(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,c);if(this.header={magic:l["LoaderUtils"].decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==s)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var r=new DataView(e,c),o=0;while(o<r.byteLength){var i=r.getUint32(o,!0);o+=4;var a=r.getUint32(o,!0);if(o+=4,a===u.JSON){var d=new Uint8Array(e,c+o,i);this.content=l["LoaderUtils"].decodeText(d)}else if(a===u.BIN){var p=c+o;this.body=e.slice(p,p+i)}o+=i}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function p(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function h(){this.name=n.KHR_TEXTURE_TRANSFORM}function f(e){l["MeshStandardMaterial"].call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),i=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),a={specular:{value:(new l["Color"]).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(var s in a)e.uniforms[s]=a[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",t),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",o),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",i)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function m(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return f},extendParams:function(e,t,n){var r=t.extensions[this.name];e.color=new l["Color"](1,1,1),e.opacity=1;var o=[];if(Array.isArray(r.diffuseFactor)){var i=r.diffuseFactor;e.color.fromArray(i),e.opacity=i[3]}if(void 0!==r.diffuseTexture&&o.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new l["Color"](0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new l["Color"](1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var a=r.specularGlossinessTexture;o.push(n.assignTexture(e,"glossinessMap",a)),o.push(n.assignTexture(e,"specularMap",a))}return Promise.all(o)},createMaterial:function(e){var t=new f(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=l["TangentSpaceNormalMap"],e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function g(){this.name=n.KHR_MESH_QUANTIZATION}function v(e,t,n,r){l["Interpolant"].call(this,e,t,n,r)}p.prototype.decodePrimitive=function(e,t){var n=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,a={},s={},l={};for(var c in i){var u=x[c]||c.toLowerCase();a[u]=i[c]}for(c in e.attributes){u=x[c]||c.toLowerCase();if(void 0!==i[c]){var d=n.accessors[e.attributes[c]],p=b[d.componentType];l[u]=p,s[u]=!0===d.normalized}}return t.getDependency("bufferView",o).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],o=s[n];void 0!==o&&(r.normalized=o)}t(e)}),a,l)}))}))},h.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},f.prototype=Object.create(l["MeshStandardMaterial"].prototype),f.prototype.constructor=f,f.prototype.copy=function(e){return l["MeshStandardMaterial"].prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},v.prototype=Object.create(l["Interpolant"].prototype),v.prototype.constructor=v,v.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=e*r*3+r,i=0;i!==r;i++)t[i]=n[o+i];return t},v.prototype.beforeStart_=v.prototype.copySampleValue_,v.prototype.afterEnd_=v.prototype.copySampleValue_,v.prototype.interpolate_=function(e,t,n,r){for(var o=this.resultBuffer,i=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=r-t,u=(n-t)/c,d=u*u,p=d*u,h=e*l,f=h-l,m=-2*p+3*d,g=p-d,v=1-m,_=g-d+u,b=0;b!==a;b++){var y=i[f+b+a],w=i[f+b+s]*c,S=i[h+b+a],x=i[h+b]*c;o[b]=v*y+_*w+m*S+g*x}return o};var _={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},b={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},y={9728:l["NearestFilter"],9729:l["LinearFilter"],9984:l["NearestMipmapNearestFilter"],9985:l["LinearMipmapNearestFilter"],9986:l["NearestMipmapLinearFilter"],9987:l["LinearMipmapLinearFilter"]},w={33071:l["ClampToEdgeWrapping"],33648:l["MirroredRepeatWrapping"],10497:l["RepeatWrapping"]},S={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},x={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},E={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},L={CUBICSPLINE:void 0,LINEAR:l["InterpolateLinear"],STEP:l["InterpolateDiscrete"]},A={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},T={"image/png":l["RGBAFormat"],"image/jpeg":l["RGBFormat"]};function M(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function R(e){return void 0===e["DefaultMaterial"]&&(e["DefaultMaterial"]=new l["MeshStandardMaterial"]({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:l["FrontSide"]})),e["DefaultMaterial"]}function O(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function C(e,t){void 0!==t.extras&&("object"===Object(Le["a"])(t.extras)?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function N(e,t,n){for(var r=!1,o=!1,i=0,a=t.length;i<a;i++){var s=t[i];if(void 0!==s.POSITION&&(r=!0),void 0!==s.NORMAL&&(o=!0),r&&o)break}if(!r&&!o)return Promise.resolve(e);var l=[],c=[];for(i=0,a=t.length;i<a;i++){s=t[i];if(r){var u=void 0!==s.POSITION?n.getDependency("accessor",s.POSITION):e.attributes.position;l.push(u)}if(o){u=void 0!==s.NORMAL?n.getDependency("accessor",s.NORMAL):e.attributes.normal;c.push(u)}}return Promise.all([Promise.all(l),Promise.all(c)]).then((function(t){var n=t[0],i=t[1];return r&&(e.morphAttributes.position=n),o&&(e.morphAttributes.normal=i),e.morphTargetsRelative=!0,e}))}function k(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var o=t.extras.targetNames;if(e.morphTargetInfluences.length===o.length){e.morphTargetDictionary={};for(n=0,r=o.length;n<r;n++)e.morphTargetDictionary[o[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function D(e){var t,r=e.extensions&&e.extensions[n.KHR_DRACO_MESH_COMPRESSION];return t=r?"draco:"+r.bufferView+":"+r.indices+":"+P(r.attributes):e.indices+":"+P(e.attributes)+":"+e.mode,t}function P(e){for(var t="",n=Object.keys(e).sort(),r=0,o=n.length;r<o;r++)t+=n[r]+":"+e[n[r]]+";";return t}function F(e,n,r){this.json=e||{},this.extensions=n||{},this.options=r||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new l["TextureLoader"](this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new l["FileLoader"](this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function I(e,t,n){var r=t.attributes,o=new l["Box3"];if(void 0!==r.POSITION){var i=n.json.accessors[r.POSITION],a=i.min,s=i.max;if(void 0!==a&&void 0!==s){o.set(new l["Vector3"](a[0],a[1],a[2]),new l["Vector3"](s[0],s[1],s[2]));var c=t.targets;if(void 0!==c){for(var u=new l["Vector3"],d=new l["Vector3"],p=0,h=c.length;p<h;p++){var f=c[p];if(void 0!==f.POSITION){i=n.json.accessors[f.POSITION],a=i.min,s=i.max;void 0!==a&&void 0!==s?(d.setX(Math.max(Math.abs(a[0]),Math.abs(s[0]))),d.setY(Math.max(Math.abs(a[1]),Math.abs(s[1]))),d.setZ(Math.max(Math.abs(a[2]),Math.abs(s[2]))),u.max(d)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(u)}e.boundingBox=o;var m=new l["Sphere"];o.getCenter(m.center),m.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}function H(e,t,n){var r=t.attributes,o=[];function i(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var a in r){var s=x[a]||a.toLowerCase();s in e.attributes||o.push(i(r[a],s))}if(void 0!==t.indices&&!e.index){var l=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));o.push(l)}return C(e,t),I(e,t,n),Promise.all(o).then((function(){return void 0!==t.targets?N(e,t.targets,n):e}))}function B(e,t){var n=e.getIndex();if(null===n){var r=[],o=e.getAttribute("position");if(void 0===o)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<o.count;i++)r.push(i);e.setIndex(r),n=e.getIndex()}var a=n.count-2,s=[];if(t===l["TriangleFanDrawMode"])for(i=1;i<=a;i++)s.push(n.getX(0)),s.push(n.getX(i)),s.push(n.getX(i+1));else for(i=0;i<a;i++)i%2===0?(s.push(n.getX(i)),s.push(n.getX(i+1)),s.push(n.getX(i+2))):(s.push(n.getX(i+2)),s.push(n.getX(i+1)),s.push(n.getX(i)));s.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=e.clone();return c.setIndex(s),c}return F.prototype.parse=function(e,t){var n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var i={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};O(o,i,r),C(i,r),e(i)}))["catch"](t)},F.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r={},o={},i=0,a=t.length;i<a;i++)for(var s=t[i].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var u=0,d=e.length;u<d;u++){var p=e[u];void 0!==p.mesh&&(void 0===r[p.mesh]&&(r[p.mesh]=o[p.mesh]=0),r[p.mesh]++,void 0!==p.skin&&(n[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=o},F.prototype.getDependency=function(e,t){var r=e+":"+t,o=this.cache.get(r);if(!o){switch(e){case"scene":o=this.loadScene(t);break;case"node":o=this.loadNode(t);break;case"mesh":o=this.loadMesh(t);break;case"accessor":o=this.loadAccessor(t);break;case"bufferView":o=this.loadBufferView(t);break;case"buffer":o=this.loadBuffer(t);break;case"material":o=this.loadMaterial(t);break;case"texture":o=this.loadTexture(t);break;case"skin":o=this.loadSkin(t);break;case"animation":o=this.loadAnimation(t);break;case"camera":o=this.loadCamera(t);break;case"light":o=this.extensions[n.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,o)}return o},F.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t},F.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var o=this.options;return new Promise((function(e,n){r.load(M(t.uri,o.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},F.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))},F.prototype.loadAccessor=function(e){var t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var o=[];return void 0!==r.bufferView?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),void 0!==r.sparse&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then((function(e){var o,i,a=e[0],s=S[r.type],c=b[r.componentType],u=c.BYTES_PER_ELEMENT,d=u*s,p=r.byteOffset||0,h=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,f=!0===r.normalized;if(h&&h!==d){var m=Math.floor(p/h),g="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+m+":"+r.count,v=t.cache.get(g);v||(o=new c(a,m*h,r.count*h/u),v=new l["InterleavedBuffer"](o,h/u),t.cache.add(g,v)),i=new l["InterleavedBufferAttribute"](v,s,p%h/u,f)}else o=null===a?new c(r.count*s):new c(a,p,r.count*s),i=new l["BufferAttribute"](o,s,f);if(void 0!==r.sparse){var _=S.SCALAR,y=b[r.sparse.indices.componentType],w=r.sparse.indices.byteOffset||0,x=r.sparse.values.byteOffset||0,E=new y(e[1],w,r.sparse.count*_),L=new c(e[2],x,r.sparse.count*s);null!==a&&(i=new l["BufferAttribute"](i.array.slice(),i.itemSize,i.normalized));for(var A=0,T=E.length;A<T;A++){var M=E[A];if(i.setX(M,L[A*s]),s>=2&&i.setY(M,L[A*s+1]),s>=3&&i.setZ(M,L[A*s+2]),s>=4&&i.setW(M,L[A*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i}))},F.prototype.loadTexture=function(e){var t,r=this,o=this.json,i=this.options,a=this.textureLoader,s=self.URL||self.webkitURL,c=o.textures[e],u=c.extensions||{};t=u[n.MSFT_TEXTURE_DDS]?o.images[u[n.MSFT_TEXTURE_DDS].source]:o.images[c.source];var d=t.uri,p=!1;return void 0!==t.bufferView&&(d=r.getDependency("bufferView",t.bufferView).then((function(e){p=!0;var n=new Blob([e],{type:t.mimeType});return d=s.createObjectURL(n),d}))),Promise.resolve(d).then((function(e){var t=i.manager.getHandler(e);return t||(t=u[n.MSFT_TEXTURE_DDS]?r.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:a),new Promise((function(n,r){t.load(M(e,i.path),n,void 0,r)}))})).then((function(e){!0===p&&s.revokeObjectURL(d),e.flipY=!1,c.name&&(e.name=c.name),t.mimeType in T&&(e.format=T[t.mimeType]);var n=o.samplers||{},r=n[c.sampler]||{};return e.magFilter=y[r.magFilter]||l["LinearFilter"],e.minFilter=y[r.minFilter]||l["LinearMipmapLinearFilter"],e.wrapS=w[r.wrapS]||l["RepeatWrapping"],e.wrapT=w[r.wrapT]||l["RepeatWrapping"],e}))},F.prototype.assignTexture=function(e,t,r){var o=this;return this.getDependency("texture",r.index).then((function(i){if(!i.isCompressedTexture)switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":i.format=l["RGBFormat"];break}if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),o.extensions[n.KHR_TEXTURE_TRANSFORM]){var a=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;a&&(i=o.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(i,a))}e[t]=i}))},F.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,r=void 0!==t.attributes.tangent,o=void 0!==t.attributes.color,i=void 0===t.attributes.normal,a=!0===e.isSkinnedMesh,s=Object.keys(t.morphAttributes).length>0,c=s&&void 0!==t.morphAttributes.normal;if(e.isPoints){var u="PointsMaterial:"+n.uuid,d=this.cache.get(u);d||(d=new l["PointsMaterial"],l["Material"].prototype.copy.call(d,n),d.color.copy(n.color),d.map=n.map,d.sizeAttenuation=!1,this.cache.add(u,d)),n=d}else if(e.isLine){u="LineBasicMaterial:"+n.uuid;var p=this.cache.get(u);p||(p=new l["LineBasicMaterial"],l["Material"].prototype.copy.call(p,n),p.color.copy(n.color),this.cache.add(u,p)),n=p}if(r||o||i||a||s){u="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),a&&(u+="skinning:"),r&&(u+="vertex-tangents:"),o&&(u+="vertex-colors:"),i&&(u+="flat-shading:"),s&&(u+="morph-targets:"),c&&(u+="morph-normals:");var h=this.cache.get(u);h||(h=n.clone(),a&&(h.skinning=!0),r&&(h.vertexTangents=!0),o&&(h.vertexColors=!0),i&&(h.flatShading=!0),s&&(h.morphTargets=!0),c&&(h.morphNormals=!0),this.cache.add(u,h)),n=h}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",new l["BufferAttribute"](t.attributes.uv.array,2)),n.normalScale&&!r&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!r&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),e.material=n},F.prototype.loadMaterial=function(e){var t,r=this,o=this.json,i=this.extensions,a=o.materials[e],s={},c=a.extensions||{},u=[];if(c[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var d=i[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=d.getMaterialType(),u.push(d.extendParams(s,a,r))}else if(c[n.KHR_MATERIALS_UNLIT]){var p=i[n.KHR_MATERIALS_UNLIT];t=p.getMaterialType(),u.push(p.extendParams(s,a,r))}else{t=l["MeshStandardMaterial"];var h=a.pbrMetallicRoughness||{};if(s.color=new l["Color"](1,1,1),s.opacity=1,Array.isArray(h.baseColorFactor)){var m=h.baseColorFactor;s.color.fromArray(m),s.opacity=m[3]}void 0!==h.baseColorTexture&&u.push(r.assignTexture(s,"map",h.baseColorTexture)),s.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,s.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(u.push(r.assignTexture(s,"metalnessMap",h.metallicRoughnessTexture)),u.push(r.assignTexture(s,"roughnessMap",h.metallicRoughnessTexture)))}!0===a.doubleSided&&(s.side=l["DoubleSide"]);var g=a.alphaMode||A.OPAQUE;if(g===A.BLEND?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,g===A.MASK&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==l["MeshBasicMaterial"]&&(u.push(r.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new l["Vector2"](1,1),void 0!==a.normalTexture.scale&&s.normalScale.set(a.normalTexture.scale,a.normalTexture.scale)),void 0!==a.occlusionTexture&&t!==l["MeshBasicMaterial"]&&(u.push(r.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==l["MeshBasicMaterial"]&&(s.emissive=(new l["Color"]).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==l["MeshBasicMaterial"]&&u.push(r.assignTexture(s,"emissiveMap",a.emissiveTexture)),c[n.KHR_MATERIALS_CLEARCOAT]){var v=i[n.KHR_MATERIALS_CLEARCOAT];t=v.getMaterialType(),u.push(v.extendParams(s,{extensions:c},r))}return Promise.all(u).then((function(){var e;return e=t===f?i[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new t(s),a.name&&(e.name=a.name),e.map&&(e.map.encoding=l["sRGBEncoding"]),e.emissiveMap&&(e.emissiveMap.encoding=l["sRGBEncoding"]),C(e,a),a.extensions&&O(i,e,a),e}))},F.prototype.loadGeometries=function(e){var t=this,r=this.extensions,o=this.primitiveCache;function i(e){return r[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return H(n,e,t)}))}for(var a=[],s=0,c=e.length;s<c;s++){var u,d=e[s],p=D(d),h=o[p];if(h)a.push(h.promise);else u=d.extensions&&d.extensions[n.KHR_DRACO_MESH_COMPRESSION]?i(d):H(new l["BufferGeometry"],d,t),o[p]={primitive:d,promise:u},a.push(u)}return Promise.all(a)},F.prototype.loadMesh=function(e){for(var t=this,n=this.json,r=n.meshes[e],o=r.primitives,i=[],a=0,s=o.length;a<s;a++){var c=void 0===o[a].material?R(this.cache):this.getDependency("material",o[a].material);i.push(c)}return i.push(t.loadGeometries(o)),Promise.all(i).then((function(n){for(var i=n.slice(0,n.length-1),a=n[n.length-1],s=[],c=0,u=a.length;c<u;c++){var d,p=a[c],h=o[c],f=i[c];if(h.mode===_.TRIANGLES||h.mode===_.TRIANGLE_STRIP||h.mode===_.TRIANGLE_FAN||void 0===h.mode)d=!0===r.isSkinnedMesh?new l["SkinnedMesh"](p,f):new l["Mesh"](p,f),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),h.mode===_.TRIANGLE_STRIP?d.geometry=B(d.geometry,l["TriangleStripDrawMode"]):h.mode===_.TRIANGLE_FAN&&(d.geometry=B(d.geometry,l["TriangleFanDrawMode"]));else if(h.mode===_.LINES)d=new l["LineSegments"](p,f);else if(h.mode===_.LINE_STRIP)d=new l["Line"](p,f);else if(h.mode===_.LINE_LOOP)d=new l["LineLoop"](p,f);else{if(h.mode!==_.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);d=new l["Points"](p,f)}Object.keys(d.geometry.morphAttributes).length>0&&k(d,r),d.name=r.name||"mesh_"+e,a.length>1&&(d.name+="_"+c),C(d,r),t.assignFinalMaterial(d),s.push(d)}if(1===s.length)return s[0];var m=new l["Group"];for(c=0,u=s.length;c<u;c++)m.add(s[c]);return m}))},F.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new l["PerspectiveCamera"](l["MathUtils"].radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new l["OrthographicCamera"](r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar)),n.name&&(t.name=n.name),C(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},F.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},F.prototype.loadAnimation=function(e){for(var t=this.json,n=t.animations[e],r=[],o=[],i=[],a=[],s=[],c=0,u=n.channels.length;c<u;c++){var d=n.channels[c],p=n.samplers[d.sampler],h=d.target,f=void 0!==h.node?h.node:h.id,m=void 0!==n.parameters?n.parameters[p.input]:p.input,g=void 0!==n.parameters?n.parameters[p.output]:p.output;r.push(this.getDependency("node",f)),o.push(this.getDependency("accessor",m)),i.push(this.getDependency("accessor",g)),a.push(p),s.push(h)}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(i),Promise.all(a),Promise.all(s)]).then((function(t){for(var r=t[0],o=t[1],i=t[2],a=t[3],s=t[4],c=[],u=0,d=r.length;u<d;u++){var p=r[u],h=o[u],f=i[u],m=a[u],g=s[u];if(void 0!==p){var _;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,E[g.path]){case E.weights:_=l["NumberKeyframeTrack"];break;case E.rotation:_=l["QuaternionKeyframeTrack"];break;case E.position:case E.scale:default:_=l["VectorKeyframeTrack"];break}var b=p.name?p.name:p.uuid,y=void 0!==m.interpolation?L[m.interpolation]:l["InterpolateLinear"],w=[];E[g.path]===E.weights?p.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&w.push(e.name?e.name:e.uuid)})):w.push(b);var S=f.array;if(f.normalized){var x;if(S.constructor===Int8Array)x=1/127;else if(S.constructor===Uint8Array)x=1/255;else if(S.constructor==Int16Array)x=1/32767;else{if(S.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");x=1/65535}for(var A=new Float32Array(S.length),T=0,M=S.length;T<M;T++)A[T]=S[T]*x;S=A}for(T=0,M=w.length;T<M;T++){var R=new _(w[T]+"."+E[g.path],h.array,S,y);"CUBICSPLINE"===m.interpolation&&(R.createInterpolant=function(e){return new v(this.times,this.values,this.getValueSize()/3,e)},R.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(R)}}}var O=n.name?n.name:"animation_"+e;return new l["AnimationClip"](O,void 0,c)}))},F.prototype.loadNode=function(e){var t=this.json,r=this.extensions,o=this,i=t.meshReferences,a=t.meshUses,s=t.nodes[e];return function(){var e=[];return void 0!==s.mesh&&e.push(o.getDependency("mesh",s.mesh).then((function(e){var t;if(i[s.mesh]>1){var n=a[s.mesh]++;t=e.clone(),t.name+="_instance_"+n}else t=e;return void 0!==s.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=s.weights.length;t<n;t++)e.morphTargetInfluences[t]=s.weights[t]})),t}))),void 0!==s.camera&&e.push(o.getDependency("camera",s.camera)),s.extensions&&s.extensions[n.KHR_LIGHTS_PUNCTUAL]&&void 0!==s.extensions[n.KHR_LIGHTS_PUNCTUAL].light&&e.push(o.getDependency("light",s.extensions[n.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(e)}().then((function(e){var t;if(t=!0===s.isBone?new l["Bone"]:e.length>1?new l["Group"]:1===e.length?e[0]:new l["Object3D"],t!==e[0])for(var n=0,o=e.length;n<o;n++)t.add(e[n]);if(s.name&&(t.userData.name=s.name,t.name=l["PropertyBinding"].sanitizeNodeName(s.name)),C(t,s),s.extensions&&O(r,t,s),void 0!==s.matrix){var i=new l["Matrix4"];i.fromArray(s.matrix),t.applyMatrix4(i)}else void 0!==s.translation&&t.position.fromArray(s.translation),void 0!==s.rotation&&t.quaternion.fromArray(s.rotation),void 0!==s.scale&&t.scale.fromArray(s.scale);return t}))},F.prototype.loadScene=function(){function e(t,n,r,o){var i=r.nodes[t];return o.getDependency("node",t).then((function(e){return void 0===i.skin?e:o.getDependency("skin",i.skin).then((function(e){t=e;for(var n=[],r=0,i=t.joints.length;r<i;r++)n.push(o.getDependency("node",t.joints[r]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var r=[],o=[],i=0,a=n.length;i<a;i++){var s=n[i];if(s){r.push(s);var c=new l["Matrix4"];void 0!==t.inverseBindMatrices&&c.fromArray(t.inverseBindMatrices.array,16*i),o.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[i])}e.bind(new l["Skeleton"](r,o),e.matrixWorld)}})),e}));var t})).then((function(t){n.add(t);var a=[];if(i.children)for(var s=i.children,l=0,c=s.length;l<c;l++){var u=s[l];a.push(e(u,t,r,o))}return Promise.all(a)}))}return function(t){var n=this.json,r=this.extensions,o=this.json.scenes[t],i=this,a=new l["Group"];o.name&&(a.name=o.name),C(a,o),o.extensions&&O(r,a,o);for(var s=o.nodes||[],c=[],u=0,d=s.length;u<d;u++)c.push(e(s[u],a,n,i));return Promise.all(c).then((function(){return a}))}}(),e}()),Jt=function(){function e(){Object(a["a"])(this,e)}return Object(s["a"])(e,[{key:"loadTexture",value:function(e){var t=new l["TextureLoader"];return new Promise((function(n){t.load(e,(function(e){n(e)}))}))}},{key:"importGLTF",value:function(e){var t,n;Array.from(e).forEach((function(e){var r=Object(Wt["a"])(e,2),o=r[0],i=r[1];i.name.match(/\.(gltf|glb)$/)&&(t=i,n=o.replace(i.name,""))})),t||console.error("No .gltf or .glb asset found.");var r="string"===typeof t?t:URL.createObjectURL(t);return this.loadLocalGLTF(r,n,e)}},{key:"loadLocalGLTF",value:function(e,t,n){var r=l["LoaderUtils"].extractUrlBase(e);return new Promise((function(o,i){var a=new l["LoadingManager"];a.setURLModifier((function(e,o){var i=t+e.replace(r,"").replace(/^(\.?\/)/,"");if(n.has(i)){var a=n.get(i),s=URL.createObjectURL(a);return c.push(s),s}return(o||"")+e}));var s=new qt(a);s.setCrossOrigin("anonymous");var c=[];s.load(e,(function(e){o(e)}),void 0,i)}))}},{key:"loadGLTF",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"scene.gltf",n=new qt;return n.setPath(e),new Promise((function(e){n.load(t,(function(t){e(t)}))}))}}]),e}(),Zt=n("8792"),Qt={name:"container",data:function(){return{openImportPage:!0}},mounted:function(){this.initEvent()},methods:{initScene:function(e){var t=document.querySelector("#canvasContainer");this.scene=new Yt(t,e,(function(){document.querySelector("#wrapper").classList.remove("isLoading")}))},initEvent:function(){var e=this,t=this,n=new Jt,r=document.body.querySelector("#file-input"),o=document.body.querySelector(".dropzone"),i=new Zt["a"](o,r);i.on("drop",(function(r){var o=r.files;return n.importGLTF(o).then((function(n){e.initScene(n),t.openImportPage=!1}))}))},loadDefaultMode:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"./assets/models/DamagedHelmet/",n=new Jt;this.openImportPage=!1,n.loadGLTF(t).then((function(t){e.initScene(t)}))}}},$t=Qt,en=(n("8aaa"),n("2877")),tn=Object(en["a"])($t,o,i,!1,null,null,null),nn=tn.exports;new r["a"]({render:function(e){return e(nn)}}).$mount("#container")},"8aaa":function(e,t,n){"use strict";var r=n("3468"),o=n.n(r);o.a}});
//# sourceMappingURL=app.73b2ac78.js.map